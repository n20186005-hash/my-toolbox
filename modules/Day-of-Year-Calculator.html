<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Day of Year Calculator Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #fff7ed; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="doy_calc" 
         data-category="date" 
         data-title="Day of Year Calculator" 
         data-icon="üìÖ">
        
        <div class="absolute top-4 right-4">
            <select id="doy-lang" onchange="DayOfYear.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en">English</option>
                <option value="zh-CN">Á∞°È´î‰∏≠Êñá</option>
                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">üìÖ Day of Year Calculator</h2>
        
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="lbl_date">Select Date</label>
            <input type="date" id="doy-date" class="w-full p-2 border rounded focus:ring-2 focus:ring-orange-500 outline-none" onchange="DayOfYear.calc()">
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-orange-50 p-3 rounded border border-orange-100 text-center">
                <span class="text-xs text-gray-500 uppercase" data-i18n="res_nth">Day of Year</span>
                <div id="val-nth" class="text-3xl font-bold text-orange-600 mt-1">--</div>
            </div>
            <div class="bg-gray-50 p-3 rounded border border-gray-200 text-center">
                <span class="text-xs text-gray-500 uppercase" data-i18n="res_remain">Days Remaining</span>
                <div id="val-remain" class="text-3xl font-bold text-gray-700 mt-1">--</div>
            </div>
        </div>

        <div class="mt-4 p-3 bg-white border border-gray-100 rounded shadow-sm text-center">
            <span class="text-sm text-gray-600">
                <span data-i18n="res_week">Week Number:</span> 
                <span id="val-week" class="font-bold text-gray-900 ml-1">--</span>
            </span>
            <div id="val-leap" class="text-xs text-orange-400 mt-1"></div>
        </div>
    </div>

    <script>
        const DayOfYear = {
            i18n: {
                'en': {
                    title: 'üìÖ Day of Year Calculator',
                    lbl_date: 'Select Date',
                    res_nth: 'Day of Year',
                    res_remain: 'Days Remaining',
                    res_week: 'Week Number:',
                    msg_leap: '{y} is a Leap Year (366 days)',
                    msg_norm: '{y} is a Normal Year (365 days)'
                },
                'zh-CN': {
                    title: 'üìÖ ‰∏ÄÂπ¥‰∏≠ÁöÑÁ¨¨Âá†Â§©',
                    lbl_date: 'ÈÄâÊã©Êó•Êúü',
                    res_nth: 'Á¨¨Âá†Â§©',
                    res_remain: 'Ââ©‰ΩôÂ§©Êï∞',
                    res_week: 'Á¨¨Âá†Âë®:',
                    msg_leap: '{y} ÊòØÈó∞Âπ¥ (366Â§©)',
                    msg_norm: '{y} ÊòØÂπ≥Âπ¥ (365Â§©)'
                },
                'zh-TW': {
                    title: 'üìÖ ‰∏ÄÂπ¥‰∏≠ÁöÑÁ¨¨ÂπæÂ§©',
                    lbl_date: 'ÈÅ∏ÊìáÊó•Êúü',
                    res_nth: 'Á¨¨ÂπæÂ§©',
                    res_remain: 'Ââ©È§òÂ§©Êï∏',
                    res_week: 'Á¨¨ÂπæÈÄ±:',
                    msg_leap: '{y} ÊòØÈñèÂπ¥ (366Â§©)',
                    msg_norm: '{y} ÊòØÂπ≥Âπ¥ (365Â§©)'
                },
                'ja': {
                    title: 'üìÖ Âπ¥ÈñìÈÄöÁÆóÊó•Ë®àÁÆó',
                    lbl_date: 'Êó•‰ªòÈÅ∏Êäû',
                    res_nth: 'ÈÄöÁÆóÊó•Êï∞',
                    res_remain: 'ÊÆã„ÇäÊó•Êï∞',
                    res_week: 'ÈÄ±Áï™Âè∑:',
                    msg_leap: '{y}Âπ¥„ÅØ„ÅÜ„Çã„ÅÜÂπ¥ (366Êó•)',
                    msg_norm: '{y}Âπ¥„ÅØÂπ≥Âπ¥ (365Êó•)'
                },
                'ru': {
                    title: 'üìÖ –î–µ–Ω—å –≤ –≥–æ–¥—É',
                    lbl_date: '–î–∞—Ç–∞',
                    res_nth: '–î–µ–Ω—å –≥–æ–¥–∞',
                    res_remain: '–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π',
                    res_week: '–ù–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏:',
                    msg_leap: '{y} - –≤–∏—Å–æ–∫–æ—Å–Ω—ã–π (366 –¥–Ω.)',
                    msg_norm: '{y} - –æ–±—ã—á–Ω—ã–π (365 –¥–Ω.)'
                },
                'es': {
                    title: 'üìÖ D√≠a del A√±o',
                    lbl_date: 'Seleccionar Fecha',
                    res_nth: 'D√≠a del A√±o',
                    res_remain: 'D√≠as Restantes',
                    res_week: 'Semana:',
                    msg_leap: '{y} es A√±o Bisiesto',
                    msg_norm: '{y} es A√±o Normal'
                }
            },

            changeLang: () => {
                const lang = document.getElementById('doy-lang').value;
                const texts = DayOfYear.i18n[lang];
                const elements = document.querySelectorAll('[data-id="doy_calc"] [data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });
                DayOfYear.calc();
            },

            isLeap: (year) => {
                return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
            },

            getWeekNumber: (d) => {
                // ISO 8601 week number
                d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
                d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
                var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
                var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
                return weekNo;
            },

            calc: () => {
                const dateVal = document.getElementById('doy-date').value;
                if (!dateVal) return;

                const date = new Date(dateVal);
                const year = date.getFullYear();
                const start = new Date(year, 0, 0); // Dec 31 previous year
                const diff = date - start;
                const oneDay = 1000 * 60 * 60 * 24;
                const dayOfYear = Math.floor(diff / oneDay);

                const isLeap = DayOfYear.isLeap(year);
                const totalDays = isLeap ? 366 : 365;
                const remaining = totalDays - dayOfYear;

                const lang = document.getElementById('doy-lang').value;
                const txt = DayOfYear.i18n[lang];

                document.getElementById('val-nth').innerText = dayOfYear;
                document.getElementById('val-remain').innerText = remaining;
                document.getElementById('val-week').innerText = DayOfYear.getWeekNumber(new Date(dateVal));
                
                const leapMsg = isLeap ? txt.msg_leap : txt.msg_norm;
                document.getElementById('val-leap').innerText = leapMsg.replace('{y}', year);
            }
        };

        // Init
        document.getElementById('doy-date').valueAsDate = new Date();
        DayOfYear.calc();
    </script>
</body>
</html>