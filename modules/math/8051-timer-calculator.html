<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Category Meta Tag -->
    <meta name="category" content="engineering">
    <meta name="icon" content="ğŸ’¾">
    <meta name="description" content="8051 Timer Calculator - Calculate reload values (THx/TLx) for Mode 0, 1, 2, 3 with 12T/6T support.">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect x=%2220%22 y=%2220%22 width=%2260%22 height=%2260%22 rx=%225%22 fill=%22none%22 stroke=%22%238b5cf6%22 stroke-width=%226%22/><path d=%22M30,80 L30,90 M40,80 L40,90 M50,80 L50,90 M60,80 L60,90 M70,80 L70,90%22 stroke=%22%238b5cf6%22 stroke-width=%224%22/></svg>">
    
    <title>51å•ç‰‡æœºå®šæ—¶å™¨è®¡ç®—å™¨ | MCU Timer Pro</title>
    
    <link rel="canonical" href="https://toolboxpro.top/modules/math/8051-timer-calculator.html" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#8b5cf6', hover: '#7c3aed' }, /* Violet */
                        secondary: { DEFAULT: '#3b82f6', hover: '#2563eb' }, /* Blue */
                        bg: { light: '#f5f3ff', dark: '#0f172a' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .glass {
                @apply bg-white/90 dark:bg-slate-800/90 backdrop-blur-lg border border-violet-200 dark:border-slate-700;
            }
            .input-group {
                @apply relative flex items-center;
            }
            .input-field {
                @apply w-full pl-3 pr-10 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all text-sm font-mono placeholder:text-slate-400;
            }
            .unit-label {
                @apply absolute right-3 text-slate-400 text-xs font-bold pointer-events-none;
            }
            .btn-primary {
                @apply bg-gradient-to-r from-violet-500 to-indigo-600 hover:from-violet-600 hover:to-indigo-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg shadow-violet-500/20 transition-all active:scale-95 flex items-center justify-center gap-2 text-sm;
            }
            .btn-secondary {
                @apply bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-medium py-2 px-4 rounded-xl transition-all text-sm;
            }
            .reg-box {
                @apply flex flex-col items-center justify-center p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50;
            }
            .reg-title {
                @apply text-[10px] font-bold text-slate-400 uppercase mb-1;
            }
            .reg-val {
                @apply font-mono font-bold text-lg text-violet-600 dark:text-violet-400;
            }
            .chip-btn {
                @apply px-3 py-1.5 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-xs font-bold cursor-pointer hover:border-violet-400 hover:text-violet-600 transition-all flex-1 text-center;
            }
            .chip-btn.active {
                @apply bg-violet-50 dark:bg-violet-900/30 border-violet-500 text-violet-700 dark:text-violet-400 ring-1 ring-violet-500/50;
            }
            
            /* Reference Table Styles */
            .ref-table {
                @apply w-full text-xs border-collapse;
            }
            .ref-table th, .ref-table td {
                @apply border border-slate-200 dark:border-slate-700 p-2 text-left text-slate-600 dark:text-slate-300;
            }
            .ref-table th {
                @apply bg-slate-100 dark:bg-slate-800 font-bold text-slate-700 dark:text-slate-200;
            }
        }
    </style>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9279583389810634"
     crossorigin="anonymous"></script>

</head>
<body class="bg-bg-light dark:bg-bg-dark min-h-screen font-sans text-slate-800 dark:text-slate-200 transition-colors duration-300 overflow-x-hidden">

    <!-- Header -->
    <header class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-violet-500 to-indigo-600 text-white flex items-center justify-center font-bold text-xs shadow-md">
                    MCU
                </div>
                <div>
                    <h1 class="text-lg font-bold text-slate-900 dark:text-white leading-tight" data-i18n="title">51å•ç‰‡æœºå®šæ—¶å™¨è®¡ç®—å™¨</h1>
                    <p class="text-[10px] text-slate-500 font-medium" data-i18n="subtitle">8051 Timer Reload Value Calculator</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <select id="lang-selector" class="bg-slate-100 dark:bg-slate-700 text-xs font-bold px-2 py-1.5 rounded-lg border-none focus:ring-0 cursor-pointer text-slate-600 dark:text-slate-300">
                    <option value="zh-CN">ä¸­æ–‡</option>
                    <option value="en">EN</option>
                </select>
                <button id="mode-toggle" class="w-8 h-8 rounded-lg bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-500 hover:text-primary transition-colors">
                    <i class="fa fa-moon-o dark:hidden"></i>
                    <i class="fa fa-sun-o hidden dark:inline"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6 max-w-6xl grid lg:grid-cols-12 gap-6">
        
        <!-- Input Panel -->
        <div class="lg:col-span-5 space-y-6">
            <div class="glass rounded-2xl p-5 shadow-sm border-t-4 border-t-violet-500">
                
                <h3 class="text-sm font-bold text-slate-500 uppercase mb-4 flex items-center gap-2">
                    <i class="fa fa-sliders"></i> <span data-i18n="h_inputs">å‚æ•°é…ç½®</span>
                </h3>

                <div class="space-y-4">
                    <!-- Clock Cycle Selection -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lbl_clock">æ—¶é’Ÿå‘¨æœŸ (Clock):</label>
                        <select id="inp-clock" class="input-field cursor-pointer" onchange="App.calculate()">
                            <option value="12" selected data-i18n="opt_12t">æ ‡å‡† 12T (Standard)</option>
                            <option value="6" data-i18n="opt_6t">åŠ å¼º 6T (Enhanced)</option>
                        </select>
                    </div>

                    <!-- Crystal Freq -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lbl_freq">æ™¶æŒ¯é¢‘ç‡ (Crystal):</label>
                        <div class="flex gap-2 mb-2">
                            <button class="chip-btn active" onclick="App.setFreq(11.0592)" id="btn-f-11">11.0592</button>
                            <button class="chip-btn" onclick="App.setFreq(12)" id="btn-f-12">12.000</button>
                            <button class="chip-btn" onclick="App.setFreq(24)" id="btn-f-24">24.000</button>
                        </div>
                        <div class="input-group">
                            <input type="number" id="inp-freq" class="input-field" value="11.0592" oninput="App.calculate()">
                            <span class="unit-label">MHz</span>
                        </div>
                    </div>

                    <!-- Timer Mode -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lbl_mode">å®šæ—¶å™¨æ¨¡å¼ (Mode):</label>
                        <select id="inp-mode" class="input-field cursor-pointer" onchange="App.calculate()">
                            <option value="0" data-i18n="opt_m0">æ–¹å¼ 0 (13-bit)</option>
                            <option value="1" selected data-i18n="opt_m1">æ–¹å¼ 1 (16-bit)</option>
                            <option value="2" data-i18n="opt_m2">æ–¹å¼ 2 (8-bit Auto)</option>
                            <option value="3" data-i18n="opt_m3">æ–¹å¼ 3 (Split 8-bit)</option>
                        </select>
                    </div>

                    <!-- Target Time -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lbl_time">ç›®æ ‡å®šæ—¶æ—¶é—´ (Timing):</label>
                        <div class="flex gap-2">
                            <div class="input-group flex-grow">
                                <input type="number" id="inp-time" class="input-field" value="50" oninput="App.calculate()">
                            </div>
                            <select id="inp-unit" class="bg-slate-100 dark:bg-slate-700 text-xs font-bold px-2 rounded-lg border-none focus:ring-0 cursor-pointer w-20 text-center" onchange="App.calculate()">
                                <option value="us">us</option>
                                <option value="ms" selected>ms</option>
                                <option value="s">s</option>
                            </select>
                        </div>
                    </div>

                    <button onclick="App.calculate()" class="btn-primary w-full mt-2">
                        <span data-i18n="btn_calc">è®¡ç®—åˆå€¼</span>
                    </button>
                </div>
            </div>

            <!-- Machine Cycle Info -->
            <div class="bg-slate-100 dark:bg-slate-800 rounded-xl p-4 flex justify-between items-center text-xs">
                <span class="text-slate-500"><span data-i18n="lbl_cycle_info">æœºå™¨å‘¨æœŸ (uS):</span></span>
                <span id="res-cycle" class="font-mono font-bold text-slate-700 dark:text-slate-300">- us</span>
            </div>
        </div>

        <!-- Output Panel -->
        <div class="lg:col-span-7 space-y-6">
            
            <!-- Result Box -->
            <div class="glass rounded-2xl shadow-sm border-t-4 border-t-indigo-500 p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wide" data-i18n="h_result">è®¡ç®—ç»“æœ (Results)</h3>
                    <div id="status-badge" class="px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-100 text-emerald-700">OK</div>
                </div>
                
                <!-- Hex Result -->
                <div class="text-center mb-8">
                    <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block" data-i18n="lbl_hex">åˆå€¼ (HEX)</label>
                    <div id="res-hex" class="text-4xl md:text-5xl font-mono font-bold text-indigo-600 dark:text-indigo-400 tracking-wider">
                        ----
                    </div>
                    <div class="text-xs text-slate-400 mt-2">
                        Decimal: <span id="res-dec" class="font-mono text-slate-600 dark:text-slate-300">-</span>
                    </div>
                </div>

                <!-- Registers -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="reg-box">
                        <span class="reg-title">THx (High Byte)</span>
                        <span id="res-th-hex" class="reg-val">0x--</span>
                        <span id="res-th-dec" class="text-[10px] text-slate-400 font-mono">Dec: -</span>
                    </div>
                    <div class="reg-box">
                        <span class="reg-title">TLx (Low Byte)</span>
                        <span id="res-tl-hex" class="reg-val">0x--</span>
                        <span id="res-tl-dec" class="text-[10px] text-slate-400 font-mono">Dec: -</span>
                    </div>
                </div>

                <!-- Error & Max -->
                <div class="mt-6 pt-4 border-t border-slate-100 dark:border-slate-700/50">
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-slate-500" data-i18n="lbl_max_time">å½“å‰æ¨¡å¼æœ€å¤§å®šæ—¶:</span>
                        <span id="res-max-time" class="font-mono font-bold text-slate-700 dark:text-slate-200">-</span>
                    </div>
                    <div id="error-msg" class="mt-2 text-xs text-red-500 font-bold text-center hidden">
                        <i class="fa fa-exclamation-circle"></i> <span data-i18n="err_overflow">æ—¶é—´è¶…å‡ºèŒƒå›´ (Overflow)</span>
                    </div>
                </div>
            </div>

            <!-- C Code Snippet -->
            <div class="glass rounded-2xl p-4 bg-slate-900 border border-slate-700">
                <div class="flex justify-between items-center mb-2">
                    <h4 class="text-[10px] font-bold text-slate-400 uppercase">C Code Example</h4>
                    <button class="text-slate-400 hover:text-white" onclick="App.copyCode()">
                        <i class="fa fa-copy"></i>
                    </button>
                </div>
                <pre class="font-mono text-xs text-emerald-400 overflow-x-auto whitespace-pre-wrap" id="code-block">
// Timer Init
TMOD &= 0xF0; // Clear T0 bits
TMOD |= 0x01; // Set Mode 1
TH0 = 0xXX;
TL0 = 0xXX;
TR0 = 1;      // Start Timer
                </pre>
            </div>

        </div>
    </div>

    <!-- Guide Section -->
    <section class="container mx-auto px-4 mb-12 max-w-6xl">
        <div class="glass rounded-2xl p-8 shadow-xl">
            <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2">
                <i class="fa fa-book text-primary"></i> <span data-i18n="guide_title">è®¡ç®—å…¬å¼ä¸å‚è€ƒæ•°æ®</span>
            </h2>
            
            <div class="space-y-6 text-sm text-slate-600 dark:text-slate-300">
                
                <!-- Reference Table -->
                <div class="overflow-x-auto">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th data-i18n="th_item">å‚æ•°é¡¹</th>
                                <th data-i18n="th_12t">æ ‡å‡† 12T (Standard)</th>
                                <th data-i18n="th_6t">åŠ å¼º 6T (Enhanced)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td data-i18n="td_machine_cycle">æ—¶é—´å•å®šæ—¶å™¨ (uSec)</td>
                                <td class="font-mono">1 / (MHz/12)</td>
                                <td class="font-mono">1 / (MHz/6)</td>
                            </tr>
                            <tr>
                                <td data-i18n="td_max_8bit">8ä½å®šæ—¶æœ€å¤§æ—¶é—´ (mSec)</td>
                                <td class="font-mono">TIC12 * 256 / 1000</td>
                                <td class="font-mono">TIC6 * 256 / 1000</td>
                            </tr>
                            <tr>
                                <td data-i18n="td_max_16bit">16ä½å®šæ—¶æœ€å¤§æ—¶é—´ (mSec)</td>
                                <td class="font-mono">TIC12 * 65536 / 1000</td>
                                <td class="font-mono">TIC6 * 65536 / 1000</td>
                            </tr>
                             <tr>
                                <td data-i18n="td_reload_8bit">8ä½é‡è®¡æ•°å€¼</td>
                                <td class="font-mono">256 - (DRT / TIC12 * 1000)</td>
                                <td class="font-mono">256 - (DRT / TIC6 * 1000)</td>
                            </tr>
                            <tr>
                                <td data-i18n="td_reload_16bit">16ä½é‡è®¡æ•°å€¼</td>
                                <td class="font-mono">65536 - (DRT / TIC12 * 1000)</td>
                                <td class="font-mono">65536 - (DRT / TIC6 * 1000)</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="text-[10px] mt-2 text-slate-400 italic">
                        * TIC = Machine Cycle (uS), DRT = Desired Run Time (mS), MHz = Crystal Frequency.
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8 pt-4 border-t border-slate-200 dark:border-slate-700">
                    <div class="space-y-2">
                        <h3 class="font-bold text-slate-800 dark:text-slate-200" data-i18n="h_mode0">æ–¹å¼ 0 (13ä½)</h3>
                        <p class="text-xs" data-i18n="p_mode0">13ä½å®šæ—¶è®¡æ•°æ–¹å¼ã€‚è®¡æ•°å™¨ç”± THx çš„ 8 ä½å’Œ TLx çš„ä½ 5 ä½ç»„æˆã€‚TLx çš„é«˜ 3 ä½æœªç”¨ã€‚æœ€å¤§è®¡æ•° 8192ã€‚</p>
                        
                        <h3 class="font-bold text-slate-800 dark:text-slate-200 mt-4" data-i18n="h_mode1">æ–¹å¼ 1 (16ä½) - æœ€å¸¸ç”¨</h3>
                        <p class="text-xs" data-i18n="p_mode1">16ä½å®šæ—¶è®¡æ•°æ–¹å¼ã€‚è®¡æ•°å™¨ç”± THx (8ä½) å’Œ TLx (8ä½) çº§è”ç»„æˆã€‚æœ€å¤§è®¡æ•° 65536ã€‚</p>
                    </div>

                    <div class="space-y-2">
                        <h3 class="font-bold text-slate-800 dark:text-slate-200" data-i18n="h_mode2">æ–¹å¼ 2 (8ä½è‡ªåŠ¨é‡è£…)</h3>
                        <p class="text-xs" data-i18n="p_mode2">8ä½è‡ªåŠ¨é‡è£…åˆå€¼æ–¹å¼ã€‚TLx è®¡æ•°ï¼Œæº¢å‡ºåè‡ªåŠ¨å°† THx çš„å€¼é‡è£…å…¥ TLxã€‚æœ€å¤§è®¡æ•° 256ã€‚å¸¸ç”¨äºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨ã€‚</p>
                        
                        <h3 class="font-bold text-slate-800 dark:text-slate-200 mt-4" data-i18n="h_mode3">æ–¹å¼ 3 (åŒ8ä½)</h3>
                        <p class="text-xs" data-i18n="p_mode3">åªé€‚ç”¨ T0ã€‚æŠŠ 16ä½çš„ T0 åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ 8ä½è®¡æ•°å™¨ TH0 å’Œ TL0ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="text-center text-xs text-slate-400 py-6">
        <p>&copy; <span id="year"></span> 8051 Timer Calculator. Generated for Educational Purposes.</p>
    </footer>

    <script>
        const i18nData = {
            'zh-CN': {
                title: "51å•ç‰‡æœºå®šæ—¶å™¨è®¡ç®—å™¨", subtitle: "8051 å®šæ—¶å™¨åˆå€¼è®¡ç®—å·¥å…·",
                h_inputs: "å‚æ•°é…ç½®", lbl_freq: "æ™¶æŒ¯é¢‘ç‡ (Crystal):", lbl_mode: "å®šæ—¶å™¨æ¨¡å¼ (Mode):", lbl_time: "ç›®æ ‡å®šæ—¶æ—¶é—´ (Timing):",
                lbl_clock: "æ—¶é’Ÿå‘¨æœŸ (Clock):", opt_12t: "æ ‡å‡† 12T (Standard)", opt_6t: "åŠ å¼º 6T (Enhanced)",
                opt_m0: "æ–¹å¼ 0 (13ä½)", opt_m1: "æ–¹å¼ 1 (16ä½)", opt_m2: "æ–¹å¼ 2 (8ä½è‡ªåŠ¨é‡è£…)", opt_m3: "æ–¹å¼ 3 (åŒ8ä½)",
                btn_calc: "è®¡ç®—åˆå€¼", lbl_cycle_info: "æœºå™¨å‘¨æœŸ (uS):",
                h_result: "è®¡ç®—ç»“æœ (Results)", lbl_hex: "åˆå€¼ (HEX)", lbl_max_time: "å½“å‰æ¨¡å¼æœ€å¤§å®šæ—¶:",
                err_overflow: "æ—¶é—´è¶…å‡ºèŒƒå›´ (Overflow)",
                
                guide_title: "è®¡ç®—å…¬å¼ä¸å‚è€ƒæ•°æ®",
                th_item: "å‚æ•°é¡¹", th_12t: "æ ‡å‡† 12T (Standard)", th_6t: "åŠ å¼º 6T (Enhanced)",
                td_machine_cycle: "æ—¶é—´å•å®šæ—¶å™¨ (uSec)", td_max_8bit: "8ä½å®šæ—¶æœ€å¤§æ—¶é—´ (mSec)", td_max_16bit: "16ä½å®šæ—¶æœ€å¤§æ—¶é—´ (mSec)",
                td_reload_8bit: "8ä½é‡è®¡æ•°å€¼", td_reload_16bit: "16ä½é‡è®¡æ•°å€¼",

                h_mode0: "æ–¹å¼ 0 (13ä½)", p_mode0: "13ä½å®šæ—¶è®¡æ•°æ–¹å¼ã€‚è®¡æ•°å™¨ç”± THx çš„ 8 ä½å’Œ TLx çš„ä½ 5 ä½ç»„æˆã€‚TLx çš„é«˜ 3 ä½æœªç”¨ã€‚æœ€å¤§è®¡æ•° 8192ã€‚",
                h_mode1: "æ–¹å¼ 1 (16ä½) - æœ€å¸¸ç”¨", p_mode1: "16ä½å®šæ—¶è®¡æ•°æ–¹å¼ã€‚è®¡æ•°å™¨ç”± THx (8ä½) å’Œ TLx (8ä½) çº§è”ç»„æˆã€‚æœ€å¤§è®¡æ•° 65536ã€‚é€‚ç”¨äºé•¿å»¶æ—¶ã€‚",
                h_mode2: "æ–¹å¼ 2 (8ä½è‡ªåŠ¨é‡è£…)", p_mode2: "8ä½è‡ªåŠ¨é‡è£…åˆå€¼æ–¹å¼ã€‚TLx è®¡æ•°ï¼Œæº¢å‡ºåè‡ªåŠ¨å°† THx çš„å€¼é‡è£…å…¥ TLxã€‚æœ€å¤§è®¡æ•° 256ã€‚å¸¸ç”¨äºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨ï¼Œç²¾åº¦é«˜ï¼Œæ— éœ€è½¯ä»¶é‡è£…ã€‚",
                h_mode3: "æ–¹å¼ 3 (åŒ8ä½)", p_mode3: "åªé€‚ç”¨ T0ã€‚æŠŠ 16ä½çš„ T0 åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ 8ä½è®¡æ•°å™¨ TH0 å’Œ TL0ã€‚T1 åœ¨æ­¤æ¨¡å¼ä¸‹é€šå¸¸ä»…ä½œä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨ã€‚"
            },
            'en': {
                title: "8051 Timer Calculator", subtitle: "Timer Reload Value Tool",
                h_inputs: "Configuration", lbl_freq: "Crystal Freq:", lbl_mode: "Timer Mode:", lbl_time: "Target Time:",
                lbl_clock: "Clock Cycle:", opt_12t: "Standard 12T", opt_6t: "Enhanced 6T",
                opt_m0: "Mode 0 (13-bit)", opt_m1: "Mode 1 (16-bit)", opt_m2: "Mode 2 (8-bit Auto-Reload)", opt_m3: "Mode 3 (Split 8-bit)",
                btn_calc: "Calculate", lbl_cycle_info: "Machine Cycle (uS):",
                h_result: "Results", lbl_hex: "Reload Value (HEX)", lbl_max_time: "Max Time for Mode:",
                err_overflow: "Time Overflow",

                guide_title: "Formulas & Reference",
                th_item: "Item", th_12t: "Standard 12T", th_6t: "Enhanced 6T",
                td_machine_cycle: "Machine Cycle (uSec)", td_max_8bit: "Max Time 8-bit (mSec)", td_max_16bit: "Max Time 16-bit (mSec)",
                td_reload_8bit: "Reload Value (8-bit)", td_reload_16bit: "Reload Value (16-bit)",

                h_mode0: "Mode 0 (13-bit)", p_mode0: "13-bit timer. Uses 8 bits of THx and lower 5 bits of TLx. Max count 8192.",
                h_mode1: "Mode 1 (16-bit) - Common", p_mode1: "16-bit timer. Uses full THx (8-bit) and TLx (8-bit). Max count 65536. Best for general timing.",
                h_mode2: "Mode 2 (8-bit Auto)", p_mode2: "8-bit auto-reload. TLx counts, reloads from THx on overflow. Max 256. Ideal for baud rate generation.",
                h_mode3: "Mode 3 (Split)", p_mode3: "Only for T0. Splits T0 into two independent 8-bit counters (TH0, TL0). T1 is limited in this mode."
            }
        };

        const App = {
            lang: 'zh-CN',
            
            init() {
                this.setupLang();
                this.handleTheme();
                this.updateYear();
                this.calculate();
            },

            updateYear() {
                document.getElementById('year').textContent = new Date().getFullYear();
            },

            setupLang() {
                const sel = document.getElementById('lang-selector');
                const urlParams = new URLSearchParams(window.location.search);
                this.lang = urlParams.get('lang') || 'zh-CN';
                sel.value = this.lang;
                this.updateText();
                sel.addEventListener('change', (e) => {
                    this.lang = e.target.value;
                    try {
                        const newUrl = new URL(window.location);
                        newUrl.searchParams.set('lang', this.lang);
                        window.history.pushState({}, '', newUrl);
                    } catch (e) {}
                    this.updateText();
                    this.calculate(); // Re-calc error message
                });
            },

            updateText() {
                const dict = i18nData[this.lang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(dict[key]) el.innerHTML = dict[key];
                });
            },

            setFreq(val) {
                document.getElementById('inp-freq').value = val;
                ['11', '12', '24'].forEach(k => {
                    document.getElementById(`btn-f-${k}`).className = 'chip-btn';
                });
                const key = Math.floor(val) === 11 ? '11' : (val===12?'12':'24');
                document.getElementById(`btn-f-${key}`).className = 'chip-btn active';
                this.calculate();
            },

            calculate() {
                const freqMHz = parseFloat(document.getElementById('inp-freq').value);
                const clockType = parseInt(document.getElementById('inp-clock').value) || 12; // 12 or 6
                const mode = parseInt(document.getElementById('inp-mode').value);
                const timeVal = parseFloat(document.getElementById('inp-time').value);
                const timeUnit = document.getElementById('inp-unit').value;
                
                const resHex = document.getElementById('res-hex');
                const resDec = document.getElementById('res-dec');
                const resThHex = document.getElementById('res-th-hex');
                const resTlHex = document.getElementById('res-tl-hex');
                const resThDec = document.getElementById('res-th-dec');
                const resTlDec = document.getElementById('res-tl-dec');
                const resCycle = document.getElementById('res-cycle');
                const resMaxTime = document.getElementById('res-max-time');
                const errBox = document.getElementById('error-msg');
                const badge = document.getElementById('status-badge');
                const codeBlock = document.getElementById('code-block');

                if (isNaN(freqMHz) || freqMHz <= 0 || isNaN(timeVal) || timeVal < 0) {
                    resHex.textContent = '----';
                    return;
                }

                // 1. Calculate Machine Cycle
                // Tcy = N / F_osc (N = 12 for standard, 6 for enhanced)
                const t_machine_us = clockType / freqMHz; // us
                resCycle.textContent = t_machine_us.toFixed(3) + ' us';

                // 2. Convert Target Time to us
                let target_us = timeVal;
                if (timeUnit === 'ms') target_us *= 1000;
                if (timeUnit === 's') target_us *= 1000000;

                // 3. Determine Max Counts based on Mode
                let max_counts = 65536;
                if (mode === 0) max_counts = 8192; // 2^13
                else if (mode === 1) max_counts = 65536; // 2^16
                else if (mode === 2 || mode === 3) max_counts = 256; // 2^8

                const max_time_us = max_counts * t_machine_us;
                
                // Format Max Time nicely
                let max_time_str = '';
                if (max_time_us > 1000000) max_time_str = (max_time_us / 1000000).toFixed(2) + ' s';
                else if (max_time_us > 1000) max_time_str = (max_time_us / 1000).toFixed(2) + ' ms';
                else max_time_str = max_time_us.toFixed(1) + ' us';
                resMaxTime.textContent = max_time_str;

                // 4. Calculate Required Counts
                const counts_needed = target_us / t_machine_us;
                const rounded_counts = Math.round(counts_needed);

                if (rounded_counts > max_counts) {
                    badge.textContent = "Error";
                    badge.className = "px-2 py-0.5 rounded text-[10px] font-bold bg-red-100 text-red-700";
                    errBox.innerHTML = '<i class="fa fa-exclamation-circle"></i> ' + i18nData[this.lang].err_overflow;
                    errBox.classList.remove('hidden');
                    resHex.textContent = 'OVER';
                    resDec.textContent = '-';
                    return;
                } else {
                    badge.textContent = "OK";
                    badge.className = "px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-100 text-emerald-700";
                    errBox.classList.add('hidden');
                }

                // 5. Calculate Initial Value
                const init_dec = max_counts - rounded_counts;
                
                // 6. Split TH/TL
                let th, tl;
                if (mode === 0) {
                    // Mode 0: 13-bit.
                    tl = init_dec % 32;
                    th = Math.floor(init_dec / 32);
                } else if (mode === 2 || mode === 3) {
                    // 8-bit
                    th = init_dec;
                    tl = init_dec;
                } else {
                    // Mode 1: 16-bit
                    th = Math.floor(init_dec / 256);
                    tl = init_dec % 256;
                }

                // Render
                const toHex = (n) => n.toString(16).toUpperCase().padStart(2, '0');
                const hexVal = toHex(th) + toHex(tl);

                resHex.textContent = hexVal;
                resDec.textContent = init_dec;

                resThHex.textContent = '0x' + toHex(th);
                resTlHex.textContent = '0x' + toHex(tl);
                resThDec.textContent = 'Dec: ' + th;
                resTlDec.textContent = 'Dec: ' + tl;

                // Update Code Block
                let codeMode = `0x${(mode === 0 ? '00' : (mode === 1 ? '01' : (mode === 2 ? '02' : '03')))}`;
                let code = `// Timer0 Mode ${mode}, ${timeVal}${timeUnit} @ ${freqMHz}MHz (${clockType}T)\n`;
                code += `TMOD &= 0xF0; // Clear T0 bits\n`;
                code += `TMOD |= ${codeMode}; // Set Mode\n`;
                code += `TH0 = 0x${toHex(th)};\n`;
                code += `TL0 = 0x${toHex(tl)};\n`;
                code += `TR0 = 1;      // Start Timer`;
                codeBlock.textContent = code;
            },

            copyCode() {
                const code = document.getElementById('code-block').textContent;
                navigator.clipboard.writeText(code).then(() => {
                    alert('Code copied to clipboard!');
                });
            },

            handleTheme() {
                const toggle = document.getElementById('mode-toggle');
                const html = document.documentElement;
                if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    html.classList.add('dark');
                }
                toggle.addEventListener('click', () => {
                    html.classList.toggle('dark');
                    localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
     <!--  ç»“å°¾å¿…é¡»åŒ…å«çš„ä»£ç  -->
    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
</body>
</html>