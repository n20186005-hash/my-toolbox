<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permutation & Combination Calculator</title>
    
    <!-- åŸºç¡€ä¿¡æ¯ -->
    <meta name="tool-id" content="permutation_calc">
    <meta name="category" content="Math">
    <meta name="icon" content="ğŸ”¢">
    
    <!-- é»˜è®¤è‹±æ–‡å†…å®¹ -->
    <meta name="title" content="Permutation & Combination Calculator">
    <meta name="description" content="Calculate permutations, combinations and other related values for given sets of elements.">
    
    <!-- å¤šè¯­è¨€é…ç½® -->
    <meta name="lang-title-zh-CN" content="æ’åˆ—ç»„åˆè®¡ç®—å™¨">
    <meta name="lang-description-zh-CN" content="è®¡ç®—ç»™å®šå…ƒç´ é›†çš„æ’åˆ—æ•°ã€ç»„åˆæ•°å’Œå…¶ä»–ç›¸å…³å€¼ã€‚">
    
    <meta name="lang-title-zh-TW" content="æ’åˆ—çµ„åˆè¨ˆç®—å™¨">
    <meta name="lang-description-zh-TW" content="è¨ˆç®—çµ¦å®šå…ƒç´ é›†çš„æ’åˆ—æ•¸ã€çµ„åˆæ•¸å’Œå…¶ä»–ç›¸é—œå€¼ã€‚">
    
    <meta name="lang-title-ja" content="é †åˆ—çµ„åˆã›è¨ˆç®—ãƒ„ãƒ¼ãƒ«">
    <meta name="lang-description-ja" content="æŒ‡å®šã•ã‚ŒãŸè¦ç´ ã‚»ãƒƒãƒˆã®é †åˆ—ã€çµ„åˆã›ã€ãŠã‚ˆã³ãã®ä»–ã®é–¢é€£å€¤ã‚’è¨ˆç®—ã—ã¾ã™ã€‚">
    
    <meta name="lang-title-ru" content="ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğº Ğ¸ ÑĞ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ğ¹">
    <meta name="lang-description-ru" content="Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚Ğµ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸, ÑĞ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ² ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ².">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0f9ff; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto; position: relative; }
        .result-container { word-break: break-all; }
        .calc-option { padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; cursor: pointer; }
        .calc-option.active { border-color: #3b82f6; background-color: #eff6ff; }
        .option-label { font-weight: bold; margin-bottom: 5px; display: block; }
        .option-desc { font-size: 0.85rem; color: #666; }
        .formula { font-family: 'Courier New', monospace; background: #f8fafc; padding: 10px; border-radius: 6px; margin: 10px 0; }
        .result-card { background: #e6f4ea; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .result-label { font-size: 0.9rem; color: #4b5563; margin-bottom: 5px; }
        .result-value { font-size: 1.2rem; font-weight: bold; color: #1e40af; }
        .variables-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        @media (max-width: 600px) {
            .variables-grid { grid-template-columns: 1fr; }
        }
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/math/permutation-calculator.html" />

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9279583389810634"
     crossorigin="anonymous"></script>

</head>
<body>

    <div class="tool-module active" 
         data-id="permutation_calc" 
         data-category="calculators" 
         data-title="Permutation & Combination Calculator" 
         data-icon="ğŸ”¢">
        
        <!-- è¯­è¨€é€‰æ‹©å™¨ -->
        <div class="absolute top-4 right-4">
            <select id="perm-lang" onchange="PermCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en" selected>English</option>
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">ğŸ”¢ Permutation & Combination Calculator</h2>
        
        <div class="space-y-4 mb-6">
            <!-- è®¡ç®—ç±»å‹é€‰æ‹© -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="calc_type">Calculation Type</label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="calc-option active" onclick="PermCalc.setCalcType('permutation')" id="opt-permutation">
                        <div class="option-label" data-i18n="permutation">Permutation (nPr)</div>
                        <div class="option-desc" data-i18n="permutation_desc">Arrangements of r elements from n elements where order matters</div>
                    </div>
                    <div class="calc-option" onclick="PermCalc.setCalcType('combination')" id="opt-combination">
                        <div class="option-label" data-i18n="combination">Combination (nCr)</div>
                        <div class="option-desc" data-i18n="combination_desc">Selections of r elements from n elements where order doesn't matter</div>
                    </div>
                    <div class="calc-option" onclick="PermCalc.setCalcType('factorial')" id="opt-factorial">
                        <div class="option-label" data-i18n="factorial">Factorial (n!)</div>
                        <div class="option-desc" data-i18n="factorial_desc">Product of all positive integers up to n</div>
                    </div>
                    <div class="calc-option" onclick="PermCalc.setCalcType('permutation_rep')" id="opt-permutation-rep">
                        <div class="option-label" data-i18n="permutation_rep">Permutation with Repetition</div>
                        <div class="option-desc" data-i18n="permutation_rep_desc">Permutations where elements can be repeated</div>
                    </div>
                </div>
            </div>
            
            <!-- å˜é‡è¾“å…¥ -->
            <div class="variables-grid">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="total_elements">Total Elements (n)</label>
                    <input type="number" id="total-elements" min="1" value="10" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div id="selected-elements-container">
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="selected_elements">Elements to Choose (r)</label>
                    <input type="number" id="selected-elements" min="0" value="3" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div id="repetitions-container" class="hidden md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="repetitions">Repetitions (separated by commas)</label>
                    <input type="text" id="repetitions" placeholder="e.g. 2,3,4" value="2,3" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                    <div class="text-xs text-gray-500 mt-1" data-i18n="repetitions_note">Enter counts of identical elements (sum should equal n)</div>
                </div>
            </div>
            
            <!-- å…¬å¼å±•ç¤º -->
            <div>
                <div class="text-sm font-medium text-gray-700 mb-1" data-i18n="formula">Formula</div>
                <div class="formula" id="formula-display">P(n,r) = n! / (n-r)!</div>
            </div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <div class="flex gap-2 mt-4">
                <button onclick="PermCalc.loadSample()" class="flex-1 bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 transition" data-i18n="load_sample">Load Sample</button>
                <button onclick="PermCalc.clearForm()" class="flex-1 bg-gray-600 text-white py-2 rounded font-bold hover:bg-gray-700 transition" data-i18n="clear">Clear</button>
                <button onclick="PermCalc.calculate()" class="flex-2 bg-green-600 text-white py-2 rounded font-bold hover:bg-green-700 transition" data-i18n="calculate">Calculate</button>
            </div>
        </div>

        <!-- é”™è¯¯æç¤º -->
        <div id="perm-error" class="text-sm text-red-600 mt-2 hidden mb-4"></div>
        
        <!-- ç»“æœå±•ç¤º -->
        <div id="perm-results" class="hidden mt-4">
            <div class="text-sm text-gray-500 mb-2" data-i18n="results">Results</div>
            
            <div class="result-card">
                <div class="result-label" data-i18n="result_value">Result Value</div>
                <div class="result-value" id="result-value">--</div>
            </div>
            
            <div class="result-card">
                <div class="result-label" data-i18n="calculation_steps">Calculation Steps</div>
                <div id="calculation-steps" class="whitespace-pre-line">--</div>
            </div>
            
            <div id="additional-results" class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                <div class="result-card">
                    <div class="result-label" data-i18n="n_factorial">n! (Factorial of n)</div>
                    <div class="result-value" id="n-factorial">--</div>
                </div>
                <div id="r-factorial-container" class="result-card">
                    <div class="result-label" data-i18n="r_factorial">r! (Factorial of r)</div>
                    <div class="result-value" id="r-factorial">--</div>
                </div>
                <div id="nr-factorial-container" class="result-card">
                    <div class="result-label" data-i18n="nr_factorial">(n-r)! (Factorial of n-r)</div>
                    <div class="result-value" id="nr-factorial">--</div>
                </div>
            </div>
        </div>

        <!-- è¯´æ˜ä¿¡æ¯ -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600">
            <p data-i18n="notes">Notes:</p>
            <ul class="list-disc list-inside mt-2 space-y-1" data-i18n="notes_list">
                <li>Permutation (nPr) = n! / (n-r)!</li>
                <li>Combination (nCr) = n! / (r! Ã— (n-r)!)</li>
                <li>Factorial (n!) = 1 Ã— 2 Ã— 3 Ã— ... Ã— n</li>
                <li>Permutation with repetition = n! / (nâ‚! Ã— nâ‚‚! Ã— ... Ã— nk!)</li>
                <li>For large values, results may be displayed in scientific notation</li>
            </ul>
        </div>
    </div>

    <script>
        const PermCalc = {
            currentCalcType: 'permutation',
            
            i18n: {
                'en': {
                    title: 'ğŸ”¢ Permutation & Combination Calculator',
                    calc_type: 'Calculation Type',
                    permutation: 'Permutation (nPr)',
                    permutation_desc: 'Arrangements of r elements from n elements where order matters',
                    combination: 'Combination (nCr)',
                    combination_desc: 'Selections of r elements from n elements where order doesn\'t matter',
                    factorial: 'Factorial (n!)',
                    factorial_desc: 'Product of all positive integers up to n',
                    permutation_rep: 'Permutation with Repetition',
                    permutation_rep_desc: 'Permutations where elements can be repeated',
                    total_elements: 'Total Elements (n)',
                    selected_elements: 'Elements to Choose (r)',
                    repetitions: 'Repetitions (separated by commas)',
                    repetitions_note: 'Enter counts of identical elements (sum should equal n)',
                    formula: 'Formula',
                    load_sample: 'Load Sample',
                    clear: 'Clear',
                    calculate: 'Calculate',
                    results: 'Results',
                    result_value: 'Result Value',
                    calculation_steps: 'Calculation Steps',
                    n_factorial: 'n! (Factorial of n)',
                    r_factorial: 'r! (Factorial of r)',
                    nr_factorial: '(n-r)! (Factorial of n-r)',
                    notes: 'Notes:',
                    notes_list: `
                        <li>Permutation (nPr) = n! / (n-r)!</li>
                        <li>Combination (nCr) = n! / (r! Ã— (n-r)!)</li>
                        <li>Factorial (n!) = 1 Ã— 2 Ã— 3 Ã— ... Ã— n</li>
                        <li>Permutation with repetition = n! / (nâ‚! Ã— nâ‚‚! Ã— ... Ã— nk!)</li>
                        <li>For large values, results may be displayed in scientific notation</li>
                    `,
                    err_n_invalid: 'Total elements (n) must be a positive integer',
                    err_r_invalid: 'Selected elements (r) must be a non-negative integer',
                    err_r_larger_n: 'Selected elements (r) cannot be larger than total elements (n)',
                    err_repetitions_invalid: 'Repetitions must be positive integers separated by commas',
                    err_repetitions_sum: 'Sum of repetitions must equal total elements (n)',
                    err_no_repetitions: 'Please enter at least two repetition values'
                },
                'zh-CN': {
                    title: 'ğŸ”¢ æ’åˆ—ç»„åˆè®¡ç®—å™¨',
                    calc_type: 'è®¡ç®—ç±»å‹',
                    permutation: 'æ’åˆ— (nPr)',
                    permutation_desc: 'ä»nä¸ªå…ƒç´ ä¸­é€‰å–rä¸ªå…ƒç´ çš„æ’åˆ—ï¼Œè€ƒè™‘é¡ºåº',
                    combination: 'ç»„åˆ (nCr)',
                    combination_desc: 'ä»nä¸ªå…ƒç´ ä¸­é€‰å–rä¸ªå…ƒç´ çš„ç»„åˆï¼Œä¸è€ƒè™‘é¡ºåº',
                    factorial: 'é˜¶ä¹˜ (n!)',
                    factorial_desc: 'åˆ°nçš„æ‰€æœ‰æ­£æ•´æ•°çš„ä¹˜ç§¯',
                    permutation_rep: 'é‡å¤æ’åˆ—',
                    permutation_rep_desc: 'å…ƒç´ å¯ä»¥é‡å¤çš„æ’åˆ—',
                    total_elements: 'æ€»å…ƒç´ æ•° (n)',
                    selected_elements: 'é€‰æ‹©çš„å…ƒç´ æ•° (r)',
                    repetitions: 'é‡å¤æ¬¡æ•°ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰',
                    repetitions_note: 'è¾“å…¥ç›¸åŒå…ƒç´ çš„è®¡æ•°ï¼ˆæ€»å’Œåº”ç­‰äºnï¼‰',
                    formula: 'å…¬å¼',
                    load_sample: 'åŠ è½½ç¤ºä¾‹',
                    clear: 'æ¸…é™¤',
                    calculate: 'è®¡ç®—',
                    results: 'ç»“æœ',
                    result_value: 'ç»“æœå€¼',
                    calculation_steps: 'è®¡ç®—æ­¥éª¤',
                    n_factorial: 'n!ï¼ˆnçš„é˜¶ä¹˜ï¼‰',
                    r_factorial: 'r!ï¼ˆrçš„é˜¶ä¹˜ï¼‰',
                    nr_factorial: '(n-r)!ï¼ˆn-rçš„é˜¶ä¹˜ï¼‰',
                    notes: 'è¯´æ˜ï¼š',
                    notes_list: `
                        <li>æ’åˆ— (nPr) = n! / (n-r)!</li>
                        <li>ç»„åˆ (nCr) = n! / (r! Ã— (n-r)!)</li>
                        <li>é˜¶ä¹˜ (n!) = 1 Ã— 2 Ã— 3 Ã— ... Ã— n</li>
                        <li>é‡å¤æ’åˆ— = n! / (nâ‚! Ã— nâ‚‚! Ã— ... Ã— nk!)</li>
                        <li>å¯¹äºå¤§æ•°å€¼ï¼Œç»“æœå¯èƒ½ä»¥ç§‘å­¦è®¡æ•°æ³•æ˜¾ç¤º</li>
                    `,
                    err_n_invalid: 'æ€»å…ƒç´ æ•° (n) å¿…é¡»æ˜¯æ­£æ•´æ•°',
                    err_r_invalid: 'é€‰æ‹©çš„å…ƒç´ æ•° (r) å¿…é¡»æ˜¯éè´Ÿæ•´æ•°',
                    err_r_larger_n: 'é€‰æ‹©çš„å…ƒç´ æ•° (r) ä¸èƒ½å¤§äºæ€»å…ƒç´ æ•° (n)',
                    err_repetitions_invalid: 'é‡å¤æ¬¡æ•°å¿…é¡»æ˜¯ç”¨é€—å·åˆ†éš”çš„æ­£æ•´æ•°',
                    err_repetitions_sum: 'é‡å¤æ¬¡æ•°çš„æ€»å’Œå¿…é¡»ç­‰äºæ€»å…ƒç´ æ•° (n)',
                    err_no_repetitions: 'è¯·è‡³å°‘è¾“å…¥ä¸¤ä¸ªé‡å¤å€¼'
                },
                'zh-TW': {
                    title: 'ğŸ”¢ æ’åˆ—çµ„åˆè¨ˆç®—å™¨',
                    calc_type: 'è¨ˆç®—é¡å‹',
                    permutation: 'æ’åˆ— (nPr)',
                    permutation_desc: 'å¾nå€‹å…ƒç´ ä¸­é¸å–rå€‹å…ƒç´ çš„æ’åˆ—ï¼Œè€ƒæ…®é †åº',
                    combination: 'çµ„åˆ (nCr)',
                    combination_desc: 'å¾nå€‹å…ƒç´ ä¸­é¸å–rå€‹å…ƒç´ çš„çµ„åˆï¼Œä¸è€ƒæ…®é †åº',
                    factorial: 'éšä¹˜ (n!)',
                    factorial_desc: 'åˆ°nçš„æ‰€æœ‰æ­£æ•´æ•¸çš„ä¹˜ç©',
                    permutation_rep: 'é‡è¤‡æ’åˆ—',
                    permutation_rep_desc: 'å…ƒç´ å¯ä»¥é‡è¤‡çš„æ’åˆ—',
                    total_elements: 'ç¸½å…ƒç´ æ•¸ (n)',
                    selected_elements: 'é¸æ“‡çš„å…ƒç´ æ•¸ (r)',
                    repetitions: 'é‡è¤‡æ¬¡æ•¸ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰',
                    repetitions_note: 'è¼¸å…¥ç›¸åŒå…ƒç´ çš„è¨ˆæ•¸ï¼ˆç¸½å’Œæ‡‰ç­‰æ–¼nï¼‰',
                    formula: 'å…¬å¼',
                    load_sample: 'åŠ è¼‰ç¤ºä¾‹',
                    clear: 'æ¸…é™¤',
                    calculate: 'è¨ˆç®—',
                    results: 'çµæœ',
                    result_value: 'çµæœå€¼',
                    calculation_steps: 'è¨ˆç®—æ­¥é©Ÿ',
                    n_factorial: 'n!ï¼ˆnçš„éšä¹˜ï¼‰',
                    r_factorial: 'r!ï¼ˆrçš„éšä¹˜ï¼‰',
                    nr_factorial: '(n-r)!ï¼ˆn-rçš„éšä¹˜ï¼‰',
                    notes: 'èªªæ˜ï¼š',
                    notes_list: `
                        <li>æ’åˆ— (nPr) = n! / (n-r)!</li>
                        <li>çµ„åˆ (nCr) = n! / (r! Ã— (n-r)!)</li>
                        <li>éšä¹˜ (n!) = 1 Ã— 2 Ã— 3 Ã— ... Ã— n</li>
                        <li>é‡è¤‡æ’åˆ— = n! / (nâ‚! Ã— nâ‚‚! Ã— ... Ã— nk!)</li>
                        <li>å°æ–¼å¤§æ•¸å€¼ï¼Œçµæœå¯èƒ½ä»¥ç§‘å­¸è¨ˆæ•¸æ³•é¡¯ç¤º</li>
                    `,
                    err_n_invalid: 'ç¸½å…ƒç´ æ•¸ (n) å¿…é ˆæ˜¯æ­£æ•´æ•¸',
                    err_r_invalid: 'é¸æ“‡çš„å…ƒç´ æ•¸ (r) å¿…é ˆæ˜¯éè² æ•´æ•¸',
                    err_r_larger_n: 'é¸æ“‡çš„å…ƒç´ æ•¸ (r) ä¸èƒ½å¤§æ–¼ç¸½å…ƒç´ æ•¸ (n)',
                    err_repetitions_invalid: 'é‡è¤‡æ¬¡æ•¸å¿…é ˆæ˜¯ç”¨é€—è™Ÿåˆ†éš”çš„æ­£æ•´æ•¸',
                    err_repetitions_sum: 'é‡è¤‡æ¬¡æ•¸çš„ç¸½å’Œå¿…é ˆç­‰æ–¼ç¸½å…ƒç´ æ•¸ (n)',
                    err_no_repetitions: 'è«‹è‡³å°‘è¼¸å…¥å…©å€‹é‡è¤‡å€¼'
                },
                'ja': {
                    title: 'ğŸ”¢ é †åˆ—çµ„åˆã›è¨ˆç®—ãƒ„ãƒ¼ãƒ«',
                    calc_type: 'è¨ˆç®—ã‚¿ã‚¤ãƒ—',
                    permutation: 'é †åˆ— (nPr)',
                    permutation_desc: 'é †åºãŒé‡è¦ãªnå€‹ã®è¦ç´ ã‹ã‚‰rå€‹ã®è¦ç´ ã‚’å–ã‚Šå‡ºã™ä¸¦ã³æ–¹',
                    combination: 'çµ„åˆã› (nCr)',
                    combination_desc: 'é †åºãŒé‡è¦ã§ãªã„nå€‹ã®è¦ç´ ã‹ã‚‰rå€‹ã®è¦ç´ ã‚’å–ã‚Šå‡ºã™é¸ã³æ–¹',
                    factorial: 'éšä¹— (n!)',
                    factorial_desc: 'nã¾ã§ã®ã™ã¹ã¦ã®æ­£ã®æ•´æ•°ã®ç©',
                    permutation_rep: 'ç¹°ã‚Šè¿”ã—ã‚’å«ã‚€é †åˆ—',
                    permutation_rep_desc: 'è¦ç´ ãŒç¹°ã‚Šè¿”ã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹é †åˆ—',
                    total_elements: 'ç·è¦ç´ æ•° (n)',
                    selected_elements: 'é¸æŠã™ã‚‹è¦ç´ æ•° (r)',
                    repetitions: 'ç¹°ã‚Šè¿”ã—å›æ•°ï¼ˆã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‹ï¼‰',
                    repetitions_note: 'åŒä¸€è¦ç´ ã®æ•°ã‚’å…¥åŠ›ï¼ˆåˆè¨ˆã¯nã«ç­‰ã—ããªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ï¼‰',
                    formula: 'å…¬å¼',
                    load_sample: 'ã‚µãƒ³ãƒ—ãƒ«ã‚’èª­ã¿è¾¼ã‚€',
                    clear: 'ã‚¯ãƒªã‚¢',
                    calculate: 'è¨ˆç®—',
                    results: 'çµæœ',
                    result_value: 'çµæœå€¤',
                    calculation_steps: 'è¨ˆç®—æ‰‹é †',
                    n_factorial: 'n!ï¼ˆnã®éšä¹—ï¼‰',
                    r_factorial: 'r!ï¼ˆrã®éšä¹—ï¼‰',
                    nr_factorial: '(n-r)!ï¼ˆn-rã®éšä¹—ï¼‰',
                    notes: 'æ³¨æ„äº‹é …ï¼š',
                    notes_list: `
                        <li>é †åˆ— (nPr) = n! / (n-r)!</li>
                        <li>çµ„åˆã› (nCr) = n! / (r! Ã— (n-r)!)</li>
                        <li>éšä¹— (n!) = 1 Ã— 2 Ã— 3 Ã— ... Ã— n</li>
                        <li>ç¹°ã‚Šè¿”ã—ã‚’å«ã‚€é †åˆ— = n! / (nâ‚! Ã— nâ‚‚! Ã— ... Ã— nk!)</li>
                        <li>å¤§ããªå€¤ã®å ´åˆã€çµæœã¯ç§‘å­¦çš„è¡¨è¨˜æ³•ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™</li>
                    `,
                    err_n_invalid: 'ç·è¦ç´ æ•° (n) ã¯æ­£ã®æ•´æ•°ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“',
                    err_r_invalid: 'é¸æŠã™ã‚‹è¦ç´ æ•° (r) ã¯éè² ã®æ•´æ•°ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“',
                    err_r_larger_n: 'é¸æŠã™ã‚‹è¦ç´ æ•° (r) ã¯ç·è¦ç´ æ•° (n) ã‚ˆã‚Šå¤§ããã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“',
                    err_repetitions_invalid: 'ç¹°ã‚Šè¿”ã—å›æ•°ã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‰ã‚ŒãŸæ­£ã®æ•´æ•°ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“',
                    err_repetitions_sum: 'ç¹°ã‚Šè¿”ã—å›æ•°ã®åˆè¨ˆã¯ç·è¦ç´ æ•° (n) ã«ç­‰ã—ããªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“',
                    err_no_repetitions: 'å°‘ãªãã¨ã‚‚2ã¤ã®ç¹°ã‚Šè¿”ã—å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
                },
                'ru': {
                    title: 'ğŸ”¢ ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğº Ğ¸ ÑĞ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ğ¹',
                    calc_type: 'Ğ¢Ğ¸Ğ¿ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ',
                    permutation: 'ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° (nPr)',
                    permutation_desc: 'Ğ Ğ°ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ r ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸Ğ· n ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ², Ğ³Ğ´Ğµ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ¸Ğ¼ĞµĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ',
                    combination: 'Ğ¡Ğ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ğµ (nCr)',
                    combination_desc: 'Ğ’Ñ‹Ğ±Ğ¾Ñ€Ñ‹ r ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸Ğ· n ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ², Ğ³Ğ´Ğµ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ',
                    factorial: 'Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ°Ğ» (n!)',
                    factorial_desc: 'ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ñ†ĞµĞ»Ñ‹Ñ… Ñ‡Ğ¸ÑĞµĞ» Ğ´Ğ¾ n',
                    permutation_rep: 'ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸ĞµĞ¼',
                    permutation_rep_desc: 'ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸, Ğ³Ğ´Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒÑÑ',
                    total_elements: 'Ğ’ÑĞµĞ³Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (n)',
                    selected_elements: 'Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° (r)',
                    repetitions: 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ (Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿ÑÑ‚Ñ‹Ğ¼Ğ¸)',
                    repetitions_note: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (ÑÑƒĞ¼Ğ¼Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ñ€Ğ°Ğ²Ğ½ÑÑ‚ÑŒÑÑ n)',
                    formula: 'Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°',
                    load_sample: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€',
                    clear: 'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ',
                    calculate: 'Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ',
                    results: 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹',
                    result_value: 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ¸Ñ€ÑƒÑÑ‰ĞµĞµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ',
                    calculation_steps: 'Ğ¨Ğ°Ğ³Ğ¸ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ',
                    n_factorial: 'n! (Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ°Ğ» n)',
                    r_factorial: 'r! (Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ°Ğ» r)',
                    nr_factorial: '(n-r)! (Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ°Ğ» n-r)',
                    notes: 'ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ:',
                    notes_list: `
                        <li>ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° (nPr) = n! / (n-r)!</li>
                        <li>Ğ¡Ğ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ğµ (nCr) = n! / (r! Ã— (n-r)!)</li>
                        <li>Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ°Ğ» (n!) = 1 Ã— 2 Ã— 3 Ã— ... Ã— n</li>
                        <li>ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸ĞµĞ¼ = n! / (nâ‚! Ã— nâ‚‚! Ã— ... Ã— nk!)</li>
                        <li>Ğ”Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°Ñ‚ÑŒÑÑ Ğ² Ğ½Ğ°ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸</li>
                    `,
                    err_n_invalid: 'Ğ’ÑĞµĞ³Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (n) Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ†ĞµĞ»Ñ‹Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼',
                    err_r_invalid: 'Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° (r) Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ½ĞµĞ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ†ĞµĞ»Ñ‹Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼',
                    err_r_larger_n: 'Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° (r) Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ, Ñ‡ĞµĞ¼ Ğ²ÑĞµĞ³Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (n)',
                    err_repetitions_invalid: 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ†ĞµĞ»Ñ‹Ğ¼Ğ¸ Ñ‡Ğ¸ÑĞ»Ğ°Ğ¼Ğ¸, Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ·Ğ°Ğ¿ÑÑ‚Ñ‹Ğ¼Ğ¸',
                    err_repetitions_sum: 'Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ñ€Ğ°Ğ²Ğ½ÑÑ‚ÑŒÑÑ Ğ¾Ğ±Ñ‰ĞµĞ¼Ñƒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ñƒ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (n)',
                    err_no_repetitions: 'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ´Ğ²Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹'
                }
            },
            
            // åˆå§‹åŒ–
            init: function() {
                const params = new URLSearchParams(window.location.search);
                const lang = params.get('lang');
                if (lang && this.i18n[lang]) {
                    document.getElementById('lang-selector').value = lang;
                    this.changeLang();
                    return;
                }
                this.updateFormulaDisplay();
                this.changeLang();
            },
            
            // è®¾ç½®è®¡ç®—ç±»å‹
            setCalcType: function(type) {
                this.currentCalcType = type;
                
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.calc-option').forEach(elem => {
                    elem.classList.remove('active');
                });
                
                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                document.getElementById('opt-' + type).classList.add('active');
                
                // æ˜¾ç¤º/éšè—é€‚å½“çš„è¾“å…¥å­—æ®µ
                if (type === 'factorial') {
                    document.getElementById('selected-elements-container').classList.add('hidden');
                    document.getElementById('repetitions-container').classList.add('hidden');
                    document.getElementById('r-factorial-container').classList.add('hidden');
                    document.getElementById('nr-factorial-container').classList.add('hidden');
                } else if (type === 'permutation_rep') {
                    document.getElementById('selected-elements-container').classList.add('hidden');
                    document.getElementById('repetitions-container').classList.remove('hidden');
                    document.getElementById('r-factorial-container').classList.add('hidden');
                    document.getElementById('nr-factorial-container').classList.add('hidden');
                } else {
                    document.getElementById('selected-elements-container').classList.remove('hidden');
                    document.getElementById('repetitions-container').classList.add('hidden');
                    
                    if (type === 'combination') {
                        document.getElementById('r-factorial-container').classList.remove('hidden');
                    } else {
                        document.getElementById('r-factorial-container').classList.add('hidden');
                    }
                    
                    document.getElementById('nr-factorial-container').classList.remove('hidden');
                }
                
                // æ›´æ–°å…¬å¼æ˜¾ç¤º
                this.updateFormulaDisplay();
            },
            
            // æ›´æ–°å…¬å¼æ˜¾ç¤º
            updateFormulaDisplay: function() {
                const formulaElement = document.getElementById('formula-display');
                
                switch (this.currentCalcType) {
                    case 'permutation':
                        formulaElement.textContent = 'P(n,r) = n! / (n-r)!';
                        break;
                    case 'combination':
                        formulaElement.textContent = 'C(n,r) = n! / (r! Ã— (n-r)!)';
                        break;
                    case 'factorial':
                        formulaElement.textContent = 'n! = 1 Ã— 2 Ã— 3 Ã— ... Ã— n';
                        break;
                    case 'permutation_rep':
                        formulaElement.textContent = 'P = n! / (nâ‚! Ã— nâ‚‚! Ã— ... Ã— nk!)';
                        break;
                }
            },
            
            // åŠ è½½ç¤ºä¾‹æ•°æ®
            loadSample: function() {
                switch (this.currentCalcType) {
                    case 'permutation':
                        document.getElementById('total-elements').value = 10;
                        document.getElementById('selected-elements').value = 3;
                        break;
                    case 'combination':
                        document.getElementById('total-elements').value = 52;
                        document.getElementById('selected-elements').value = 5;
                        break;
                    case 'factorial':
                        document.getElementById('total-elements').value = 12;
                        break;
                    case 'permutation_rep':
                        document.getElementById('total-elements').value = 7;
                        document.getElementById('repetitions').value = '2,2,3';
                        break;
                }
            },
            
            // æ¸…é™¤è¡¨å•
            clearForm: function() {
                document.getElementById('total-elements').value = '';
                document.getElementById('selected-elements').value = '';
                document.getElementById('repetitions').value = '';
                
                // éšè—ç»“æœå’Œé”™è¯¯
                document.getElementById('perm-results').classList.add('hidden');
                document.getElementById('perm-error').classList.add('hidden');
            },
            
            // åˆ‡æ¢è¯­è¨€
            changeLang: function() {
                const lang = document.getElementById('perm-lang').value;
                const translations = this.i18n[lang] || this.i18n['en'];
                
                // æ›´æ–°æ‰€æœ‰ç¿»è¯‘å…ƒç´ 
                document.querySelectorAll('[data-i18n]').forEach(elem => {
                    const key = elem.getAttribute('data-i18n');
                    if (translations[key]) {
                        elem.innerHTML = translations[key];
                    }
                });
            },
            
            // è®¡ç®—
            calculate: function() {
                // é‡ç½®é”™è¯¯å’Œç»“æœ
                document.getElementById('perm-error').classList.add('hidden');
                document.getElementById('perm-results').classList.remove('hidden');
                
                try {
                    let result, steps, nFactorial, rFactorial = 0, nrFactorial = 0;
                    const n = parseInt(document.getElementById('total-elements').value);
                    
                    // éªŒè¯n
                    if (isNaN(n) || n < 1) {
                        throw new Error(this.getCurrentTranslation('err_n_invalid'));
                    }
                    
                    // è®¡ç®—é˜¶ä¹˜n!
                    nFactorial = this.calculateFactorial(n);
                    
                    switch (this.currentCalcType) {
                        case 'permutation':
                            const rPerm = parseInt(document.getElementById('selected-elements').value);
                            
                            // éªŒè¯r
                            if (isNaN(rPerm) || rPerm < 0) {
                                throw new Error(this.getCurrentTranslation('err_r_invalid'));
                            }
                            if (rPerm > n) {
                                throw new Error(this.getCurrentTranslation('err_r_larger_n'));
                            }
                            
                            // è®¡ç®—(n-r)!
                            const nrPerm = n - rPerm;
                            nrFactorial = nrPerm === 0 ? 1 : this.calculateFactorial(nrPerm);
                            
                            // è®¡ç®—æ’åˆ—
                            result = nFactorial / nrFactorial;
                            
                            // æ„å»ºæ­¥éª¤
                            steps = `P(${n}, ${rPerm}) = ${n}! / (${n} - ${rPerm})!`;
                            steps += `\n= ${this.formatLargeNumber(nFactorial)} / ${this.formatLargeNumber(nrFactorial)}`;
                            steps += `\n= ${this.formatLargeNumber(result)}`;
                            
                            // æ›´æ–°ç»“æœ
                            document.getElementById('r-factorial').textContent = '-';
                            document.getElementById('nr-factorial').textContent = this.formatLargeNumber(nrFactorial);
                            break;
                            
                        case 'combination':
                            const rComb = parseInt(document.getElementById('selected-elements').value);
                            
                            // éªŒè¯r
                            if (isNaN(rComb) || rComb < 0) {
                                throw new Error(this.getCurrentTranslation('err_r_invalid'));
                            }
                            if (rComb > n) {
                                throw new Error(this.getCurrentTranslation('err_r_larger_n'));
                            }
                            
                            // è®¡ç®—r!å’Œ(n-r)!
                            rFactorial = rComb === 0 ? 1 : this.calculateFactorial(rComb);
                            const nrComb = n - rComb;
                            nrFactorial = nrComb === 0 ? 1 : this.calculateFactorial(nrComb);
                            
                            // è®¡ç®—ç»„åˆ
                            result = nFactorial / (rFactorial * nrFactorial);
                            
                            // æ„å»ºæ­¥éª¤
                            steps = `C(${n}, ${rComb}) = ${n}! / (${rComb}! Ã— (${n} - ${rComb})!)`;
                            steps += `\n= ${this.formatLargeNumber(nFactorial)} / (${this.formatLargeNumber(rFactorial)} Ã— ${this.formatLargeNumber(nrFactorial)})`;
                            steps += `\n= ${this.formatLargeNumber(nFactorial)} / ${this.formatLargeNumber(rFactorial * nrFactorial)}`;
                            steps += `\n= ${this.formatLargeNumber(result)}`;
                            
                            // æ›´æ–°ç»“æœ
                            document.getElementById('r-factorial').textContent = this.formatLargeNumber(rFactorial);
                            document.getElementById('nr-factorial').textContent = this.formatLargeNumber(nrFactorial);
                            break;
                            
                        case 'factorial':
                            // ç»“æœå°±æ˜¯n!
                            result = nFactorial;
                            
                            // æ„å»ºæ­¥éª¤
                            steps = `${n}! = 1 Ã— 2 Ã— 3 Ã— ... Ã— ${n}`;
                            steps += `\n= ${this.formatLargeNumber(result)}`;
                            
                            break;
                            
                        case 'permutation_rep':
                            const repStr = document.getElementById('repetitions').value;
                            const reps = repStr.split(',').map(Number);
                            
                            // éªŒè¯é‡å¤å€¼
                            if (reps.length < 2) {
                                throw new Error(this.getCurrentTranslation('err_no_repetitions'));
                            }
                            if (reps.some(r => isNaN(r) || r < 1)) {
                                throw new Error(this.getCurrentTranslation('err_repetitions_invalid'));
                            }
                            
                            // éªŒè¯æ€»å’Œ
                            const repSum = reps.reduce((a, b) => a + b, 0);
                            if (repSum !== n) {
                                throw new Error(this.getCurrentTranslation('err_repetitions_sum'));
                            }
                            
                            // è®¡ç®—æ¯ä¸ªé‡å¤å€¼çš„é˜¶ä¹˜å¹¶ç›¸ä¹˜
                            let repFactProduct = 1;
                            for (const r of reps) {
                                repFactProduct *= this.calculateFactorial(r);
                            }
                            
                            // è®¡ç®—é‡å¤æ’åˆ—
                            result = nFactorial / repFactProduct;
                            
                            // æ„å»ºæ­¥éª¤
                            steps = `P = ${n}! / (${reps.join('! Ã— ')}!)`;
                            steps += `\n= ${this.formatLargeNumber(nFactorial)} / (${reps.map(r => this.formatLargeNumber(this.calculateFactorial(r))).join(' Ã— ')})`;
                            steps += `\n= ${this.formatLargeNumber(nFactorial)} / ${this.formatLargeNumber(repFactProduct)}`;
                            steps += `\n= ${this.formatLargeNumber(result)}`;
                            
                            break;
                    }
                    
                    // æ›´æ–°ç»“æœæ˜¾ç¤º
                    document.getElementById('result-value').textContent = this.formatLargeNumber(result);
                    document.getElementById('calculation-steps').textContent = steps;
                    document.getElementById('n-factorial').textContent = this.formatLargeNumber(nFactorial);
                    
                } catch (error) {
                    this.showError(error.message);
                }
            },
            
            // è®¡ç®—é˜¶ä¹˜
            calculateFactorial: function(num) {
                // å¤„ç†å¤§é˜¶ä¹˜æ—¶ä½¿ç”¨BigIntä»¥é¿å…ç²¾åº¦æŸå¤±
                if (num < 0) return NaN;
                if (num === 0 || num === 1) return 1;
                
                let result = 1n;
                for (let i = 2n; i <= BigInt(num); i++) {
                    result *= i;
                }
                return result;
            },
            
            // æ ¼å¼åŒ–å¤§æ•°å­—
            formatLargeNumber: function(num) {
                // å¯¹äºéå¸¸å¤§çš„æ•°å­—ï¼Œä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•
                if (typeof num === 'bigint') {
                    const str = num.toString();
                    if (str.length > 15) {
                        return num.toExponential(5);
                    }
                    return str;
                }
                return num.toLocaleString();
            },
            
            // æ˜¾ç¤ºé”™è¯¯
            showError: function(message) {
                const errorElement = document.getElementById('perm-error');
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
                document.getElementById('perm-results').classList.add('hidden');
            },
            
            // è·å–å½“å‰è¯­è¨€çš„ç¿»è¯‘
            getCurrentTranslation: function(key) {
                const lang = document.getElementById('perm-lang').value;
                return this.i18n[lang]?.[key] || this.i18n['en'][key];
            }
        };
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            PermCalc.init();
        });
    </script>

    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
    

    <div id="toolbox-seo-wrapper-unique-id" class="max-w-4xl mx-auto px-4"></div>
    <script src="/scripts/seo-loader.js"></script>

</body>
</html>