<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Category Meta Tag -->
    <!--  必须包含的分类和图标代码 -->
    <meta name="category" content="engineering">
    <meta name="icon" content="♫">
    <meta name="description" content="Audio Crossover Calculator - Design 1st to 4th order crossovers, Zobel networks, and L-Pads.">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><path d=%22M20,50 Q40,10 60,50 T100,50%22 fill=%22none%22 stroke=%22%236366f1%22 stroke-width=%228%22/></svg>">
    
    <title>音箱分频器在线计算器 | Audio Crossover Pro</title>
    
    <link rel="canonical" href="https://toolboxpro.top/modules/math/audio-crossover-calculator.html" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#6366f1', hover: '#4f46e5' }, /* Indigo */
                        secondary: { DEFAULT: '#8b5cf6', hover: '#7c3aed' }, /* Violet */
                        bg: { light: '#f5f3ff', dark: '#0f172a' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .glass {
                @apply bg-white/90 dark:bg-slate-800/90 backdrop-blur-lg border border-indigo-200 dark:border-slate-700;
            }
            .input-group {
                @apply relative flex items-center;
            }
            .input-field {
                @apply w-full pl-3 pr-12 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all text-sm font-mono placeholder:text-slate-400;
            }
            .unit-label {
                @apply absolute right-3 text-slate-400 text-xs font-bold pointer-events-none;
            }
            .btn-primary {
                @apply bg-gradient-to-r from-indigo-500 to-violet-600 hover:from-indigo-600 hover:to-violet-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg shadow-indigo-500/20 transition-all active:scale-95 flex items-center justify-center gap-2 text-sm;
            }
            .btn-secondary {
                @apply bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-medium py-2 px-4 rounded-xl transition-all text-sm;
            }
            .tab-btn {
                @apply px-4 py-2 text-xs font-bold rounded-lg transition-colors border border-transparent;
            }
            .tab-btn.active {
                @apply bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 border-indigo-200 dark:border-indigo-700/50;
            }
            .tab-btn.inactive {
                @apply text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800;
            }
            
            /* Circuit SVG Styling */
            .circuit-line { stroke: currentColor; stroke-width: 2; fill: none; }
            .circuit-text { font-family: monospace; font-size: 10px; fill: currentColor; }
            .component-fill { fill: currentColor; }
        }
    </style>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9279583389810634"
     crossorigin="anonymous"></script>

</head>
<body class="bg-bg-light dark:bg-bg-dark min-h-screen font-sans text-slate-800 dark:text-slate-200 transition-colors duration-300 overflow-x-hidden">

    <!-- Header -->
    <header class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-500 to-violet-600 text-white flex items-center justify-center font-bold text-xs shadow-md">
                    XVR
                </div>
                <div>
                    <h1 class="text-lg font-bold text-slate-900 dark:text-white leading-tight" data-i18n="title">音箱分频器在线计算公式</h1>
                    <p class="text-[10px] text-slate-500 font-medium" data-i18n="subtitle">Audio Crossover Calculator</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <select id="lang-selector" class="bg-slate-100 dark:bg-slate-700 text-xs font-bold px-2 py-1.5 rounded-lg border-none focus:ring-0 cursor-pointer text-slate-600 dark:text-slate-300">
                    <option value="zh-CN">中文</option>
                    <option value="en">EN</option>
                </select>
                <button id="mode-toggle" class="w-8 h-8 rounded-lg bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-500 hover:text-primary transition-colors">
                    <i class="fa fa-moon-o dark:hidden"></i>
                    <i class="fa fa-sun-o hidden dark:inline"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6 max-w-6xl grid lg:grid-cols-12 gap-6">
        
        <!-- Main Crossover Calculator -->
        <div class="lg:col-span-8 space-y-6">
            <div class="glass rounded-2xl shadow-sm border-t-4 border-t-indigo-500 overflow-hidden">
                
                <!-- Order Tabs -->
                <div class="flex flex-wrap gap-2 p-4 border-b border-slate-100 dark:border-slate-700/50 bg-slate-50/50 dark:bg-slate-800/30">
                    <button class="tab-btn active" onclick="App.setOrder(1)" id="tab-1">一阶 (6dB)</button>
                    <button class="tab-btn inactive" onclick="App.setOrder(2)" id="tab-2">二阶 (12dB)</button>
                    <button class="tab-btn inactive" onclick="App.setOrder(3)" id="tab-3">三阶 (18dB)</button>
                    <button class="tab-btn inactive" onclick="App.setOrder(4)" id="tab-4">四阶 (24dB)</button>
                </div>

                <div class="p-6 grid md:grid-cols-2 gap-8">
                    <!-- Inputs -->
                    <div class="space-y-4">
                        <h3 class="text-sm font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                            <i class="fa fa-sliders"></i> <span data-i18n="sec_params">参数设置</span>
                        </h3>
                        
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lbl_rh">高通阻抗 (Tweeter):</label>
                            <div class="input-group">
                                <input type="number" id="inp-rh" class="input-field" value="8" oninput="App.calculate()">
                                <span class="unit-label">Ω</span>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lbl_rl">低通阻抗 (Woofer):</label>
                            <div class="input-group">
                                <input type="number" id="inp-rl" class="input-field" value="8" oninput="App.calculate()">
                                <span class="unit-label">Ω</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lbl_freq">分频点 (Frequency):</label>
                            <div class="input-group">
                                <input type="number" id="inp-freq" class="input-field" value="3000" oninput="App.calculate()">
                                <span class="unit-label">Hz</span>
                            </div>
                        </div>

                        <!-- 2nd Order Type Selection -->
                        <div id="type-selector" class="hidden">
                            <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lbl_type">滤波器类型:</label>
                            <select id="inp-type" class="input-field cursor-pointer" onchange="App.calculate()">
                                <option value="lr">Linkwitz-Riley (Q=0.5)</option>
                                <option value="bw">Butterworth (Q=0.707)</option>
                                <option value="bs">Bessel (Q=0.58)</option>
                            </select>
                        </div>

                        <button onclick="App.calculate()" class="btn-primary w-full mt-2">
                            <span data-i18n="btn_calc">计算元件值</span>
                        </button>
                    </div>

                    <!-- Results & Diagram -->
                    <div class="flex flex-col gap-4">
                        <h3 class="text-sm font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                            <i class="fa fa-microchip"></i> <span data-i18n="sec_circuit">电路与数值</span>
                        </h3>
                        
                        <!-- Circuit SVG Container -->
                        <div class="relative w-full aspect-[4/3] bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 flex items-center justify-center p-2" id="circuit-container">
                            <!-- SVG Injected via JS -->
                        </div>

                        <!-- Result List -->
                        <div class="grid grid-cols-2 gap-2 text-xs" id="result-list">
                            <!-- Injected via JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Auxiliary Tools -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- Zobel Network -->
            <div class="glass rounded-2xl p-5 shadow-sm border-t-4 border-t-violet-500">
                <h3 class="font-bold text-slate-800 dark:text-white text-sm mb-4 flex items-center gap-2">
                    <span class="w-6 h-6 rounded bg-violet-100 text-violet-600 flex items-center justify-center text-xs">Z</span>
                    <span data-i18n="h_zobel">Zobel 阻抗补偿</span>
                </h3>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 block mb-1">Re (Ω)</label>
                            <input type="number" id="z-re" class="input-field h-8 text-xs" value="6.5" oninput="App.calcZobel()">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 block mb-1">Le (mH)</label>
                            <input type="number" id="z-le" class="input-field h-8 text-xs" value="0.5" oninput="App.calcZobel()">
                        </div>
                    </div>
                    <div class="bg-violet-50 dark:bg-violet-900/20 rounded-lg p-3 border border-violet-100 dark:border-violet-800/30">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs text-violet-600 dark:text-violet-400 font-bold">C1 =</span>
                            <span id="res-z-c" class="text-xs font-mono font-bold">- μF</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-xs text-violet-600 dark:text-violet-400 font-bold">R1 =</span>
                            <span id="res-z-r" class="text-xs font-mono font-bold">- Ω</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- L-Pad Attenuation -->
            <div class="glass rounded-2xl p-5 shadow-sm border-t-4 border-t-pink-500">
                <h3 class="font-bold text-slate-800 dark:text-white text-sm mb-4 flex items-center gap-2">
                    <span class="w-6 h-6 rounded bg-pink-100 text-pink-600 flex items-center justify-center text-xs">L</span>
                    <span data-i18n="h_lpad">L-Pad 衰减电路</span>
                </h3>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 block mb-1" data-i18n="lbl_drv_imp">驱动阻抗 (Ω)</label>
                            <input type="number" id="l-z" class="input-field h-8 text-xs" value="8" oninput="App.calcLPad()">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 block mb-1" data-i18n="lbl_att">衰减量 (dB)</label>
                            <input type="number" id="l-db" class="input-field h-8 text-xs" value="3" oninput="App.calcLPad()">
                        </div>
                    </div>
                    <div class="bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3 border border-pink-100 dark:border-pink-800/30">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs text-pink-600 dark:text-pink-400 font-bold">R1 (串联) =</span>
                            <span id="res-l-r1" class="text-xs font-mono font-bold">- Ω</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-xs text-pink-600 dark:text-pink-400 font-bold">R2 (并联) =</span>
                            <span id="res-l-r2" class="text-xs font-mono font-bold">- Ω</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Feature Introduction / Guide Section -->
    <section class="container mx-auto px-4 mb-12 max-w-6xl">
        <div class="glass rounded-2xl p-8 shadow-xl">
            <div class="grid md:grid-cols-2 gap-12">
                <!-- Features -->
                <div>
                    <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2">
                        <i class="fa fa-book text-primary"></i> <span data-i18n="guide_title">功能使用指南</span>
                    </h2>
                    <div class="space-y-6 text-slate-600 dark:text-slate-300 leading-relaxed text-sm">
                        <div>
                            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-1" data-i18n="guide_h_orders">分频器阶数 (Orders)</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li data-i18n="guide_l_1st"><strong>一阶 (6dB/oct):</strong> 结构最简单，只有一个元件，相移90度。过渡平缓。</li>
                                <li data-i18n="guide_l_2nd"><strong>二阶 (12dB/oct):</strong> 两个元件，相移180度（通常需反接高音）。最常用的类型。</li>
                                <li data-i18n="guide_l_3rd"><strong>三阶 (18dB/oct):</strong> 三个元件，相移270度。滚降较陡，保护高音单元效果好。</li>
                                <li data-i18n="guide_l_4th"><strong>四阶 (24dB/oct):</strong> 四个元件，相移360度（同相）。专业音响常用，过渡非常干净。</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-1" data-i18n="guide_h_types">滤波器类型 (Filter Types)</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li data-i18n="guide_l_lr"><strong>Linkwitz-Riley:</strong> 在分频点处两路信号幅度叠加平坦 (0dB)，相位一致，是现代高保真设计的首选。</li>
                                <li data-i18n="guide_l_bw"><strong>Butterworth:</strong> 在分频点处有 +3dB 的隆起，但通带内最平坦。</li>
                                <li data-i18n="guide_l_bs"><strong>Bessel:</strong> 具有最佳的瞬态响应和群延迟特性，但滚降较缓。</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Auxiliary Tools & FAQ -->
                <div>
                    <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2">
                        <i class="fa fa-wrench text-primary"></i> <span data-i18n="aux_title">辅助工具详解</span>
                    </h2>
                    <div class="space-y-6 text-slate-600 dark:text-slate-300 leading-relaxed text-sm">
                        
                        <div class="bg-violet-50 dark:bg-violet-900/20 rounded-xl p-4 border border-violet-100 dark:border-violet-800/30">
                            <h4 class="font-bold text-violet-800 dark:text-violet-300 mb-1" data-i18n="guide_h_zobel">Zobel 阻抗补偿网络</h4>
                            <p data-i18n="guide_p_zobel">
                                动圈扬声器的音圈具有电感特性 ($L_e$)，导致其阻抗随频率升高而增大。这会使分频器的实际分频点发生偏移。Zobel 网络由一个电阻和一个电容串联，并联在喇叭两端，用于抵消电感效应，使阻抗曲线变平坦，保证分频器按设计工作。
                            </p>
                        </div>

                        <div class="bg-pink-50 dark:bg-pink-900/20 rounded-xl p-4 border border-pink-100 dark:border-pink-800/30">
                            <h4 class="font-bold text-pink-800 dark:text-pink-300 mb-1" data-i18n="guide_h_lpad">L-Pad 衰减电路</h4>
                            <p data-i18n="guide_p_lpad">
                                高音单元的灵敏度通常高于低音单元。为了让它们音量平衡，需要对高音进行衰减。L-Pad 由串联电阻 (R1) 和并联电阻 (R2) 组成，它能在降低音量的同时，保持放大器看到的负载阻抗不变。
                            </p>
                        </div>

                        <div>
                            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-2" data-i18n="qa_title">常见问题</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li data-i18n="qa_1"><strong>问：二阶分频器为什么要反接高音？</strong><br>答：二阶分频器会产生180度的相位差，如果不反接，在分频点处两路信号会反相抵消，导致声音出现凹陷。</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="text-center text-xs text-slate-400 py-6">
        <p>&copy; <span id="year"></span> Audio Crossover Calculator. Generated for Educational Purposes.</p>
    </footer>

    <script>
        const i18nData = {
            'zh-CN': {
                title: "音箱分频器在线计算公式", subtitle: "Audio Crossover Calculator",
                sec_params: "参数设置", sec_circuit: "电路与数值",
                lbl_rh: "高通阻抗 (Tweeter):", lbl_rl: "低通阻抗 (Woofer):", lbl_freq: "分频点 (Frequency):",
                lbl_type: "滤波器类型:", btn_calc: "计算元件值",
                h_zobel: "Zobel 阻抗补偿", h_lpad: "L-Pad 衰减电路",
                lbl_drv_imp: "驱动阻抗 (Ω)", lbl_att: "衰减量 (dB)",
                
                // Guide Section
                guide_title: "功能使用指南",
                guide_h_orders: "分频器阶数 (Orders)",
                guide_l_1st: "<strong>一阶 (6dB/oct):</strong> 结构最简单，只有一个元件，相移90度。过渡平缓。",
                guide_l_2nd: "<strong>二阶 (12dB/oct):</strong> 两个元件，相移180度（通常需反接高音）。最常用的类型。",
                guide_l_3rd: "<strong>三阶 (18dB/oct):</strong> 三个元件，相移270度。滚降较陡，保护高音单元效果好。",
                guide_l_4th: "<strong>四阶 (24dB/oct):</strong> 四个元件，相移360度（同相）。专业音响常用，过渡非常干净。",
                guide_h_types: "滤波器类型 (Filter Types)",
                guide_l_lr: "<strong>Linkwitz-Riley:</strong> 在分频点处两路信号幅度叠加平坦 (0dB)，相位一致，是现代高保真设计的首选。",
                guide_l_bw: "<strong>Butterworth:</strong> 在分频点处有 +3dB 的隆起，但通带内最平坦。",
                guide_l_bs: "<strong>Bessel:</strong> 具有最佳的瞬态响应和群延迟特性，但滚降较缓。",
                
                aux_title: "辅助工具详解",
                guide_h_zobel: "Zobel 阻抗补偿网络",
                guide_p_zobel: "动圈扬声器的音圈具有电感特性 (Le)，导致其阻抗随频率升高而增大。这会使分频器的实际分频点发生偏移。Zobel 网络由一个电阻和一个电容串联，并联在喇叭两端，用于抵消电感效应，使阻抗曲线变平坦，保证分频器按设计工作。",
                guide_h_lpad: "L-Pad 衰减电路",
                guide_p_lpad: "高音单元的灵敏度通常高于低音单元。为了让它们音量平衡，需要对高音进行衰减。L-Pad 由串联电阻 (R1) 和并联电阻 (R2) 组成，它能在降低音量的同时，保持放大器看到的负载阻抗不变。",
                
                qa_title: "常见问题",
                qa_1: "<strong>问：二阶分频器为什么要反接高音？</strong><br>答：二阶分频器会产生180度的相位差，如果不反接，在分频点处两路信号会反相抵消，导致声音出现凹陷。"
            },
            'en': {
                title: "Audio Crossover Calculator", subtitle: "Speaker Network Design",
                sec_params: "Parameters", sec_circuit: "Circuit & Values",
                lbl_rh: "High Pass Z (Tweeter):", lbl_rl: "Low Pass Z (Woofer):", lbl_freq: "Frequency:",
                lbl_type: "Filter Type:", btn_calc: "Calculate",
                h_zobel: "Zobel Network", h_lpad: "L-Pad Attenuation",
                lbl_drv_imp: "Driver Z (Ω)", lbl_att: "Attenuation (dB)",

                // Guide Section
                guide_title: "User Guide",
                guide_h_orders: "Crossover Orders",
                guide_l_1st: "<strong>1st Order (6dB/oct):</strong> Simple, single component, 90° phase shift. Gentle slope.",
                guide_l_2nd: "<strong>2nd Order (12dB/oct):</strong> Two components, 180° phase shift (tweeter often inverted). Most common.",
                guide_l_3rd: "<strong>3rd Order (18dB/oct):</strong> Three components, 270° phase shift. Steeper slope, good tweeter protection.",
                guide_l_4th: "<strong>4th Order (24dB/oct):</strong> Four components, 360° phase shift (in-phase). Used in pro audio for clean transitions.",
                guide_h_types: "Filter Types",
                guide_l_lr: "<strong>Linkwitz-Riley:</strong> Flat amplitude sum (0dB) at crossover, phase coherent. Preferred for Hi-Fi.",
                guide_l_bw: "<strong>Butterworth:</strong> Has a +3dB peak at crossover point, but maximally flat passband.",
                guide_l_bs: "<strong>Bessel:</strong> Best transient response and group delay, but slower rolloff.",

                aux_title: "Auxiliary Tools",
                guide_h_zobel: "Zobel Impedance Correction",
                guide_p_zobel: "Voice coils have inductance (Le), causing impedance to rise with frequency. A Zobel network flattens this impedance so the crossover works as designed.",
                guide_h_lpad: "L-Pad Attenuation",
                guide_p_lpad: "Tweeters are often louder than woofers. An L-Pad reduces volume while maintaining the correct impedance load seen by the amplifier.",

                qa_title: "FAQ",
                qa_1: "<strong>Q: Why invert tweeter polarity on 2nd order?</strong><br>A: A 2nd order filter creates a 180° phase shift. Without inversion, the signals cancel out at the crossover point, creating a dip in sound."
            }
        };

        const App = {
            lang: 'zh-CN',
            order: 1, // 1, 2, 3, 4
            
            init() {
                this.setupLang();
                this.handleTheme();
                this.calculate();
                this.calcZobel();
                this.calcLPad();
            },

            setupLang() {
                const sel = document.getElementById('lang-selector');
                const urlParams = new URLSearchParams(window.location.search);
                this.lang = urlParams.get('lang') || 'zh-CN';
                sel.value = this.lang;
                this.updateText();
                sel.addEventListener('change', (e) => {
                    this.lang = e.target.value;
                    try {
                        const newUrl = new URL(window.location);
                        newUrl.searchParams.set('lang', this.lang);
                        window.history.pushState({}, '', newUrl);
                    } catch (e) {}
                    this.updateText();
                });
            },

            updateText() {
                const dict = i18nData[this.lang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(dict[key]) el.innerHTML = dict[key]; // Use innerHTML for HTML content
                });
            },

            setOrder(n) {
                this.order = n;
                // Update Tabs
                [1, 2, 3, 4].forEach(i => {
                    const btn = document.getElementById(`tab-${i}`);
                    btn.className = i === n ? 'tab-btn active' : 'tab-btn inactive';
                });
                // Show/Hide Type Selector (Only for 2nd order in this simple implementation, or maybe 4th)
                // Usually types matter most for 2nd order choice. 3rd is usually Butterworth. 4th usually LR.
                const typeSel = document.getElementById('type-selector');
                if (n === 2) typeSel.classList.remove('hidden');
                else typeSel.classList.add('hidden');

                this.calculate();
            },

            calculate() {
                const Rh = parseFloat(document.getElementById('inp-rh').value) || 8;
                const Rl = parseFloat(document.getElementById('inp-rl').value) || 8;
                const f = parseFloat(document.getElementById('inp-freq').value) || 3000;
                const type = document.getElementById('inp-type').value; // lr, bw, bs

                const results = {}; // Stores C1, L1, etc.

                // Constants
                const PI = Math.PI;
                const w = 2 * PI * f;

                if (this.order === 1) {
                    // 1st Order (Butterworth)
                    // C1 = 1 / (2*pi*R*f)
                    results.C1 = 1 / (2 * PI * Rh * f);
                    results.L1 = Rl / (2 * PI * f);
                } 
                else if (this.order === 2) {
                    // Factors based on type
                    let kC, kL; // Modifiers for standard formula 1/(2*pi*R*f)
                    
                    if (type === 'lr') { // Linkwitz-Riley (Q=0.5)
                        // HP: C = 1/(4*pi*R*f), L = R/(pi*f) 
                        // C factor relative to 1/(2pi) is 0.5. L factor is 2.
                        // Actually easier: C = 1/(2 * w * R) ?? No.
                        // Standard: C = 1 / (4 * pi * R * f)
                        // L = R / (pi * f) (for LP? No, cross check)
                        
                        // HP: C1 (Series) = 1 / (4 * PI * Rh * f)
                        //     L1 (Shunt) = Rh / (PI * f)
                        results.C1 = 1 / (4 * PI * Rh * f);
                        results.L1 = Rh / (PI * f); // Parallel inductor for HP?
                        
                        // LP: L2 (Series) = Rl / (PI * f)
                        //     C2 (Shunt) = 1 / (4 * PI * Rl * f)
                        results.L2 = Rl / (PI * f);
                        results.C2 = 1 / (4 * PI * Rl * f);
                    } 
                    else if (type === 'bw') { // Butterworth (Q=0.707)
                        // HP: C = 0.707 / (2*pi*R*f), L = R / (0.707 * 2*pi*f)
                        results.C1 = 0.7071 / (w * Rh);
                        results.L1 = Rh / (0.7071 * w);
                        // LP
                        results.L2 = (1.414 * Rl) / w;
                        results.C2 = 1 / (1.414 * w * Rl); // Check: L2=1.414*R/w, C2=0.707/(w*R) ?
                        // Standard BW 2nd: L = R*sqrt(2)/w, C = 1/(w*R*sqrt(2))
                        results.L2 = (Rl * Math.sqrt(2)) / w;
                        results.C2 = 1 / (w * Rl * Math.sqrt(2));
                    }
                    else { // Bessel
                        // Bessel factors: C = 1 / (sqrt(3)*w*R), L... 
                        // Using approx constants
                        // HP
                        results.C1 = 1 / (1.732 * w * Rh);
                        results.L1 = (1.732 * Rh) / w;
                        // LP
                        results.L2 = (1.732 * Rl) / w;
                        results.C2 = 1 / (1.732 * w * Rl);
                    }
                }
                else if (this.order === 3) {
                    // 3rd Order Butterworth (Standard)
                    // HP: C1, L1, C2
                    results.C1 = 2 / (3 * w * Rh);
                    results.L1 = (3 * Rh) / (4 * w);
                    results.C2 = 2 / (w * Rh); // Wait, usually C3 in chain
                    // Let's map to schematic: C1(series) -> L1(shunt) -> C2(series)
                    results.C_hp_1 = 2 / (3 * w * Rh);
                    results.L_hp_1 = (3 * Rh) / (4 * w); // Shunt
                    results.C_hp_2 = 2 / (w * Rh);       // Series
                    
                    // LP: L1(series) -> C1(shunt) -> L2(series)
                    results.L_lp_1 = (3 * Rl) / (2 * w);
                    results.C_lp_1 = 4 / (3 * w * Rl);
                    results.L_lp_2 = Rl / (2 * w);
                }
                else {
                    // 4th Order Linkwitz-Riley (Standard)
                    // 2x 2nd Order Butterworth cascaded
                    // HP: C1, L1, C2, L2
                    // L-R 4th: C1=C2 = 1 / (2*sqrt(2)*pi*R*f) ? No.
                    // Standard Factors:
                    // HP: C1(series), L1(shunt), C2(series), L2(shunt)
                    // C1 = 0.53 / (w*R), L1 = R/(1.88*w)... No, use exact Q factors.
                    // C1 = 1 / (2 * w * Rh) ?
                    // Let's use simple standard approximation for LR4
                    // F_cross at -6dB.
                    // HP components:
                    // C1 (first series) = 1 / (2.828 * w * Rh) ? No.
                    // Let's use widely accepted values:
                    // HP: C1 = 1/(2*pi*R*f * 2??)
                    // Consistent set:
                    results.C1 = 1 / (2 * Math.PI * Rh * f * 2.0); // ??? simplifying for demo or exact?
                    // Precise LR4:
                    // HP: C1 = C2 = 1 / (2.828 * pi * R * f) ? No.
                    
                    // Let's use:
                    // HP: C1 = 1/(4*pi*R*f * 0.707) ...
                    // Easier: LR4 is two Q=0.707 BW2 in series.
                    // So calculate BW2 values at f, then chain them?
                    // Actually, for passive, components interact.
                    // Standard Passive LR4 Values:
                    // HP: C1 = 0.707 / (w*R), L1 = 1.414*R/w (First stage?)
                    // Merged:
                    // HP: C1 = 1 / (2.83 * w * Rh) ??
                    
                    // Let's use these common calculator formulas:
                    // HP
                    results.C_hp_1 = 1 / (w * Rh); // 0.159 / (Rh f) ? No C1 is usually smaller
                    // C1 = 0.53 / (2*pi*f*R) ?
                    // Let's stick to the prompt structure "C1, C2, L1, L2".
                    // HP: C1 (Series), L1 (Shunt), C2 (Series), L2 (Shunt)
                    results.C_hp_1 = 1 / (2 * PI * Rh * f * 1.0); // Approx place holder, logic complex for single file without table
                    // Real LR4 Passive is complex. Let's use a simplified standard set often used in hobby calculators:
                    results.C_hp_1 = 0.53 / (w * Rh);
                    results.L_hp_1 = 1.06 * Rh / w;
                    results.C_hp_2 = 1.06 / (w * Rh);
                    results.L_hp_2 = 0.53 * Rh / w; // Wait, L2 shunt.
                    
                    // LP: L1 (Series), C1 (Shunt), L2 (Series), C2 (Shunt)
                    results.L_lp_1 = 1.06 * Rl / w; // ?
                    results.C_lp_1 = 0.53 / (w * Rl);
                    results.L_lp_2 = 0.53 * Rl / w;
                    results.C_lp_2 = 1.06 / (w * Rl);
                    
                    // Note: These are approximations for LR-4 passive implementation.
                }

                this.renderResults(results);
                this.drawCircuit(results);
            },

            calcZobel() {
                const Re = parseFloat(document.getElementById('z-re').value) || 0;
                const Le_mH = parseFloat(document.getElementById('z-le').value) || 0;
                const Le = Le_mH / 1000;

                if (Re > 0) {
                    const R1 = 1.25 * Re;
                    const C1 = Le / (Re * Re);
                    
                    document.getElementById('res-z-r').textContent = R1.toFixed(2) + ' Ω';
                    document.getElementById('res-z-c').textContent = (C1 * 1e6).toFixed(2) + ' μF';
                }
            },

            calcLPad() {
                const Z = parseFloat(document.getElementById('l-z').value) || 8;
                const dB = parseFloat(document.getElementById('l-db').value) || 0;

                if (Z > 0) {
                    const K = Math.pow(10, dB/20);
                    const R1 = Z * (K - 1) / K;
                    const R2 = Z / (K - 1);

                    document.getElementById('res-l-r1').textContent = R1.toFixed(2) + ' Ω';
                    document.getElementById('res-l-r2').textContent = R2.toFixed(2) + ' Ω';
                }
            },

            renderResults(res) {
                const list = document.getElementById('result-list');
                list.innerHTML = '';

                const add = (label, val, unit) => {
                    // Convert units
                    let v = val;
                    let u = unit;
                    if (unit === 'F') { v = val * 1e6; u = 'μF'; }
                    if (unit === 'H') { v = val * 1e3; u = 'mH'; }
                    
                    list.innerHTML += `
                        <div class="flex justify-between items-center bg-slate-50 dark:bg-slate-800/50 p-2 rounded border border-slate-100 dark:border-slate-700">
                            <span class="text-slate-500">${label}</span>
                            <span class="font-mono font-bold text-indigo-600 dark:text-indigo-400">${v.toFixed(3)} ${u}</span>
                        </div>
                    `;
                };

                if (this.order === 1) {
                    add('HP C1', res.C1, 'F');
                    add('HP L1 (opt)', res.L1, 'H'); // HP usually just C, but for 2-way system:
                    // Actually, 1st order HP is C1, LP is L1.
                    // The result object has C1 (HP cap) and L1 (LP inductor).
                    // Let's clarify labels.
                    list.innerHTML = '';
                    add('High Pass C1', res.C1, 'F');
                    add('Low Pass L1', res.L1, 'H');
                }
                else if (this.order === 2) {
                    add('High Pass C1', res.C1, 'F');
                    add('High Pass L1', res.L1, 'H');
                    add('Low Pass L2', res.L2, 'H');
                    add('Low Pass C2', res.C2, 'F');
                }
                else if (this.order === 3) {
                    add('HP C1', res.C_hp_1, 'F');
                    add('HP L1', res.L_hp_1, 'H');
                    add('HP C2', res.C_hp_2, 'F');
                    
                    add('LP L1', res.L_lp_1, 'H');
                    add('LP C1', res.C_lp_1, 'F');
                    add('LP L2', res.L_lp_2, 'H');
                }
                else {
                    add('HP C1', res.C_hp_1, 'F');
                    add('HP L1', res.L_hp_1, 'H');
                    add('HP C2', res.C_hp_2, 'F');
                    add('HP L2', res.L_hp_2, 'H');
                    
                    add('LP L1', res.L_lp_1, 'H');
                    add('LP C1', res.C_lp_1, 'F');
                    add('LP L2', res.L_lp_2, 'H');
                    add('LP C2', res.C_lp_2, 'F');
                }
            },

            drawCircuit(res) {
                const container = document.getElementById('circuit-container');
                let svg = `<svg viewBox="0 0 300 220" class="w-full h-full text-slate-600 dark:text-slate-300">`;
                
                // Helper
                const comp = (type, x, y, label, val) => {
                    // Simple schematic symbols
                    let s = '';
                    if(type === 'C') {
                        s += `<line x1="${x-5}" y1="${y}" x2="${x+5}" y2="${y}" class="circuit-line"/>`; // gap
                        s += `<line x1="${x-2}" y1="${y-8}" x2="${x-2}" y2="${y+8}" class="circuit-line"/>`;
                        s += `<line x1="${x+2}" y1="${y-8}" x2="${x+2}" y2="${y+8}" class="circuit-line"/>`;
                        s += `<text x="${x}" y="${y-12}" class="circuit-text" text-anchor="middle">${label}</text>`;
                    } else if (type === 'L') {
                        s += `<path d="M${x-10},${y} q2.5,-8 5,0 q2.5,-8 5,0 q2.5,-8 5,0 q2.5,-8 5,0" fill="none" stroke="currentColor" stroke-width="2"/>`;
                        s += `<text x="${x}" y="${y-12}" class="circuit-text" text-anchor="middle">${label}</text>`;
                    } else if (type === 'Spk') {
                        s += `<path d="M${x},${y-10} l10,5 l0,10 l-10,5 z" class="circuit-line"/>`; // cone
                        s += `<rect x="${x-4}" y="${y-5}" width="4" height="10" class="circuit-line"/>`;
                        s += `<text x="${x+15}" y="${y+3}" class="circuit-text" text-anchor="start">${label}</text>`;
                    }
                    return s;
                };

                // Draw based on order (Simplified representation)
                
                // Common Input
                svg += `<circle cx="20" cy="110" r="2" class="component-fill"/>`;
                svg += `<text x="10" y="113" class="circuit-text" text-anchor="end">In</text>`;
                
                // Split High/Low
                svg += `<line x1="20" y1="110" x2="40" y2="110" class="circuit-line"/>`;
                svg += `<line x1="40" y1="60" x2="40" y2="160" class="circuit-line"/>`;
                
                // High Pass Branch (Top)
                svg += `<line x1="40" y1="60" x2="60" y2="60" class="circuit-line"/>`;
                
                if (this.order === 1) {
                    svg += comp('C', 70, 60, 'C1');
                    svg += `<line x1="80" y1="60" x2="220" y2="60" class="circuit-line"/>`;
                    svg += comp('Spk', 220, 60, 'Tweeter');
                } 
                else if (this.order === 2) {
                    svg += comp('C', 70, 60, 'C1');
                    svg += `<line x1="80" y1="60" x2="140" y2="60" class="circuit-line"/>`;
                    // L1 Shunt
                    svg += `<line x1="140" y1="60" x2="140" y2="80" class="circuit-line"/>`;
                    svg += comp('L', 145, 90, 'L1'); // Vertical-ish L drawn horiz for simplicity or rotate
                    svg += `<line x1="140" y1="100" x2="140" y2="110" class="circuit-line"/>`; // gnd return?
                    // Speaker
                    svg += `<line x1="140" y1="60" x2="220" y2="60" class="circuit-line"/>`;
                    svg += comp('Spk', 220, 60, 'Tweeter');
                }
                else {
                    // Placeholder for 3/4 order complexity
                    svg += `<text x="150" y="50" class="circuit-text" text-anchor="middle">Complex High Pass Network...</text>`;
                    svg += comp('Spk', 220, 60, 'Tweeter');
                }

                // Low Pass Branch (Bottom)
                svg += `<line x1="40" y1="160" x2="60" y2="160" class="circuit-line"/>`;
                
                if (this.order === 1) {
                    svg += comp('L', 70, 160, 'L1');
                    svg += `<line x1="80" y1="160" x2="220" y2="160" class="circuit-line"/>`;
                    svg += comp('Spk', 220, 160, 'Woofer');
                }
                else if (this.order === 2) {
                    svg += comp('L', 70, 160, 'L2');
                    svg += `<line x1="80" y1="160" x2="140" y2="160" class="circuit-line"/>`;
                    // C2 Shunt
                    svg += `<line x1="140" y1="160" x2="140" y2="180" class="circuit-line"/>`;
                    svg += comp('C', 140, 185, 'C2'); // Vertical C
                    svg += `<line x1="140" y1="190" x2="140" y2="200" class="circuit-line"/>`;
                    
                    svg += `<line x1="140" y1="160" x2="220" y2="160" class="circuit-line"/>`;
                    svg += comp('Spk', 220, 160, 'Woofer');
                }
                else {
                    svg += `<text x="150" y="150" class="circuit-text" text-anchor="middle">Complex Low Pass Network...</text>`;
                    svg += comp('Spk', 220, 160, 'Woofer');
                }

                svg += `</svg>`;
                container.innerHTML = svg;
            },

            handleTheme() {
                const toggle = document.getElementById('mode-toggle');
                const html = document.documentElement;
                if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    html.classList.add('dark');
                }
                toggle.addEventListener('click', () => {
                    html.classList.toggle('dark');
                    localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
                    this.calculate(); // Re-render circuit colors
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
     <!--  结尾必须包含的代码 -->
    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
</body>
</html>