<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="category" content="health">
    <meta name="description" content="Ultimate Health Calculator: Calories Burned & Weight Gain/TDEE Calculator. Support multi-language.">
    <title>Ultimate Health Calculator | å…¨èƒ½å¥åº·è®¡ç®—å™¨</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#f97316', hover: '#ea580c', light: '#ffedd5' },
                        gain: { DEFAULT: '#10b981', hover: '#059669', light: '#d1fae5' },
                        surface: { light: '#ffffff', dark: '#1e293b' },
                        bg: { light: '#fff7ed', dark: '#0f172a' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(5px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .glass {
                @apply bg-white/90 dark:bg-slate-800/90 backdrop-blur-lg border border-slate-200 dark:border-slate-700;
            }
            .input-field {
                @apply w-full px-4 py-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all text-sm;
            }
            .label-text {
                @apply text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1.5 block uppercase tracking-wide;
            }
            .tab-btn {
                @apply px-4 py-1.5 rounded-full text-xs font-bold transition-all border;
            }
            .tab-btn.active {
                @apply bg-primary text-white border-primary;
            }
            .tab-btn.inactive {
                @apply bg-transparent text-slate-500 border-transparent hover:bg-slate-100 dark:hover:bg-slate-800;
            }
            .mode-switch {
                @apply flex-1 py-3 text-sm font-bold rounded-xl transition-all flex items-center justify-center gap-2 border-2;
            }
            .mode-switch.active-burn {
                @apply bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 border-orange-500;
            }
            .mode-switch.active-gain {
                @apply bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 border-emerald-500;
            }
            .mode-switch.inactive {
                @apply bg-white dark:bg-slate-800 text-slate-400 border-transparent hover:bg-slate-50 dark:hover:bg-slate-700;
            }
            .info-card {
                @apply p-5 rounded-xl border border-slate-100 dark:border-slate-700 bg-white/50 dark:bg-slate-800/50 hover:shadow-md transition-shadow;
            }
            .info-icon {
                @apply w-10 h-10 rounded-full flex items-center justify-center text-lg mb-3;
            }
        }
    </style>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9279583389810634"
     crossorigin="anonymous"></script>

</head>
<body class="bg-bg-light dark:bg-bg-dark min-h-screen font-sans text-slate-800 dark:text-slate-200 transition-colors duration-300 overflow-x-hidden">

    <!-- Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0 opacity-40 dark:opacity-20">
        <div id="bg-blob-1" class="absolute top-[-10%] left-[-10%] w-[600px] h-[600px] bg-orange-200 rounded-full blur-[120px] mix-blend-multiply dark:mix-blend-screen transition-colors duration-700"></div>
        <div id="bg-blob-2" class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-blue-200 rounded-full blur-[100px] mix-blend-multiply dark:mix-blend-screen transition-colors duration-700"></div>
    </div>

    <div class="container mx-auto px-4 py-6 max-w-6xl relative z-10 flex flex-col min-h-screen">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row items-center justify-between gap-4 mb-8">
            <div class="flex items-center gap-3">
                <div id="logo-bg" class="w-12 h-12 rounded-2xl bg-gradient-to-br from-orange-500 to-red-600 text-white flex items-center justify-center text-2xl shadow-lg shadow-orange-500/20 transition-all duration-500">
                    <i id="logo-icon" class="fa fa-fire"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight text-slate-900 dark:text-white" data-i18n="title">Ultimate Health Calc</h1>
                    <p class="text-xs text-slate-500 font-medium" data-i18n="subtitle">å…¨èƒ½å¥åº·è®¡ç®—å™¨ï¼šæ¶ˆè€—ä¸å¢è‚Œ</p>
                </div>
            </div>

            <div class="flex items-center gap-2 bg-white dark:bg-slate-800 p-1.5 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm">
                <select id="lang-selector" class="bg-transparent text-sm font-medium px-2 py-1 rounded focus:outline-none cursor-pointer text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 max-w-[140px]">
                    <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                    <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                    <option value="pl">ğŸ‡µğŸ‡± Polski</option>
                </select>
                <div class="w-px h-5 bg-slate-300 dark:bg-slate-600 mx-1"></div>
                <button id="mode-toggle" class="w-8 h-8 rounded-lg flex items-center justify-center text-slate-500 hover:text-primary hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fa fa-moon-o dark:hidden"></i>
                    <i class="fa fa-sun-o hidden dark:inline"></i>
                </button>
            </div>
        </header>

        <!-- Main Tool Area -->
        <div class="grid lg:grid-cols-12 gap-6 mb-12">
            
            <!-- Left Column: Inputs -->
            <main class="lg:col-span-4 flex flex-col gap-6">
                <div class="glass rounded-3xl shadow-lg overflow-hidden border-t-4 border-t-primary p-6 space-y-5 transition-colors duration-500" id="input-card">
                    
                    <!-- Mode Switcher -->
                    <div class="flex gap-2 mb-2">
                        <button class="mode-switch active-burn" id="mode-btn-burn" onclick="App.setMode('burn')">
                            <i class="fa fa-fire"></i> <span data-i18n="mode_burn">è¿åŠ¨æ¶ˆè€—</span>
                        </button>
                        <button class="mode-switch inactive" id="mode-btn-gain" onclick="App.setMode('gain')">
                            <i class="fa fa-line-chart"></i> <span data-i18n="mode_gain">TDEE / å¢é‡</span>
                        </button>
                    </div>

                    <div class="flex justify-between items-center">
                        <h2 class="text-lg font-bold flex items-center gap-2 text-slate-800 dark:text-white">
                            <i class="fa fa-sliders"></i> <span data-i18n="h2_config">è®¡ç®—å‚æ•°</span>
                        </h2>
                        <!-- Unit Toggle -->
                        <div class="flex bg-slate-100 dark:bg-slate-800 rounded-lg p-1">
                            <button class="px-3 py-1 text-xs font-bold rounded-md bg-white dark:bg-slate-700 shadow-sm text-slate-800 dark:text-white transition-all" id="btn-metric" onclick="App.setUnit('metric')">Metric</button>
                            <button class="px-3 py-1 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 dark:hover:text-white transition-all" id="btn-imperial" onclick="App.setUnit('imperial')">Imperial</button>
                        </div>
                    </div>

                    <!-- Common Input: Weight -->
                    <div>
                        <label class="label-text"><span data-i18n="lbl_weight">ä½“é‡</span> <span id="unit-weight" class="text-xs text-slate-400">(kg)</span></label>
                        <input type="number" id="input-weight" class="input-field font-mono" value="70" oninput="Calculator.calculate()">
                    </div>

                    <!-- ================= BURN MODE INPUTS ================= -->
                    <div id="inputs-burn" class="space-y-5 animate-fade-in">
                        <!-- Activity Selector -->
                        <div>
                            <label class="label-text" data-i18n="lbl_activity">é€‰æ‹©æ´»åŠ¨ç±»å‹</label>
                            <select id="input-activity" class="input-field" onchange="App.handleActivityChange()">
                                <optgroup label="Latest Additions">
                                    <option value="skiing" data-i18n="act_skiing">æ»‘é›ª (Skiing)</option>
                                    <option value="gardening" data-i18n="act_gardening">å›­è‰º (Gardening)</option>
                                    <option value="swimming" data-i18n="act_swimming">æ¸¸æ³³ (Swimming)</option>
                                    <option value="stairs" data-i18n="act_stairs">çˆ¬æ¥¼æ¢¯ (Stairs)</option>
                                    <option value="skydiving" data-i18n="act_skydiving">è·³ä¼ (Skydiving)</option>
                                    <option value="dancing" data-i18n="act_dancing">è·³èˆ (Dancing)</option>
                                    <option value="jogging" data-i18n="act_jogging">æ…¢è·‘ (Jogging)</option>
                                    <option value="jumping_rope" data-i18n="act_jumping_rope">è·³ç»³ (Jumping Rope)</option>
                                </optgroup>
                                <optgroup label="Ball Sports">
                                    <option value="basketball" data-i18n="act_basketball">æ‰“ç¯®çƒ (Basketball)</option>
                                    <option value="badminton" data-i18n="act_badminton">æ‰“ç¾½æ¯›çƒ (Badminton)</option>
                                    <option value="billiards" data-i18n="act_billiards">æ‰“å°çƒ (Billiards)</option>
                                    <option value="bowling" data-i18n="act_bowling">æ‰“ä¿é¾„çƒ (Bowling)</option>
                                    <option value="racquetball" data-i18n="act_racquetball">ç¾å¼å£çƒ (Racquetball)</option>
                                    <option value="volleyball" data-i18n="act_volleyball">æ‰“æ’çƒ (Volleyball)</option>
                                    <option value="soccer" data-i18n="act_soccer">è¸¢è¶³çƒ (Soccer)</option>
                                    <option value="rugby" data-i18n="act_rugby">æ‰“æ©„æ¦„çƒ (Rugby)</option>
                                    <option value="squash" data-i18n="act_squash">æ‰“å£çƒ (Squash)</option>
                                    <option value="table_tennis" data-i18n="act_table_tennis">ä¹’ä¹“çƒ (Table Tennis)</option>
                                    <option value="ball_sports" data-i18n="act_ball_sports">çƒç±»è¿åŠ¨ (General)</option>
                                </optgroup>
                                <optgroup label="Cardio & Outdoors">
                                    <option value="hiking" data-i18n="act_hiking">å¾’æ­¥æ—…è¡Œ (Hiking)</option>
                                    <option value="biking" data-i18n="act_biking">æˆ·å¤–éª‘è¡Œ (Biking)</option>
                                    <option value="scooter" data-i18n="act_scooter">éª‘æ»‘æ¿è½¦ (Scooter)</option>
                                    <option value="surfing" data-i18n="act_surfing">å†²æµª (Surfing)</option>
                                    <option value="kayaking" data-i18n="act_kayaking">çš®åˆ’è‰‡ (Kayaking)</option>
                                    <option value="rock_climbing" data-i18n="act_rock_climbing">æ”€å²© (Rock Climbing)</option>
                                    <option value="rowing" data-i18n="act_rowing">åˆ’èˆ¹ (Rowing)</option>
                                    <option value="rollerblading" data-i18n="act_rollerblading">è½®æ»‘ (Rollerblading)</option>
                                    <option value="running" data-i18n="act_running">è·‘æ­¥ (Running)</option>
                                    <option value="walking" data-i18n="act_walking">æ­¥è¡Œ (Walking)</option>
                                    <option value="water_walking" data-i18n="act_water_walking">æ°´ä¸­è¡Œèµ° (Water Walking)</option>
                                    <option value="sailing" data-i18n="act_sailing">å¸†èˆ¹/å¸†æ¿ (Sailing)</option>
                                    <option value="shopping" data-i18n="act_shopping">æ­¥è¡Œè´­ç‰© (Shopping)</option>
                                </optgroup>
                                <optgroup label="Fitness & Combat">
                                    <option value="bodycombat" data-i18n="act_bodycombat">æå‡»æ“ (BodyCombat)</option>
                                    <option value="bodybalance" data-i18n="act_bodybalance">èº«å¿ƒå¹³è¡¡ (BodyBalance)</option>
                                    <option value="kickboxing" data-i18n="act_kickboxing">è¸¢æ‹³ (Kickboxing)</option>
                                    <option value="hiit" data-i18n="act_hiit">é«˜å¼ºåº¦é—´æ­‡ (HIIT)</option>
                                    <option value="crossfit" data-i18n="act_crossfit">CrossFit</option>
                                    <option value="spinning" data-i18n="act_spinning">åŠ¨æ„Ÿå•è½¦ (Spinning)</option>
                                </optgroup>
                                <optgroup label="Bodyweight & Low Impact">
                                    <option value="push_ups" data-i18n="act_push_ups">ä¿¯å§æ’‘ (Push-ups)</option>
                                    <option value="squats" data-i18n="act_squats">æ·±è¹² (Squats)</option>
                                    <option value="reverse-crunches" data-i18n="act_crunches">åå‘å·è…¹ (Crunches)</option>
                                    <option value="side-plank" data-i18n="act_plank">ä¾§å¹³æ¿æ”¯æ’‘ (Plank)</option>
                                </optgroup>
                                <optgroup label="Other">
                                    <option value="auto-racing" data-i18n="act_racing">èµ›è½¦æ¯”èµ› (Auto Racing)</option>
                                </optgroup>
                            </select>
                        </div>

                        <!-- Dynamic Input (Duration OR Reps) -->
                        <div id="input-group-duration">
                            <label class="label-text"><span data-i18n="lbl_duration">æŒç»­æ—¶é—´</span> <span class="text-xs text-slate-400">(min)</span></label>
                            <input type="number" id="input-duration" class="input-field font-mono" value="30" oninput="Calculator.calculate()">
                        </div>
                        
                        <div id="input-group-reps" class="hidden">
                            <label class="label-text" data-i18n="lbl_reps">é‡å¤æ¬¡æ•° (Reps)</label>
                            <input type="number" id="input-reps" class="input-field font-mono" value="50" oninput="Calculator.calculate()">
                        </div>

                        <!-- Intensity -->
                        <div>
                            <label class="label-text" data-i18n="lbl_intensity">å¼ºåº¦ç­‰çº§</label>
                            <select id="input-intensity" class="input-field" onchange="Calculator.calculate()">
                                <option value="low" data-i18n="int_low">ä½å¼ºåº¦ (Low)</option>
                                <option value="moderate" selected data-i18n="int_moderate">ä¸­ç­‰å¼ºåº¦ (Moderate)</option>
                                <option value="high" data-i18n="int_high">é«˜å¼ºåº¦ (High)</option>
                            </select>
                        </div>
                    </div>

                    <!-- ================= GAIN MODE INPUTS ================= -->
                    <div id="inputs-gain" class="space-y-5 hidden animate-fade-in">
                        <!-- Gender -->
                        <div>
                            <label class="label-text" data-i18n="lbl_gender">æ€§åˆ«</label>
                            <div class="flex gap-2">
                                <button class="flex-1 py-2 rounded-lg border border-emerald-500 bg-emerald-500 text-white text-sm font-medium transition-all" id="btn-male" onclick="App.setGender('male')">
                                    <i class="fa fa-male mr-1"></i> <span data-i18n="gender_male">ç”·</span>
                                </button>
                                <button class="flex-1 py-2 rounded-lg border border-slate-300 dark:border-slate-600 text-sm font-medium transition-all hover:bg-slate-50 dark:hover:bg-slate-700" id="btn-female" onclick="App.setGender('female')">
                                    <i class="fa fa-female mr-1"></i> <span data-i18n="gender_female">å¥³</span>
                                </button>
                            </div>
                        </div>

                        <!-- Age & Height -->
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="label-text" data-i18n="lbl_age">å¹´é¾„</label>
                                <input type="number" id="input-age" class="input-field font-mono" value="25" oninput="Calculator.calculate()">
                            </div>
                            <div>
                                <label class="label-text"><span data-i18n="lbl_height">èº«é«˜</span> <span id="unit-height" class="text-xs text-slate-400">(cm)</span></label>
                                <input type="number" id="input-height" class="input-field font-mono" value="175" oninput="Calculator.calculate()">
                            </div>
                        </div>

                        <!-- Lifestyle -->
                        <div>
                            <label class="label-text" data-i18n="lbl_lifestyle">æ—¥å¸¸æ´»åŠ¨æ°´å¹³</label>
                            <select id="input-lifestyle" class="input-field" onchange="Calculator.calculate()">
                                <option value="1.2" data-i18n="style_sedentary">ä¹…å</option>
                                <option value="1.375" data-i18n="style_light">è½»åº¦æ´»åŠ¨</option>
                                <option value="1.55" selected data-i18n="style_moderate">ä¸­åº¦æ´»åŠ¨</option>
                                <option value="1.725" data-i18n="style_active">æ´»è·ƒ</option>
                                <option value="1.9" data-i18n="style_extreme">æåº¦æ´»è·ƒ</option>
                            </select>
                        </div>
                    </div>

                </div>

                <!-- Dynamic Hint Box -->
                <div class="bg-orange-50 dark:bg-orange-900/20 rounded-2xl p-4 border border-orange-100 dark:border-orange-800/30 text-sm text-orange-800 dark:text-orange-300 transition-all" id="hint-box">
                    <i class="fa fa-lightbulb-o mr-1"></i> <span id="activity-hint">...</span>
                </div>
            </main>

            <!-- Right Column: Results -->
            <main class="lg:col-span-8 flex flex-col gap-6">
                <div class="glass rounded-3xl shadow-xl overflow-hidden min-h-[500px] flex flex-col">
                    
                    <!-- Header -->
                    <div class="bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-700 p-6 flex justify-between items-center">
                        <h2 class="font-bold text-slate-700 dark:text-slate-200 text-lg" data-i18n="h2_results">åˆ†æç»“æœ</h2>
                        <!-- Timeframe toggle only for Burn mode -->
                        <div id="timeframe-selector" class="flex bg-white dark:bg-slate-800 rounded-lg p-1 border border-slate-200 dark:border-slate-700">
                            <button class="tab-btn active" data-tf="total" onclick="App.setTimeframe('total')" data-i18n="tf_total">æ€»è®¡</button>
                            <button class="tab-btn inactive" data-tf="hour" onclick="App.setTimeframe('hour')" data-i18n="tf_hour">æ¯å°æ—¶</button>
                        </div>
                    </div>

                    <div class="p-6 md:p-8 flex-grow flex flex-col gap-8 animate-fade-in">
                        
                        <!-- ================= BURN RESULTS ================= -->
                        <div id="results-burn" class="space-y-8">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="rounded-2xl border-2 border-orange-500/30 p-6 space-y-2 bg-orange-50/50 dark:bg-orange-900/10 relative overflow-hidden text-center flex flex-col justify-center">
                                    <h4 class="text-xs font-bold text-orange-600 dark:text-orange-400 uppercase tracking-wider" data-i18n="lbl_burned">æ¶ˆè€—çƒ­é‡</h4>
                                    <div class="py-2">
                                        <span class="text-5xl md:text-6xl font-bold font-mono text-slate-800 dark:text-white" id="res-calories">0</span>
                                        <span class="text-sm text-slate-500 block mt-1">kcal</span>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400">Based on your activity</p>
                                </div>

                                <div class="grid grid-rows-3 gap-3">
                                    <div class="bg-slate-50 dark:bg-slate-800/50 rounded-xl px-4 py-3 flex justify-between items-center border border-slate-100 dark:border-slate-700">
                                        <span class="text-xs font-bold text-slate-500 uppercase" data-i18n="metric_fat">é¢„ä¼°ç‡ƒè„‚</span>
                                        <span class="font-mono font-bold text-slate-700 dark:text-slate-200"><span id="res-fat">0</span> g</span>
                                    </div>
                                    <div class="bg-slate-50 dark:bg-slate-800/50 rounded-xl px-4 py-3 flex justify-between items-center border border-slate-100 dark:border-slate-700">
                                        <span class="text-xs font-bold text-slate-500 uppercase" data-i18n="metric_food">ç­‰æ•ˆé£Ÿç‰©</span>
                                        <span class="font-medium text-slate-700 dark:text-slate-200 text-sm text-right" id="res-food">-</span>
                                    </div>
                                    <div class="bg-slate-50 dark:bg-slate-800/50 rounded-xl px-4 py-3 flex justify-between items-center border border-slate-100 dark:border-slate-700">
                                        <span class="text-xs font-bold text-slate-500 uppercase" id="lbl-efficiency">æ•ˆç‡</span>
                                        <span class="font-mono font-bold text-slate-700 dark:text-slate-200"><span id="res-rate">0</span> kcal/min</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Comparison Chart -->
                            <div class="bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-200 dark:border-slate-700">
                                <h4 class="text-sm font-bold text-slate-700 dark:text-slate-300 mb-4" data-i18n="chart_title">æ´»åŠ¨æ•ˆç‡å¯¹æ¯” (30 min)</h4>
                                <div class="h-48 w-full">
                                    <canvas id="burn-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- ================= GAIN RESULTS ================= -->
                        <div id="results-gain" class="hidden space-y-8">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="rounded-2xl border-2 border-emerald-500/30 p-6 space-y-2 bg-emerald-50/50 dark:bg-emerald-900/10 relative overflow-hidden text-center flex flex-col justify-center">
                                    <h4 class="text-xs font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-wider" data-i18n="lbl_gain_target">å¢é‡/å¢è‚Œ æ¯æ—¥ç›®æ ‡</h4>
                                    <div class="py-2">
                                        <span class="text-5xl md:text-6xl font-bold font-mono text-slate-800 dark:text-white" id="res-gain-cal">2,800</span>
                                        <span class="text-sm text-slate-500 block mt-1">kcal / day</span>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400" data-i18n="lbl_gain_subtitle">TDEE + 500 kcal Surplus</p>
                                </div>

                                <div class="space-y-3">
                                    <div class="bg-slate-50 dark:bg-slate-800/50 rounded-xl p-4 border border-slate-100 dark:border-slate-700">
                                        <div class="flex justify-between mb-1">
                                            <span class="text-xs font-bold text-slate-500 uppercase">TDEE (Maintenance)</span>
                                            <span class="font-mono font-bold text-slate-700 dark:text-slate-200" id="res-tdee">2,300</span>
                                        </div>
                                        <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-1.5">
                                            <div class="bg-slate-400 h-1.5 rounded-full" style="width: 80%"></div>
                                        </div>
                                    </div>
                                    <div class="bg-slate-50 dark:bg-slate-800/50 rounded-xl p-4 border border-slate-100 dark:border-slate-700">
                                        <div class="flex justify-between mb-1">
                                            <span class="text-xs font-bold text-slate-500 uppercase">BMR (Basal Rate)</span>
                                            <span class="font-mono font-bold text-slate-700 dark:text-slate-200" id="res-bmr">1,600</span>
                                        </div>
                                        <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-1.5">
                                            <div class="bg-slate-300 h-1.5 rounded-full" style="width: 60%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Macros Chart -->
                            <div class="grid md:grid-cols-2 gap-6 items-center">
                                <div class="h-48 relative flex justify-center">
                                    <canvas id="gain-chart"></canvas>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <h4 class="font-bold text-slate-700 dark:text-slate-200 mb-2" data-i18n="lbl_macros">å®é‡è¥å…»ç´ å»ºè®®</h4>
                                    <div class="flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-emerald-500"></span>
                                        <span class="text-slate-600 dark:text-slate-400 w-20">Carbs</span>
                                        <span class="font-mono font-bold" id="res-macro-c">350g</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                                        <span class="text-slate-600 dark:text-slate-400 w-20">Protein</span>
                                        <span class="font-mono font-bold" id="res-macro-p">175g</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-amber-500"></span>
                                        <span class="text-slate-600 dark:text-slate-400 w-20">Fats</span>
                                        <span class="font-mono font-bold" id="res-macro-f">78g</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </main>
        </div>

        <!-- Comprehensive Activity Guide Section -->
        <section class="glass rounded-2xl p-8 shadow-xl mb-12" id="knowledge-base">
            <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2">
                <i class="fa fa-book text-primary"></i> <span data-i18n="kb_title">å„é¡¹è¿åŠ¨æ¶ˆè€—è¯¦è§£</span>
            </h2>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="activity-grid">
                <!-- Content injected via JS -->
            </div>
            
            <div class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                <h3 class="font-bold text-slate-900 dark:text-white mb-2" data-i18n="guide_title">è®¡ç®—åŸç†è¯´æ˜</h3>
                <p id="guide-burn" data-i18n="guide_p1">
                    <strong>è¿åŠ¨æ¶ˆè€—æ¨¡å¼ï¼š</strong> ä½¿ç”¨ MET ä»£è°¢å½“é‡æ³•ï¼ˆæœ‰æ°§è¿åŠ¨ï¼‰æˆ–ç‰¹å®šåŠ¨ä½œå…¬å¼ï¼ˆæ·±è¹²/HIITï¼‰è®¡ç®—ã€‚
                </p>
                <p id="guide-gain" class="hidden mt-2" data-i18n="guide_p2">
                    <strong>å¢é‡/å¢è‚Œæ¨¡å¼ï¼š</strong> åŸºäº Mifflin-St Jeor å…¬å¼è®¡ç®—æ‚¨çš„ BMR å’Œ TDEEï¼Œç„¶åå¢åŠ  500 å¡è·¯é‡Œçš„çƒ­é‡ç›ˆä½™ã€‚
                </p>
            </div>
        </section>

        <footer class="text-center text-xs text-slate-400 py-6">
            <p>&copy; <span id="year"></span> Ultimate Health Calculator.</p>
        </footer>

    </div>

    <!-- Required Scripts -->
    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>

    <script>
        // --- DATA & CONFIG ---
        const i18nData = {
            'zh-CN': {
                title: "å…¨èƒ½å¥åº·è®¡ç®—å™¨", subtitle: "è¿åŠ¨æ¶ˆè€— & å¢è‚Œå¢é‡è®¡ç®—",
                mode_burn: "è¿åŠ¨æ¶ˆè€—", mode_gain: "TDEE / å¢é‡", h2_config: "è®¡ç®—å‚æ•°",
                lbl_activity: "é€‰æ‹©æ´»åŠ¨ç±»å‹", lbl_weight: "ä½“é‡", lbl_duration: "æŒç»­æ—¶é—´", lbl_reps: "é‡å¤æ¬¡æ•°",
                lbl_intensity: "å¼ºåº¦ç­‰çº§", int_low: "ä½å¼ºåº¦", int_moderate: "ä¸­ç­‰", int_high: "é«˜å¼ºåº¦",
                lbl_gender: "æ€§åˆ«", gender_male: "ç”·", gender_female: "å¥³",
                lbl_age: "å¹´é¾„", lbl_height: "èº«é«˜", lbl_lifestyle: "æ—¥å¸¸æ´»åŠ¨æ°´å¹³",
                style_sedentary: "ä¹…å (åŠå…¬å®¤å·¥ä½œ)", style_light: "è½»åº¦æ´»åŠ¨ (æ¯å‘¨1-3æ¬¡)", style_moderate: "ä¸­åº¦æ´»åŠ¨ (æ¯å‘¨3-5æ¬¡)", style_active: "æ´»è·ƒ (æ¯å‘¨6-7æ¬¡)", style_extreme: "æåº¦æ´»è·ƒ (ä½“åŠ›å·¥ä½œ)",
                h2_results: "åˆ†æç»“æœ", tf_total: "æ€»è®¡", tf_hour: "æ¯å°æ—¶",
                lbl_burned: "æ¶ˆè€—çƒ­é‡", metric_fat: "é¢„ä¼°ç‡ƒè„‚", metric_food: "ç­‰æ•ˆé£Ÿç‰©",
                lbl_gain_target: "å¢é‡æ¯æ—¥ç›®æ ‡", lbl_gain_subtitle: "TDEE + 500 kcal çƒ­é‡ç›ˆä½™", lbl_macros: "è¥å…»ç´ åˆ†é…å»ºè®®",
                kb_title: "å„é¡¹è¿åŠ¨æ¶ˆè€—è¯¦è§£", guide_title: "è®¡ç®—åŸç†è¯´æ˜", chart_title: "æ´»åŠ¨æ•ˆç‡å¯¹æ¯” (30 min)",
                guide_p1: "è¿åŠ¨æ¶ˆè€—æ¨¡å¼ï¼šåŒ…å«é«˜å¼ºåº¦é¡¹ç›®ã€‚ç»“æœåŸºäº MET å…¬å¼åŠç‰¹å®šåŠ¨ä½œåšåŠŸä¼°ç®—ã€‚",
                guide_p2: "å¢é‡æ¨¡å¼ï¼šåŸºäº Mifflin-St Jeor å…¬å¼è®¡ç®— TDEEï¼Œå¹¶å¢åŠ  500 å¡è·¯é‡Œä½œä¸ºå¥åº·çš„å¢é‡ç›ˆä½™ã€‚",
                hint_gain: "å¢é‡éœ€è¦â€˜çƒ­é‡ç›ˆä½™â€™ã€‚å»ºè®®æ¯æ—¥å¤šæ‘„å…¥ 500 å¡è·¯é‡Œï¼Œå¹¶ä¿è¯è›‹ç™½è´¨å……è¶³ä»¥æ”¯æŒè‚Œè‚‰ç”Ÿé•¿ã€‚"
            },
            'zh-TW': {
                title: "å…¨èƒ½å¥åº·è¨ˆç®—å™¨", subtitle: "é‹å‹•æ¶ˆè€— & å¢è‚Œå¢é‡è¨ˆç®—",
                mode_burn: "é‹å‹•æ¶ˆè€—", mode_gain: "TDEE / å¢é‡", h2_config: "è¨ˆç®—åƒæ•¸",
                lbl_activity: "é¸æ“‡æ´»å‹•é¡å‹", lbl_weight: "é«”é‡", lbl_duration: "æŒçºŒæ™‚é–“", lbl_reps: "é‡è¤‡æ¬¡æ•¸",
                lbl_intensity: "å¼·åº¦ç­‰ç´š", int_low: "ä½å¼·åº¦", int_moderate: "ä¸­ç­‰", int_high: "é«˜å¼·åº¦",
                lbl_gender: "æ€§åˆ¥", gender_male: "ç”·", gender_female: "å¥³",
                lbl_age: "å¹´é½¡", lbl_height: "èº«é«˜", lbl_lifestyle: "æ—¥å¸¸æ´»å‹•æ°´å¹³",
                style_sedentary: "ä¹…å (è¾¦å…¬å®¤å·¥ä½œ)", style_light: "è¼•åº¦æ´»å‹• (æ¯é€±1-3æ¬¡)", style_moderate: "ä¸­åº¦æ´»å‹• (æ¯é€±3-5æ¬¡)", style_active: "æ´»èº (æ¯é€±6-7æ¬¡)", style_extreme: "æ¥µåº¦æ´»èº (é«”åŠ›å·¥ä½œ)",
                h2_results: "åˆ†æçµæœ", tf_total: "ç¸½è¨ˆ", tf_hour: "æ¯å°æ™‚",
                lbl_burned: "æ¶ˆè€—ç†±é‡", metric_fat: "é ä¼°ç‡ƒè„‚", metric_food: "ç­‰æ•ˆé£Ÿç‰©",
                lbl_gain_target: "å¢é‡æ¯æ—¥ç›®æ¨™", lbl_gain_subtitle: "TDEE + 500 kcal ç†±é‡ç›ˆé¤˜", lbl_macros: "ç‡Ÿé¤Šç´ åˆ†é…å»ºè­°",
                kb_title: "å„é …é‹å‹•æ¶ˆè€—è©³è§£", guide_title: "è¨ˆç®—åŸç†èªªæ˜", chart_title: "æ´»å‹•æ•ˆç‡å°æ¯” (30 min)",
                guide_p1: "é‹å‹•æ¶ˆè€—æ¨¡å¼ï¼šåŒ…å«é«˜å¼·åº¦é …ç›®ã€‚çµæœåŸºæ–¼ MET å…¬å¼åŠç‰¹å®šå‹•ä½œåšåŠŸä¼°ç®—ã€‚",
                guide_p2: "å¢é‡æ¨¡å¼ï¼šåŸºæ–¼ Mifflin-St Jeor å…¬å¼è¨ˆç®— TDEEï¼Œä¸¦å¢åŠ  500 å¡è·¯é‡Œä½œç‚ºå¥åº·çš„å¢é‡ç›ˆé¤˜ã€‚",
                hint_gain: "å¢é‡éœ€è¦â€˜ç†±é‡ç›ˆé¤˜â€™ã€‚å»ºè­°æ¯æ—¥å¤šæ”å…¥ 500 å¡è·¯é‡Œï¼Œä¸¦ä¿è­‰è›‹ç™½è³ªå……è¶³ä»¥æ”¯æŒè‚Œè‚‰ç”Ÿé•·ã€‚"
            },
            'en': {
                title: "Ultimate Health Calc", subtitle: "Calories Burned & Gain Calculator",
                mode_burn: "Burn Calories", mode_gain: "TDEE / Gain", h2_config: "Configuration",
                lbl_activity: "Activity Type", lbl_weight: "Weight", lbl_duration: "Duration", lbl_reps: "Reps",
                lbl_intensity: "Intensity", int_low: "Low", int_moderate: "Moderate", int_high: "High",
                lbl_gender: "Gender", gender_male: "Male", gender_female: "Female",
                lbl_age: "Age", lbl_height: "Height", lbl_lifestyle: "Activity Level",
                style_sedentary: "Sedentary (Office Job)", style_light: "Light Active (1-3 days/wk)", style_moderate: "Moderate (3-5 days/wk)", style_active: "Active (6-7 days/wk)", style_extreme: "Extreme (Physical Job)",
                h2_results: "Analysis", tf_total: "Total", tf_hour: "Per Hour",
                lbl_burned: "Calories Burned", metric_fat: "Est. Fat Loss", metric_food: "Equivalent Food",
                lbl_gain_target: "Daily Gain Target", lbl_gain_subtitle: "TDEE + 500 kcal Surplus", lbl_macros: "Macro Suggestion",
                kb_title: "Activity Details", guide_title: "Calculation Logic", chart_title: "Efficiency Comparison (30 min)",
                guide_p1: "Burn Mode: Uses MET values (Aerobic) or specific work formulas (Squats/HIIT).",
                guide_p2: "Gain Mode: Calculates TDEE via Mifflin-St Jeor and adds a 500 calorie surplus.",
                hint_gain: "Gaining weight requires a caloric surplus. Aim for +500 kcal/day with sufficient protein."
            },
            'es': {
                title: "Calculadora de Salud", subtitle: "CalorÃ­as Quemadas y Ganancia Muscular",
                mode_burn: "Quemar CalorÃ­as", mode_gain: "TDEE / Ganancia", h2_config: "ConfiguraciÃ³n",
                lbl_activity: "Actividad", lbl_weight: "Peso", lbl_duration: "DuraciÃ³n", lbl_reps: "Repeticiones",
                lbl_intensity: "Intensidad", int_low: "Baja", int_moderate: "Moderada", int_high: "Alta",
                lbl_gender: "GÃ©nero", gender_male: "Hombre", gender_female: "Mujer",
                lbl_age: "Edad", lbl_height: "Altura", lbl_lifestyle: "Nivel de Actividad",
                style_sedentary: "Sedentario", style_light: "Ligeramente Activo", style_moderate: "Moderado", style_active: "Activo", style_extreme: "Muy Activo",
                h2_results: "Resultados", tf_total: "Total", tf_hour: "Por Hora",
                lbl_burned: "CalorÃ­as Quemadas", metric_fat: "Grasa Est.", metric_food: "Comida Equiv.",
                lbl_gain_target: "Objetivo Diario", lbl_gain_subtitle: "TDEE + 500 kcal SuperÃ¡vit", lbl_macros: "Macros Sugeridos",
                kb_title: "Detalles de Actividad", guide_title: "LÃ³gica de CÃ¡lculo", chart_title: "ComparaciÃ³n (30 min)",
                guide_p1: "Modo Quemar: Usa valores MET o fÃ³rmulas de trabajo especÃ­ficas.",
                guide_p2: "Modo Ganancia: Calcula TDEE y agrega 500 calorÃ­as de superÃ¡vit.",
                hint_gain: "Ganar peso requiere un superÃ¡vit calÃ³rico. Apunta a +500 kcal/dÃ­a."
            },
            'ja': {
                title: "ç©¶æ¥µã®å¥åº·è¨ˆç®—æ©Ÿ", subtitle: "æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ & å¢—é‡è¨ˆç®—",
                mode_burn: "ç‡ƒç„¼ãƒ¢ãƒ¼ãƒ‰", mode_gain: "TDEE / å¢—é‡", h2_config: "è¨­å®š",
                lbl_activity: "æ´»å‹•ã‚¿ã‚¤ãƒ—", lbl_weight: "ä½“é‡", lbl_duration: "æ™‚é–“ (åˆ†)", lbl_reps: "å›æ•°",
                lbl_intensity: "å¼·åº¦", int_low: "ä½", int_moderate: "ä¸­", int_high: "é«˜",
                lbl_gender: "æ€§åˆ¥", gender_male: "ç”·æ€§", gender_female: "å¥³æ€§",
                lbl_age: "å¹´é½¢", lbl_height: "èº«é•·", lbl_lifestyle: "æ´»å‹•ãƒ¬ãƒ™ãƒ«",
                style_sedentary: "åº§ã‚Šä»•äº‹", style_light: "è»½ã„é‹å‹• (é€±1-3å›)", style_moderate: "ä¸­ç¨‹åº¦ã®é‹å‹• (é€±3-5å›)", style_active: "æ´»ç™º (é€±6-7å›)", style_extreme: "éå¸¸ã«æ´»ç™º",
                h2_results: "åˆ†æçµæœ", tf_total: "åˆè¨ˆ", tf_hour: "1æ™‚é–“ã‚ãŸã‚Š",
                lbl_burned: "æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼", metric_fat: "äºˆæƒ³è„‚è‚ªç‡ƒç„¼", metric_food: "ç›¸å½“ã™ã‚‹é£Ÿäº‹",
                lbl_gain_target: "å¢—é‡ç›®æ¨™", lbl_gain_subtitle: "TDEE + 500 kcal", lbl_macros: "ãƒã‚¯ãƒ­æ „é¤Šç´ ",
                kb_title: "æ´»å‹•ã®è©³ç´°", guide_title: "è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯", chart_title: "åŠ¹ç‡æ¯”è¼ƒ (30åˆ†)",
                guide_p1: "ç‡ƒç„¼ãƒ¢ãƒ¼ãƒ‰ï¼šMETå€¤ã¾ãŸã¯ç‰¹å®šã®å‹•ä½œå…¬å¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚",
                guide_p2: "å¢—é‡ãƒ¢ãƒ¼ãƒ‰ï¼šMifflin-St Jeorå¼ã§TDEEã‚’è¨ˆç®—ã—ã€500kcalã‚’è¿½åŠ ã—ã¾ã™ã€‚",
                hint_gain: "å¢—é‡ã«ã¯ã‚«ãƒ­ãƒªãƒ¼ã®ä½™å‰°ãŒå¿…è¦ã§ã™ã€‚1æ—¥+500kcalã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚"
            },
            'ru': {
                title: "ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ", subtitle: "Ğ¡Ğ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ Ğ¸ ĞĞ°Ğ±Ğ¾Ñ€ Ğ¼Ğ°ÑÑÑ‹",
                mode_burn: "Ğ¡Ğ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ", mode_gain: "TDEE / ĞĞ°Ğ±Ğ¾Ñ€", h2_config: "ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹",
                lbl_activity: "Ğ’Ğ¸Ğ´ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸", lbl_weight: "Ğ’ĞµÑ", lbl_duration: "Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ", lbl_reps: "ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ",
                lbl_intensity: "Ğ˜Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ", int_low: "ĞĞ¸Ğ·ĞºĞ°Ñ", int_moderate: "Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ", int_high: "Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ",
                lbl_gender: "ĞŸĞ¾Ğ»", gender_male: "ĞœÑƒĞ¶", gender_female: "Ğ–ĞµĞ½",
                lbl_age: "Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚", lbl_height: "Ğ Ğ¾ÑÑ‚", lbl_lifestyle: "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸",
                style_sedentary: "Ğ¡Ğ¸Ğ´ÑÑ‡Ğ¸Ğ¹", style_light: "Ğ›ĞµĞ³ĞºĞ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ", style_moderate: "Ğ£Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ°Ñ", style_active: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ", style_extreme: "Ğ­ĞºÑÑ‚Ñ€ĞµĞ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ",
                h2_results: "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹", tf_total: "Ğ’ÑĞµĞ³Ğ¾", tf_hour: "Ğ’ Ñ‡Ğ°Ñ",
                lbl_burned: "Ğ¡Ğ¾Ğ¶Ğ¶ĞµĞ½Ğ¾", metric_fat: "Ğ–Ğ¸Ñ€ (Ğ³)", metric_food: "Ğ•Ğ´Ğ°",
                lbl_gain_target: "Ğ¦ĞµĞ»ÑŒ (ĞºĞºĞ°Ğ»)", lbl_gain_subtitle: "TDEE + 500 ĞºĞºĞ°Ğ»", lbl_macros: "ĞœĞ°ĞºÑ€Ğ¾Ğ½ÑƒÑ‚Ñ€Ğ¸ĞµĞ½Ñ‚Ñ‹",
                kb_title: "Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸", guide_title: "Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ°", chart_title: "Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ (30 Ğ¼Ğ¸Ğ½)",
                guide_p1: "Ğ ĞµĞ¶Ğ¸Ğ¼ ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ñ: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ MET Ğ¸Ğ»Ğ¸ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹.",
                guide_p2: "Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°: Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ TDEE Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ 500 ĞºĞºĞ°Ğ».",
                hint_gain: "Ğ”Ğ»Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ğ²ĞµÑĞ° Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ (+500 ĞºĞºĞ°Ğ»/Ğ´ĞµĞ½ÑŒ)."
            },
            'hi': {
                title: "à¤¹à¥‡à¤²à¥à¤¥ à¤•à¥ˆà¤²à¤•à¥à¤²à¥‡à¤Ÿà¤°", subtitle: "à¤•à¥ˆà¤²à¥‹à¤°à¥€ à¤¬à¤°à¥à¤¨ à¤”à¤° à¤µà¤œà¤¨ à¤¬à¥à¤¾à¤¨à¤¾",
                mode_burn: "à¤•à¥ˆà¤²à¥‹à¤°à¥€ à¤¬à¤°à¥à¤¨", mode_gain: "TDEE / à¤µà¤œà¤¨ à¤¬à¥à¤¾à¤¨à¤¾", h2_config: "à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",
                lbl_activity: "à¤—à¤¤à¤¿à¤µà¤¿à¤§à¤¿ à¤šà¥à¤¨à¥‡à¤‚", lbl_weight: "à¤µà¤œà¤¨", lbl_duration: "à¤…à¤µà¤§à¤¿", lbl_reps: "à¤¦à¥‹à¤¹à¤°à¤¾à¤µ (Reps)",
                lbl_intensity: "à¤¤à¥€à¤µà¥à¤°à¤¤à¤¾", int_low: "à¤•à¤®", int_moderate: "à¤®à¤§à¥à¤¯à¤®", int_high: "à¤‰à¤šà¥à¤š",
                lbl_gender: "à¤²à¤¿à¤‚à¤—", gender_male: "à¤ªà¥à¤°à¥à¤·", gender_female: "à¤®à¤¹à¤¿à¤²à¤¾",
                lbl_age: "à¤‰à¤®à¥à¤°", lbl_height: "à¤•à¤¦", lbl_lifestyle: "à¤¸à¤•à¥à¤°à¤¿à¤¯à¤¤à¤¾ à¤¸à¥à¤¤à¤°",
                style_sedentary: "à¤¨à¤¿à¤·à¥à¤•à¥à¤°à¥€à¤¯", style_light: "à¤¹à¤²à¥à¤•à¤¾ à¤¸à¤•à¥à¤°à¤¿à¤¯", style_moderate: "à¤®à¤§à¥à¤¯à¤®", style_active: "à¤¸à¤•à¥à¤°à¤¿à¤¯", style_extreme: "à¤…à¤¤à¥à¤¯à¤§à¤¿à¤• à¤¸à¤•à¥à¤°à¤¿à¤¯",
                h2_results: "à¤ªà¤°à¤¿à¤£à¤¾à¤®", tf_total: "à¤•à¥à¤²", tf_hour: "à¤ªà¥à¤°à¤¤à¤¿ à¤˜à¤‚à¤Ÿà¤¾",
                lbl_burned: "à¤•à¥ˆà¤²à¥‹à¤°à¥€ à¤¬à¤°à¥à¤¨", metric_fat: "à¤«à¥ˆà¤Ÿ à¤²à¥‰à¤¸", metric_food: "à¤­à¥‹à¤œà¤¨",
                lbl_gain_target: "à¤¦à¥ˆà¤¨à¤¿à¤• à¤²à¤•à¥à¤·à¥à¤¯", lbl_gain_subtitle: "TDEE + 500 à¤•à¥ˆà¤²à¥‹à¤°à¥€", lbl_macros: "à¤®à¥ˆà¤•à¥à¤°à¥‹à¤¨à¥à¤¯à¥‚à¤Ÿà¥à¤°à¤¿à¤à¤‚à¤Ÿà¥à¤¸",
                kb_title: "à¤—à¤¤à¤¿à¤µà¤¿à¤§à¤¿ à¤µà¤¿à¤µà¤°à¤£", guide_title: "à¤—à¤£à¤¨à¤¾ à¤•à¤¾ à¤†à¤§à¤¾à¤°", chart_title: "à¤¤à¥à¤²à¤¨à¤¾ (30 à¤®à¤¿à¤¨à¤Ÿ)",
                guide_p1: "à¤¬à¤°à¥à¤¨ à¤®à¥‹à¤¡: MET à¤®à¥‚à¤²à¥à¤¯à¥‹à¤‚ à¤¯à¤¾ à¤µà¤¿à¤¶à¤¿à¤·à¥à¤Ÿ à¤•à¤¾à¤°à¥à¤¯ à¤¸à¥‚à¤¤à¥à¤°à¥‹à¤‚ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆà¥¤",
                guide_p2: "à¤—à¥‡à¤¨ à¤®à¥‹à¤¡: TDEE à¤•à¥€ à¤—à¤£à¤¨à¤¾ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ à¤”à¤° 500 à¤•à¥ˆà¤²à¥‹à¤°à¥€ à¤œà¥‹à¤¡à¤¼à¤¤à¤¾ à¤¹à¥ˆà¥¤",
                hint_gain: "à¤µà¤œà¤¨ à¤¬à¤¢à¤¼à¤¾à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥ˆà¤²à¥‹à¤°à¥€ à¤…à¤§à¤¿à¤¶à¥‡à¤· à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆ (+500/à¤¦à¤¿à¤¨)à¥¤"
            },
            'pl': {
                title: "Kalkulator Zdrowia", subtitle: "Spalanie Kalorii i Masa",
                mode_burn: "Spalanie", mode_gain: "TDEE / Masa", h2_config: "Konfiguracja",
                lbl_activity: "AktywnoÅ›Ä‡", lbl_weight: "Waga", lbl_duration: "Czas", lbl_reps: "PowtÃ³rzenia",
                lbl_intensity: "IntensywnoÅ›Ä‡", int_low: "Niska", int_moderate: "Åšrednia", int_high: "Wysoka",
                lbl_gender: "PÅ‚eÄ‡", gender_male: "M", gender_female: "K",
                lbl_age: "Wiek", lbl_height: "Wzrost", lbl_lifestyle: "Poziom aktywnoÅ›ci",
                style_sedentary: "SiedzÄ…cy", style_light: "Lekko aktywny", style_moderate: "Umiarkowany", style_active: "Aktywny", style_extreme: "Bardzo aktywny",
                h2_results: "Wyniki", tf_total: "Razem", tf_hour: "Na godz.",
                lbl_burned: "Spalone Kalorie", metric_fat: "TÅ‚uszcz", metric_food: "Jedzenie",
                lbl_gain_target: "Cel Dzienny", lbl_gain_subtitle: "TDEE + 500 kcal", lbl_macros: "MakroskÅ‚adniki",
                kb_title: "SzczegÃ³Å‚y", guide_title: "Metoda obliczeÅ„", chart_title: "PorÃ³wnanie (30 min)",
                guide_p1: "Tryb spalania: UÅ¼ywa wartoÅ›ci MET lub wzorÃ³w pracy.",
                guide_p2: "Tryb masy: Oblicza TDEE i dodaje 500 kcal nadwyÅ¼ki.",
                hint_gain: "Przyrost masy wymaga nadwyÅ¼ki kalorycznej. Celuj w +500 kcal/dzieÅ„."
            }
        };

        // --- CORE LOGIC ---
        const Logic = {
            activities: {
                'gardening': { type: 'duration', met: 3.8, hint: 'hint_gardening', desc: 'desc_gardening', icon: 'fa-leaf', color: 'text-green-600', bg: 'bg-green-100 dark:bg-green-900/30' },
                'skydiving': { type: 'duration', met: 3.5, hint: 'hint_skydiving', desc: 'desc_skydiving', icon: 'fa-cloud', color: 'text-sky-500', bg: 'bg-sky-100 dark:bg-sky-900/30' },
                'stairs': { type: 'duration', met: 8.0, hint: 'hint_stairs', desc: 'desc_stairs', icon: 'fa-level-up', color: 'text-orange-600', bg: 'bg-orange-100 dark:bg-orange-900/30' },
                'swimming': { type: 'duration', met: 6.0, hint: 'hint_swimming', desc: 'desc_swimming', icon: 'fa-tint', color: 'text-blue-500', bg: 'bg-blue-100 dark:bg-blue-900/30' },
                'dancing': { type: 'duration', met: 5.5, hint: 'hint_dancing', desc: 'desc_dancing', icon: 'fa-music', color: 'text-purple-500', bg: 'bg-purple-100 dark:bg-purple-900/30' },
                'jogging': { type: 'duration', met: 7.0, hint: 'hint_jogging', desc: 'desc_jogging', icon: 'fa-road', color: 'text-orange-500', bg: 'bg-orange-100 dark:bg-orange-900/30' },
                'jumping_rope': { type: 'duration', met: 11.0, hint: 'hint_jumping_rope', desc: 'desc_jumping_rope', icon: 'fa-heartbeat', color: 'text-red-600', bg: 'bg-red-100 dark:bg-red-900/30' },
                'kayaking': { type: 'duration', met: 5.0, hint: 'hint_kayaking', desc: 'desc_kayaking', icon: 'fa-ship', color: 'text-blue-600', bg: 'bg-blue-100 dark:bg-blue-900/30' },
                'rock_climbing': { type: 'duration', met: 8.0, hint: 'hint_rock_climbing', desc: 'desc_rock_climbing', icon: 'fa-hand-rock-o', color: 'text-stone-600', bg: 'bg-stone-200 dark:bg-stone-700/50' },
                'rollerblading': { type: 'duration', met: 7.0, hint: 'hint_rollerblading', desc: 'desc_rollerblading', icon: 'fa-circle-o', color: 'text-pink-600', bg: 'bg-pink-100 dark:bg-pink-900/30' },
                'running': { type: 'duration', met: 9.8, hint: 'hint_running', desc: 'desc_running', icon: 'fa-road', color: 'text-orange-600', bg: 'bg-orange-100 dark:bg-orange-900/30' },
                'basketball': { type: 'duration', met: 8.0, hint: 'hint_basketball', desc: 'desc_basketball', icon: 'fa-dribbble', color: 'text-orange-600', bg: 'bg-orange-100 dark:bg-orange-900/30' },
                'badminton': { type: 'duration', met: 5.5, hint: 'hint_badminton', desc: 'desc_badminton', icon: 'fa-rocket', color: 'text-green-500', bg: 'bg-green-100 dark:bg-green-900/30' },
                'billiards': { type: 'duration', met: 2.5, hint: 'hint_billiards', desc: 'desc_billiards', icon: 'fa-dot-circle-o', color: 'text-slate-600', bg: 'bg-slate-200 dark:bg-slate-700/50' },
                'bowling': { type: 'duration', met: 3.0, hint: 'hint_bowling', desc: 'desc_bowling', icon: 'fa-circle', color: 'text-blue-500', bg: 'bg-blue-100 dark:bg-blue-900/30' },
                'racquetball': { type: 'duration', met: 7.0, hint: 'hint_racquetball', desc: 'desc_racquetball', icon: 'fa-play-circle', color: 'text-indigo-500', bg: 'bg-indigo-100 dark:bg-indigo-900/30' },
                'ball_sports': { type: 'duration', met: 6.0, hint: 'hint_ball_sports', desc: 'desc_ball_sports', icon: 'fa-futbol-o', color: 'text-teal-600', bg: 'bg-teal-100 dark:bg-teal-900/30' },
                'walking': { type: 'duration', met: 3.5, hint: 'hint_walking', desc: 'desc_walking', icon: 'fa-male', color: 'text-cyan-500', bg: 'bg-cyan-100 dark:bg-cyan-900/30' },
                'water_walking': { type: 'duration', met: 4.5, hint: 'hint_water_walking', desc: 'desc_water_walking', icon: 'fa-life-ring', color: 'text-blue-400', bg: 'bg-blue-50 dark:bg-blue-900/20' },
                'sailing': { type: 'duration', met: 4.0, hint: 'hint_sailing', desc: 'desc_sailing', icon: 'fa-ship', color: 'text-sky-600', bg: 'bg-sky-100 dark:bg-sky-900/30' },
                'bodycombat': { type: 'duration', met: 8.5, hint: 'hint_bodycombat', desc: 'desc_bodycombat', icon: 'fa-hand-rock-o', color: 'text-red-700', bg: 'bg-red-50 dark:bg-red-900/30' },
                'bodybalance': { type: 'duration', met: 3.5, hint: 'hint_bodybalance', desc: 'desc_bodybalance', icon: 'fa-leaf', color: 'text-green-500', bg: 'bg-green-50 dark:bg-green-900/30' },
                'volleyball': { type: 'duration', met: 6.0, hint: 'hint_volleyball', desc: 'desc_volleyball', icon: 'fa-circle-o', color: 'text-yellow-600', bg: 'bg-yellow-50 dark:bg-yellow-900/30' },
                'skiing': { type: 'duration', met: 7.0, hint: 'hint_skiing', desc: 'desc_skiing', icon: 'fa-snowflake-o', color: 'text-cyan-500', bg: 'bg-cyan-50 dark:bg-cyan-900/30' },
                'hiking': { type: 'duration', met: 6.0, hint: 'hint_hiking', desc: 'desc_hiking', icon: 'fa-tree', color: 'text-emerald-700', bg: 'bg-emerald-100 dark:bg-emerald-900/30' },
                'biking': { type: 'duration', met: 7.5, hint: 'hint_biking', desc: 'desc_biking', icon: 'fa-bicycle', color: 'text-blue-600', bg: 'bg-blue-100 dark:bg-blue-900/30' },
                'spinning': { type: 'duration', met: 8.5, hint: 'hint_spinning', desc: 'desc_spinning', icon: 'fa-refresh', color: 'text-purple-600', bg: 'bg-purple-100 dark:bg-purple-900/30' },
                'scooter': { type: 'duration', met: 5.0, hint: 'hint_scooter', desc: 'desc_scooter', icon: 'fa-motorcycle', color: 'text-lime-600', bg: 'bg-lime-100 dark:bg-lime-900/30' },
                'surfing': { type: 'duration', met: 4.0, hint: 'hint_surfing', desc: 'desc_surfing', icon: 'fa-tint', color: 'text-blue-500', bg: 'bg-blue-100 dark:bg-blue-900/30' },
                'soccer': { type: 'duration', met: 8.0, hint: 'hint_soccer', desc: 'desc_soccer', icon: 'fa-futbol-o', color: 'text-green-600', bg: 'bg-green-100 dark:bg-green-900/30' },
                'push_ups': { type: 'reps', baseFactor: 0.35, hint: 'hint_push_ups', desc: 'desc_push_ups', icon: 'fa-chevron-down', color: 'text-gray-700', bg: 'bg-gray-100 dark:bg-gray-800' },
                'squash': { type: 'duration', met: 10.0, hint: 'hint_squash', desc: 'desc_squash', icon: 'fa-trophy', color: 'text-indigo-600', bg: 'bg-indigo-100 dark:bg-indigo-900/30' },
                'table_tennis': { type: 'duration', met: 4.0, hint: 'hint_table_tennis', desc: 'desc_table_tennis', icon: 'fa-circle', color: 'text-blue-400', bg: 'bg-blue-50 dark:bg-blue-900/20' },
                'roller_skating': { type: 'duration', met: 7.0, hint: 'hint_roller_skating', desc: 'desc_roller_skating', icon: 'fa-bicycle', color: 'text-purple-500', bg: 'bg-purple-100 dark:bg-purple-900/30' },
                'rugby': { type: 'duration', met: 10.0, hint: 'hint_rugby', desc: 'desc_rugby', icon: 'fa-shield', color: 'text-amber-700', bg: 'bg-amber-100 dark:bg-amber-900/30' },
                'shopping': { type: 'duration', met: 2.3, hint: 'hint_shopping', desc: 'desc_shopping', icon: 'fa-shopping-bag', color: 'text-pink-500', bg: 'bg-pink-100 dark:bg-pink-900/30' },
                'rowing': { type: 'duration', met: 7.0, hint: 'hint_rowing', desc: 'desc_rowing', icon: 'fa-ship', color: 'text-cyan-600', bg: 'bg-cyan-100 dark:bg-cyan-900/30' },
                'kickboxing': { type: 'duration', met: 10.0, hint: 'hint_kickboxing', desc: 'desc_kickboxing', icon: 'fa-hand-rock-o', color: 'text-red-500', bg: 'bg-red-100 dark:bg-red-900/30' },
                'hiit': { type: 'duration', met: 9.5, hint: 'hint_hiit', desc: 'desc_hiit', icon: 'fa-bolt', color: 'text-yellow-500', bg: 'bg-yellow-100 dark:bg-yellow-900/30' },
                'crossfit': { type: 'duration', met: 12.5, hint: 'hint_crossfit', desc: 'desc_crossfit', icon: 'fa-users', color: 'text-orange-500', bg: 'bg-orange-100 dark:bg-orange-900/30' },
                'squats': { type: 'reps', baseFactor: 0.32, hint: 'hint_squats', desc: 'desc_squats', icon: 'fa-arrow-down', color: 'text-blue-500', bg: 'bg-blue-100 dark:bg-blue-900/30' },
                'reverse-crunches': { type: 'duration', met: 5.0, hint: 'hint_crunches', desc: 'desc_crunches', icon: 'fa-circle-o-notch', color: 'text-indigo-500', bg: 'bg-indigo-100 dark:bg-indigo-900/30' },
                'side-plank': { type: 'duration', met: 3.8, hint: 'hint_plank', desc: 'desc_plank', icon: 'fa-minus', color: 'text-teal-500', bg: 'bg-teal-100 dark:bg-teal-900/30' },
                'auto-racing': { type: 'duration', met: 7.0, hint: 'hint_racing', desc: 'desc_racing', icon: 'fa-car', color: 'text-slate-600', bg: 'bg-slate-200 dark:bg-slate-700/50' }
            },

            getIntensityFactor(level) {
                return level === 'low' ? 0.8 : (level === 'high' ? 1.2 : 1.0);
            },

            calculateBurn(activity, weightKg, inputVal, intensity) {
                const config = this.activities[activity] || this.activities['walking'];
                const factor = this.getIntensityFactor(intensity);
                let calories = 0;

                if (config.type === 'reps') {
                    // Formula for reps
                    const coeff = activity === 'push_ups' ? 0.0050 : 0.0065;
                    calories = weightKg * inputVal * coeff * factor;
                } else {
                    // MET Formula
                    calories = config.met * weightKg * (inputVal / 60) * factor;
                }

                return {
                    calories: calories,
                    fat: calories / 7.7
                };
            },

            calculateGain(weightKg, heightCm, age, gender, activityLevel) {
                // Mifflin-St Jeor
                let s = (gender === 'male') ? 5 : -161;
                let bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) + s;
                let tdee = bmr * parseFloat(activityLevel);
                let target = tdee + 500;

                return {
                    bmr: bmr,
                    tdee: tdee,
                    target: target,
                    macros: {
                        c: (target * 0.50) / 4,
                        p: (target * 0.25) / 4,
                        f: (target * 0.25) / 9
                    }
                };
            }
        };

        // --- APP CONTROLLER ---
        const App = {
            lang: 'zh-CN',
            unit: 'metric',
            mode: 'burn', 
            gender: 'male',
            charts: {},

            init() {
                // URL Parameter Logic
                const urlParams = new URLSearchParams(window.location.search);
                const urlLang = urlParams.get('lang');
                
                // Fallback valid languages
                const validLangs = ['zh-CN', 'zh-TW', 'en', 'es', 'ja', 'ru', 'hi', 'pl'];
                
                if (urlLang && validLangs.includes(urlLang)) {
                    this.lang = urlLang;
                    document.getElementById('lang-selector').value = urlLang;
                } else {
                    this.lang = document.getElementById('lang-selector').value;
                }

                this.setupListeners();
                this.setUnit('metric');
                this.setMode('burn');
                document.getElementById('year').textContent = new Date().getFullYear();
                this.updateUI(); // Trigger UI update to set initial text
                this.initCharts();
            },

            setupListeners() {
                document.getElementById('lang-selector').addEventListener('change', (e) => {
                    this.lang = e.target.value;
                    
                    // Update URL without reloading
                    try {
                        const url = new URL(window.location);
                        url.searchParams.set('lang', this.lang);
                        window.history.pushState({}, '', url);
                    } catch (err) {
                        console.warn('Unable to update URL parameters (likely running in a secure sandbox):', err);
                    }

                    this.updateUI();
                });
                document.getElementById('mode-toggle').addEventListener('click', () => {
                    document.documentElement.classList.toggle('dark');
                    this.updateChartsTheme();
                });
            },

            renderKnowledgeBase() {
                const grid = document.getElementById('activity-grid');
                if(!grid) return;
                grid.innerHTML = '';
                
                const dict = i18nData[this.lang] || i18nData['en'];
                const fallbackDict = i18nData['en']; // Fallback for missing descriptions
                
                Object.entries(Logic.activities).forEach(([key, act]) => {
                    // Try current lang, then english, then just key name
                    const title = dict[`act_${key}`] || fallbackDict[`act_${key}`] || key;
                    const desc = dict[act.desc] || fallbackDict[act.desc] || "Description not available in this language.";

                    const card = document.createElement('div');
                    card.className = 'info-card';
                    card.innerHTML = `
                        <div class="info-icon ${act.bg} ${act.color}">
                            <i class="fa ${act.icon}"></i>
                        </div>
                        <h4 class="font-bold text-slate-800 dark:text-white mb-2">${title}</h4>
                        <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed">
                            ${desc}
                        </p>
                    `;
                    grid.appendChild(card);
                });
            },

            setMode(mode) {
                this.mode = mode;
                
                const btnBurn = document.getElementById('mode-btn-burn');
                const btnGain = document.getElementById('mode-btn-gain');
                const inputCard = document.getElementById('input-card');
                const hintBox = document.getElementById('hint-box');
                const guideBurn = document.getElementById('guide-burn');
                const guideGain = document.getElementById('guide-gain');
                const tfSelector = document.getElementById('timeframe-selector');
                const kbSection = document.getElementById('knowledge-base');

                if (mode === 'burn') {
                    btnBurn.className = 'mode-switch active-burn';
                    btnGain.className = 'mode-switch inactive';
                    
                    document.getElementById('inputs-burn').classList.remove('hidden');
                    document.getElementById('inputs-gain').classList.add('hidden');
                    document.getElementById('results-burn').classList.remove('hidden');
                    document.getElementById('results-gain').classList.add('hidden');
                    
                    inputCard.classList.remove('border-t-emerald-500');
                    inputCard.classList.add('border-t-orange-500');
                    
                    hintBox.classList.remove('bg-emerald-50', 'dark:bg-emerald-900/20', 'text-emerald-800', 'dark:text-emerald-300', 'border-emerald-100');
                    hintBox.classList.add('bg-orange-50', 'dark:bg-orange-900/20', 'text-orange-800', 'dark:text-orange-300', 'border-orange-100');
                    
                    guideBurn.classList.remove('hidden');
                    guideGain.classList.add('hidden');
                    tfSelector.classList.remove('invisible');
                    kbSection.classList.remove('hidden');

                    this.handleActivityChange(); 
                } else {
                    btnBurn.className = 'mode-switch inactive';
                    btnGain.className = 'mode-switch active-gain';
                    
                    document.getElementById('inputs-burn').classList.add('hidden');
                    document.getElementById('inputs-gain').classList.remove('hidden');
                    document.getElementById('results-burn').classList.add('hidden');
                    document.getElementById('results-gain').classList.remove('hidden');

                    inputCard.classList.remove('border-t-orange-500');
                    inputCard.classList.add('border-t-emerald-500');

                    hintBox.classList.remove('bg-orange-50', 'dark:bg-orange-900/20', 'text-orange-800', 'dark:text-orange-300', 'border-orange-100');
                    hintBox.classList.add('bg-emerald-50', 'dark:bg-emerald-900/20', 'text-emerald-800', 'dark:text-emerald-300', 'border-emerald-100');

                    guideBurn.classList.add('hidden');
                    guideGain.classList.remove('hidden');
                    tfSelector.classList.add('invisible');
                    kbSection.classList.add('hidden');

                    const dict = i18nData[this.lang] || i18nData['en'];
                    const fallback = i18nData['en'];
                    document.getElementById('activity-hint').textContent = dict['hint_gain'] || fallback['hint_gain'];
                }

                Calculator.calculate();
            },

            setUnit(u) {
                this.unit = u;
                const isMetric = u === 'metric';
                
                const btnM = document.getElementById('btn-metric');
                const btnI = document.getElementById('btn-imperial');
                
                const activeClass = isMetric ? 'bg-white dark:bg-slate-700 shadow-sm text-slate-800 dark:text-white' : 'text-slate-500 hover:text-slate-800 dark:hover:text-white';
                const inactiveClass = !isMetric ? 'bg-white dark:bg-slate-700 shadow-sm text-slate-800 dark:text-white' : 'text-slate-500 hover:text-slate-800 dark:hover:text-white';
                
                btnM.className = `px-3 py-1 text-xs font-bold rounded-md transition-all ${activeClass}`;
                btnI.className = `px-3 py-1 text-xs font-bold rounded-md transition-all ${inactiveClass}`;

                document.getElementById('unit-weight').textContent = isMetric ? '(kg)' : '(lbs)';
                document.getElementById('unit-height').textContent = isMetric ? '(cm)' : '(in)';
                
                const wInput = document.getElementById('input-weight');
                const hInput = document.getElementById('input-height');
                
                let wVal = parseFloat(wInput.value) || 0;
                let hVal = parseFloat(hInput.value) || 0;

                if (wVal > 0) wInput.value = Math.round(isMetric ? wVal * 0.453592 : wVal * 2.20462);
                if (hVal > 0) hInput.value = Math.round(isMetric ? hVal * 2.54 : hVal / 2.54);

                Calculator.calculate();
            },

            setGender(g) {
                this.gender = g;
                document.getElementById('btn-male').className = `flex-1 py-2 rounded-lg text-sm font-medium transition-all ${g === 'male' ? 'border border-emerald-500 bg-emerald-500 text-white' : 'border border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700'}`;
                document.getElementById('btn-female').className = `flex-1 py-2 rounded-lg text-sm font-medium transition-all ${g === 'female' ? 'border border-emerald-500 bg-emerald-500 text-white' : 'border border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700'}`;
                Calculator.calculate();
            },

            handleActivityChange() {
                const activity = document.getElementById('input-activity').value;
                const config = Logic.activities[activity];
                
                if (config.type === 'reps') {
                    document.getElementById('input-group-duration').classList.add('hidden');
                    document.getElementById('input-group-reps').classList.remove('hidden');
                } else {
                    document.getElementById('input-group-duration').classList.remove('hidden');
                    document.getElementById('input-group-reps').classList.add('hidden');
                }

                const dict = i18nData[this.lang] || i18nData['en'];
                const fallback = i18nData['en'];
                document.getElementById('activity-hint').textContent = dict[config.hint] || fallback[config.hint] || "...";

                Calculator.calculate();
            },

            setTimeframe(tf) {
                document.querySelectorAll('#timeframe-selector .tab-btn').forEach(b => {
                    b.classList.remove('active');
                    b.classList.add('inactive');
                    if(b.dataset.tf === tf) {
                        b.classList.add('active');
                        b.classList.remove('inactive');
                    }
                });
                Calculator.calculate();
            },

            updateUI() {
                const dict = i18nData[this.lang] || i18nData['en'];
                const fallbackDict = i18nData['en'];
                document.documentElement.lang = this.lang;
                
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    // Translate OR Fallback OR keep existing
                    if (dict[key]) el.textContent = dict[key];
                    else if (fallbackDict[key]) el.textContent = fallbackDict[key];
                });
                
                // Update dropdown options
                const select = document.getElementById('input-activity');
                Array.from(select.options).forEach(opt => {
                    const key = opt.getAttribute('data-i18n');
                    if(key) {
                        opt.textContent = dict[key] || fallbackDict[key] || opt.textContent;
                    }
                });

                this.renderKnowledgeBase();

                if(this.mode === 'burn') this.handleActivityChange();
                else document.getElementById('activity-hint').textContent = dict['hint_gain'] || fallbackDict['hint_gain'];
            },

            initCharts() {
                const ctxBurn = document.getElementById('burn-chart').getContext('2d');
                this.charts.burn = new Chart(ctxBurn, {
                    type: 'bar',
                    data: {
                        labels: ['Walk', 'Jog', 'Jump Rope', 'Dance', 'Run', 'CrossFit'],
                        datasets: [{
                            label: 'kcal / 30min',
                            data: [120, 240, 380, 180, 340, 430],
                            backgroundColor: ['#94a3b8', '#f97316', '#ef4444', '#a855f7', '#f59e0b', '#ec4899'],
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                            x: { grid: { display: false } }
                        }
                    }
                });

                const ctxGain = document.getElementById('gain-chart').getContext('2d');
                this.charts.gain = new Chart(ctxGain, {
                    type: 'doughnut',
                    data: {
                        labels: ['Carbs (50%)', 'Protein (25%)', 'Fats (25%)'],
                        datasets: [{
                            data: [50, 25, 25],
                            backgroundColor: ['#10b981', '#3b82f6', '#f59e0b'],
                            borderWidth: 0,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: { legend: { display: false } }
                    }
                });

                this.updateChartsTheme();
            },

            updateChartsTheme() {
                const isDark = document.documentElement.classList.contains('dark');
                const gridColor = isDark ? '#334155' : '#e2e8f0';
                const textColor = isDark ? '#94a3b8' : '#64748b';

                if (this.charts.burn) {
                    this.charts.burn.options.scales.y.grid.color = gridColor;
                    this.charts.burn.options.scales.x.ticks.color = textColor;
                    this.charts.burn.options.scales.y.ticks.color = textColor;
                    this.charts.burn.update();
                }
            }
        };

        // --- CALCULATOR ENGINE (Defined BEFORE App) ---
        const Calculator = {
            calculate() {
                let weight = parseFloat(document.getElementById('input-weight').value) || 0;
                let weightKg = App.unit === 'imperial' ? weight * 0.453592 : weight;

                if (App.mode === 'burn') {
                    this.calculateBurn(weightKg);
                } else {
                    this.calculateGain(weightKg);
                }
            },

            calculateBurn(weightKg) {
                const activity = document.getElementById('input-activity').value;
                const intensity = document.getElementById('input-intensity').value;
                const config = Logic.activities[activity];
                
                let inputVal = config.type === 'reps' ? 
                    parseFloat(document.getElementById('input-reps').value) || 0 : 
                    parseFloat(document.getElementById('input-duration').value) || 0;

                const res = Logic.calculateBurn(activity, weightKg, inputVal, intensity);
                
                const isHour = document.querySelector('#timeframe-selector .tab-btn.active').dataset.tf === 'hour';
                let displayCals = res.calories;
                
                if (isHour && config.type === 'duration' && inputVal > 0) {
                    displayCals = (res.calories / inputVal) * 60;
                }

                this.animateValue('res-calories', Math.round(displayCals));
                document.getElementById('res-fat').textContent = res.fat.toFixed(1);
                
                const foods = [
                    { cal: 90, name_zh: 'åŠæ ¹é¦™è•‰', name_en: '1/2 Banana' },
                    { cal: 150, name_zh: '1ä¸ªé¸¡è›‹', name_en: '1 Egg' },
                    { cal: 300, name_zh: '1ä¸ªæ±‰å ¡', name_en: '1 Burger' },
                    { cal: 500, name_zh: '1é¡¿å¤§é¤', name_en: '1 Big Meal' }
                ];
                let food = foods.find(f => displayCals < f.cal) || foods[foods.length-1];
                
                // Simple food name localization
                let foodName = food.name_en;
                if(App.lang === 'zh-CN' || App.lang === 'zh-TW') foodName = food.name_zh;
                // Add more food translations here if critical, otherwise fallback to English/Chinese
                
                document.getElementById('res-food').textContent = foodName;

                const rateVal = config.type === 'reps' ? (res.calories / (inputVal || 1)) : (res.calories / (inputVal || 1));
                document.getElementById('res-rate').textContent = rateVal.toFixed(2);
                
                const efficiencyMap = {
                    'zh-CN': { rep: 'æ¯æ¬¡æ¶ˆè€—', min: 'æ¯åˆ†é’Ÿæ¶ˆè€—' },
                    'zh-TW': { rep: 'æ¯æ¬¡æ¶ˆè€—', min: 'æ¯åˆ†é˜æ¶ˆè€—' },
                    'en': { rep: 'Per Rep', min: 'Per Min' },
                    'es': { rep: 'Por Rep', min: 'Por Min' },
                    'ja': { rep: '1å›ã‚ãŸã‚Š', min: '1åˆ†ã‚ãŸã‚Š' },
                    'ru': { rep: 'Ğ—Ğ° Ñ€Ğ°Ğ·', min: 'Ğ’ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ' },
                    'hi': { rep: 'à¤ªà¥à¤°à¤¤à¤¿ à¤¬à¤¾à¤°', min: 'à¤ªà¥à¤°à¤¤à¤¿ à¤®à¤¿à¤¨à¤Ÿ' },
                    'pl': { rep: 'Na powt.', min: 'Na min' }
                };
                
                const dict = efficiencyMap[App.lang] || efficiencyMap['en'];
                document.getElementById('lbl-efficiency').textContent = config.type === 'reps' ? dict.rep : dict.min;

                if (App.charts.burn) {
                    const acts = ['walking', 'jogging', 'jumping_rope', 'dancing', 'running', 'crossfit'];
                    const newData = acts.map(a => Logic.calculateBurn(a, weightKg, 30, 'moderate').calories);
                    
                    App.charts.burn.data.datasets[0].data = newData;
                    App.charts.burn.update();
                }
            },

            calculateGain(weightKg) {
                let height = parseFloat(document.getElementById('input-height').value) || 0;
                let age = parseFloat(document.getElementById('input-age').value) || 25;
                const activityLevel = document.getElementById('input-lifestyle').value;

                let heightCm = App.unit === 'imperial' ? height * 2.54 : height;

                const res = Logic.calculateGain(weightKg, heightCm, age, App.gender, activityLevel);

                this.animateValue('res-gain-cal', Math.round(res.target));
                this.animateValue('res-tdee', Math.round(res.tdee));
                this.animateValue('res-bmr', Math.round(res.bmr));

                document.getElementById('res-macro-c').textContent = Math.round(res.macros.c) + 'g';
                document.getElementById('res-macro-p').textContent = Math.round(res.macros.p) + 'g';
                document.getElementById('res-macro-f').textContent = Math.round(res.macros.f) + 'g';
            },

            animateValue(id, end) {
                const obj = document.getElementById(id);
                if(obj) obj.textContent = end.toLocaleString();
            }
        };

        // Init
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
</body>
</html>