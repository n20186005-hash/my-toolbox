<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Category Meta Tag -->
    <meta name="category" content="education">
    <meta name="icon" content="ğŸ“">
    <meta name="description" content="GSAT Score Calculator - Convert raw scores to level scores (1-15) based on custom intervals.">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>15</text></svg>">
    
    <title>å­¸æ¸¬ç´šåˆ†è¨ˆç®—å™¨ | GSAT Calc Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#8b5cf6', hover: '#7c3aed' }, /* Violet */
                        secondary: { DEFAULT: '#0ea5e9', hover: '#0284c7' }, /* Sky */
                        bg: { light: '#f5f3ff', dark: '#0f172a' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .glass {
                @apply bg-white/90 dark:bg-slate-800/90 backdrop-blur-lg border border-violet-200 dark:border-slate-700;
            }
            .input-group {
                @apply relative flex items-center;
            }
            .input-field {
                @apply w-full px-2 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all text-sm font-mono placeholder:text-slate-400 text-center;
            }
            .btn-icon {
                @apply p-2 rounded-lg text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors;
            }
            .btn-primary {
                @apply bg-gradient-to-r from-violet-500 to-fuchsia-600 hover:from-violet-600 hover:to-fuchsia-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg shadow-violet-500/30 transition-all active:scale-95 flex items-center justify-center gap-2 text-sm;
            }
            .level-badge {
                @apply w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm shadow-sm transition-all;
            }
            .level-15 { @apply bg-emerald-500 text-white; }
            .level-10 { @apply bg-blue-500 text-white; }
            .level-5 { @apply bg-yellow-500 text-white; }
            .level-0 { @apply bg-slate-300 text-slate-600; }
        }
    </style>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9279583389810634"
     crossorigin="anonymous"></script>

</head>
<body class="bg-bg-light dark:bg-bg-dark min-h-screen font-sans text-slate-800 dark:text-slate-200 transition-colors duration-300 overflow-x-hidden">

    <!-- Header -->
    <header class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-violet-500 to-fuchsia-600 text-white flex items-center justify-center font-bold text-xs shadow-md">
                    15
                </div>
                <div>
                    <h1 class="text-lg font-bold text-slate-900 dark:text-white leading-tight" data-i18n="title">å­¸æ¸¬ç´šåˆ†è¨ˆç®—å™¨</h1>
                    <p class="text-[10px] text-slate-500 font-medium" data-i18n="subtitle">GSAT Score to Level Converter</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <select id="lang-selector" class="bg-slate-100 dark:bg-slate-700 text-xs font-bold px-2 py-1.5 rounded-lg border-none focus:ring-0 cursor-pointer text-slate-600 dark:text-slate-300">
                    <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                    <option value="en">English</option>
                </select>
                <button id="mode-toggle" class="w-8 h-8 rounded-lg bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-500 hover:text-primary transition-colors">
                    <i class="fa fa-moon-o dark:hidden"></i>
                    <i class="fa fa-sun-o hidden dark:inline"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6 max-w-6xl grid lg:grid-cols-12 gap-6">
        
        <!-- Input Panel -->
        <div class="lg:col-span-5 space-y-6">
            <div class="glass rounded-2xl p-5 shadow-sm border-t-4 border-t-violet-500">
                
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-sm font-bold text-slate-500 uppercase flex items-center gap-2">
                        <i class="fa fa-pencil-square-o"></i> <span data-i18n="h_inputs">æˆç¸¾è¼¸å…¥</span>
                    </h3>
                    <button onclick="App.reset()" class="text-xs text-red-500 hover:text-red-600 font-bold">
                        <i class="fa fa-refresh"></i> <span data-i18n="btn_reset">é‡ç½®</span>
                    </button>
                </div>

                <!-- Subjects Container -->
                <div class="space-y-4">
                    <!-- Header Row -->
                    <div class="grid grid-cols-12 gap-2 text-[10px] font-bold text-slate-400 uppercase text-center px-1">
                        <div class="col-span-4 text-left pl-2" data-i18n="th_subject">ç§‘ç›®</div>
                        <div class="col-span-3" data-i18n="th_raw">åŸå§‹å¾—åˆ†</div>
                        <div class="col-span-3" data-i18n="th_interval">ç´šè· (L)</div>
                        <div class="col-span-2"></div>
                    </div>

                    <!-- Dynamic List -->
                    <div id="subjects-list" class="space-y-2">
                        <!-- Items injected by JS -->
                    </div>

                    <!-- Add Button -->
                    <button onclick="App.addSubject()" class="w-full py-2 rounded-lg border-2 border-dashed border-slate-300 dark:border-slate-600 text-slate-400 hover:text-violet-500 hover:border-violet-400 hover:bg-violet-50 dark:hover:bg-violet-900/20 transition-all text-xs font-bold flex items-center justify-center gap-2">
                        <i class="fa fa-plus"></i> <span data-i18n="btn_add">æ–°å¢ç§‘ç›®</span>
                    </button>
                </div>

                <div class="pt-4 border-t border-slate-100 dark:border-slate-700/50 mt-4">
                    <button onclick="App.calculate()" class="btn-primary w-full">
                        <span data-i18n="btn_calc">è¨ˆç®—ç´šåˆ†</span>
                    </button>
                    <p class="text-[10px] text-slate-400 text-center mt-2 italic" data-i18n="note_default">* é è¨­å€¼ç‚º 110 å­¸å¹´åº¦ç´šè·ï¼Œå¯æ‰‹å‹•ä¿®æ”¹ã€‚</p>
                </div>
            </div>
        </div>

        <!-- Output Panel -->
        <div class="lg:col-span-7 space-y-6">
            
            <!-- Result Cards -->
            <div class="glass rounded-2xl shadow-sm border-t-4 border-t-sky-500 p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wide" data-i18n="h_result">ç´šåˆ†çµæœ</h3>
                    <div class="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-300">Max: 15 / Subject</div>
                </div>

                <!-- Total Score -->
                <div class="text-center mb-8">
                    <div class="text-[10px] text-sky-600 dark:text-sky-400 font-bold uppercase mb-1" data-i18n="lbl_total">ç¸½ç´šåˆ† (Total)</div>
                    <div id="res-total" class="text-5xl md:text-6xl font-mono font-bold text-slate-800 dark:text-white">0</div>
                </div>

                <!-- Individual Badges -->
                <div class="flex justify-center gap-3 md:gap-5 flex-wrap" id="badges-container">
                    <!-- Injected via JS -->
                </div>

                <!-- Chart -->
                <div class="mt-8 relative w-full h-[250px]">
                    <canvas id="scoreChart"></canvas>
                </div>
            </div>

        </div>
    </div>

    <!-- Guide Section -->
    <section class="container mx-auto px-4 mb-12 max-w-6xl">
        <div class="glass rounded-2xl p-8 shadow-xl">
            <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2">
                <i class="fa fa-book text-primary"></i> <span data-i18n="guide_title">è¨ˆç®—åŸç†èˆ‡èªªæ˜</span>
            </h2>
            
            <div class="grid md:grid-cols-2 gap-12">
                <div class="space-y-6 text-slate-600 dark:text-slate-300 leading-relaxed text-sm">
                    <div class="bg-violet-50 dark:bg-violet-900/20 border-l-4 border-violet-500 p-4 rounded-r-lg">
                        <h3 class="font-bold text-violet-800 dark:text-violet-200 mb-2 text-sm uppercase" data-i18n="h_formula">ç´šè·è¨ˆç®—å…¬å¼</h3>
                        <p class="text-xs mb-2" data-i18n="p_formula_1">
                            1. <strong>ç´šè· (L)</strong>ï¼šä»¥å„ç§‘åˆ°è€ƒè€ƒç”Ÿï¼Œè¨ˆç®—å…¶åŸå§‹å¾—åˆ†å‰ç™¾åˆ†ä¹‹ä¸€è€ƒç”Ÿï¼ˆå°æ•¸ä»¥ç„¡æ¢ä»¶é€²å…¥æ³•å–è‡³å€‹ä½æ•¸ï¼‰çš„å¹³å‡åŸå§‹å¾—åˆ†ï¼Œå†é™¤ä»¥ 15ï¼Œä¸¦å–è‡³å°æ•¸ç¬¬äºŒä½ï¼Œç¬¬ä¸‰ä½å››æ¨äº”å…¥ã€‚
                        </p>
                        <div class="font-mono text-violet-900 dark:text-violet-100 text-xs bg-white dark:bg-slate-900 p-2 rounded border border-violet-100 dark:border-violet-800">
                            L = (Top 1% Average) / 15
                        </div>
                    </div>
                </div>

                <div class="space-y-6 text-slate-600 dark:text-slate-300 leading-relaxed text-sm">
                    <div class="bg-sky-50 dark:bg-sky-900/20 border-l-4 border-sky-500 p-4 rounded-r-lg">
                        <h3 class="font-bold text-sky-800 dark:text-sky-200 mb-2 text-sm uppercase" data-i18n="h_rules">ç´šåˆ†åˆ¤å®šè¦å‰‡</h3>
                        <ul class="list-disc list-inside text-xs space-y-1">
                            <li data-i18n="rule_1"><strong>0 ç´šåˆ†ï¼š</strong> åŸå§‹å¾—åˆ†ç‚º 0 åˆ†ï¼Œæˆ–ç¼ºè€ƒã€‚</li>
                            <li data-i18n="rule_2"><strong>15 ç´šåˆ†ï¼š</strong> åŸå§‹å¾—åˆ† > 14 Ã— Lã€‚</li>
                            <li data-i18n="rule_3"><strong>n ç´šåˆ† (1~14)ï¼š</strong> (n-1)Ã—L < åŸå§‹å¾—åˆ† â‰¤ nÃ—Lã€‚</li>
                        </ul>
                        <p class="text-[10px] mt-2 text-sky-600/80 dark:text-sky-400/80" data-i18n="note_rules">
                            *è‹¥åŸå§‹å¾—åˆ†å¤§æ–¼ 0 ä½†å°æ–¼ç­‰æ–¼ 1 å€‹ç´šè· (L)ï¼Œå‰‡ç‚º 1 ç´šåˆ†ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="text-center text-xs text-slate-400 py-6">
        <p>&copy; <span id="year"></span> GSAT Score Calculator. Generated for Educational Purposes.</p>
    </footer>

    <script>
        const i18nData = {
            'zh-TW': {
                title: "å­¸æ¸¬ç´šåˆ†è¨ˆç®—å™¨", subtitle: "GSAT Score to Level Converter",
                h_inputs: "æˆç¸¾è¼¸å…¥", btn_reset: "é‡ç½®",
                th_subject: "ç§‘ç›®", th_raw: "åŸå§‹å¾—åˆ†", th_interval: "ç´šè· (L)",
                sub_chi: "åœ‹æ–‡", sub_eng: "è‹±æ–‡", sub_math: "æ•¸å­¸", sub_soc: "ç¤¾æœƒ", sub_nat: "è‡ªç„¶",
                btn_calc: "è¨ˆç®—ç´šåˆ†", btn_add: "æ–°å¢ç§‘ç›®", note_default: "* é è¨­å€¼ç‚º 110 å­¸å¹´åº¦ç´šè·ï¼Œå¯æ‰‹å‹•ä¿®æ”¹ã€‚",
                h_result: "ç´šåˆ†çµæœ", lbl_total: "ç¸½ç´šåˆ† (Total)",
                
                guide_title: "è¨ˆç®—åŸç†èˆ‡èªªæ˜",
                h_formula: "ç´šè·è¨ˆç®—å…¬å¼",
                p_formula_1: "1. <strong>ç´šè· (L)</strong>ï¼šä»¥å„ç§‘åˆ°è€ƒè€ƒç”Ÿï¼Œè¨ˆç®—å…¶åŸå§‹å¾—åˆ†å‰ç™¾åˆ†ä¹‹ä¸€è€ƒç”Ÿï¼ˆå°æ•¸ä»¥ç„¡æ¢ä»¶é€²å…¥æ³•å–è‡³å€‹ä½æ•¸ï¼‰çš„å¹³å‡åŸå§‹å¾—åˆ†ï¼Œå†é™¤ä»¥ 15ï¼Œä¸¦å–è‡³å°æ•¸ç¬¬äºŒä½ï¼Œç¬¬ä¸‰ä½å››æ¨äº”å…¥ã€‚",
                h_rules: "ç´šåˆ†åˆ¤å®šè¦å‰‡",
                rule_1: "<strong>0 ç´šåˆ†ï¼š</strong> åŸå§‹å¾—åˆ†ç‚º 0 åˆ†ï¼Œæˆ–ç¼ºè€ƒã€‚",
                rule_2: "<strong>15 ç´šåˆ†ï¼š</strong> åŸå§‹å¾—åˆ† > 14 Ã— Lã€‚",
                rule_3: "<strong>n ç´šåˆ† (1~14)ï¼š</strong> (n-1)Ã—L < åŸå§‹å¾—åˆ† â‰¤ nÃ—Lã€‚",
                note_rules: "*è‹¥åŸå§‹å¾—åˆ†å¤§æ–¼ 0 ä½†å°æ–¼ç­‰æ–¼ 1 å€‹ç´šè· (L)ï¼Œå‰‡ç‚º 1 ç´šåˆ†ã€‚"
            },
            'en': {
                title: "GSAT Score Calculator", subtitle: "Score to Level Converter",
                h_inputs: "Score Input", btn_reset: "Reset",
                th_subject: "Subject", th_raw: "Raw Score", th_interval: "Interval (L)",
                sub_chi: "Chinese", sub_eng: "English", sub_math: "Math", sub_soc: "Social", sub_nat: "Nature",
                btn_calc: "Calculate", btn_add: "Add Subject", note_default: "* Default intervals based on 110 academic year.",
                h_result: "Results", lbl_total: "Total Level",
                
                guide_title: "Theory & Rules",
                h_formula: "Interval Formula",
                p_formula_1: "1. <strong>Interval (L)</strong>: Average score of top 1% candidates divided by 15, rounded to 2 decimal places.",
                h_rules: "Level Rules",
                rule_1: "<strong>Level 0:</strong> Raw score is 0 or absent.",
                rule_2: "<strong>Level 15:</strong> Raw score > 14 Ã— L.",
                rule_3: "<strong>Level n (1~14):</strong> (n-1)Ã—L < Raw Score â‰¤ nÃ—L.",
                note_rules: "*If raw score > 0 but â‰¤ 1 interval (L), it is Level 1."
            }
        };

        const colorPalette = ['bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-violet-500', 'bg-pink-500', 'bg-indigo-500', 'bg-orange-500'];

        const App = {
            lang: 'zh-TW',
            chart: null,
            subjects: [], // Dynamic array of subject objects
            
            init() {
                this.setupLang();
                this.handleTheme();
                this.updateYear();
                this.initSubjects();
                this.initChart();
                this.calculate();
            },

            initSubjects() {
                // Initial Default Subjects
                this.subjects = [
                    { id: 1, type: 'default', key: 'sub_chi', name: 'åœ‹æ–‡', raw: '', int: 5.38, color: 'bg-red-500' },
                    { id: 2, type: 'default', key: 'sub_eng', name: 'è‹±æ–‡', raw: '', int: 6.23, color: 'bg-blue-500' },
                    { id: 3, type: 'default', key: 'sub_math', name: 'æ•¸å­¸', raw: '', int: 6.03, color: 'bg-green-500' },
                    { id: 4, type: 'default', key: 'sub_soc', name: 'ç¤¾æœƒ', raw: '', int: 8.33, color: 'bg-yellow-500' },
                    { id: 5, type: 'default', key: 'sub_nat', name: 'è‡ªç„¶', raw: '', int: 8.27, color: 'bg-violet-500' }
                ];
                this.renderList();
            },

            updateYear() {
                document.getElementById('year').textContent = new Date().getFullYear();
            },

            setupLang() {
                const sel = document.getElementById('lang-selector');
                const urlParams = new URLSearchParams(window.location.search);
                this.lang = urlParams.get('lang') || 'zh-TW';
                sel.value = this.lang;
                
                this.updateText();

                sel.addEventListener('change', (e) => {
                    this.lang = e.target.value;
                    try {
                        const newUrl = new URL(window.location);
                        newUrl.searchParams.set('lang', this.lang);
                        window.history.pushState({}, '', newUrl);
                    } catch (e) {}
                    this.updateText();
                    this.updateDefaultNames(); // Update names in list
                });
            },

            updateText() {
                const dict = i18nData[this.lang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(dict[key]) el.innerHTML = dict[key];
                });
            },

            updateDefaultNames() {
                const dict = i18nData[this.lang];
                this.subjects.forEach(sub => {
                    if (sub.type === 'default' && sub.key && dict[sub.key]) {
                        sub.name = dict[sub.key];
                    }
                });
                this.renderList();
                this.calculate();
            },

            addSubject() {
                const nextId = this.subjects.length > 0 ? Math.max(...this.subjects.map(s => s.id)) + 1 : 1;
                const color = colorPalette[this.subjects.length % colorPalette.length];
                const newSub = {
                    id: nextId,
                    type: 'custom',
                    name: this.lang === 'zh-TW' ? `ç§‘ç›® ${this.subjects.length + 1}` : `Subject ${this.subjects.length + 1}`,
                    raw: '',
                    int: 10.00,
                    color: color
                };
                this.subjects.push(newSub);
                this.renderList();
                this.calculate();
            },

            removeSubject(id) {
                this.subjects = this.subjects.filter(s => s.id !== id);
                this.renderList();
                this.calculate();
            },

            updateSubjectValue(id, field, value) {
                const sub = this.subjects.find(s => s.id === id);
                if (sub) {
                    if (field === 'name') sub.name = value;
                    else sub[field] = value; // raw or int
                }
                // Don't re-render entire list to keep focus, just calculate
                this.calculate();
            },

            renderList() {
                const container = document.getElementById('subjects-list');
                container.innerHTML = '';

                this.subjects.forEach(sub => {
                    const div = document.createElement('div');
                    div.className = 'grid grid-cols-12 gap-2 items-center animate-slide-up';
                    
                    div.innerHTML = `
                        <div class="col-span-4 flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full ${sub.color} shrink-0"></span>
                            <input type="text" class="input-field px-1 text-left bg-transparent border-transparent hover:border-slate-200 focus:bg-white focus:border-primary transition-all" 
                                value="${sub.name}" 
                                oninput="App.updateSubjectValue(${sub.id}, 'name', this.value)"
                                placeholder="Name">
                        </div>
                        <div class="col-span-3">
                            <input type="number" class="input-field" placeholder="0-100" 
                                value="${sub.raw}" 
                                oninput="App.updateSubjectValue(${sub.id}, 'raw', this.value)">
                        </div>
                        <div class="col-span-3">
                            <input type="number" class="input-field bg-slate-50 dark:bg-slate-800" 
                                value="${sub.int}" step="0.01" 
                                oninput="App.updateSubjectValue(${sub.id}, 'int', this.value)">
                        </div>
                        <div class="col-span-2 flex justify-center">
                            <button onclick="App.removeSubject(${sub.id})" class="btn-icon" title="Remove">
                                <i class="fa fa-trash-o"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            },

            calculate() {
                let totalLevel = 0;
                const chartLabels = [];
                const chartData = [];
                const chartColors = [];
                const chartBorders = [];

                // DOM Container for Badges
                const badgeContainer = document.getElementById('badges-container');
                badgeContainer.innerHTML = '';

                this.subjects.forEach(sub => {
                    const raw = parseFloat(sub.raw);
                    const L = parseFloat(sub.int);
                    let level = 0;

                    if (!isNaN(raw) && !isNaN(L) && L > 0) {
                        if (raw <= 0) {
                            level = 0;
                        } else if (raw > 14 * L) {
                            level = 15;
                        } else {
                            level = Math.ceil(raw / L);
                            if (level > 15) level = 15;
                            if (level < 1) level = 1;
                        }
                    } else if (sub.raw === '') {
                        level = 0;
                    }

                    totalLevel += level;

                    // Chart Data
                    chartLabels.push(sub.name);
                    chartData.push(level);
                    
                    // Helper to get RGB from tailwind class name logic is hard, let's use fixed mapping or simple colors
                    // Simplifying color extraction for chart based on bg class string
                    let rgba = 'rgba(100, 116, 139, 0.7)'; // default slate
                    let rgb = 'rgb(100, 116, 139)';
                    
                    if (sub.color.includes('red')) { rgba = 'rgba(239, 68, 68, 0.7)'; rgb = 'rgb(239, 68, 68)'; }
                    else if (sub.color.includes('blue')) { rgba = 'rgba(59, 130, 246, 0.7)'; rgb = 'rgb(59, 130, 246)'; }
                    else if (sub.color.includes('green')) { rgba = 'rgba(34, 197, 94, 0.7)'; rgb = 'rgb(34, 197, 94)'; }
                    else if (sub.color.includes('yellow')) { rgba = 'rgba(234, 179, 8, 0.7)'; rgb = 'rgb(234, 179, 8)'; }
                    else if (sub.color.includes('violet')) { rgba = 'rgba(139, 92, 246, 0.7)'; rgb = 'rgb(139, 92, 246)'; }
                    else if (sub.color.includes('pink')) { rgba = 'rgba(236, 72, 153, 0.7)'; rgb = 'rgb(236, 72, 153)'; }
                    else if (sub.color.includes('indigo')) { rgba = 'rgba(99, 102, 241, 0.7)'; rgb = 'rgb(99, 102, 241)'; }
                    else if (sub.color.includes('orange')) { rgba = 'rgba(249, 115, 22, 0.7)'; rgb = 'rgb(249, 115, 22)'; }

                    chartColors.push(rgba);
                    chartBorders.push(rgb);

                    // Create Badge
                    const badge = document.createElement('div');
                    badge.className = 'flex flex-col items-center gap-1 animate-slide-up';
                    
                    let badgeColor = 'bg-slate-200 text-slate-500';
                    if (level === 15) badgeColor = 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/30';
                    else if (level >= 10) badgeColor = 'bg-sky-500 text-white';
                    else if (level > 0) badgeColor = sub.color + ' text-white opacity-90';

                    badge.innerHTML = `
                        <div class="level-badge ${badgeColor} w-10 h-10 text-lg">${level}</div>
                        <span class="text-[10px] text-slate-400 font-bold uppercase truncate w-14 text-center">${sub.name}</span>
                    `;
                    badgeContainer.appendChild(badge);
                });

                document.getElementById('res-total').textContent = totalLevel;
                this.updateChart(chartLabels, chartData, chartColors, chartBorders);
            },

            reset() {
                // Clear values but keep subjects? Or reset to default 5?
                // Let's reset values only to be safe, user can delete if they want.
                this.subjects.forEach(sub => {
                    sub.raw = '';
                    if (sub.type === 'default') {
                        // Reset defaults interval to 110 year values
                        if(sub.key === 'sub_chi') sub.int = 5.38;
                        if(sub.key === 'sub_eng') sub.int = 6.23;
                        if(sub.key === 'sub_math') sub.int = 6.03;
                        if(sub.key === 'sub_soc') sub.int = 8.33;
                        if(sub.key === 'sub_nat') sub.int = 8.27;
                    }
                });
                // Re-render inputs to clear fields visually
                this.renderList();
                this.calculate();
            },

            initChart() {
                const ctx = document.getElementById('scoreChart').getContext('2d');
                this.chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Level',
                            data: [],
                            backgroundColor: [],
                            borderColor: [],
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 15,
                                grid: { color: 'rgba(200, 200, 200, 0.1)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            },

            updateChart(labels, data, colors, borders) {
                if (this.chart) {
                    this.chart.data.labels = labels;
                    this.chart.data.datasets[0].data = data;
                    this.chart.data.datasets[0].backgroundColor = colors;
                    this.chart.data.datasets[0].borderColor = borders;
                    this.chart.update();
                }
            },

            handleTheme() {
                const toggle = document.getElementById('mode-toggle');
                const html = document.documentElement;
                if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    html.classList.add('dark');
                }
                toggle.addEventListener('click', () => {
                    html.classList.toggle('dark');
                    localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
     <!--  ç»“å°¾å¿…é¡»åŒ…å«çš„ä»£ç  -->
    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
</body>
</html>