<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Quality Calculator</title>
    
    <!-- åŸºç¡€ä¿¡æ¯ -->
    <meta name="tool-id" content="water_calc">
    <meta name="category" content="Math">
    <meta name="icon" content="ğŸ’§">
    
    <!-- é»˜è®¤è‹±æ–‡å†…å®¹ -->
    <meta name="title" content="Water Quality Calculator">
    <meta name="description" content="Calculate various water quality parameters such as concentration, dilution, and conversion between units.">
    
    <!-- å¤šè¯­è¨€é…ç½® -->
    <meta name="lang-title-zh-CN" content="æ°´è´¨è®¡ç®—å™¨">
    <meta name="lang-description-zh-CN" content="è®¡ç®—å„ç§æ°´è´¨å‚æ•°ï¼Œå¦‚æµ“åº¦ã€ç¨€é‡Šåº¦å’Œå•ä½ä¹‹é—´çš„è½¬æ¢ã€‚">
    
    <meta name="lang-title-zh-TW" content="æ°´è³ªè¨ˆç®—å™¨">
    <meta name="lang-description-zh-TW" content="è¨ˆç®—å„ç¨®æ°´è³ªåƒæ•¸ï¼Œå¦‚æ¿ƒåº¦ã€ç¨€é‡‹åº¦å’Œå–®ä½ä¹‹é–“çš„è½‰æ›ã€‚">
    
    <meta name="lang-title-ja" content="æ°´è³ªè¨ˆç®—ãƒ„ãƒ¼ãƒ«">
    <meta name="lang-description-ja" content="æ¿ƒåº¦ã€å¸Œé‡ˆç‡ã€å˜ä½æ›ç®—ãªã©ã€ã•ã¾ã–ã¾ãªæ°´è³ªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨ˆç®—ã—ã¾ã™ã€‚">
    
    <meta name="lang-title-ru" content="ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ²Ğ¾Ğ´Ñ‹">
    <meta name="lang-description-ru" content="Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ²Ğ¾Ğ´Ñ‹, Ñ‚Ğ°ĞºĞ¸Ğµ ĞºĞ°Ğº ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ñ, Ñ€Ğ°Ğ·Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ğ°Ğ¼Ğ¸ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0f9ff; font-family: 'Segoe UI', Roboto, sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto; position: relative; }
        .result-container { word-break: break-all; }
        .calc-option { padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; }
        .calc-option:hover { background-color: #f8fafc; }
        .calc-option.active { border-color: #3b82f6; background-color: #eff6ff; box-shadow: 0 0 0 1px #3b82f6; }
        .option-label { font-weight: bold; margin-bottom: 5px; display: block; }
        .option-desc { font-size: 0.85rem; color: #666; }
        .formula { font-family: 'Courier New', monospace; background: #f8fafc; padding: 10px; border-radius: 6px; margin: 10px 0; border: 1px solid #e2e8f0; color: #475569; }
        .result-card { background: #f0fdf4; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #dcfce7; }
        .result-label { font-size: 0.9rem; color: #4b5563; margin-bottom: 5px; }
        .result-value { font-size: 1.5rem; font-weight: bold; color: #15803d; }
        .variables-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        @media (max-width: 600px) {
            .variables-grid { grid-template-columns: 1fr; }
        }
        .unit-selector { display: flex; align-items: center; gap: 10px; }
        .guideline { font-size: 0.85rem; padding: 8px; border-radius: 4px; margin-top: 5px; }
        .hidden { display: none; }
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/math/water-calculator.html" />
</head>
<body>

    <div class="tool-module active" 
         data-id="water_calc" 
         data-category="environmental" 
         data-title="Water Quality Calculator" 
         data-icon="ğŸ’§">
        
        <!-- è¯­è¨€é€‰æ‹©å™¨ -->
        <div class="absolute top-4 right-4">
            <select id="water-lang" onchange="WaterCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en" selected>English</option>
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">ğŸ’§ Water Quality Calculator</h2>
        
        <div class="space-y-4 mb-6">
            <!-- è®¡ç®—ç±»å‹é€‰æ‹© -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="calc_type">Calculation Type</label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="calc-option active" onclick="WaterCalc.setCalcType('concentration')" id="opt-concentration">
                        <div class="option-label" data-i18n="concentration">Concentration Calculation</div>
                        <div class="option-desc" data-i18n="concentration_desc">Calculate solute concentration in solution</div>
                    </div>
                    <div class="calc-option" onclick="WaterCalc.setCalcType('dilution')" id="opt-dilution">
                        <div class="option-label" data-i18n="dilution">Dilution Calculation</div>
                        <div class="option-desc" data-i18n="dilution_desc">Calculate dilution factor and final concentration</div>
                    </div>
                    <div class="calc-option" onclick="WaterCalc.setCalcType('unit_conversion')" id="opt-unit-conversion">
                        <div class="option-label" data-i18n="unit_conversion">Unit Conversion</div>
                        <div class="option-desc" data-i18n="unit_conversion_desc">Convert between different concentration units</div>
                    </div>
                    <div class="calc-option" onclick="WaterCalc.setCalcType('dosage')" id="opt-dosage">
                        <div class="option-label" data-i18n="dosage">Chemical Dosage</div>
                        <div class="option-desc" data-i18n="dosage_desc">Calculate chemical dosage for water treatment</div>
                    </div>
                </div>
            </div>
            
            <!-- æµ“åº¦è®¡ç®— -->
            <div id="concentration-calculator">
                <div class="variables-grid">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="solute_mass">Solute Mass</label>
                        <div class="unit-selector">
                            <input type="number" id="solute-mass" min="0" step="any" value="10" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="mass-unit" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="mg">mg</option>
                                <option value="g">g</option>
                                <option value="kg">kg</option>
                                <option value="Î¼g">Î¼g</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="solution_volume">Solution Volume</label>
                        <div class="unit-selector">
                            <input type="number" id="solution-volume" min="0" step="any" value="1" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="volume-unit" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="L">L</option>
                                <option value="mL">mL</option>
                                <option value="m3">mÂ³</option>
                                <option value="gal">gal (US)</option>
                            </select>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="result_unit">Result Unit</label>
                        <select id="concentration-result-unit" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="mg/L">mg/L (ppm)</option>
                            <option value="g/L">g/L</option>
                            <option value="kg/m3">kg/mÂ³</option>
                            <option value="Î¼g/L">Î¼g/L (ppb)</option>
                            <option value="percent">%</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- ç¨€é‡Šè®¡ç®— -->
            <div id="dilution-calculator" class="hidden">
                <div class="variables-grid">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="initial_concentration">Initial Concentration</label>
                        <div class="unit-selector">
                            <input type="number" id="initial-concentration" min="0" step="any" value="1000" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="initial-conc-unit" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="mg/L">mg/L</option>
                                <option value="g/L">g/L</option>
                                <option value="percent">%</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="initial_volume">Initial Volume</label>
                        <div class="unit-selector">
                            <input type="number" id="initial-volume" min="0" step="any" value="10" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="initial-vol-unit" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="mL">mL</option>
                                <option value="L">L</option>
                                <option value="gal">gal (US)</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="diluent_volume">Diluent Volume</label>
                        <div class="unit-selector">
                            <input type="number" id="diluent-volume" min="0" step="any" value="90" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="diluent-vol-unit" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="mL">mL</option>
                                <option value="L">L</option>
                                <option value="gal">gal (US)</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="final_conc_unit">Final Conc. Unit</label>
                        <select id="final-conc-unit" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="mg/L">mg/L</option>
                            <option value="g/L">g/L</option>
                            <option value="percent">%</option>
                            <option value="Î¼g/L">Î¼g/L</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- å•ä½è½¬æ¢ -->
            <div id="unit-conversion-calculator" class="hidden">
                <div class="variables-grid">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="value_to_convert">Value to Convert</label>
                        <input type="number" id="value-to-convert" min="0" step="any" value="1" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="from_unit">From Unit</label>
                        <select id="from-unit" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="mg/L">mg/L (ppm)</option>
                            <option value="g/L">g/L</option>
                            <option value="kg/m3">kg/mÂ³</option>
                            <option value="Î¼g/L">Î¼g/L (ppb)</option>
                            <option value="percent">% (percent)</option>
                            <!-- <option value="mmol/L">mmol/L</option> -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="to_unit">To Unit</label>
                        <select id="to-unit" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="mg/L">mg/L (ppm)</option>
                            <option value="g/L">g/L</option>
                            <option value="kg/m3">kg/mÂ³</option>
                            <option value="Î¼g/L">Î¼g/L (ppb)</option>
                            <option value="percent">% (percent)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- è¯å‰‚æŠ•åŠ é‡ -->
            <div id="dosage-calculator" class="hidden">
                <div class="variables-grid">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="water_flow_rate">Water Flow Rate</label>
                        <div class="unit-selector">
                            <input type="number" id="flow-rate" min="0" step="any" value="100" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="flow-unit" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="m3/h">mÂ³/h</option>
                                <option value="L/min">L/min</option>
                                <option value="gal/min">gal/min</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="target_concentration">Target Concentration</label>
                        <div class="unit-selector">
                            <input type="number" id="target-concentration" min="0" step="any" value="2" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="target-conc-unit" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="mg/L">mg/L</option>
                                <option value="g/m3">g/mÂ³</option>
                                <option value="ppm">ppm</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="chemical_purity">Chemical Purity (%)</label>
                        <input type="number" id="chemical-purity" min="0" max="100" step="any" value="98" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="dosage_unit">Dosage Result Unit</label>
                        <select id="dosage-result-unit" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="g/h">g/h</option>
                            <option value="kg/day">kg/day</option>
                            <option value="lb/day">lb/day</option>
                            <option value="g/min">g/min</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- å…¬å¼å±•ç¤º -->
            <div>
                <div class="text-sm font-medium text-gray-700 mb-1" data-i18n="formula">Formula</div>
                <div class="formula" id="formula-display">Concentration = Solute Mass / Solution Volume</div>
            </div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <div class="flex gap-2 mt-4">
                <button onclick="WaterCalc.loadSample()" class="flex-1 bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 transition" data-i18n="load_sample">Load Sample</button>
                <button onclick="WaterCalc.clearForm()" class="flex-1 bg-gray-600 text-white py-2 rounded font-bold hover:bg-gray-700 transition" data-i18n="clear">Clear</button>
                <button onclick="WaterCalc.calculate()" class="flex-2 bg-green-600 text-white py-2 rounded font-bold hover:bg-green-700 transition" data-i18n="calculate">Calculate</button>
            </div>
        </div>

        <!-- é”™è¯¯æç¤º -->
        <div id="water-error" class="text-sm text-red-600 mt-2 hidden mb-4"></div>
        
        <!-- ç»“æœå±•ç¤º -->
        <div id="water-results" class="hidden mt-4">
            <div class="text-sm text-gray-500 mb-2" data-i18n="results">Results</div>
            
            <div class="result-card">
                <div class="result-label" data-i18n="result_value">Result Value</div>
                <div class="result-value" id="result-value">--</div>
            </div>
            
            <div class="result-card">
                <div class="result-label" data-i18n="calculation_steps">Calculation Steps</div>
                <div id="calculation-steps" class="whitespace-pre-line text-sm text-gray-700 font-mono">--</div>
            </div>
        </div>

        <!-- è¯´æ˜ä¿¡æ¯ -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600">
            <p data-i18n="notes" class="font-bold mb-2">Notes:</p>
            <ul class="list-disc list-inside mt-2 space-y-1" data-i18n="notes_list">
                <li>1 mg/L = 1 ppm (parts per million) for dilute aqueous solutions</li>
                <li>1 Î¼g/L = 1 ppb (parts per billion) for dilute aqueous solutions</li>
                <li>Concentration calculations assume ideal solutions</li>
                <li>Dosage calculations do not account for chemical reactions or losses</li>
                <li>Always verify results against established water quality standards</li>
            </ul>
        </div>
    </div>

    <script>
        const WaterCalc = {
            currentCalcType: 'concentration',
            
            i18n: {
                'en': {
                    title: 'ğŸ’§ Water Quality Calculator',
                    calc_type: 'Calculation Type',
                    concentration: 'Concentration',
                    concentration_desc: 'Calculate solute concentration in solution',
                    dilution: 'Dilution',
                    dilution_desc: 'Calculate dilution factor and final concentration',
                    unit_conversion: 'Unit Conversion',
                    unit_conversion_desc: 'Convert between different concentration units',
                    dosage: 'Chemical Dosage',
                    dosage_desc: 'Calculate chemical dosage for water treatment',
                    solute_mass: 'Solute Mass',
                    solution_volume: 'Solution Volume',
                    result_unit: 'Result Unit',
                    initial_concentration: 'Initial Concentration',
                    initial_volume: 'Initial Volume',
                    diluent_volume: 'Diluent Volume',
                    final_conc_unit: 'Final Conc. Unit',
                    value_to_convert: 'Value to Convert',
                    from_unit: 'From Unit',
                    to_unit: 'To Unit',
                    water_flow_rate: 'Water Flow Rate',
                    target_concentration: 'Target Concentration',
                    chemical_purity: 'Chemical Purity (%)',
                    dosage_unit: 'Dosage Result Unit',
                    formula: 'Formula',
                    load_sample: 'Load Sample',
                    clear: 'Clear',
                    calculate: 'Calculate',
                    results: 'Results',
                    result_value: 'Result Value',
                    calculation_steps: 'Calculation Steps',
                    notes: 'Notes:',
                    notes_list: '<li>1 mg/L = 1 ppm (parts per million) for dilute aqueous solutions</li><li>1 Î¼g/L = 1 ppb (parts per billion) for dilute aqueous solutions</li><li>Concentration calculations assume ideal solutions</li><li>Dosage calculations do not account for chemical reactions or losses</li><li>Always verify results against established water quality standards</li>'
                },
                'zh-CN': {
                    title: 'ğŸ’§ æ°´è´¨è®¡ç®—å™¨',
                    calc_type: 'è®¡ç®—ç±»å‹',
                    concentration: 'æµ“åº¦è®¡ç®—',
                    concentration_desc: 'è®¡ç®—æº¶æ¶²ä¸­çš„æº¶è´¨æµ“åº¦',
                    dilution: 'ç¨€é‡Šè®¡ç®—',
                    dilution_desc: 'è®¡ç®—ç¨€é‡Šå€æ•°å’Œæœ€ç»ˆæµ“åº¦',
                    unit_conversion: 'å•ä½æ¢ç®—',
                    unit_conversion_desc: 'åœ¨ä¸åŒæµ“åº¦å•ä½ä¹‹é—´è½¬æ¢',
                    dosage: 'è¯å‰‚æŠ•åŠ é‡',
                    dosage_desc: 'è®¡ç®—æ°´å¤„ç†çš„åŒ–å­¦è¯å‰‚æŠ•åŠ é‡',
                    solute_mass: 'æº¶è´¨è´¨é‡',
                    solution_volume: 'æº¶æ¶²ä½“ç§¯',
                    result_unit: 'ç»“æœå•ä½',
                    initial_concentration: 'åˆå§‹æµ“åº¦',
                    initial_volume: 'åˆå§‹ä½“ç§¯',
                    diluent_volume: 'ç¨€é‡Šå‰‚ä½“ç§¯',
                    final_conc_unit: 'æœ€ç»ˆæµ“åº¦å•ä½',
                    value_to_convert: 'è½¬æ¢æ•°å€¼',
                    from_unit: 'æºå•ä½',
                    to_unit: 'ç›®æ ‡å•ä½',
                    water_flow_rate: 'æ°´æµé‡',
                    target_concentration: 'ç›®æ ‡æµ“åº¦',
                    chemical_purity: 'è¯å‰‚çº¯åº¦ (%)',
                    dosage_unit: 'æŠ•åŠ é‡å•ä½',
                    formula: 'è®¡ç®—å…¬å¼',
                    load_sample: 'åŠ è½½ç¤ºä¾‹',
                    clear: 'æ¸…ç©º',
                    calculate: 'è®¡ç®—',
                    results: 'è®¡ç®—ç»“æœ',
                    result_value: 'ç»“æœå€¼',
                    calculation_steps: 'è®¡ç®—æ­¥éª¤',
                    notes: 'æ³¨æ„ï¼š',
                    notes_list: '<li>1 mg/L = 1 ppmï¼ˆç™¾ä¸‡åˆ†æ¯”ï¼‰ï¼Œé€‚ç”¨äºç¨€æ°´æº¶æ¶²</li><li>1 Î¼g/L = 1 ppbï¼ˆåäº¿åˆ†æ¯”ï¼‰ï¼Œé€‚ç”¨äºç¨€æ°´æº¶æ¶²</li><li>æµ“åº¦è®¡ç®—å‡è®¾ä¸ºç†æƒ³æº¶æ¶²</li><li>æŠ•åŠ é‡è®¡ç®—æœªè€ƒè™‘åŒ–å­¦ååº”æˆ–æŸè€—</li><li>è¯·åŠ¡å¿…æ ¹æ®æ—¢å®šçš„æ°´è´¨æ ‡å‡†éªŒè¯ç»“æœ</li>'
                },
                'zh-TW': {
                    title: 'ğŸ’§ æ°´è³ªè¨ˆç®—å™¨',
                    calc_type: 'è¨ˆç®—é¡å‹',
                    concentration: 'æ¿ƒåº¦è¨ˆç®—',
                    concentration_desc: 'è¨ˆç®—æº¶æ¶²ä¸­çš„æº¶è³ªæ¿ƒåº¦',
                    dilution: 'ç¨€é‡‹è¨ˆç®—',
                    dilution_desc: 'è¨ˆç®—ç¨€é‡‹å€æ•¸å’Œæœ€çµ‚æ¿ƒåº¦',
                    unit_conversion: 'å–®ä½æ›ç®—',
                    unit_conversion_desc: 'åœ¨ä¸åŒæ¿ƒåº¦å–®ä½ä¹‹é–“è½‰æ›',
                    dosage: 'è—¥åŠ‘æŠ•åŠ é‡',
                    dosage_desc: 'è¨ˆç®—æ°´è™•ç†çš„åŒ–å­¸è—¥åŠ‘æŠ•åŠ é‡',
                    solute_mass: 'æº¶è³ªè³ªé‡',
                    solution_volume: 'æº¶æ¶²é«”ç©',
                    result_unit: 'çµæœå–®ä½',
                    initial_concentration: 'åˆå§‹æ¿ƒåº¦',
                    initial_volume: 'åˆå§‹é«”ç©',
                    diluent_volume: 'ç¨€é‡‹åŠ‘é«”ç©',
                    final_conc_unit: 'æœ€çµ‚æ¿ƒåº¦å–®ä½',
                    value_to_convert: 'è½‰æ›æ•¸å€¼',
                    from_unit: 'æºå–®ä½',
                    to_unit: 'ç›®æ¨™å–®ä½',
                    water_flow_rate: 'æ°´æµé‡',
                    target_concentration: 'ç›®æ¨™æ¿ƒåº¦',
                    chemical_purity: 'è—¥åŠ‘ç´”åº¦ (%)',
                    dosage_unit: 'æŠ•åŠ é‡å–®ä½',
                    formula: 'è¨ˆç®—å…¬å¼',
                    load_sample: 'åŠ è¼‰ç¤ºä¾‹',
                    clear: 'æ¸…ç©º',
                    calculate: 'è¨ˆç®—',
                    results: 'è¨ˆç®—çµæœ',
                    result_value: 'çµæœå€¼',
                    calculation_steps: 'è¨ˆç®—æ­¥é©Ÿ',
                    notes: 'æ³¨æ„ï¼š',
                    notes_list: '<li>1 mg/L = 1 ppmï¼ˆç™¾è¬åˆ†æ¯”ï¼‰ï¼Œé©ç”¨æ–¼ç¨€æ°´æº¶æ¶²</li><li>1 Î¼g/L = 1 ppbï¼ˆåå„„åˆ†æ¯”ï¼‰ï¼Œé©ç”¨æ–¼ç¨€æ°´æº¶æ¶²</li><li>æ¿ƒåº¦è¨ˆç®—å‡è¨­ç‚ºç†æƒ³æº¶æ¶²</li><li>æŠ•åŠ é‡è¨ˆç®—æœªè€ƒæ…®åŒ–å­¸åæ‡‰æˆ–æè€—</li><li>è«‹å‹™å¿…æ ¹æ“šæ—¢å®šçš„æ°´è³ªæ¨™æº–é©—è­‰çµæœ</li>'
                },
                'ja': {
                    title: 'ğŸ’§ æ°´è³ªè¨ˆç®—ãƒ„ãƒ¼ãƒ«',
                    calc_type: 'è¨ˆç®—ã‚¿ã‚¤ãƒ—',
                    concentration: 'æ¿ƒåº¦è¨ˆç®—',
                    concentration_desc: 'æº¶æ¶²ä¸­ã®æº¶è³ªæ¿ƒåº¦ã‚’è¨ˆç®—',
                    dilution: 'å¸Œé‡ˆè¨ˆç®—',
                    dilution_desc: 'å¸Œé‡ˆç‡ã¨æœ€çµ‚æ¿ƒåº¦ã‚’è¨ˆç®—',
                    unit_conversion: 'å˜ä½æ›ç®—',
                    unit_conversion_desc: 'ç•°ãªã‚‹æ¿ƒåº¦å˜ä½é–“ã§ã®æ›ç®—',
                    dosage: 'è–¬å“æ³¨å…¥é‡',
                    dosage_desc: 'æ°´å‡¦ç†ã®è–¬å“æ³¨å…¥é‡ã‚’è¨ˆç®—',
                    solute_mass: 'æº¶è³ªè³ªé‡',
                    solution_volume: 'æº¶æ¶²ä½“ç©',
                    result_unit: 'çµæœå˜ä½',
                    initial_concentration: 'åˆæœŸæ¿ƒåº¦',
                    initial_volume: 'åˆæœŸä½“ç©',
                    diluent_volume: 'å¸Œé‡ˆæ¶²ã®ä½“ç©',
                    final_conc_unit: 'æœ€çµ‚æ¿ƒåº¦å˜ä½',
                    value_to_convert: 'å¤‰æ›ã™ã‚‹å€¤',
                    from_unit: 'å…ƒã®å˜ä½',
                    to_unit: 'ç›®æ¨™å˜ä½',
                    water_flow_rate: 'æ°´æµé‡',
                    target_concentration: 'ç›®æ¨™æ¿ƒåº¦',
                    chemical_purity: 'è–¬å“ç´”åº¦ (%)',
                    dosage_unit: 'æ³¨å…¥é‡å˜ä½',
                    formula: 'è¨ˆç®—å¼',
                    load_sample: 'ã‚µãƒ³ãƒ—ãƒ«èª­è¾¼',
                    clear: 'ã‚¯ãƒªã‚¢',
                    calculate: 'è¨ˆç®—',
                    results: 'çµæœ',
                    result_value: 'çµæœå€¤',
                    calculation_steps: 'è¨ˆç®—æ‰‹é †',
                    notes: 'æ³¨æ„ï¼š',
                    notes_list: '<li>å¸Œè–„æ°´æº¶æ¶²ã®å ´åˆã€1 mg/L = 1 ppm (parts per million)</li><li>å¸Œè–„æ°´æº¶æ¶²ã®å ´åˆã€1 Î¼g/L = 1 ppb (parts per billion)</li><li>æ¿ƒåº¦è¨ˆç®—ã¯ç†æƒ³æº¶æ¶²ã‚’ä»®å®šã—ã¦ã„ã¾ã™</li><li>æ³¨å…¥é‡è¨ˆç®—ã¯åŒ–å­¦åå¿œã‚„æå¤±ã‚’è€ƒæ…®ã—ã¦ã„ã¾ã›ã‚“</li><li>çµæœã¯å¸¸ã«ç¢ºç«‹ã•ã‚ŒãŸæ°´è³ªåŸºæº–ã¨ç…§åˆã—ã¦ãã ã•ã„</li>'
                },
                'ru': {
                    title: 'ğŸ’§ ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ²Ğ¾Ğ´Ñ‹',
                    calc_type: 'Ğ¢Ğ¸Ğ¿ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ°',
                    concentration: 'Ğ Ğ°ÑÑ‡ĞµÑ‚ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸',
                    concentration_desc: 'Ğ Ğ°ÑÑ‡ĞµÑ‚ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ°ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ²ĞµÑ‰ĞµÑÑ‚Ğ²Ğ°',
                    dilution: 'Ğ Ğ°ÑÑ‡ĞµÑ‚ Ñ€Ğ°Ğ·Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ',
                    dilution_desc: 'Ğ Ğ°ÑÑ‡ĞµÑ‚ ĞºĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° Ñ€Ğ°Ğ·Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸',
                    unit_conversion: 'ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†',
                    unit_conversion_desc: 'ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ğ°Ğ¼Ğ¸ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸',
                    dosage: 'Ğ”Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ€ĞµĞ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²',
                    dosage_desc: 'Ğ Ğ°ÑÑ‡ĞµÑ‚ Ğ´Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ñ…Ğ¸Ğ¼Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ğ¾Ğ´Ğ¾Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸',
                    solute_mass: 'ĞœĞ°ÑÑĞ° Ğ²ĞµÑ‰ĞµÑÑ‚Ğ²Ğ°',
                    solution_volume: 'ĞĞ±ÑŠĞµĞ¼ Ñ€Ğ°ÑÑ‚Ğ²Ğ¾Ñ€Ğ°',
                    result_unit: 'Ğ•Ğ´Ğ¸Ğ½Ğ¸Ñ†Ğ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°',
                    initial_concentration: 'ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ñ',
                    initial_volume: 'ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞ¼',
                    diluent_volume: 'ĞĞ±ÑŠĞµĞ¼ Ñ€Ğ°Ğ·Ğ±Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»Ñ',
                    final_conc_unit: 'ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ğ°Ñ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ğ°',
                    value_to_convert: 'Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ',
                    from_unit: 'Ğ˜Ğ· ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹',
                    to_unit: 'Ğ’ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñƒ',
                    water_flow_rate: 'Ğ Ğ°ÑÑ…Ğ¾Ğ´ Ğ²Ğ¾Ğ´Ñ‹',
                    target_concentration: 'Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ñ',
                    chemical_purity: 'Ğ§Ğ¸ÑÑ‚Ğ¾Ñ‚Ğ° Ñ€ĞµĞ°Ğ³ĞµĞ½Ñ‚Ğ° (%)',
                    dosage_unit: 'Ğ•Ğ´Ğ¸Ğ½Ğ¸Ñ†Ğ° Ğ´Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸',
                    formula: 'Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°',
                    load_sample: 'ĞŸÑ€Ğ¸Ğ¼ĞµÑ€',
                    clear: 'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ',
                    calculate: 'Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ',
                    results: 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹',
                    result_value: 'Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ',
                    calculation_steps: 'Ğ¨Ğ°Ğ³Ğ¸ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ°',
                    notes: 'ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ:',
                    notes_list: '<li>1 Ğ¼Ğ³/Ğ» = 1 ppm (Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½Ğ½Ğ°Ñ Ğ´Ğ¾Ğ»Ñ) Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ²Ğ¾Ğ´Ğ½Ñ‹Ñ… Ñ€Ğ°ÑÑ‚Ğ²Ğ¾Ñ€Ğ¾Ğ²</li><li>1 Ğ¼ĞºĞ³/Ğ» = 1 ppb (Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ°Ñ€Ğ´Ğ½Ğ°Ñ Ğ´Ğ¾Ğ»Ñ)</li><li>Ğ Ğ°ÑÑ‡ĞµÑ‚Ñ‹ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ğ»Ğ°Ğ³Ğ°ÑÑ‚ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°ÑÑ‚Ğ²Ğ¾Ñ€Ñ‹</li><li>Ğ Ğ°ÑÑ‡ĞµÑ‚ Ğ´Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ½Ğµ ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ñ‚ĞµÑ€Ğ¸</li><li>Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞ¹Ñ‚Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ğ¾ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ°Ğ¼ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ²Ğ¾Ğ´Ñ‹</li>'
                }
            },

            init: () => {
                WaterCalc.setCalcType('concentration');
                // Auto detect language
                const userLang = navigator.language || navigator.userLanguage;
                let targetLang = 'en'; 
                if (userLang.startsWith('zh')) {
                    targetLang = userLang.includes('TW') || userLang.includes('HK') ? 'zh-TW' : 'zh-CN';
                } else if (userLang.startsWith('ja')) targetLang = 'ja';
                else if (userLang.startsWith('ru')) targetLang = 'ru';
                
                const langSelect = document.getElementById('water-lang');
                if(langSelect && targetLang !== 'en') {
                    langSelect.value = targetLang;
                    WaterCalc.changeLang();
                }
            },

            changeLang: () => {
                const lang = document.getElementById('water-lang').value;
                const texts = WaterCalc.i18n[lang];
                // Select only elements within this tool to avoid conflicts
                const elements = document.querySelectorAll('[data-id="water_calc"] [data-i18n]');
                
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) {
                        // Special handling for HTML content (lists)
                        if (key === 'notes_list') {
                            el.innerHTML = texts[key];
                        } else {
                            el.innerText = texts[key];
                        }
                    }
                });
            },

            setCalcType: (type) => {
                WaterCalc.currentCalcType = type;
                
                const calculatorTypes = [
                    { id: 'concentration', optionId: 'opt-concentration' },
                    { id: 'dilution', optionId: 'opt-dilution' },
                    { id: 'unit_conversion', optionId: 'opt-unit-conversion' },
                    { id: 'dosage', optionId: 'opt-dosage' }
                ];

                // ç»Ÿä¸€å¤„ç†æ‰€æœ‰é€‰é¡¹å’Œè®¡ç®—å™¨åŒºå—çš„æ˜¾ç¤º/éšè—
                calculatorTypes.forEach(calc => {
                    const calculatorElement = document.getElementById(calc.id + '-calculator');
                    const optionElement = document.getElementById(calc.optionId);
                    
                    if (calculatorElement) {
                        if (calc.id === type) {
                            calculatorElement.classList.remove('hidden');
                        } else {
                            calculatorElement.classList.add('hidden');
                        }
                    }

                    if (optionElement) {
                        if (calc.id === type) {
                            optionElement.classList.add('active');
                        } else {
                            optionElement.classList.remove('active');
                        }
                    }
                });
                
                // Update formula display
                const formulas = {
                    'concentration': 'Concentration = Solute Mass / Solution Volume',
                    'dilution': 'C1 Ã— V1 = C2 Ã— V2  (Final Concentration = (C1 Ã— V1) / (V1 + Vdiluent))',
                    'unit_conversion': 'Target Unit = Source Unit Ã— Conversion Factor',
                    'dosage': 'Dosage Rate = Flow Rate Ã— Target Concentration / Purity'
                };
                document.getElementById('formula-display').innerText = formulas[type];
                
                // Hide results on switch
                document.getElementById('water-results').classList.add('hidden');
            },

            calculate: () => {
                const type = WaterCalc.currentCalcType;
                document.getElementById('water-error').classList.add('hidden');
                
                try {
                    let result;
                    
                    if (type === 'concentration') {
                        result = WaterCalc.calcConcentration();
                    } else if (type === 'dilution') {
                        result = WaterCalc.calcDilution();
                    } else if (type === 'unit_conversion') {
                        result = WaterCalc.calcConversion();
                    } else if (type === 'dosage') {
                        result = WaterCalc.calcDosage();
                    }
                    
                    document.getElementById('result-value').innerText = result.value;
                    document.getElementById('calculation-steps').innerHTML = result.steps;
                    document.getElementById('water-results').classList.remove('hidden');
                    
                } catch (e) {
                    const errorEl = document.getElementById('water-error');
                    errorEl.innerText = e.message;
                    errorEl.classList.remove('hidden');
                }
            },

            // Helper to get factor to convert TO mg/L (standard)
            getFactorToMgL: (unit) => {
                const map = {
                    'mg/L': 1, 'ppm': 1,
                    'g/L': 1000, 'kg/m3': 1000,
                    'Î¼g/L': 0.001, 'ppb': 0.001,
                    'percent': 10000 // 1% = 10,000 mg/L approx
                };
                return map[unit] || 1;
            },

            calcConcentration: () => {
                const mass = parseFloat(document.getElementById('solute-mass').value);
                const massUnit = document.getElementById('mass-unit').value;
                const volume = parseFloat(document.getElementById('solution-volume').value);
                const volUnit = document.getElementById('volume-unit').value;
                const resUnit = document.getElementById('concentration-result-unit').value;

                if (isNaN(mass) || isNaN(volume)) throw new Error("Please enter valid numbers for mass and volume.");
                if (volume <= 0) throw new Error("Volume must be greater than 0");

                // Convert mass to mg
                let massMg = mass;
                if (massUnit === 'g') massMg = mass * 1000;
                if (massUnit === 'kg') massMg = mass * 1000000;
                if (massUnit === 'Î¼g') massMg = mass / 1000;

                // Convert volume to L
                let volL = volume;
                if (volUnit === 'mL') volL = volume / 1000;
                if (volUnit === 'm3') volL = volume * 1000;
                if (volUnit === 'gal') volL = volume * 3.78541;

                // Base concentration in mg/L
                const concMgL = massMg / volL;
                
                // Convert to target unit
                let finalVal = concMgL;
                const factor = WaterCalc.getFactorToMgL(resUnit);
                finalVal = concMgL / factor;

                return {
                    value: finalVal.toExponential(4) + ' ' + resUnit,
                    steps: `1. Convert mass to mg: ${mass.toFixed(2)} ${massUnit} = ${massMg.toExponential(4)} mg\n2. Convert volume to L: ${volume.toFixed(2)} ${volUnit} = ${volL.toFixed(4)} L\n3. Calculate (mg/L): ${concMgL.toFixed(4)} mg/L\n4. Convert to ${resUnit}: ${finalVal.toExponential(4)}`
                };
            },

            calcDilution: () => {
                const c1 = parseFloat(document.getElementById('initial-concentration').value);
                const c1Unit = document.getElementById('initial-conc-unit').value;
                const v1 = parseFloat(document.getElementById('initial-volume').value);
                const v1Unit = document.getElementById('initial-vol-unit').value;
                const vDiluent = parseFloat(document.getElementById('diluent-volume').value);
                const vDiluentUnit = document.getElementById('diluent-vol-unit').value;
                const resUnit = document.getElementById('final-conc-unit').value;

                if (isNaN(c1) || isNaN(v1) || isNaN(vDiluent)) throw new Error("Please enter valid numbers for concentration and volumes.");
                if (v1 <= 0) throw new Error("Initial volume must be greater than 0");

                // Normalize everything to mg/L and L
                const c1MgL = c1 * WaterCalc.getFactorToMgL(c1Unit);
                
                let v1L = v1;
                if (v1Unit === 'mL') v1L = v1 / 1000;
                if (v1Unit === 'gal') v1L = v1 * 3.78541;

                let vDL = vDiluent;
                if (vDiluentUnit === 'mL') vDL = vDiluent / 1000;
                if (vDiluentUnit === 'gal') vDL = vDiluent * 3.78541;

                const v2L = v1L + vDL;
                
                // C1V1 = C2V2 => C2 = C1V1 / V2
                const c2MgL = (c1MgL * v1L) / v2L;
                
                // Convert to target
                const finalVal = c2MgL / WaterCalc.getFactorToMgL(resUnit);
                const dilFactor = v2L / v1L;

                return {
                    value: finalVal.toFixed(4) + ' ' + resUnit,
                    steps: `1. Initial Concentration (normalized): ${c1MgL.toExponential(4)} mg/L\n2. Initial Volume (normalized): ${v1L.toFixed(4)} L\n3. Final Volume: ${v2L.toFixed(4)} L\n4. Dilution Factor: ${dilFactor.toFixed(2)}x\n5. Final Concentration: ${finalVal.toFixed(4)} ${resUnit}`
                };
            },

            calcConversion: () => {
                const val = parseFloat(document.getElementById('value-to-convert').value);
                const from = document.getElementById('from-unit').value;
                const to = document.getElementById('to-unit').value;

                if (isNaN(val)) throw new Error("Please enter a valid number for conversion.");

                const valMgL = val * WaterCalc.getFactorToMgL(from);
                const finalVal = valMgL / WaterCalc.getFactorToMgL(to);

                return {
                    value: finalVal.toExponential(4) + ' ' + to,
                    steps: `1. Convert ${from} value (${val}) to mg/L: ${valMgL.toExponential(4)} mg/L\n2. Convert mg/L to ${to}: ${finalVal.toExponential(4)}`
                };
            },

            calcDosage: () => {
                const flow = parseFloat(document.getElementById('flow-rate').value);
                const flowUnit = document.getElementById('flow-unit').value;
                const target = parseFloat(document.getElementById('target-concentration').value);
                const targetUnit = document.getElementById('target-conc-unit').value;
                const purityInput = parseFloat(document.getElementById('chemical-purity').value);
                const purity = purityInput / 100;
                const resUnit = document.getElementById('dosage-result-unit').value;

                if (isNaN(flow) || isNaN(target) || isNaN(purityInput)) throw new Error("Please enter valid numbers for flow rate, concentration, and purity.");
                if (purity <= 0 || purity > 1) throw new Error("Purity must be between 0 and 100");

                // Convert flow to m3/h
                let flowM3h = flow;
                let flowStep = `${flow} ${flowUnit}`;
                if (flowUnit === 'L/min') {
                    flowM3h = flow * 0.06;
                    flowStep += ` (x 0.06)`;
                }
                if (flowUnit === 'gal/min') {
                    flowM3h = flow * 0.227125;
                    flowStep += ` (x 0.227125)`;
                }

                // Convert target to g/m3 (same as mg/L)
                let targetGm3 = target; 
                // Note: 1 mg/L = 1 g/m3
                if (targetUnit === 'ppm' || targetUnit === 'mg/L') targetGm3 = target; 
                if (targetUnit === 'g/m3') targetGm3 = target;

                // Required pure chemical mass rate (g/h) = flow(m3/h) * target(g/m3)
                const pureRateGh = flowM3h * targetGm3;
                
                // Adjust for purity
                const actualRateGh = pureRateGh / purity;

                // Convert to result unit
                let finalVal = actualRateGh;
                let unitLabel = 'g/h';
                
                if (resUnit === 'kg/day') {
                    finalVal = (actualRateGh * 24) / 1000;
                    unitLabel = 'kg/day';
                } else if (resUnit === 'lb/day') {
                    finalVal = ((actualRateGh * 24) / 1000) * 2.20462;
                    unitLabel = 'lb/day';
                } else if (resUnit === 'g/min') {
                    finalVal = actualRateGh / 60;
                    unitLabel = 'g/min';
                }

                return {
                    value: finalVal.toFixed(4) + ' ' + unitLabel,
                    steps: `1. Flow in mÂ³/h: ${flowStep} = ${flowM3h.toFixed(2)} mÂ³/h\n2. Target in g/mÂ³: ${targetGm3.toFixed(2)} g/mÂ³\n3. Pure chemical needed: ${pureRateGh.toFixed(2)} g/h\n4. Adjust for ${purityInput}% purity: ${actualRateGh.toFixed(2)} g/h\n5. Final Dosage Rate: ${finalVal.toFixed(4)} ${unitLabel}`
                };
            },

            loadSample: () => {
                const type = WaterCalc.currentCalcType;
                if (type === 'concentration') {
                    document.getElementById('solute-mass').value = 5;
                    document.getElementById('mass-unit').value = 'g';
                    document.getElementById('solution-volume').value = 2;
                    document.getElementById('volume-unit').value = 'L';
                } else if (type === 'dilution') {
                    document.getElementById('initial-concentration').value = 5000; // 5000 ppm (0.5%)
                    document.getElementById('initial-conc-unit').value = 'mg/L';
                    document.getElementById('initial-volume').value = 1;
                    document.getElementById('initial-vol-unit').value = 'L';
                    document.getElementById('diluent-volume').value = 9; // 1:10 dilution
                    document.getElementById('diluent-vol-unit').value = 'L';
                } else if (type === 'dosage') {
                    document.getElementById('flow-rate').value = 100; // m3/h
                    document.getElementById('flow-unit').value = 'm3/h';
                    document.getElementById('target-concentration').value = 5; // mg/L chlorine maybe
                    document.getElementById('target-conc-unit').value = 'mg/L';
                    document.getElementById('chemical-purity').value = 12; // 12% Bleach
                } else if (type === 'unit_conversion') {
                    document.getElementById('value-to-convert').value = 0.5;
                    document.getElementById('from-unit').value = 'g/L';
                    document.getElementById('to-unit').value = 'mg/L';
                }
                WaterCalc.calculate();
            },

            clearForm: () => {
                document.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
                document.getElementById('water-results').classList.add('hidden');
                document.getElementById('water-error').classList.add('hidden');
            }
        };

        document.addEventListener('DOMContentLoaded', WaterCalc.init);
    </script>

    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
    

    <div id="toolbox-seo-wrapper-unique-id" class="max-w-4xl mx-auto px-4"></div>
    <script src="/scripts/seo-loader.js"></script>

</body>

</html>
