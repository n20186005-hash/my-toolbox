<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="category" content="E-commerce Operations">
    <title>Global E-Commerce Toolbox (Fixed)</title>
    <meta name="icon" content="ğŸ“Š">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Font Family optimized for multi-language */
        body { font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', 'Meiryo', sans-serif; background-color: #f0f4f8; }
        
        /* Tab Navigation */
        .nav-btn { position: relative; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .nav-btn.active { color: #2563eb; background-color: #eff6ff; font-weight: 600; }
        .nav-btn.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background-color: #2563eb; border-radius: 3px 3px 0 0;
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Inputs */
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .input-group { transition: transform 0.2s; }
        .input-group:focus-within { transform: translateY(-1px); }

        /* Scrollbar */
        .custom-scroll::-webkit-scrollbar { height: 6px; width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; }

        /* Toast Notification */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 100; pointer-events: none; }
        .toast { pointer-events: auto; padding: 12px 24px; border-radius: 8px; color: white; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); animation: slideDown 0.3s ease-out; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .toast.error { background-color: #ef4444; }
        .toast.success { background-color: #10b981; }
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/e-commerce-operations/global-e-commerce-toolbox.html" />
</head>
<body class="p-0 md:p-6 min-h-screen flex flex-col text-slate-800">

    <div id="toast-container"></div>

    <div class="max-w-7xl mx-auto w-full flex-grow flex flex-col">
        
        <div class="bg-white rounded-none md:rounded-2xl shadow-sm border-b md:border border-slate-200 mb-0 md:mb-6 sticky top-0 z-30">
            <div class="flex flex-col md:flex-row justify-between items-center p-4 md:px-6">
                <div class="flex items-center gap-3 w-full md:w-auto mb-4 md:mb-0">
                    <div class="bg-gradient-to-br from-blue-600 to-indigo-700 text-white p-2.5 rounded-xl shadow-lg shadow-blue-500/20">
                        <i class="fa-solid fa-layer-group text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-slate-800 leading-tight" data-i18n="app_title">Global E-Commerce Toolbox</h1>
                        <p class="text-xs text-slate-400 font-medium" data-i18n="app_subtitle">All-in-One Operations Suite</p>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-slate-100 p-1.5 rounded-xl w-full sm:w-auto overflow-x-auto">
                        <button onclick="App.switchTab('bid')" id="nav-bid" class="nav-btn active flex-1 sm:flex-none px-4 py-2 rounded-lg text-sm text-slate-500 hover:text-slate-700 flex items-center justify-center gap-2 whitespace-nowrap">
                            <i class="fa-solid fa-calculator"></i> <span data-i18n="tab_bid">Bid Calc</span>
                        </button>
                        <button onclick="App.switchTab('merchant')" id="nav-merchant" class="nav-btn flex-1 sm:flex-none px-4 py-2 rounded-lg text-sm text-slate-500 hover:text-slate-700 flex items-center justify-center gap-2 whitespace-nowrap">
                            <i class="fa-solid fa-store"></i> <span data-i18n="tab_merchant">Merchant ROI</span>
                        </button>
                        <button onclick="App.switchTab('influencer')" id="nav-influencer" class="nav-btn flex-1 sm:flex-none px-4 py-2 rounded-lg text-sm text-slate-500 hover:text-slate-700 flex items-center justify-center gap-2 whitespace-nowrap">
                            <i class="fa-solid fa-user-tag"></i> <span data-i18n="tab_influencer">Influencer</span>
                        </button>
                        <button onclick="App.switchTab('metrics')" id="nav-metrics" class="nav-btn flex-1 sm:flex-none px-4 py-2 rounded-lg text-sm text-slate-500 hover:text-slate-700 flex items-center justify-center gap-2 whitespace-nowrap">
                            <i class="fa-solid fa-chart-line"></i> <span data-i18n="tab_metrics">Metrics</span>
                        </button>
                    </div>

                    <div class="relative w-full sm:w-auto">
                        <select id="lang-select" onchange="I18nModule.changeLanguage(this.value)" class="w-full sm:w-40 appearance-none bg-white border border-slate-200 text-slate-700 text-sm rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 block p-2.5 cursor-pointer font-medium hover:border-blue-300 transition shadow-sm">
                            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                            <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                            <option value="zh-TW">ğŸ‡­ğŸ‡° ç¹é«”ä¸­æ–‡</option>
                            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-slate-500">
                            <i class="fa-solid fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white md:rounded-3xl shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden flex-grow relative min-h-[600px]">
            
            <div id="view-bid" class="fade-in p-6 md:p-10 h-full">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 h-full">
                    <div class="lg:col-span-4 space-y-6">
                        <div class="bg-blue-50/50 p-6 rounded-2xl border border-blue-100">
                            <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2">
                                <span class="bg-blue-600 text-white w-8 h-8 rounded-lg flex items-center justify-center text-sm"><i class="fa-solid fa-sliders"></i></span>
                                <span data-i18n="params_title">Parameters</span>
                            </h3>
                            
                            <div class="space-y-5">
                                <div class="input-group">
                                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5" data-i18n="bid_label">Base Bid</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-slate-400"><i class="fa-solid fa-tag"></i></div>
                                        <input type="number" id="bid-base" step="0.01" class="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white text-slate-800 font-medium" placeholder="0.00">
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5" data-i18n="premium_label">Crowd Premium (%)</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-slate-400"><i class="fa-solid fa-users"></i></div>
                                        <input type="number" id="bid-premium" step="1" class="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition bg-white text-slate-800 font-medium" placeholder="0">
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5" data-i18n="discount_label">Time Discount (%)</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-slate-400"><i class="fa-solid fa-clock"></i></div>
                                        <input type="number" id="bid-discount" step="1" value="100" class="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition bg-white text-slate-800 font-medium" placeholder="100">
                                    </div>
                                </div>

                                <button onclick="BidModule.calculate()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-600/20 hover:shadow-blue-600/40 transition-all transform active:scale-[0.98] mt-4 flex justify-center items-center gap-2 group">
                                    <i class="fa-solid fa-bolt group-hover:animate-pulse"></i> <span data-i18n="btn_calc">Calculate</span>
                                </button>
                            </div>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 text-xs text-slate-500 leading-relaxed">
                            <i class="fa-solid fa-circle-info text-blue-500 mr-1.5"></i> <span data-i18n="bid_hint">Formula: Final = Base * (1 + Premium%) * (Discount%)</span>
                        </div>
                    </div>

                    <div class="lg:col-span-8 flex flex-col h-full">
                        <div class="flex justify-between items-end mb-5">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800" data-i18n="history_title">History</h3>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="App.exportCSV('bid')" class="text-xs font-semibold text-blue-600 hover:text-blue-800 px-3 py-2 bg-blue-50 rounded-lg hover:bg-blue-100 transition"><i class="fa-solid fa-download mr-1"></i> CSV</button>
                                <button onclick="App.clearData('bid')" class="text-xs font-semibold text-red-500 hover:text-red-700 px-3 py-2 bg-red-50 rounded-lg hover:bg-red-100 transition"><i class="fa-regular fa-trash-can mr-1"></i> Clear</button>
                            </div>
                        </div>

                        <div class="w-full bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col">
                            <div class="overflow-x-auto">
                                <div class="max-h-[500px] overflow-y-auto custom-scroll min-h-[300px]">
                                    <table class="w-full text-sm text-left text-slate-600">
                                        <thead class="text-xs text-slate-400 uppercase bg-slate-50 sticky top-0 z-10 border-b border-slate-100">
                                            <tr>
                                                <th class="px-6 py-4 font-semibold whitespace-nowrap" data-i18n="col_base">Base</th>
                                                <th class="px-6 py-4 font-semibold whitespace-nowrap" data-i18n="col_premium">Premium</th>
                                                <th class="px-6 py-4 font-semibold whitespace-nowrap" data-i18n="col_discount">Discount</th>
                                                <th class="px-6 py-4 font-semibold whitespace-nowrap text-blue-600" data-i18n="col_final">Final</th>
                                                <th class="px-6 py-4 text-center whitespace-nowrap" data-i18n="col_action">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bid-list" class="divide-y divide-slate-100"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-merchant" class="fade-in hidden p-6 md:p-10 h-full">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 h-full">
                    <div class="lg:col-span-4 space-y-6">
                        <div class="bg-indigo-50/50 p-6 rounded-2xl border border-indigo-100">
                            <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2">
                                <span class="bg-indigo-600 text-white w-8 h-8 rounded-lg flex items-center justify-center text-sm"><i class="fa-solid fa-shop"></i></span>
                                <span data-i18n="m_cost_title">Merchant Costs</span>
                            </h3>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2">
                                    <label class="block text-[10px] font-bold text-indigo-400 uppercase tracking-wider mb-1" data-i18n="m_price">Selling Price</label>
                                    <input type="number" id="m-price" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm font-semibold" placeholder="0.00">
                                </div>
                                
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="m_cost">Product Cost</label>
                                    <input type="number" id="m-cost" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0.00">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="m_shipping">Shipping</label>
                                    <input type="number" id="m-shipping" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0.00">
                                </div>

                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="m_platform">Platform (%)</label>
                                    <input type="number" id="m-platform" value="5" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="5.0">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="m_commission">Comm. (%)</label>
                                    <input type="number" id="m-commission" value="0" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0.0">
                                </div>

                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="m_return">Return Rate %</label>
                                    <input type="number" id="m-return" value="0" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0.0">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="m_misc">Misc/Pack</label>
                                    <input type="number" id="m-misc" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0.00">
                                </div>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t border-indigo-100 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-[10px] font-bold text-indigo-400 uppercase tracking-wider mb-1" data-i18n="m_gift">Gift Cost</label>
                                    <input type="number" id="m-gift" value="0" class="w-full p-2 border border-indigo-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-indigo-500" placeholder="0.00">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="m_tax">Tax (%)</label>
                                    <input type="number" id="m-tax" value="0" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-white" placeholder="0">
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="m_insurance">Insurance</label>
                                    <input type="number" id="m-insurance" value="0" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-white" placeholder="0.00">
                                </div>
                            </div>

                            <button onclick="MerchantModule.calculate()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-600/20 hover:shadow-indigo-600/40 transition-all transform active:scale-[0.98] mt-6 flex justify-center items-center gap-2 group">
                                <i class="fa-solid fa-wand-magic-sparkles group-hover:animate-spin-slow"></i> <span data-i18n="btn_analyze">Analyze Profit</span>
                            </button>
                        </div>
                    </div>

                    <div class="lg:col-span-8 flex flex-col h-full">
                        <div class="flex justify-between items-end mb-5">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800" data-i18n="m_result_title">Profit Analysis</h3>
                                <p class="text-sm text-slate-400 mt-1" data-i18n="m_result_sub">Includes deductions for returns & commissions.</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="App.exportCSV('merchant')" class="text-xs font-semibold text-indigo-600 hover:text-indigo-800 px-3 py-2 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition"><i class="fa-solid fa-download mr-1"></i> CSV</button>
                                <button onclick="App.clearData('merchant')" class="text-xs font-semibold text-red-500 hover:text-red-700 px-3 py-2 bg-red-50 rounded-lg hover:bg-red-100 transition"><i class="fa-regular fa-trash-can mr-1"></i> Clear</button>
                            </div>
                        </div>

                        <div class="w-full bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col">
                            <div class="overflow-x-auto">
                                <div class="max-h-[500px] overflow-y-auto custom-scroll min-h-[300px]">
                                    <table class="w-full text-sm text-left text-slate-600">
                                        <thead class="text-xs text-slate-400 uppercase bg-slate-50 sticky top-0 z-10 border-b border-slate-100">
                                            <tr>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_price">Price</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_cost_total">Total Cost</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_profit">Net Profit</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap text-indigo-600" data-i18n="col_breakeven">Breakeven ROI</th>
                                                <th class="px-5 py-4 text-center whitespace-nowrap" data-i18n="col_action">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="merchant-list" class="divide-y divide-slate-100"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-influencer" class="fade-in hidden p-6 md:p-10 h-full">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 h-full">
                    <div class="lg:col-span-4 space-y-6">
                        <div class="bg-purple-50/50 p-6 rounded-2xl border border-purple-100">
                            <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2">
                                <span class="bg-purple-600 text-white w-8 h-8 rounded-lg flex items-center justify-center text-sm"><i class="fa-solid fa-bullhorn"></i></span>
                                <span data-i18n="i_title">Influencer / Affiliate</span>
                            </h3>
                            
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="col-span-2">
                                        <label class="block text-[10px] font-bold text-purple-400 uppercase tracking-wider mb-1" data-i18n="i_sales">Total Sales (GMV)</label>
                                        <input type="number" id="i-gmv" class="w-full p-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm font-semibold" placeholder="0.00">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="i_comm_rate">Comm. Rate (%)</label>
                                        <input type="number" id="i-rate" class="w-full p-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm" placeholder="20.0">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="i_platform_fee">Service Fee (%)</label>
                                        <input type="number" id="i-fee" value="10" class="w-full p-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm" placeholder="10.0">
                                    </div>
                                </div>
                                
                                <div class="pt-2 border-t border-purple-100">
                                    <label class="block text-xs font-bold text-slate-800 mb-2 mt-2" data-i18n="i_costs">Promotion Costs</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="i_ad_spend">Ad Spend</label>
                                            <input type="number" id="i-ad" value="0" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="0.00">
                                        </div>
                                        <div>
                                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="i_sample">Sample/Misc</label>
                                            <input type="number" id="i-sample" value="0" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="0.00">
                                        </div>
                                    </div>
                                </div>

                                <button onclick="InfluencerModule.calculate()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-purple-600/20 hover:shadow-purple-600/40 transition-all transform active:scale-[0.98] mt-4 flex justify-center items-center gap-2">
                                    <i class="fa-solid fa-coins"></i> <span data-i18n="btn_calc_income">Calculate Income</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-8 flex flex-col h-full">
                        <div class="flex justify-between items-end mb-5">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800" data-i18n="i_result_title">Income Statement</h3>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="App.exportCSV('influencer')" class="text-xs font-semibold text-purple-600 hover:text-purple-800 px-3 py-2 bg-purple-50 rounded-lg hover:bg-purple-100 transition"><i class="fa-solid fa-download mr-1"></i> CSV</button>
                                <button onclick="App.clearData('influencer')" class="text-xs font-semibold text-red-500 hover:text-red-700 px-3 py-2 bg-red-50 rounded-lg hover:bg-red-100 transition"><i class="fa-regular fa-trash-can mr-1"></i> Clear</button>
                            </div>
                        </div>

                        <div class="w-full bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col">
                            <div class="overflow-x-auto">
                                <div class="max-h-[500px] overflow-y-auto custom-scroll min-h-[300px]">
                                    <table class="w-full text-sm text-left text-slate-600">
                                        <thead class="text-xs text-slate-400 uppercase bg-slate-50 sticky top-0 z-10 border-b border-slate-100">
                                            <tr>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_gmv">GMV</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_gross_comm">Gross Comm.</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_net_income">Net Income</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap text-purple-600" data-i18n="col_roi_ad">Ad ROI</th>
                                                <th class="px-5 py-4 text-center whitespace-nowrap" data-i18n="col_action">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="influencer-list" class="divide-y divide-slate-100"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-metrics" class="fade-in hidden p-6 md:p-10 h-full">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 h-full">
                    <div class="lg:col-span-4 space-y-6">
                        <div class="bg-teal-50/50 p-6 rounded-2xl border border-teal-100">
                            <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2">
                                <span class="bg-teal-600 text-white w-8 h-8 rounded-lg flex items-center justify-center text-sm"><i class="fa-solid fa-chart-line"></i></span>
                                <span data-i18n="metrics_title">Key Metrics</span>
                            </h3>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="met_visitors">Visitors/Clicks</label>
                                    <input type="number" id="met-visitors" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 text-sm" placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="met_orders">Orders</label>
                                    <input type="number" id="met-orders" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 text-sm" placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="met_revenue">Revenue</label>
                                    <input type="number" id="met-revenue" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 text-sm" placeholder="0.00">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1" data-i18n="met_spend">Ad Spend</label>
                                    <input type="number" id="met-spend" class="w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 text-sm" placeholder="0.00">
                                </div>
                            </div>
                            
                            <button onclick="MetricsModule.calculate()" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-teal-600/20 hover:shadow-teal-600/40 transition-all transform active:scale-[0.98] mt-6 flex justify-center items-center gap-2 group">
                                <i class="fa-solid fa-calculator group-hover:animate-pulse"></i> <span data-i18n="btn_calc_metrics">Calculate KPIs</span>
                            </button>
                        </div>
                    </div>

                    <div class="lg:col-span-8 flex flex-col h-full">
                        <div class="flex justify-between items-end mb-5">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800" data-i18n="metrics_history">KPI Report</h3>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="App.exportCSV('metrics')" class="text-xs font-semibold text-teal-600 hover:text-teal-800 px-3 py-2 bg-teal-50 rounded-lg hover:bg-teal-100 transition"><i class="fa-solid fa-download mr-1"></i> CSV</button>
                                <button onclick="App.clearData('metrics')" class="text-xs font-semibold text-red-500 hover:text-red-700 px-3 py-2 bg-red-50 rounded-lg hover:bg-red-100 transition"><i class="fa-regular fa-trash-can mr-1"></i> Clear</button>
                            </div>
                        </div>

                        <div class="w-full bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col">
                            <div class="overflow-x-auto">
                                <div class="max-h-[500px] overflow-y-auto custom-scroll min-h-[300px]">
                                    <table class="w-full text-sm text-left text-slate-600">
                                        <thead class="text-xs text-slate-400 uppercase bg-slate-50 sticky top-0 z-10 border-b border-slate-100">
                                            <tr>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_cvr">CVR</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_aov">AOV</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_roas">ROAS</th>
                                                <th class="px-5 py-4 font-semibold whitespace-nowrap" data-i18n="col_cpa">CPA</th>
                                                <th class="px-5 py-4 text-center whitespace-nowrap" data-i18n="col_action">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="metrics-list" class="divide-y divide-slate-100"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 px-4 md:px-0">
                <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4 text-center" data-i18n="features_title">Toolbox Features</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-white p-5 rounded-xl border border-slate-100 shadow-sm flex flex-col items-center text-center">
                        <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center mb-3">
                            <i class="fa-solid fa-calculator"></i>
                        </div>
                        <h5 class="font-bold text-slate-800 text-sm mb-1" data-i18n="tab_bid">Bid Calc</h5>
                        <p class="text-xs text-slate-500 leading-relaxed" data-i18n="feat_bid_desc">Smart bidding calculator considering crowd premiums and time-based discounts for optimal ad spend.</p>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-100 shadow-sm flex flex-col items-center text-center">
                        <div class="w-10 h-10 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center mb-3">
                            <i class="fa-solid fa-store"></i>
                        </div>
                        <h5 class="font-bold text-slate-800 text-sm mb-1" data-i18n="tab_merchant">Merchant ROI</h5>
                        <p class="text-xs text-slate-500 leading-relaxed" data-i18n="feat_m_desc">Comprehensive profit analysis including tax, shipping, platform fees, and return rates.</p>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-100 shadow-sm flex flex-col items-center text-center">
                        <div class="w-10 h-10 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center mb-3">
                            <i class="fa-solid fa-user-tag"></i>
                        </div>
                        <h5 class="font-bold text-slate-800 text-sm mb-1" data-i18n="tab_influencer">Influencer</h5>
                        <p class="text-xs text-slate-500 leading-relaxed" data-i18n="feat_i_desc">Track affiliate and influencer campaigns, calculating net income after commissions and ad costs.</p>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-100 shadow-sm flex flex-col items-center text-center">
                        <div class="w-10 h-10 rounded-full bg-teal-50 text-teal-600 flex items-center justify-center mb-3">
                            <i class="fa-solid fa-chart-line"></i>
                        </div>
                        <h5 class="font-bold text-slate-800 text-sm mb-1" data-i18n="tab_metrics">Metrics</h5>
                        <p class="text-xs text-slate-500 leading-relaxed" data-i18n="feat_met_desc">Instant calculation of core e-commerce KPIs: CVR, AOV, ROAS, and CPA.</p>
                    </div>
                </div>
            </div>

        </div>
        
        <div class="text-center mt-8 text-slate-400 text-xs pb-4">
            &copy; 2025 Global E-Commerce Toolbox. Local Processing.
        </div>
    </div>

    <script>
        /* --- MODULE 1: I18N (Multi-language) - UPDATED FIX --- */
        const I18nModule = {
            currentLang: 'en',
            data: {
                'en': {
                    app_title: 'Global E-Commerce Toolbox',
                    app_subtitle: 'All-in-One Operations Suite',
                    tab_bid: 'Bid Calc',
                    tab_merchant: 'Merchant ROI',
                    tab_influencer: 'Influencer',
                    tab_metrics: 'Metrics',
                    params_title: 'Parameters',
                    bid_label: 'Base Bid',
                    premium_label: 'Crowd Premium (%)',
                    discount_label: 'Time Discount (%)',
                    btn_calc: 'Calculate Bid',
                    bid_hint: 'Formula: Final = Base * (1 + Premium%) * (Discount%)',
                    history_title: 'History',
                    col_base: 'Base',
                    col_premium: 'Premium',
                    col_discount: 'Discount',
                    col_final: 'Final Bid',
                    col_action: 'Action',
                    m_cost_title: 'Merchant Cost Structure',
                    m_price: 'Selling Price',
                    m_cost: 'Product Cost',
                    m_shipping: 'Shipping',
                    m_platform: 'Platform Fee (%)',
                    m_commission: 'Commission (%)',
                    m_return: 'Return Rate (%)',
                    m_misc: 'Misc/Packing',
                    m_gift: 'Gift Cost',
                    m_tax: 'Tax (%)',
                    m_insurance: 'Insurance',
                    btn_analyze: 'Analyze Profit',
                    m_result_title: 'Profit Analysis',
                    m_result_sub: 'Includes deductions for returns, gifts & commissions.',
                    col_price: 'Price',
                    col_cost_total: 'Total Cost',
                    col_profit: 'Net Profit',
                    col_breakeven: 'Breakeven ROI',
                    i_title: 'Influencer / Affiliate',
                    i_sales: 'Total Sales (GMV)',
                    i_comm_rate: 'Commission Rate (%)',
                    i_platform_fee: 'Service Fee (%)',
                    i_costs: 'Promotion Costs',
                    i_ad_spend: 'Ad Spend',
                    i_sample: 'Sample/Misc',
                    btn_calc_income: 'Calculate Income',
                    i_result_title: 'Income Statement',
                    col_gmv: 'GMV',
                    col_gross_comm: 'Gross Comm.',
                    col_net_income: 'Net Income',
                    col_roi_ad: 'Ad ROI',
                    metrics_title: 'Key Metrics',
                    met_visitors: 'Visitors/Clicks',
                    met_orders: 'Orders',
                    met_revenue: 'Revenue',
                    met_spend: 'Ad Spend',
                    btn_calc_metrics: 'Calculate KPIs',
                    metrics_history: 'KPI Report',
                    col_cvr: 'Conv. Rate',
                    col_aov: 'AOV',
                    col_roas: 'ROAS',
                    col_cpa: 'CPA',
                    copied: 'Copied to clipboard',
                    no_data: 'No calculations yet',
                    cleared: 'Data cleared',
                    // Features
                    features_title: 'Toolbox Features',
                    feat_bid_desc: 'Smart bidding calculator considering crowd premiums and time-based discounts for optimal ad spend.',
                    feat_m_desc: 'Comprehensive profit analysis including tax, shipping, platform fees, and return rates.',
                    feat_i_desc: 'Track affiliate and influencer campaigns, calculating net income after commissions and ad costs.',
                    feat_met_desc: 'Instant calculation of core e-commerce KPIs: CVR, AOV, ROAS, and CPA.'
                },
                'zh-CN': {
                    app_title: 'å…¨çƒç”µå•†å·¥å…·ç®±',
                    app_subtitle: 'å…¨èƒ½è¿è¥å¥—ä»¶',
                    tab_bid: 'ç«ä»·è®¡ç®—å™¨',
                    tab_merchant: 'å•†å®¶ROIæ¨¡æ‹Ÿ',
                    tab_influencer: 'ç½‘çº¢/è”ç›Ÿ',
                    tab_metrics: 'ç”µå•†æŒ‡æ ‡',
                    params_title: 'å‚æ•°è®¾ç½®',
                    bid_label: 'åŸºç¡€å‡ºä»·',
                    premium_label: 'äººç¾¤æº¢ä»·(%)',
                    discount_label: 'æ—¶æ®µæŠ˜æ‰£(%)',
                    btn_calc: 'è®¡ç®—å‡ºä»·',
                    bid_hint: 'å…¬å¼: æœ€ç»ˆå‡ºä»· = åŸºç¡€å‡ºä»· * (1 + äººç¾¤æº¢ä»·%) * (æ—¶æ®µæŠ˜æ‰£%)',
                    history_title: 'å†å²è®°å½•',
                    col_base: 'åŸºç¡€å‡ºä»·',
                    col_premium: 'æº¢ä»·(%)',
                    col_discount: 'æŠ˜æ‰£(%)',
                    col_final: 'æœ€ç»ˆå‡ºä»·',
                    col_action: 'æ“ä½œ',
                    m_cost_title: 'å•†å®¶æˆæœ¬ç»“æ„',
                    m_price: 'é”€å”®ä»·æ ¼',
                    m_cost: 'äº§å“æˆæœ¬',
                    m_shipping: 'è¿è´¹',
                    m_platform: 'å¹³å°è´¹ç‡(%)',
                    m_commission: 'ä½£é‡‘ç‡(%)',
                    m_return: 'é€€è´§ç‡(%)',
                    m_misc: 'æ‚è´¹/åŒ…è£…',
                    m_gift: 'èµ å“æˆæœ¬',
                    m_tax: 'ç¨ç‡(%)',
                    m_insurance: 'ä¿é™©è´¹',
                    btn_analyze: 'åˆ†æåˆ©æ¶¦',
                    m_result_title: 'åˆ©æ¶¦åˆ†æ',
                    m_result_sub: 'åŒ…å«é€€è´§ã€èµ å“å’Œä½£é‡‘æ‰£é™¤',
                    col_price: 'å”®ä»·',
                    col_cost_total: 'æ€»æˆæœ¬',
                    col_profit: 'å‡€åˆ©æ¶¦',
                    col_breakeven: 'ç›ˆäºå¹³è¡¡ROI',
                    i_title: 'ç½‘çº¢/è”ç›Ÿè¥é”€',
                    i_sales: 'æ€»é”€å”®é¢(GMV)',
                    i_comm_rate: 'ä½£é‡‘ç‡(%)',
                    i_platform_fee: 'æœåŠ¡è´¹(%)',
                    i_costs: 'æ¨å¹¿æˆæœ¬',
                    i_ad_spend: 'å¹¿å‘Šæ”¯å‡º',
                    i_sample: 'æ ·å“/æ‚è´¹',
                    btn_calc_income: 'è®¡ç®—æ”¶ç›Š',
                    i_result_title: 'æ”¶ç›ŠæŠ¥è¡¨',
                    col_gmv: 'æ€»é”€å”®é¢',
                    col_gross_comm: 'æ¯›ä½£é‡‘',
                    col_net_income: 'å‡€æ”¶å…¥',
                    col_roi_ad: 'å¹¿å‘ŠROI',
                    metrics_title: 'æ ¸å¿ƒæŒ‡æ ‡',
                    met_visitors: 'è®¿å®¢/ç‚¹å‡»é‡',
                    met_orders: 'è®¢å•æ•°',
                    met_revenue: 'æ”¶å…¥',
                    met_spend: 'å¹¿å‘Šæ”¯å‡º',
                    btn_calc_metrics: 'è®¡ç®—KPI',
                    metrics_history: 'KPIæŠ¥è¡¨',
                    col_cvr: 'è½¬åŒ–ç‡',
                    col_aov: 'å®¢å•ä»·',
                    col_roas: 'ROAS',
                    col_cpa: 'è·å®¢æˆæœ¬',
                    copied: 'å·²å¤åˆ¶',
                    no_data: 'æš‚æ— è®°å½•',
                    cleared: 'æ•°æ®å·²æ¸…ç©º',
                    // Features
                    features_title: 'åŠŸèƒ½ä»‹ç»',
                    feat_bid_desc: 'ç»“åˆäººç¾¤æº¢ä»·ä¸æ—¶æ®µæŠ˜æ‰£çš„æ™ºèƒ½å‡ºä»·è®¡ç®—ï¼Œä¼˜åŒ–å¹¿å‘Šæ”¯å‡ºã€‚',
                    feat_m_desc: 'åŒ…å«ç¨è´¹ã€è¿è´¹ã€å¹³å°è´¹åŠé€€è´§ç‡çš„å…¨æ–¹ä½åˆ©æ¶¦åˆ†æã€‚',
                    feat_i_desc: 'è¿½è¸ªç½‘çº¢ä¸è”ç›Ÿè¥é”€è¡¨ç°ï¼Œè®¡ç®—æ‰£é™¤ä½£é‡‘ä¸å¹¿å‘Šè´¹åçš„å‡€æ”¶ç›Šã€‚',
                    feat_met_desc: 'å³æ—¶è®¡ç®—æ ¸å¿ƒç”µå•†æŒ‡æ ‡ï¼šè½¬åŒ–ç‡ã€å®¢å•ä»·ã€ROASåŠè·å®¢æˆæœ¬ã€‚'
                },
                'zh-TW': {
                    app_title: 'å…¨çƒé›»å•†å·¥å…·ç®±',
                    app_subtitle: 'å…¨èƒ½é‹ç‡Ÿå¥—ä»¶',
                    tab_bid: 'ç«¶åƒ¹è¨ˆç®—å™¨',
                    tab_merchant: 'å•†å®¶ROIæ¨¡æ“¬',
                    tab_influencer: 'ç¶²ç´…/è¯ç›Ÿ',
                    tab_metrics: 'é›»å•†æŒ‡æ¨™',
                    params_title: 'åƒæ•¸è¨­ç½®',
                    bid_label: 'åŸºç¤å‡ºåƒ¹',
                    premium_label: 'äººç¾¤æº¢åƒ¹(%)',
                    discount_label: 'æ™‚æ®µæŠ˜æ‰£(%)',
                    btn_calc: 'è¨ˆç®—å‡ºåƒ¹',
                    bid_hint: 'å…¬å¼: æœ€çµ‚å‡ºåƒ¹ = åŸºç¤å‡ºåƒ¹ * (1 + äººç¾¤æº¢åƒ¹%) * (æ™‚æ®µæŠ˜æ‰£%)',
                    history_title: 'æ­·å²è¨˜éŒ„',
                    col_base: 'åŸºç¤å‡ºåƒ¹',
                    col_premium: 'æº¢åƒ¹(%)',
                    col_discount: 'æŠ˜æ‰£(%)',
                    col_final: 'æœ€çµ‚å‡ºåƒ¹',
                    col_action: 'æ“ä½œ',
                    m_cost_title: 'å•†å®¶æˆæœ¬çµæ§‹',
                    m_price: 'éŠ·å”®åƒ¹æ ¼',
                    m_cost: 'ç”¢å“æˆæœ¬',
                    m_shipping: 'é‹è²»',
                    m_platform: 'å¹³å°è²»ç‡(%)',
                    m_commission: 'å‚­é‡‘ç‡(%)',
                    m_return: 'é€€è²¨ç‡(%)',
                    m_misc: 'é›œè²»/åŒ…è£',
                    m_gift: 'è´ˆå“æˆæœ¬',
                    m_tax: 'ç¨…ç‡(%)',
                    m_insurance: 'ä¿éšªè²»',
                    btn_analyze: 'åˆ†æåˆ©æ½¤',
                    m_result_title: 'åˆ©æ½¤åˆ†æ',
                    m_result_sub: 'åŒ…å«é€€è²¨ã€è´ˆå“å’Œå‚­é‡‘æ‰£é™¤',
                    col_price: 'å”®åƒ¹',
                    col_cost_total: 'ç¸½æˆæœ¬',
                    col_profit: 'æ·¨åˆ©æ½¤',
                    col_breakeven: 'ç›ˆè™§å¹³è¡¡ROI',
                    i_title: 'ç¶²ç´…/è¯ç›Ÿè¡ŒéŠ·',
                    i_sales: 'ç¸½éŠ·å”®é¡(GMV)',
                    i_comm_rate: 'å‚­é‡‘ç‡(%)',
                    i_platform_fee: 'æœå‹™è²»(%)',
                    i_costs: 'æ¨å»£æˆæœ¬',
                    i_ad_spend: 'å»£å‘Šæ”¯å‡º',
                    i_sample: 'æ¨£å“/é›œè²»',
                    btn_calc_income: 'è¨ˆç®—æ”¶ç›Š',
                    i_result_title: 'æ”¶ç›Šå ±è¡¨',
                    col_gmv: 'ç¸½éŠ·å”®é¡',
                    col_gross_comm: 'æ¯›å‚­é‡‘',
                    col_net_income: 'æ·¨æ”¶å…¥',
                    col_roi_ad: 'å»£å‘ŠROI',
                    metrics_title: 'æ ¸å¿ƒæŒ‡æ¨™',
                    met_visitors: 'è¨ªå®¢/é»æ“Šé‡',
                    met_orders: 'è¨‚å–®æ•¸',
                    met_revenue: 'æ”¶å…¥',
                    met_spend: 'å»£å‘Šæ”¯å‡º',
                    btn_calc_metrics: 'è¨ˆç®—KPI',
                    metrics_history: 'KPIå ±è¡¨',
                    col_cvr: 'è½‰åŒ–ç‡',
                    col_aov: 'å®¢å–®åƒ¹',
                    col_roas: 'ROAS',
                    col_cpa: 'ç²å®¢æˆæœ¬',
                    copied: 'å·²è¤‡è£½',
                    no_data: 'æš«ç„¡è¨˜éŒ„',
                    cleared: 'æ•¸æ“šå·²æ¸…ç©º',
                    // Features
                    features_title: 'åŠŸèƒ½ä»‹ç´¹',
                    feat_bid_desc: 'çµåˆäººç¾¤æº¢åƒ¹èˆ‡æ™‚æ®µæŠ˜æ‰£çš„æ™ºèƒ½å‡ºåƒ¹è¨ˆç®—ï¼Œå„ªåŒ–å»£å‘Šæ”¯å‡ºã€‚',
                    feat_m_desc: 'åŒ…å«ç¨…è²»ã€é‹è²»ã€å¹³å°è²»åŠé€€è²¨ç‡çš„å…¨æ–¹ä½åˆ©æ½¤åˆ†æã€‚',
                    feat_i_desc: 'è¿½è¹¤ç¶²ç´…èˆ‡è¯ç›Ÿè¡ŒéŠ·è¡¨ç¾ï¼Œè¨ˆç®—æ‰£é™¤ä½£é‡‘èˆ‡å»£å‘Šè²»å¾Œçš„æ·¨æ”¶ç›Šã€‚',
                    feat_met_desc: 'å³æ™‚è¨ˆç®—æ ¸å¿ƒé›»å•†æŒ‡æ¨™ï¼šè½‰åŒ–ç‡ã€å®¢å–®åƒ¹ã€ROASåŠç²å®¢æˆæœ¬ã€‚'
                },
                'ja': {
                    app_title: 'ã‚°ãƒ­ãƒ¼ãƒãƒ«ECãƒ„ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹',
                    app_subtitle: 'ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³é‹ç”¨ã‚¹ã‚¤ãƒ¼ãƒˆ',
                    tab_bid: 'å…¥æœ­è¨ˆç®—æ©Ÿ',
                    tab_merchant: 'ãƒãƒ¼ãƒãƒ£ãƒ³ãƒˆROI',
                    tab_influencer: 'ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼',
                    tab_metrics: 'ECæŒ‡æ¨™',
                    params_title: 'ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿',
                    bid_label: 'åŸºæœ¬å…¥æœ­é¡',
                    premium_label: 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ (%)',
                    discount_label: 'æ™‚é–“å‰²å¼•(%)',
                    btn_calc: 'å…¥æœ­é¡ã‚’è¨ˆç®—',
                    bid_hint: 'è¨ˆç®—å¼: æœ€çµ‚ä¾¡æ ¼ = åŸºæœ¬ä¾¡æ ¼ Ã— (1 + ãƒ—ãƒ¬ãƒŸã‚¢ãƒ %) Ã— (å‰²å¼•%)',
                    history_title: 'å±¥æ­´',
                    col_base: 'åŸºæœ¬ä¾¡æ ¼',
                    col_premium: 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ',
                    col_discount: 'å‰²å¼•',
                    col_final: 'æœ€çµ‚å…¥æœ­é¡',
                    col_action: 'æ“ä½œ',
                    m_cost_title: 'ã‚³ã‚¹ãƒˆæ§‹é€ ',
                    m_price: 'è²©å£²ä¾¡æ ¼',
                    m_cost: 'è£½å“ã‚³ã‚¹ãƒˆ',
                    m_shipping: 'é…é€æ–™',
                    m_platform: 'ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ–™ç‡(%)',
                    m_commission: 'ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³(%)',
                    m_return: 'è¿”å“ç‡(%)',
                    m_misc: 'ãã®ä»–/ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸',
                    m_gift: 'ã‚®ãƒ•ãƒˆåŸä¾¡',
                    m_tax: 'ç¨(%)',
                    m_insurance: 'ä¿é™º',
                    btn_analyze: 'åˆ©ç›Šã‚’åˆ†æ',
                    m_result_title: 'åˆ©ç›Šåˆ†æ',
                    m_result_sub: 'è¿”å“ã€ã‚®ãƒ•ãƒˆã€ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®æ§é™¤ã‚’å«ã‚€',
                    col_price: 'ä¾¡æ ¼',
                    col_cost_total: 'ç·ã‚³ã‚¹ãƒˆ',
                    col_profit: 'ç´”åˆ©ç›Š',
                    col_breakeven: 'æç›Šåˆ†å²ROI',
                    i_title: 'ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼/ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ',
                    i_sales: 'ç·å£²ä¸Š(GMV)',
                    i_comm_rate: 'ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³ç‡(%)',
                    i_platform_fee: 'ã‚µãƒ¼ãƒ“ã‚¹æ–™(%)',
                    i_costs: 'ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ã‚¹ãƒˆ',
                    i_ad_spend: 'åºƒå‘Šè²»',
                    i_sample: 'ã‚µãƒ³ãƒ—ãƒ«/ãã®ä»–',
                    btn_calc_income: 'åå…¥ã‚’è¨ˆç®—',
                    i_result_title: 'åå…¥æ˜ç´°',
                    col_gmv: 'GMV',
                    col_gross_comm: 'ç²—åˆ©ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³',
                    col_net_income: 'ç´”åå…¥',
                    col_roi_ad: 'åºƒå‘ŠROI',
                    metrics_title: 'ä¸»è¦æŒ‡æ¨™',
                    met_visitors: 'è¨ªå•è€…/ã‚¯ãƒªãƒƒã‚¯',
                    met_orders: 'æ³¨æ–‡æ•°',
                    met_revenue: 'åç›Š',
                    met_spend: 'åºƒå‘Šæ”¯å‡º',
                    btn_calc_metrics: 'KPIã‚’è¨ˆç®—',
                    metrics_history: 'KPIãƒ¬ãƒãƒ¼ãƒˆ',
                    col_cvr: 'CVR',
                    col_aov: 'å¹³å‡æ³¨æ–‡é¡',
                    col_roas: 'ROAS',
                    col_cpa: 'CPA',
                    copied: 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ',
                    no_data: 'ãƒ‡ãƒ¼ã‚¿ãªã—',
                    cleared: 'ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆå»ã—ã¾ã—ãŸ',
                    // Features
                    features_title: 'æ©Ÿèƒ½ç´¹ä»‹',
                    feat_bid_desc: 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå‰²å¢—ã‚„æ™‚é–“å‰²å¼•ã‚’è€ƒæ…®ã—ãŸã‚¹ãƒãƒ¼ãƒˆå…¥æœ­è¨ˆç®—ã§ã€åºƒå‘Šè²»ã‚’æœ€é©åŒ–ã€‚',
                    feat_m_desc: 'ç¨é‡‘ã€é€æ–™ã€æ‰‹æ•°æ–™ã€è¿”å“ç‡ã‚’å«ã‚ãŸåŒ…æ‹¬çš„ãªåˆ©ç›Šåˆ†æã€‚',
                    feat_i_desc: 'ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¨åºƒå‘Šè²»ã‚’å·®ã—å¼•ã„ãŸç´”åˆ©ç›Šã‚’è¨ˆç®—ã—ã€ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼æ–½ç­–ã‚’è¿½è·¡ã€‚',
                    feat_met_desc: 'ä¸»è¦æŒ‡æ¨™ï¼ˆCVRã€AOVã€ROASã€CPAï¼‰ã‚’å³åº§ã«ç®—å‡ºã€‚'
                },
                'ru': {
                    app_title: 'Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ Ğ´Ğ»Ñ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµÑ€Ñ†Ğ¸Ğ¸',
                    app_subtitle: 'ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ',
                    tab_bid: 'ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ ÑÑ‚Ğ°Ğ²Ğ¾Ğº',
                    tab_merchant: 'ROI Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ğ°',
                    tab_influencer: 'Ğ˜Ğ½Ñ„Ğ»ÑĞµĞ½ÑĞµÑ€',
                    tab_metrics: 'ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ­Ğš',
                    params_title: 'ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹',
                    bid_label: 'Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ğ°Ğ²ĞºĞ°',
                    premium_label: 'ĞŸÑ€ĞµĞ¼Ğ¸Ñ Ğ·Ğ° Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ (%)',
                    discount_label: 'Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ ÑĞºĞ¸Ğ´ĞºĞ° (%)',
                    btn_calc: 'Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ğ²ĞºÑƒ',
                    bid_hint: 'Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°: ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ğ°Ñ = Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ * (1 + ĞŸÑ€ĞµĞ¼Ğ¸Ñ%) * (Ğ¡ĞºĞ¸Ğ´ĞºĞ°%)',
                    history_title: 'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ',
                    col_base: 'Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ',
                    col_premium: 'ĞŸÑ€ĞµĞ¼Ğ¸Ñ',
                    col_discount: 'Ğ¡ĞºĞ¸Ğ´ĞºĞ°',
                    col_final: 'ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ğ°Ñ ÑÑ‚Ğ°Ğ²ĞºĞ°',
                    col_action: 'Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ',
                    m_cost_title: 'Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ğ°',
                    m_price: 'ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ½Ğ°Ñ Ñ†ĞµĞ½Ğ°',
                    m_cost: ' Ğ¡ĞµĞ±ĞµÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°',
                    m_shipping: 'Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°',
                    m_platform: 'ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° (%)',
                    m_commission: 'ĞšĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ (%)',
                    m_return: 'ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ¾Ğ² (%)',
                    m_misc: 'Ğ Ğ°Ğ·Ğ½Ğ¾Ğµ/Ğ£Ğ¿Ğ°ĞºĞ¾Ğ²ĞºĞ°',
                    m_gift: 'ĞŸĞ¾Ğ´Ğ°Ñ€Ğ¾Ğº',
                    m_tax: 'ĞĞ°Ğ»Ğ¾Ğ³ (%)',
                    m_insurance: 'Ğ¡Ñ‚Ñ€Ğ°Ñ…Ğ¾Ğ²ĞºĞ°',
                    btn_analyze: 'ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ',
                    m_result_title: 'ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸',
                    m_result_sub: 'Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ²Ñ‹Ñ‡ĞµÑ‚Ñ‹ Ğ·Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ñ‹ Ğ¸ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸.',
                    col_price: 'Ğ¦ĞµĞ½Ğ°',
                    col_cost_total: 'ĞĞ±Ñ‰Ğ¸Ğµ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚Ñ‹',
                    col_profit: 'Ğ§Ğ¸ÑÑ‚Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ',
                    col_breakeven: 'ROI (Ğ‘ĞµĞ·ÑƒĞ±Ñ‹Ñ‚Ğ¾Ğº)',
                    i_title: 'Ğ˜Ğ½Ñ„Ğ»ÑĞµĞ½ÑĞµÑ€ / ĞÑ„Ñ„Ğ¸Ğ»Ğ¸Ğ°Ñ‚',
                    i_sales: 'ĞĞ±Ñ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸ (GMV)',
                    i_comm_rate: 'Ğ¡Ñ‚Ğ°Ğ²ĞºĞ° ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸ (%)',
                    i_platform_fee: 'Ğ¡ĞµÑ€Ğ²Ğ¸ÑĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ (%)',
                    i_costs: 'Ğ—Ğ°Ñ‚Ñ€Ğ°Ñ‚Ñ‹ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ',
                    i_ad_spend: 'Ğ ĞµĞºĞ»Ğ°Ğ¼Ğ½Ñ‹Ğµ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ñ‹',
                    i_sample: 'ĞĞ±Ñ€Ğ°Ğ·Ñ†Ñ‹/Ğ Ğ°Ğ·Ğ½Ğ¾Ğµ',
                    btn_calc_income: 'Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ´Ğ¾Ñ…Ğ¾Ğ´',
                    i_result_title: 'Ğ”Ğ¾Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚',
                    col_gmv: 'GMV',
                    col_gross_comm: 'Ğ’Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ',
                    col_net_income: 'Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ Ğ´Ğ¾Ñ…Ğ¾Ğ´',
                    col_roi_ad: 'ROI Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñ‹',
                    metrics_title: 'ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸',
                    met_visitors: 'ĞŸĞ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ğ¸/ĞšĞ»Ğ¸ĞºĞ¸',
                    met_orders: 'Ğ—Ğ°ĞºĞ°Ğ·Ñ‹',
                    met_revenue: 'Ğ”Ğ¾Ñ…Ğ¾Ğ´',
                    met_spend: 'Ğ ĞµĞºĞ»Ğ°Ğ¼Ğ½Ñ‹Ğµ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ñ‹',
                    btn_calc_metrics: 'Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ KPI',
                    metrics_history: 'ĞÑ‚Ñ‡ĞµÑ‚ KPI',
                    col_cvr: 'ĞšĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ñ',
                    col_aov: 'Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‡ĞµĞº',
                    col_roas: 'ROAS',
                    col_cpa: 'CPA',
                    copied: 'Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾',
                    no_data: 'ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…',
                    cleared: 'ĞÑ‡Ğ¸Ñ‰ĞµĞ½Ğ¾',
                    // Features
                    features_title: 'Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸',
                    feat_bid_desc: 'Ğ£Ğ¼Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ ÑÑ‚Ğ°Ğ²Ğ¾Ğº Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ¿Ñ€ĞµĞ¼Ğ¸Ğ¹ Ğ·Ğ° Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… ÑĞºĞ¸Ğ´Ğ¾Ğº.',
                    feat_m_desc: 'ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸, Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºÑƒ, ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸ Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ñ‹.',
                    feat_i_desc: 'ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹ Ğ¸Ğ½Ñ„Ğ»ÑĞµĞ½ÑĞµÑ€Ğ¾Ğ², Ñ€Ğ°ÑÑ‡ĞµÑ‚ Ñ‡Ğ¸ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ´Ğ¾Ñ…Ğ¾Ğ´Ğ° Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¹.',
                    feat_met_desc: 'ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°ÑÑ‡ĞµÑ‚ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ñ… KPI: ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ñ, ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‡ĞµĞº, ROAS Ğ¸ CPA.'
                }
            },
            
            init: function() {
                // FIXED: Prioritize URL param, then LocalStorage
                const params = new URLSearchParams(window.location.search);
                const urlLang = params.get('lang');
                
                if (urlLang && this.data[urlLang]) {
                    this.currentLang = urlLang;
                } else {
                    try {
                        const savedLang = localStorage.getItem('appLang');
                        if (savedLang && this.data[savedLang]) {
                            this.currentLang = savedLang;
                        }
                    } catch(e) { console.log('Storage not available'); }
                }

                // Sync the UI dropdown to match current language
                const selector = document.getElementById('lang-select');
                if(selector) selector.value = this.currentLang;

                this.updateTexts();
            },
            
            changeLanguage: function(lang) {
                if (this.data[lang]) {
                    this.currentLang = lang;
                    
                    // Save to LocalStorage
                    try { localStorage.setItem('appLang', lang); } catch(e) {}
                    
                    // FIXED: Update URL without reloading page (History API)
                    const newUrl = new URL(window.location);
                    newUrl.searchParams.set('lang', lang);
                    window.history.pushState({}, '', newUrl);

                    this.updateTexts();
                    App.showToast('success', 'Language changed successfully');
                }
            },
            
            updateTexts: function() {
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (this.data[this.currentLang][key]) {
                        el.textContent = this.data[this.currentLang][key];
                    }
                });
            },
            
            getText: function(key) {
                return this.data[this.currentLang][key] || key;
            }
        };

        /* --- MODULE 2: Bid Calculator --- */
        const BidModule = {
            data: [],
            
            init: function() {
                try {
                    const saved = localStorage.getItem('bidData');
                    if (saved) {
                        this.data = JSON.parse(saved);
                    }
                } catch(e) { console.log('Storage read error'); }
                this.renderList();
            },
            
            calculate: function() {
                const base = parseFloat(document.getElementById('bid-base').value) || 0;
                const premium = parseFloat(document.getElementById('bid-premium').value) || 0;
                const discount = parseFloat(document.getElementById('bid-discount').value) || 0;
                
                if (base <= 0) {
                    App.showToast('error', 'Please enter a valid base bid (>0)');
                    return;
                }
                
                const finalBid = base * (1 + premium / 100) * (discount / 100);
                
                const entry = {
                    id: Date.now(),
                    base: base.toFixed(2),
                    premium: premium,
                    discount: discount,
                    final: finalBid.toFixed(2)
                };
                
                this.data.unshift(entry);
                if (this.data.length > 20) this.data.pop();
                
                try { localStorage.setItem('bidData', JSON.stringify(this.data)); } catch(e) {}
                this.renderList();
                App.showToast('success', I18nModule.getText('btn_calc') + ' OK');
            },
            
            renderList: function() {
                const listEl = document.getElementById('bid-list');
                if (!listEl) return;
                
                if (this.data.length === 0) {
                    listEl.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-slate-400 italic">${I18nModule.getText('no_data')}</td></tr>`;
                    return;
                }
                
                let html = '';
                this.data.forEach(item => {
                    html += `
                        <tr class="hover:bg-slate-50 transition border-b border-slate-50 last:border-0">
                            <td class="px-6 py-4 font-medium text-slate-700">${item.base}</td>
                            <td class="px-6 py-4 text-slate-500">${item.premium}%</td>
                            <td class="px-6 py-4 text-slate-500">${item.discount}%</td>
                            <td class="px-6 py-4 font-bold text-blue-600">${item.final}</td>
                            <td class="px-6 py-4 text-center">
                                <button onclick="BidModule.copy(${item.id})" class="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition">
                                    <i class="fa-regular fa-copy"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                listEl.innerHTML = html;
            },
            
            copy: function(id) {
                const item = this.data.find(i => i.id === id);
                if (item) {
                    const text = `${item.final}`;
                    navigator.clipboard.writeText(text).then(() => {
                        App.showToast('success', I18nModule.getText('copied'));
                    });
                }
            },
            
            clear: function() {
                this.data = [];
                try { localStorage.removeItem('bidData'); } catch(e) {}
                this.renderList();
            },
            
            exportCSV: function() {
                if (this.data.length === 0) return App.showToast('error', I18nModule.getText('no_data'));
                let csv = 'Base,Premium (%),Discount (%),Final Bid\n';
                this.data.forEach(item => {
                    csv += `${item.base},${item.premium},${item.discount},${item.final}\n`;
                });
                App.downloadCSV(csv, 'bid-calc.csv');
            }
        };

        /* --- MODULE 3: Merchant ROI (Enhanced) --- */
        const MerchantModule = {
            data: [],
            
            init: function() {
                try {
                    const saved = localStorage.getItem('merchantData');
                    if (saved) {
                        this.data = JSON.parse(saved);
                    }
                } catch(e) {}
                this.renderList();
            },
            
            calculate: function() {
                const price = parseFloat(document.getElementById('m-price').value) || 0;
                const cost = parseFloat(document.getElementById('m-cost').value) || 0;
                const shipping = parseFloat(document.getElementById('m-shipping').value) || 0;
                const platform = parseFloat(document.getElementById('m-platform').value) || 0;
                const commission = parseFloat(document.getElementById('m-commission').value) || 0;
                const returnRate = parseFloat(document.getElementById('m-return').value) || 0;
                const misc = parseFloat(document.getElementById('m-misc').value) || 0;
                const gift = parseFloat(document.getElementById('m-gift').value) || 0;
                const tax = parseFloat(document.getElementById('m-tax').value) || 0;
                const insurance = parseFloat(document.getElementById('m-insurance').value) || 0;
                
                if (price <= 0) {
                    App.showToast('error', 'Please enter a valid selling price (>0)');
                    return;
                }
                
                const platformFee = price * (platform / 100);
                const commissionFee = price * (commission / 100);
                const taxAmount = price * (tax / 100);
                const totalCost = cost + shipping + platformFee + commissionFee + misc + gift + insurance + taxAmount;
                const effectiveRevenue = price * ((100 - returnRate) / 100);
                const netProfit = effectiveRevenue - totalCost;
                const roi = price > 0 ? ((netProfit / price) * 100).toFixed(1) : '0.0';
                
                const entry = {
                    id: Date.now(),
                    price: price.toFixed(2),
                    totalCost: totalCost.toFixed(2),
                    netProfit: netProfit.toFixed(2),
                    roi: roi,
                };
                
                this.data.unshift(entry);
                if (this.data.length > 20) this.data.pop();
                
                try { localStorage.setItem('merchantData', JSON.stringify(this.data)); } catch(e) {}
                this.renderList();
                App.showToast('success', I18nModule.getText('btn_analyze') + ' OK');
            },
            
            renderList: function() {
                const listEl = document.getElementById('merchant-list');
                if (!listEl) return;
                
                if (this.data.length === 0) {
                    listEl.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-slate-400 italic">${I18nModule.getText('no_data')}</td></tr>`;
                    return;
                }
                
                let html = '';
                this.data.forEach(item => {
                    const profitClass = parseFloat(item.netProfit) >= 0 ? 'text-green-600' : 'text-red-500';
                    const roiClass = parseFloat(item.roi) >= 0 ? 'text-indigo-600' : 'text-red-500';
                    
                    html += `
                        <tr class="hover:bg-slate-50 transition border-b border-slate-50 last:border-0">
                            <td class="px-5 py-4 font-medium text-slate-700">${item.price}</td>
                            <td class="px-5 py-4 text-slate-500">${item.totalCost}</td>
                            <td class="px-5 py-4 font-medium ${profitClass}">${item.netProfit}</td>
                            <td class="px-5 py-4 font-bold ${roiClass}">${item.roi}%</td>
                            <td class="px-5 py-4 text-center">
                                <button onclick="MerchantModule.copy(${item.id})" class="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-full transition">
                                    <i class="fa-regular fa-copy"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                listEl.innerHTML = html;
            },
            
            copy: function(id) {
                const item = this.data.find(i => i.id === id);
                if (item) {
                    const text = `Price: ${item.price}, Cost: ${item.totalCost}, Profit: ${item.netProfit}, ROI: ${item.roi}%`;
                    navigator.clipboard.writeText(text).then(() => App.showToast('success', I18nModule.getText('copied')));
                }
            },
            
            clear: function() {
                this.data = [];
                try { localStorage.removeItem('merchantData'); } catch(e) {}
                this.renderList();
            },
            
            exportCSV: function() {
                if (this.data.length === 0) return App.showToast('error', I18nModule.getText('no_data'));
                let csv = 'Price,Total Cost,Net Profit,Breakeven ROI (%)\n';
                this.data.forEach(item => {
                    csv += `${item.price},${item.totalCost},${item.netProfit},${item.roi}\n`;
                });
                App.downloadCSV(csv, 'merchant-roi.csv');
            }
        };

        /* --- MODULE 4: Influencer ROI --- */
        const InfluencerModule = {
            data: [],
            
            init: function() {
                try {
                    const saved = localStorage.getItem('influencerData');
                    if (saved) {
                        this.data = JSON.parse(saved);
                    }
                } catch(e) {}
                this.renderList();
            },
            
            calculate: function() {
                const gmv = parseFloat(document.getElementById('i-gmv').value) || 0;
                const rate = parseFloat(document.getElementById('i-rate').value) || 0;
                const fee = parseFloat(document.getElementById('i-fee').value) || 0;
                const ad = parseFloat(document.getElementById('i-ad').value) || 0;
                const sample = parseFloat(document.getElementById('i-sample').value) || 0;
                
                if (gmv <= 0) {
                    App.showToast('error', 'Please enter valid GMV (>0)');
                    return;
                }
                
                const grossComm = gmv * (rate / 100);
                const serviceFee = grossComm * (fee / 100);
                const netIncome = grossComm - serviceFee - ad - sample;
                const adRoi = ad > 0 ? ((netIncome / ad) * 100).toFixed(1) : '0.0';
                
                const entry = {
                    id: Date.now(),
                    gmv: gmv.toFixed(2),
                    grossComm: grossComm.toFixed(2),
                    netIncome: netIncome.toFixed(2),
                    adRoi: adRoi
                };
                
                this.data.unshift(entry);
                if (this.data.length > 20) this.data.pop();
                
                try { localStorage.setItem('influencerData', JSON.stringify(this.data)); } catch(e) {}
                this.renderList();
                App.showToast('success', I18nModule.getText('btn_calc_income') + ' OK');
            },
            
            renderList: function() {
                const listEl = document.getElementById('influencer-list');
                if (!listEl) return;
                
                if (this.data.length === 0) {
                    listEl.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-slate-400 italic">${I18nModule.getText('no_data')}</td></tr>`;
                    return;
                }
                
                let html = '';
                this.data.forEach(item => {
                    const incomeClass = parseFloat(item.netIncome) >= 0 ? 'text-green-600' : 'text-red-500';
                    const roiClass = parseFloat(item.adRoi) >= 0 ? 'text-purple-600' : 'text-red-500';
                    
                    html += `
                        <tr class="hover:bg-slate-50 transition border-b border-slate-50 last:border-0">
                            <td class="px-5 py-4 font-medium text-slate-700">${item.gmv}</td>
                            <td class="px-5 py-4 text-slate-500">${item.grossComm}</td>
                            <td class="px-5 py-4 font-medium ${incomeClass}">${item.netIncome}</td>
                            <td class="px-5 py-4 font-bold ${roiClass}">${item.adRoi}%</td>
                            <td class="px-5 py-4 text-center">
                                <button onclick="InfluencerModule.copy(${item.id})" class="p-2 text-slate-400 hover:text-purple-600 hover:bg-purple-50 rounded-full transition">
                                    <i class="fa-regular fa-copy"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                listEl.innerHTML = html;
            },
            
            copy: function(id) {
                const item = this.data.find(i => i.id === id);
                if (item) {
                    const text = `GMV:${item.gmv} Inc:${item.netIncome}`;
                    navigator.clipboard.writeText(text).then(() => App.showToast('success', I18nModule.getText('copied')));
                }
            },
            
            clear: function() {
                this.data = [];
                try { localStorage.removeItem('influencerData'); } catch(e) {}
                this.renderList();
            },
            
            exportCSV: function() {
                if (this.data.length === 0) return App.showToast('error', I18nModule.getText('no_data'));
                let csv = 'GMV,Gross Commission,Net Income,Ad ROI (%)\n';
                this.data.forEach(item => {
                    csv += `${item.gmv},${item.grossComm},${item.netIncome},${item.adRoi}\n`;
                });
                App.downloadCSV(csv, 'influencer-income.csv');
            }
        };

        /* --- MODULE 5: E-Commerce Metrics --- */
        const MetricsModule = {
            data: [],
            
            init: function() {
                try {
                    const saved = localStorage.getItem('metricsData');
                    if (saved) {
                        this.data = JSON.parse(saved);
                    }
                } catch(e) {}
                this.renderList();
            },
            
            calculate: function() {
                const visitors = parseInt(document.getElementById('met-visitors').value) || 0;
                const orders = parseInt(document.getElementById('met-orders').value) || 0;
                const revenue = parseFloat(document.getElementById('met-revenue').value) || 0;
                const spend = parseFloat(document.getElementById('met-spend').value) || 0;
                
                if (visitors <= 0) {
                    App.showToast('error', 'Please enter valid visitors (>0)');
                    return;
                }
                
                const cvr = visitors > 0 ? ((orders / visitors) * 100).toFixed(2) : '0.00';
                const aov = orders > 0 ? (revenue / orders).toFixed(2) : '0.00';
                const roas = spend > 0 ? (revenue / spend).toFixed(2) : '0.00';
                const cpa = orders > 0 ? (spend / orders).toFixed(2) : '0.00';
                
                const entry = {
                    id: Date.now(),
                    cvr: cvr,
                    aov: aov,
                    roas: roas,
                    cpa: cpa
                };
                
                this.data.unshift(entry);
                if (this.data.length > 20) this.data.pop();
                
                try { localStorage.setItem('metricsData', JSON.stringify(this.data)); } catch(e) {}
                this.renderList();
                App.showToast('success', I18nModule.getText('btn_calc_metrics') + ' OK');
            },
            
            renderList: function() {
                const listEl = document.getElementById('metrics-list');
                if (!listEl) return;
                
                if (this.data.length === 0) {
                    listEl.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-slate-400 italic">${I18nModule.getText('no_data')}</td></tr>`;
                    return;
                }
                
                let html = '';
                this.data.forEach(item => {
                    const roasClass = parseFloat(item.roas) >= 2 ? 'text-green-600' : 'text-slate-600';
                    
                    html += `
                        <tr class="hover:bg-slate-50 transition border-b border-slate-50 last:border-0">
                            <td class="px-5 py-4 font-medium text-slate-700">${item.cvr}%</td>
                            <td class="px-5 py-4 text-slate-500">${item.aov}</td>
                            <td class="px-5 py-4 font-medium ${roasClass}">${item.roas}x</td>
                            <td class="px-5 py-4 font-bold text-teal-600">${item.cpa}</td>
                            <td class="px-5 py-4 text-center">
                                <button onclick="MetricsModule.copy(${item.id})" class="p-2 text-slate-400 hover:text-teal-600 hover:bg-teal-50 rounded-full transition">
                                    <i class="fa-regular fa-copy"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                listEl.innerHTML = html;
            },
            
            copy: function(id) {
                const item = this.data.find(i => i.id === id);
                if (item) {
                    const text = `CVR:${item.cvr}% ROAS:${item.roas}`;
                    navigator.clipboard.writeText(text).then(() => App.showToast('success', I18nModule.getText('copied')));
                }
            },
            
            clear: function() {
                this.data = [];
                try { localStorage.removeItem('metricsData'); } catch(e) {}
                this.renderList();
            },
            
            exportCSV: function() {
                if (this.data.length === 0) return App.showToast('error', I18nModule.getText('no_data'));
                let csv = 'CVR,AOV,ROAS,CPA\n';
                this.data.forEach(item => {
                    csv += `${item.cvr},${item.aov},${item.roas},${item.cpa}\n`;
                });
                App.downloadCSV(csv, 'ecom-metrics.csv');
            }
        };

        /* --- Main Application --- */
        const App = {
            currentTab: 'bid',
            
            init: function() {
                I18nModule.init();
                BidModule.init();
                MerchantModule.init();
                InfluencerModule.init();
                MetricsModule.init();
                this.switchTab('bid');
            },
            
            switchTab: function(tab) {
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${tab}`).classList.remove('hidden');
                
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`nav-${tab}`).classList.add('active');
                
                this.currentTab = tab;
            },
            
            showToast: function(type, message) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
                toast.innerHTML = `<i class="fa-solid ${icon}"></i> ${message}`;
                container.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(-20px)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            },
            
            clearData: function(module) {
                if (confirm(I18nModule.getText('cleared') + '?')) {
                    switch(module) {
                        case 'bid': BidModule.clear(); break;
                        case 'merchant': MerchantModule.clear(); break;
                        case 'influencer': InfluencerModule.clear(); break;
                        case 'metrics': MetricsModule.clear(); break;
                    }
                    this.showToast('success', I18nModule.getText('cleared'));
                }
            },
            
            exportCSV: function(module) {
                switch(module) {
                    case 'bid': BidModule.exportCSV(); break;
                    case 'merchant': MerchantModule.exportCSV(); break;
                    case 'influencer': InfluencerModule.exportCSV(); break;
                    case 'metrics': MetricsModule.exportCSV(); break;
                }
            },
            
            downloadCSV: function(csv, filename) {
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        };

        // Expose modules to window for inline onclick handlers
        window.I18nModule = I18nModule;
        window.BidModule = BidModule;
        window.MerchantModule = MerchantModule;
        window.InfluencerModule = InfluencerModule;
        window.MetricsModule = MetricsModule;
        window.App = App;

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>

    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
    
</body>
</html>