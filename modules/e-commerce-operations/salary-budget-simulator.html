<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="category" content="E-commerce Operations">
    <meta name="icon" content="üõçÔ∏è">
    <title>Salary Budget Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0fdf4; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 1000px; margin: 0 auto; position: relative; }
        .section { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group { margin-bottom: 10px; }
        label { display: block; font-size: 0.9rem; color: #4b5563; margin-bottom: 4px; }
        input, select { width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; }
        .result-card { background: #ecfdf5; border: 1px solid #d1fae5; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .result-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px dashed #a7f3d0; }
        .result-row:last-child { border-bottom: none; }
        .result-label { color: #1e3a8a; }
        .result-value { font-weight: 600; color: #065f46; }
        .intro-section { margin-top: 30px; padding: 20px; background-color: #f8fafc; border-radius: 8px; font-size: 0.95rem; color: #475569; }
        .highlight-row { background-color: #dcfce7 !important; transition: background-color 0.3s; }
        table { width: 100%; font-size: 0.85rem; border-collapse: collapse; }
        th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: center; vertical-align: middle; }
        th { background: #f3f4f6; color: #374151; }
        
        /* Input styles for table */
        .tbl-input { width: 100%; padding: 4px; border: 1px solid transparent; background: transparent; text-align: center; border-radius: 4px; }
        .tbl-input:hover, .tbl-input:focus { border-color: #cbd5e1; background: white; outline: none; }
        .range-group { display: flex; align-items: center; gap: 4px; justify-content: center; }
        .range-input { width: 80px; padding: 4px; border: 1px solid #e2e8f0; border-radius: 4px; text-align: center; font-size: 0.8rem; }
        
        .btn-del { color: #ef4444; cursor: pointer; padding: 4px; border-radius: 4px; }
        .btn-del:hover { background-color: #fee2e2; }
        .btn-add { display: inline-flex; align-items: center; gap: 4px; color: #10b981; font-weight: 500; cursor: pointer; padding: 8px; font-size: 0.9rem; }
        .btn-add:hover { color: #059669; }
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/e-commerce-operations/salary-budget-simulator.html" />
</head>
<body>

    <div class="tool-module" id="budget-tool">
        <div class="absolute top-4 right-4">
            <select id="lang-selector" onchange="BudgetCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en" selected>English</option>
                <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-6 text-gray-800 border-b pb-2" data-i18n="title">üìä Salary Budget Simulator</h2>

        <div class="space-y-6">
            <!-- Simulation Inputs -->
            <div class="section">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-i18n="sim_settings">Simulation Settings</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label data-i18n="target_revenue">Target Monthly Revenue (¬•)</label>
                        <input type="number" id="sim_revenue" value="800000" oninput="BudgetCalc.calculate()" class="focus:ring-2 focus:ring-green-500 outline-none font-bold text-green-700">
                    </div>
                </div>
                <p class="text-sm text-gray-500 mt-2" data-i18n="hint">Enter revenue to auto-match Level and calculate costs.</p>
            </div>

            <!-- Reference Table -->
            <div class="section overflow-x-auto">
                <div class="flex justify-between items-end mb-2">
                    <h3 class="text-lg font-semibold text-gray-700" data-i18n="ref_table">Commission Rules Table</h3>
                </div>
                
                <table id="rules-table">
                    <thead>
                        <tr>
                            <th data-i18n="th_level" width="15%">Level</th>
                            <th data-i18n="th_range" width="40%">Monthly Range (¬•) (Min - Max)</th>
                            <th data-i18n="th_base" width="20%">Base (¬•)</th>
                            <th data-i18n="th_rate" width="15%">Commission %</th>
                            <th width="10%"></th>
                        </tr>
                    </thead>
                    <tbody id="rules-body">
                        <!-- Rows will be populated by JS -->
                    </tbody>
                </table>
                <div onclick="BudgetCalc.addRow()" class="btn-add">
                    <span>+</span> <span data-i18n="btn_add_level">Add Level</span>
                </div>
            </div>

            <button onclick="BudgetCalc.calculate()" class="w-full bg-green-600 text-white py-3 rounded font-bold hover:bg-green-700 transition mb-6" data-i18n="btn_calc">Calculate Budget</button>

            <!-- Results -->
            <div class="summary-section">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-i18n="results">Budget Analysis</h3>
                <div class="result-card">
                    <div class="result-row">
                        <span class="result-label" data-i18n="matched_level">Matched Level</span>
                        <span class="result-value text-blue-600 text-lg" id="res_level">-</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label" data-i18n="res_base">Base Salary</span>
                        <span class="result-value" id="res_base_val">¬•0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label" data-i18n="res_commission">Est. Commission</span>
                        <span class="result-value" id="res_comm_val">¬•0</span>
                    </div>
                    <div class="result-row border-t border-gray-300 mt-2 pt-2">
                        <span class="result-label font-bold text-gray-900" data-i18n="res_total">Total Monthly Cost</span>
                        <span class="result-value font-bold text-xl text-green-700" id="res_total_val">¬•0</span>
                    </div>
                    <div class="result-row mt-2">
                        <span class="result-label" data-i18n="res_ratio">Labor Cost Ratio</span>
                        <span class="result-value" id="res_ratio_val">0%</span>
                    </div>
                </div>
            </div>

            <!-- Intro -->
            <div class="intro-section">
                <h3 class="text-lg font-semibold mb-2 text-gray-800" data-i18n="intro_title">About This Tool</h3>
                <p data-i18n="intro_text">This tool simulates salary budgets for operations teams based on revenue targets. It automatically matches the target revenue to a P-Level (P2-P7) and calculates the estimated total labor cost (Base + Commission) and the labor cost ratio, aiding in financial planning.</p>
            </div>
        </div>
    </div>

    <script>
        const BudgetCalc = {
            // Initial default data
            defaultLevels: [
                { name: 'P2', min: 100000, max: 500000, base: 6000, rate: 0.6 },
                { name: 'P3', min: 500000, max: 1000000, base: 8000, rate: 0.8 },
                { name: 'P4', min: 1000000, max: 2000000, base: 9000, rate: 0.8 },
                { name: 'P5', min: 2000000, max: 3000000, base: 11000, rate: 1.0 },
                { name: 'P6', min: 3000000, max: 5000000, base: 15000, rate: 1.0 },
                { name: 'P7', min: 5000000, max: 10000000, base: 20000, rate: 1.0 }
            ],

            i18n: {
                'en': {
                    title: 'üìä Salary Budget Simulator',
                    sim_settings: 'Simulation Settings',
                    target_revenue: 'Target Monthly Revenue (¬•)',
                    hint: 'Enter revenue to auto-match Level and calculate costs.',
                    ref_table: 'Commission Rules Table (Editable)',
                    th_level: 'Level',
                    th_range: 'Monthly Range (¬•) (Min - Max)',
                    th_base: 'Base (¬•)',
                    th_rate: 'Commission %',
                    btn_calc: 'Calculate Budget',
                    results: 'Budget Analysis',
                    matched_level: 'Matched Level',
                    res_base: 'Base Salary',
                    res_commission: 'Est. Commission',
                    res_total: 'Total Monthly Cost',
                    res_ratio: 'Labor Cost Ratio (Cost/Rev)',
                    intro_title: 'About This Tool',
                    intro_text: 'This tool simulates salary budgets for operations teams based on revenue targets. It matches revenue to a P-Level and calculates estimated total labor cost.',
                    btn_add_level: 'Add Level',
                    err_overlap: 'Warning: Revenue ranges might overlap or have gaps.'
                },
                'zh-CN': {
                    title: 'üìä ËøêËê•Â∑•ËµÑÈ¢ÑÁÆóÊé®Êºî',
                    sim_settings: 'Êé®ÊºîËÆæÁΩÆ',
                    target_revenue: 'ÁõÆÊ†áÊúàÂ∫¶‰∏öÁª© (¬•)',
                    hint: 'ËæìÂÖ•‰∏öÁª©Ëá™Âä®ÂåπÈÖç‰∏ãÊñπË°®Ê†º‰∏≠ÁöÑËÅåÁ∫ßÂπ∂ËÆ°ÁÆóÊàêÊú¨„ÄÇ',
                    ref_table: 'ÊèêÊàêËßÑÂàôË°® (ÂèØÁºñËæë)',
                    th_level: 'Á∫ßÂà´',
                    th_range: 'ÊúàÂ∫¶Âå∫Èó¥ (¬•) (Min - Max)',
                    th_base: 'Â∫ïËñ™ (¬•)',
                    th_rate: 'ÊèêÊàêÁÇπÊï∞ (%)',
                    btn_calc: 'ÂºÄÂßãÊé®Êºî',
                    results: 'È¢ÑÁÆóÂàÜÊûê',
                    matched_level: 'ÂåπÈÖçÁ∫ßÂà´',
                    res_base: 'Âü∫Êú¨Â∫ïËñ™',
                    res_commission: 'È¢Ñ‰º∞ÊèêÊàê',
                    res_total: 'ÊúàÂ∫¶ÊÄª‰∫∫ÂäõÊàêÊú¨',
                    res_ratio: 'Ë¥πÊïàÊØî (ÊàêÊú¨/‰∏öÁª©)',
                    intro_title: 'Â∑•ÂÖ∑‰ªãÁªç',
                    intro_text: 'Êú¨Â∑•ÂÖ∑Áî®‰∫éÊ†πÊçÆ‰∏öÁª©ÁõÆÊ†áÊé®ÊºîËøêËê•Ëñ™ËµÑÈ¢ÑÁÆó„ÄÇËá™Âä®Â∞ÜËæìÂÖ•‰∏öÁª©ÂåπÈÖçËá≥‰∏ãÊñπËá™ÂÆö‰πâËÅåÁ∫ßÔºåËÆ°ÁÆóÂåÖÂê´Â∫ïËñ™‰∏éÊèêÊàêÁöÑÊÄª‰∫∫ÂäõÊàêÊú¨ÂèäË¥πÊïàÊØî„ÄÇ',
                    btn_add_level: 'Ê∑ªÂä†ËÅåÁ∫ß',
                    err_overlap: 'Ê≥®ÊÑèÔºö‰∏öÁª©Âå∫Èó¥ÂèØËÉΩÂ≠òÂú®ÈáçÂè†ÊàñÊñ≠Ê°£„ÄÇ'
                },
                'zh-TW': {
                    title: 'üìä ÈÅãÁáüÂ∑•Ë≥áÈ†êÁÆóÊé®Êºî',
                    sim_settings: 'Êé®ÊºîË®≠ÁΩÆ',
                    target_revenue: 'ÁõÆÊ®ôÊúàÂ∫¶Ê•≠Á∏æ (¬•)',
                    hint: 'Ëº∏ÂÖ•Ê•≠Á∏æËá™ÂãïÂåπÈÖç‰∏ãÊñπË°®Ê†º‰∏≠ÁöÑËÅ∑Á¥ö‰∏¶Ë®àÁÆóÊàêÊú¨„ÄÇ',
                    ref_table: 'ÊèêÊàêË¶èÂâáË°® (ÂèØÁ∑®ËºØ)',
                    th_level: 'Á¥öÂà•',
                    th_range: 'ÊúàÂ∫¶ÂçÄÈñì (¬•) (Min - Max)',
                    th_base: 'Â∫ïËñ™ (¬•)',
                    th_rate: 'ÊèêÊàêÈªûÊï∏ (%)',
                    btn_calc: 'ÈñãÂßãÊé®Êºî',
                    results: 'È†êÁÆóÂàÜÊûê',
                    matched_level: 'ÂåπÈÖçÁ¥öÂà•',
                    res_base: 'Âü∫Êú¨Â∫ïËñ™',
                    res_commission: 'È†ê‰º∞ÊèêÊàê',
                    res_total: 'ÊúàÂ∫¶Á∏Ω‰∫∫ÂäõÊàêÊú¨',
                    res_ratio: 'Ë≤ªÊïàÊØî (ÊàêÊú¨/Ê•≠Á∏æ)',
                    intro_title: 'Â∑•ÂÖ∑‰ªãÁ¥π',
                    intro_text: 'Êú¨Â∑•ÂÖ∑Áî®ÊñºÊ†πÊìöÊ•≠Á∏æÁõÆÊ®ôÊé®ÊºîÈÅãÁáüËñ™Ë≥áÈ†êÁÆó„ÄÇËá™ÂãïÂ∞áËº∏ÂÖ•Ê•≠Á∏æÂåπÈÖçËá≥‰∏ãÊñπËá™ÂÆöÁæ©ËÅ∑Á¥öÔºåË®àÁÆóÂåÖÂê´Â∫ïËñ™ËàáÊèêÊàêÁöÑÁ∏Ω‰∫∫ÂäõÊàêÊú¨ÂèäË≤ªÊïàÊØî„ÄÇ',
                    btn_add_level: 'Ê∑ªÂä†ËÅ∑Á¥ö',
                    err_overlap: 'Ê≥®ÊÑèÔºöÊ•≠Á∏æÂçÄÈñìÂèØËÉΩÂ≠òÂú®ÈáçÁñäÊàñÊñ∑Ê™î„ÄÇ'
                },
                'ja': {
                    title: 'üìä Áµ¶‰∏é‰∫àÁÆó„Ç∑„Éü„É•„É¨„Éº„Çø„Éº',
                    sim_settings: '„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ë®≠ÂÆö',
                    target_revenue: 'ÁõÆÊ®ôÊúàÈñìÂ£≤‰∏ä (¬•)',
                    hint: 'Â£≤‰∏ä„ÇíÂÖ•Âäõ„Åô„Çã„Å®„É¨„Éô„É´„ÅåËá™Âãï‰∏ÄËá¥„Åó„Ç≥„Çπ„ÉàË®àÁÆó„Åó„Åæ„Åô„ÄÇ',
                    ref_table: '„Ç≥„Éü„ÉÉ„Ç∑„Éß„É≥„É´„Éº„É´Ë°® (Á∑®ÈõÜÂèØËÉΩ)',
                    th_level: '„É¨„Éô„É´',
                    th_range: 'ÊúàÈñìÁØÑÂõ≤ (¬•) (Min - Max)',
                    th_base: 'Âü∫Êú¨Áµ¶ (¬•)',
                    th_rate: '„Ç≥„Éü„ÉÉ„Ç∑„Éß„É≥ %',
                    btn_calc: 'Ë®àÁÆó„Åô„Çã',
                    results: '‰∫àÁÆóÂàÜÊûê',
                    matched_level: '‰∏ÄËá¥„É¨„Éô„É´',
                    res_base: 'Âü∫Êú¨Áµ¶',
                    res_commission: 'Êé®ÂÆö„Ç≥„Éü„ÉÉ„Ç∑„Éß„É≥',
                    res_total: 'ÊúàÈñìÁ∑è‰∫∫‰ª∂Ë≤ª',
                    res_ratio: '‰∫∫‰ª∂Ë≤ªÁéá („Ç≥„Çπ„Éà/Â£≤‰∏ä)',
                    intro_title: '„ÉÑ„Éº„É´Á¥π‰ªã',
                    intro_text: 'Â£≤‰∏äÁõÆÊ®ô„Å´Âü∫„Å•„ÅÑ„Å¶ÈÅãÂñ∂„ÉÅ„Éº„É†„ÅÆÁµ¶‰∏é‰∫àÁÆó„Çí„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Åó„Åæ„Åô„ÄÇÂ£≤‰∏ä„Çí„É¨„Éô„É´„Å´‰∏ÄËá¥„Åï„Åõ„ÄÅÊé®ÂÆöÁ∑è‰∫∫‰ª∂Ë≤ª„ÇíË®àÁÆó„Åó„Åæ„Åô„ÄÇ',
                    btn_add_level: '„É¨„Éô„É´ËøΩÂä†',
                    err_overlap: 'Ë≠¶ÂëäÔºöÁØÑÂõ≤„ÅåÈáçË§á„Åó„Å¶„ÅÑ„Çã„Åã„ÇÆ„É£„ÉÉ„Éó„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ'
                },
                'ru': {
                    title: 'üìä –°–∏–º—É–ª—è—Ç–æ—Ä –±—é–¥–∂–µ—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã',
                    sim_settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏',
                    target_revenue: '–¶–µ–ª–µ–≤–∞—è –º–µ—Å—è—á–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ (¬•)',
                    hint: '–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä—É—á–∫—É –¥–ª—è –∞–≤—Ç–æ-–ø–æ–¥–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è –∏ —Ä–∞—Å—á–µ—Ç–∞.',
                    ref_table: '–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–∞–≤–∏–ª (–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–∞—è)',
                    th_level: '–£—Ä–æ–≤–µ–Ω—å',
                    th_range: '–ú–µ—Å—è—á–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (¬•) (–ú–∏–Ω - –ú–∞–∫—Å)',
                    th_base: '–û–∫–ª–∞–¥ (¬•)',
                    th_rate: '–ö–æ–º–∏—Å—Å–∏—è %',
                    btn_calc: '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å',
                    results: '–ê–Ω–∞–ª–∏–∑ –±—é–¥–∂–µ—Ç–∞',
                    matched_level: '–£—Ä–æ–≤–µ–Ω—å',
                    res_base: '–ë–∞–∑–æ–≤—ã–π –æ–∫–ª–∞–¥',
                    res_commission: '–û–∂–∏–¥. –∫–æ–º–∏—Å—Å–∏—è',
                    res_total: '–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã',
                    res_ratio: '–î–æ–ª—è –§–û–¢',
                    intro_title: '–û –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ',
                    intro_text: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –±—é–¥–∂–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–ª–µ–≤–æ–π –≤—ã—Ä—É—á–∫–∏. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–∏—Ä–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª.',
                    btn_add_level: '–î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å',
                    err_overlap: '–í–Ω–∏–º–∞–Ω–∏–µ: –¥–∏–∞–ø–∞–∑–æ–Ω—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è.'
                }
            },

            init: function() {
                const params = new URLSearchParams(window.location.search);
                const lang = params.get('lang');
                if (lang && this.i18n[lang]) {
                    document.getElementById('lang-selector').value = lang;
                    this.changeLang();
                    return;
                }
                this.renderTable();
                this.calculate();
            },

            changeLang: function() {
                const lang = document.getElementById('lang-selector').value;
                const newUrl = new URL(window.location);
                newUrl.searchParams.set('lang', lang);
                window.history.pushState({}, '', newUrl);
                const texts = this.i18n[lang];
                if (!texts) return;
                
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });
            },

            renderTable: function() {
                const tbody = document.getElementById('rules-body');
                tbody.innerHTML = '';
                
                this.defaultLevels.forEach((level, index) => {
                    this.appendRow(level);
                });
            },

            appendRow: function(data = { name: 'New', min: 0, max: 0, base: 0, rate: 0 }) {
                const tbody = document.getElementById('rules-body');
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><input type="text" class="tbl-input font-bold" value="${data.name}" placeholder="Name"></td>
                    <td>
                        <div class="range-group">
                            <input type="number" class="range-input min-val" value="${data.min}" oninput="BudgetCalc.calculate()"> 
                            <span class="text-gray-400">-</span>
                            <input type="number" class="range-input max-val" value="${data.max}" oninput="BudgetCalc.calculate()">
                        </div>
                    </td>
                    <td><input type="number" class="tbl-input base-val" value="${data.base}" oninput="BudgetCalc.calculate()"></td>
                    <td><input type="number" class="tbl-input rate-val" value="${data.rate}" step="0.1" oninput="BudgetCalc.calculate()"></td>
                    <td>
                        <button class="btn-del" onclick="BudgetCalc.deleteRow(this)" title="Remove">‚úï</button>
                    </td>
                `;
                tbody.appendChild(tr);
            },

            addRow: function() {
                // Determine smart defaults based on last row
                const rows = document.querySelectorAll('#rules-body tr');
                let newMin = 0;
                let newMax = 100000;
                let newName = 'Px';
                
                if (rows.length > 0) {
                    const lastRow = rows[rows.length - 1];
                    const lastMax = parseFloat(lastRow.querySelector('.max-val').value) || 0;
                    const lastName = lastRow.querySelector('input[type="text"]').value;
                    
                    newMin = lastMax;
                    newMax = lastMax * 1.5; // Guess next step
                    
                    // Try to increment P number
                    const match = lastName.match(/(\d+)$/);
                    if (match) {
                        const num = parseInt(match[1]) + 1;
                        newName = lastName.replace(/\d+$/, num);
                    }
                }

                this.appendRow({ name: newName, min: newMin, max: newMax, base: 0, rate: 1.0 });
                this.calculate(); // Re-run calc immediately
            },

            deleteRow: function(btn) {
                const row = btn.closest('tr');
                row.remove();
                this.calculate();
            },

            getLevelsFromDOM: function() {
                const levels = [];
                const rows = document.querySelectorAll('#rules-body tr');
                
                rows.forEach(tr => {
                    const name = tr.querySelector('input[type="text"]').value;
                    const min = parseFloat(tr.querySelector('.min-val').value) || 0;
                    const max = parseFloat(tr.querySelector('.max-val').value) || 0;
                    const base = parseFloat(tr.querySelector('.base-val').value) || 0;
                    const rate = parseFloat(tr.querySelector('.rate-val').value) || 0;
                    
                    levels.push({ element: tr, name, min, max, base, rate: rate / 100 }); // Convert input 1.0 to 0.01 internally
                });
                return levels;
            },

            calculate: function() {
                const revenue = parseFloat(document.getElementById('sim_revenue').value) || 0;
                const levels = this.getLevelsFromDOM();
                
                // Clear highlights
                document.querySelectorAll('tr').forEach(tr => tr.classList.remove('highlight-row'));

                let matched = null;
                
                // Find matching level
                for (let lvl of levels) {
                    // Check if revenue falls strictly within min (inclusive) and max (exclusive)
                    // Note: For the last bucket, we might want inclusive max or open ended. 
                    // Current logic: min <= revenue < max
                    // Exception: If it's the very last configured level and revenue > max, we might capture it or tell user to extend.
                    // Let's stick to strict range for clarity.
                    
                    if (revenue >= lvl.min && revenue < lvl.max) {
                        matched = lvl;
                        break;
                    }
                }

                // Fallback: If revenue is higher than the highest Max, use the highest level?
                // Or if revenue equals Max of one and Min of another (overlap edge case).
                // Let's handle "Over max" case by matching the highest level if revenue > highest max
                if (!matched && levels.length > 0) {
                    const highestLvl = levels[levels.length - 1];
                    if (revenue >= highestLvl.max) {
                        matched = highestLvl; // Assumption: Top level captures everything above
                    }
                }
                
                if (matched) {
                    matched.element.classList.add('highlight-row');
                    
                    const commission = revenue * matched.rate;
                    const totalCost = matched.base + commission;
                    const ratio = revenue > 0 ? (totalCost / revenue) * 100 : 0;

                    document.getElementById('res_level').innerText = matched.name;
                    document.getElementById('res_base_val').innerText = '¬•' + matched.base;
                    document.getElementById('res_comm_val').innerText = '¬•' + commission.toFixed(2);
                    document.getElementById('res_total_val').innerText = '¬•' + totalCost.toFixed(2);
                    document.getElementById('res_ratio_val').innerText = ratio.toFixed(2) + '%';
                } else {
                    document.getElementById('res_level').innerText = 'Out of Range / Ë∂ÖÂá∫ÁØÑÂúç';
                    document.getElementById('res_base_val').innerText = '-';
                    document.getElementById('res_comm_val').innerText = '-';
                    document.getElementById('res_total_val').innerText = '-';
                    document.getElementById('res_ratio_val').innerText = '-';
                }
            }
        };

        window.onload = function() { BudgetCalc.init(); };
    </script>

    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
    
</body>
</html>