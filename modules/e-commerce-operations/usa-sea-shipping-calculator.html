<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="category" content="E-commerce Operations">
    <title>ç¾å›½æµ·æ´¾æ¸ é“è¿è´¹è®¡ç®—å™¨ - ToolBoxPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .brand-bg { background-color: #0f172a; } 
        .accent-color { color: #2563eb; }
        .btn-primary { background-color: #2563eb; }
        .btn-primary:hover { background-color: #1d4ed8; }
        /* ç®€å•çš„è¾“å…¥æ¡†æ ·å¼è¦†ç›– */
        .edit-input { width: 100%; border: 1px solid #d1d5db; border-radius: 4px; padding: 4px; font-size: 0.875rem; }
        .edit-input:focus { outline: 2px solid #2563eb; border-color: transparent; }
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/e-commerce-operations/usa-sea-shipping-calculator.html" />
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="brand-bg text-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fa-solid fa-plane-departure text-2xl mr-3 text-blue-400"></i>
                <div>
                    <h1 class="text-xl font-bold tracking-wide" id="app-title">ç¾å›½æµ·æ´¾æ¸ é“è¿è´¹è®¡ç®—å™¨</h1>
                    <a href="https://toolboxpro.top" target="_blank" class="text-xs text-blue-300 hover:text-white transition">toolboxpro.top</a>
                </div>
            </div>
            <div>
                <select id="lang-select" class="bg-gray-700 text-white text-sm rounded border border-gray-600 focus:ring-blue-500 focus:border-blue-500 block p-2 outline-none transition-colors">
                    <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                    <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                </select>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 flex-grow max-w-5xl">
        
        <!-- 1. Calculator Section -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center border-b pb-3">
                <i class="fa-solid fa-calculator mr-3 accent-color"></i>
                <span id="calc-title">è¿è´¹è®¡ç®—</span>
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Form -->
                <form id="calculator-form" onsubmit="event.preventDefault(); calculateFreight();" class="space-y-5">
                    <!-- Channel -->
                    <div>
                        <label for="channel" class="block mb-2 text-sm font-semibold text-gray-700" id="lbl-channel">è¿è¾“æ¸ é“</label>
                        <select id="channel" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="matson_regular">ç¾æ£®æ­£ç­ (Matson CLX)</option>
                            <option value="matson_extra">ç¾æ£®åŠ ç­ (Matson CLX+)</option>
                            <option value="common_boat">æ™®é€šå¿«èˆ¹ (Regular)</option>
                        </select>
                    </div>

                    <!-- Address Type -->
                    <div>
                        <label for="addressType" class="block mb-2 text-sm font-semibold text-gray-700" id="lbl-addressType">æ´¾é€åœ°å€ç±»å‹</label>
                        <select id="addressType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="amazon">äºšé©¬é€Šåœ°å€ (Amazon)</option>
                            <option value="commercial">å•†ä¸šåœ°å€ (Commercial)</option>
                            <option value="private">ç§äººåœ°å€ (Private)</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <!-- Zip Code -->
                        <div>
                            <label for="zipCode" class="block mb-2 text-sm font-semibold text-gray-700" id="lbl-zipFirstDigit">ç¾å›½é‚®ç¼–é¦–ä½</label>
                            <input type="number" id="zipCode" min="0" max="9" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="0-9" required>
                        </div>
                        <!-- Weight -->
                        <div>
                            <label for="weight" class="block mb-2 text-sm font-semibold text-gray-700" id="lbl-weight">è´§ç‰©é‡é‡ (KG)</label>
                            <input type="number" id="weight" step="0.01" min="0" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="0.00" required>
                        </div>
                    </div>

                    <div class="flex gap-3 pt-2">
                        <button type="submit" class="flex-1 btn-primary text-white font-medium rounded-lg text-sm px-5 py-3 text-center transition shadow-md hover:shadow-lg" id="btn-calculate">
                            <i class="fa-solid fa-search mr-2"></i> <span id="btn-calc-text">è®¡ç®—è¿è´¹</span>
                        </button>
                        <button type="button" onclick="resetForm()" class="w-24 text-gray-700 bg-gray-100 border border-gray-300 hover:bg-gray-200 font-medium rounded-lg text-sm px-5 py-3 text-center transition" id="btn-reset">
                            é‡ç½®
                        </button>
                    </div>
                </form>

                <!-- Result Panel -->
                <div class="flex flex-col justify-center">
                    <!-- Default State -->
                    <div id="result-placeholder" class="text-center text-gray-400 py-10">
                        <i class="fa-solid fa-box-open text-4xl mb-3 opacity-30"></i>
                        <p class="text-sm">è¯·è¾“å…¥ä¿¡æ¯ä»¥è·å–æŠ¥ä»·</p>
                    </div>

                    <!-- Active Result State -->
                    <div id="result-area" class="hidden bg-blue-50 border border-blue-100 rounded-xl p-6 relative overflow-hidden shadow-sm">
                        <div class="absolute top-0 right-0 bg-blue-600 text-white text-xs px-3 py-1 rounded-bl-lg font-bold" id="res-zone-badge">Zone 0</div>
                        
                        <h3 class="text-lg font-bold text-gray-800 mb-4" id="lbl-resultTitle">è®¡ç®—ç»“æœ</h3>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center border-b border-blue-100 pb-2">
                                <span class="text-gray-600 text-sm" id="lbl-chargedWeight">è®¡è´¹é‡é‡</span>
                                <span class="font-bold text-gray-900 text-lg"><span id="res-weight">0</span> <span class="text-xs text-gray-500">KG</span></span>
                            </div>
                            
                            <div class="flex justify-between items-center border-b border-blue-100 pb-2">
                                <span class="text-gray-600 text-sm" id="lbl-unitPrice">é€‚ç”¨å•ä»·</span>
                                <div class="text-right">
                                    <span class="font-bold text-gray-900 text-lg"><span id="res-price">0</span> <span class="text-xs text-gray-500">CNY/KG</span></span>
                                    <div id="tier-badge" class="text-[10px] text-white bg-green-500 px-1.5 py-0.5 rounded inline-block ml-1">101KG+</div>
                                </div>
                            </div>

                            <div class="flex justify-between items-center pt-2">
                                <span class="text-gray-800 font-bold" id="lbl-totalFee">é¢„ä¼°æ€»è¿è´¹</span>
                                <span class="font-bold text-blue-700 text-2xl"><span id="res-total">0</span> <span class="text-sm">CNY</span></span>
                            </div>
                        </div>

                        <!-- Warnings/Notes -->
                        <div class="mt-4 space-y-1">
                            <div id="private-surcharge-note" class="hidden flex items-start text-xs text-orange-600 bg-orange-50 p-2 rounded border border-orange-100">
                                <i class="fa-solid fa-circle-exclamation mt-0.5 mr-1.5"></i>
                                <span id="lbl-privateNote">åŒ…å«ç§äººåœ°å€é™„åŠ è´¹ +1 CNY/KG</span>
                            </div>
                            <div id="min-weight-note" class="hidden flex items-start text-xs text-blue-600 bg-blue-100/50 p-2 rounded border border-blue-100">
                                <i class="fa-solid fa-info-circle mt-0.5 mr-1.5"></i>
                                <span id="lbl-minWeightNote">ä¸è¶³æœ€ä½èµ·è¿é‡ï¼Œå·²æŒ‰æœ€ä½æ ‡å‡†è®¡è´¹</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Error Message -->
                    <div id="error-area" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-center">
                        <p class="text-red-600 text-sm font-medium" id="error-msg"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Introduction -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <i class="fa-regular fa-file-lines mr-2 accent-color"></i>
                <span id="lbl-introTitle">æœåŠ¡ä»‹ç»</span>
            </h3>
            <div class="text-gray-600 text-sm leading-relaxed space-y-4">
                <p id="lbl-introContent">
                    ç¾å›½æµ·æ´¾æ¸ é“åŒ…å«ç¾æ£®æ­£ç­å¿«èˆ¹æµ·æ´¾ã€ç¾æ£®åŠ ç­å¿«èˆ¹æµ·æ´¾ã€æ™®é€šå¿«èˆ¹æµ·æ´¾ä¸‰ä¸ªæ¸ é“ï¼ŒæŒ‰ç¾å›½é‚®ç¼–é¦–ä½åˆ†åŒºè®¡è´¹ã€‚æ”¯æŒäºšé©¬é€Šåœ°å€ã€å•†ä¸šåœ°å€ã€ç§äººåœ°å€æ´¾é€ã€‚æŠ¥ä»·ä¸ºæ™®è´§ä»·æ ¼ï¼Œç‰¹æ®Šè´§ç‰©éœ€å’¨è¯¢å®¢æœç¡®è®¤é™„åŠ è´¹ã€‚
                </p>
                
                <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-100">
                    <h4 class="font-bold text-yellow-800 text-sm mb-2" id="lbl-note">å¤‡æ³¨è¯´æ˜ï¼š</h4>
                    <ul class="list-disc list-inside text-xs text-yellow-800/90 space-y-1">
                        <li id="lbl-note1">äºšé©¬é€Šåœ°å€13å…¬æ–¤èµ·æ”¶ï¼Œå…¶ä»–å•†ä¸š/ç§äººåœ°å€101å…¬æ–¤èµ·æ”¶</li>
                        <li id="lbl-note2">ç§äººåœ°å€å•ä»· +1 CNY/KGï¼Œåè¿œåœ°å€æ”¶å–åè¿œé™„åŠ è´¹</li>
                        <li id="lbl-note3">å•ä»¶ä¸è¶³12å…¬æ–¤æŒ‰12å…¬æ–¤è®¡è´¹ï¼Œå•ç¥¨ä¸è¶³101KGæŒ‰101KGè®¡è´¹</li>
                        <li id="lbl-note4">è¶…é•¿è¶…é‡é™åˆ¶ï¼š2å®½+2é«˜+1é•¿â‰¤260CMï¼Œæœ€é•¿è¾¹â‰¤110CMï¼Œå•ä»¶é‡é‡â‰¤22KG</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 3. Full Rate Table (Editable) -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="p-4 border-b border-gray-100 bg-gray-50 flex flex-wrap justify-between items-center gap-4">
                <div class="flex items-center">
                    <h3 class="font-bold text-gray-800 mr-4" id="lbl-tableTitle">å®Œæ•´æŠ¥ä»·è¡¨æ ¼</h3>
                    <button id="btn-edit-mode" onclick="toggleEditMode()" class="text-xs px-3 py-1.5 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors flex items-center">
                        <i class="fa-solid fa-pen-to-square mr-1.5"></i> <span id="btn-edit-text">ä¿®æ”¹æŠ¥ä»·</span>
                    </button>
                    <button id="btn-save-mode" onclick="saveRates()" class="hidden text-xs px-3 py-1.5 bg-green-500 text-white rounded hover:bg-green-600 transition-colors flex items-center ml-2 shadow-sm">
                        <i class="fa-solid fa-floppy-disk mr-1.5"></i> <span id="btn-save-text">ä¿å­˜è®¾ç½®</span>
                    </button>
                    <button id="btn-reset-default" onclick="resetDefaultRates()" class="hidden text-xs px-3 py-1.5 bg-gray-200 text-gray-600 rounded hover:bg-gray-300 transition-colors flex items-center ml-2">
                        <i class="fa-solid fa-rotate-left mr-1.5"></i> <span id="btn-reset-text">æ¢å¤é»˜è®¤</span>
                    </button>
                </div>
                <span class="text-xs text-gray-400">Data Source: toolboxpro.top</span>
            </div>
            
            <div class="overflow-x-auto relative">
                <!-- ä¿å­˜æˆåŠŸçš„æç¤º -->
                <div id="save-toast" class="absolute top-2 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded shadow-lg text-sm opacity-0 transition-opacity duration-300 pointer-events-none z-10">
                    <i class="fa-solid fa-check mr-2"></i> ä¿å­˜æˆåŠŸï¼
                </div>

                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 border-b">
                        <tr>
                            <th scope="col" class="px-4 py-3 whitespace-nowrap" id="th-channel">æ¸ é“</th>
                            <th scope="col" class="px-4 py-3 whitespace-nowrap text-center" id="th-zone">é‚®ç¼–é¦–ä½</th>
                            <th scope="col" class="px-4 py-3 text-center bg-blue-50 text-blue-700">â‰¥101KG</th>
                            <th scope="col" class="px-4 py-3 text-center bg-green-50 text-green-700">213KG+ (Amazon)</th>
                            <th scope="col" class="px-4 py-3 text-center bg-green-50 text-green-700">272KG+ (Amazon)</th>
                            <th scope="col" class="px-4 py-3 whitespace-nowrap text-gray-500 font-normal" id="th-timings">å‚è€ƒæ—¶æ•ˆ / å¤‡æ³¨</th>
                        </tr>
                    </thead>
                    <tbody id="rate-table-body">
                        <!-- JS Generated Rows -->
                    </tbody>
                </table>
            </div>
            <div class="p-4 text-xs text-gray-400 text-center bg-gray-50 border-t border-gray-100">
                * <span id="lbl-disclaimer">è¡¨æ ¼æ•°æ®ä»…ä¾›å‚è€ƒï¼Œå®é™…ä»·æ ¼ä»¥å‡ºè´§æ—¶ä¸ºå‡†ã€‚</span>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p class="font-medium text-lg mb-1">toolboxpro.top</p>
            <p class="text-xs opacity-50">Â© 2023 All rights reserved.</p>
        </div>
    </footer>

    <script>
        // --- 1. æ•°æ®ç®¡ç† (Data Management) ---
        
        const STORAGE_KEY = 'shipping_calculator_rates_v1';
        let currentLang = 'zh-CN';
        let isEditMode = false;
        let ratesData = {}; // ä¼šè¢«åŠ è½½çš„æ•°æ®å¡«å……

        // é»˜è®¤çš„åŸºç¡€ä»·æ ¼é…ç½® (ç”¨äºç”Ÿæˆé»˜è®¤æ•°æ®)
        const defaultBasePrices = {
            'matson_regular': { start: 14.5, step: 0.5, sail: 'å…­æˆªä¸‰å¼€', del: '11-13å¤©' },
            'matson_extra':   { start: 12.5, step: 0.5, sail: 'å››æˆªå¼€èˆ¹', del: '15-18å¤©' },
            'common_boat':    { start: 9.5,  step: 0.5, sail: 'ä¸€æˆªäº”å¼€', del: '25-30å¤©' }
        };
        const channels = ['matson_regular', 'matson_extra', 'common_boat'];

        // ç”Ÿæˆé»˜è®¤æ•°æ®
        function generateDefaultRates() {
            const data = {};
            channels.forEach(ch => {
                data[ch] = {};
                for(let i=0; i<=9; i++) {
                    const zone = i.toString();
                    let p101 = defaultBasePrices[ch].start + (i > 4 ? 1 : 0) + (i > 8 ? 1 : 0);
                    data[ch][zone] = {
                        price101: p101,
                        price213: parseFloat((p101 - 0.5).toFixed(1)),
                        price272: parseFloat((p101 - 1.0).toFixed(1)),
                        sailing: defaultBasePrices[ch].sail,
                        delivery: defaultBasePrices[ch].del
                    };
                }
            });
            return data;
        }

        // åˆå§‹åŒ–/åŠ è½½æ•°æ®
        function loadRates() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    ratesData = JSON.parse(stored);
                } catch (e) {
                    console.error("Data parse error, using defaults");
                    ratesData = generateDefaultRates();
                }
            } else {
                ratesData = generateDefaultRates();
            }
        }

        // ä¿å­˜æ•°æ®
        function saveRatesToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(ratesData));
        }

        // æ¢å¤é»˜è®¤
        function resetDefaultRates() {
            if(confirm('ç¡®å®šè¦æ¢å¤é»˜è®¤æŠ¥ä»·å—ï¼Ÿæ‰€æœ‰ä¿®æ”¹å°†ä¸¢å¤±ã€‚')) {
                ratesData = generateDefaultRates();
                saveRatesToStorage();
                isEditMode = false;
                updateEditUI();
                renderFullRateTable();
                calculateFreight(); // é‡æ–°è®¡ç®—
            }
        }

        // --- 2. è¯­è¨€åŒ… (I18n) ---
        const langResources = {
            'zh-CN': {
                appTitle: 'ç¾å›½æµ·æ´¾æ¸ é“è¿è´¹è®¡ç®—å™¨',
                calcTitle: 'è¿è´¹è®¡ç®—',
                lblChannel: 'è¿è¾“æ¸ é“',
                lblAddressType: 'æ´¾é€åœ°å€ç±»å‹',
                lblZipFirstDigit: 'ç¾å›½é‚®ç¼–é¦–ä½ (0-9)',
                lblWeight: 'è´§ç‰©é‡é‡ (KG)',
                btnCalculate: 'è®¡ç®—è¿è´¹',
                lblResultTitle: 'è®¡ç®—ç»“æœ',
                lblChargedWeight: 'è®¡è´¹é‡é‡',
                lblUnitPrice: 'é€‚ç”¨å•ä»·',
                lblTotalFee: 'é¢„ä¼°æ€»è¿è´¹',
                lblPrivateNote: 'åŒ…å«ç§äººåœ°å€é™„åŠ è´¹ +1 CNY/KG',
                lblMinWeightNote: 'ä¸è¶³æœ€ä½èµ·è¿é‡ï¼Œå·²æŒ‰æœ€ä½æ ‡å‡†è®¡è´¹',
                lblIntroTitle: 'æœåŠ¡ä»‹ç»',
                lblIntroContent: 'ç¾å›½æµ·æ´¾æ¸ é“åŒ…å«ç¾æ£®æ­£ç­å¿«èˆ¹æµ·æ´¾ã€ç¾æ£®åŠ ç­å¿«èˆ¹æµ·æ´¾ã€æ™®é€šå¿«èˆ¹æµ·æ´¾ä¸‰ä¸ªæ¸ é“ï¼ŒæŒ‰ç¾å›½é‚®ç¼–é¦–ä½åˆ†åŒºè®¡è´¹ã€‚æ”¯æŒäºšé©¬é€Šåœ°å€ã€å•†ä¸šåœ°å€ã€ç§äººåœ°å€æ´¾é€ã€‚æŠ¥ä»·ä¸ºæ™®è´§ä»·æ ¼ï¼Œç‰¹æ®Šè´§ç‰©éœ€å’¨è¯¢å®¢æœç¡®è®¤é™„åŠ è´¹ã€‚',
                lblNote: 'å¤‡æ³¨è¯´æ˜ï¼š',
                lblNote1: 'äºšé©¬é€Šåœ°å€13å…¬æ–¤èµ·æ”¶ï¼Œå…¶ä»–å•†ä¸š/ç§äººåœ°å€101å…¬æ–¤èµ·æ”¶',
                lblNote2: 'ç§äººåœ°å€å•ä»· +1 CNY/KGï¼Œåè¿œåœ°å€æ”¶å–åè¿œé™„åŠ è´¹',
                lblNote3: 'å•ä»¶ä¸è¶³12å…¬æ–¤æŒ‰12å…¬æ–¤è®¡è´¹ï¼Œå•ç¥¨ä¸è¶³101KGæŒ‰101KGè®¡è´¹',
                lblNote4: 'è¶…é•¿è¶…é‡é™åˆ¶ï¼š2å®½+2é«˜+1é•¿â‰¤260CMï¼Œæœ€é•¿è¾¹â‰¤110CMï¼Œå•ä»¶é‡é‡â‰¤22KG',
                lblTableTitle: 'å®Œæ•´æŠ¥ä»·è¡¨æ ¼',
                thChannel: 'æ¸ é“',
                thZone: 'é‚®ç¼–é¦–ä½',
                thTimings: 'å‚è€ƒæ—¶æ•ˆ / å¤‡æ³¨',
                lblDisclaimer: 'è¡¨æ ¼æ•°æ®ä»…ä¾›å‚è€ƒï¼Œå®é™…ä»·æ ¼ä»¥å‡ºè´§æ—¶ä¸ºå‡†ã€‚',
                optMatsonReg: 'ç¾æ£®æ­£ç­ (Matson CLX)',
                optMatsonExt: 'ç¾æ£®åŠ ç­ (Matson CLX+)',
                optCommon: 'æ™®é€šå¿«èˆ¹ (Regular)',
                optAmazon: 'äºšé©¬é€Šåœ°å€',
                optCommercial: 'å•†ä¸šåœ°å€',
                optPrivate: 'ç§äººåœ°å€',
                errZip: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç¼–é¦–ä½ (0-9)',
                errWeight: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‡é‡',
                btnEdit: 'ä¿®æ”¹æŠ¥ä»·',
                btnSave: 'ä¿å­˜è®¾ç½®',
                btnResetDefault: 'æ¢å¤é»˜è®¤'
            },
            'zh-TW': {
                appTitle: 'ç¾åœ‹æµ·æ´¾æ¸ é“é‹è²»è¨ˆç®—æ©Ÿ',
                calcTitle: 'é‹è²»è¨ˆç®—',
                lblChannel: 'é‹è¼¸æ¸ é“',
                lblAddressType: 'æ´¾é€åœ°å€é¡å‹',
                lblZipFirstDigit: 'ç¾åœ‹éƒµéå€è™Ÿé¦–ä½ (0-9)',
                lblWeight: 'è²¨ç‰©é‡é‡ (KG)',
                btnCalculate: 'è¨ˆç®—é‹è²»',
                lblResultTitle: 'è¨ˆç®—çµæœ',
                lblChargedWeight: 'è¨ˆè²»é‡é‡',
                lblUnitPrice: 'é©ç”¨å–®åƒ¹',
                lblTotalFee: 'é ä¼°ç¸½é‹è²»',
                lblPrivateNote: 'åŒ…å«ç§äººåœ°å€é™„åŠ è²» +1 CNY/KG',
                lblMinWeightNote: 'ä¸è¶³æœ€ä½èµ·é‹é‡ï¼Œå·²æŒ‰æœ€ä½æ¨™æº–è¨ˆè²»',
                lblIntroTitle: 'æœå‹™ä»‹ç´¹',
                lblIntroContent: 'ç¾åœ‹æµ·æ´¾æ¸ é“åŒ…å«ç¾æ£®æ­£ç­å¿«èˆ¹æµ·æ´¾ã€ç¾æ£®åŠ ç­å¿«èˆ¹æµ·æ´¾ã€æ™®é€šå¿«èˆ¹æµ·æ´¾ä¸‰å€‹æ¸ é“ï¼ŒæŒ‰ç¾åœ‹éƒµéå€è™Ÿé¦–ä½åˆ†å€è¨ˆè²»ã€‚æ”¯æŒäºé¦¬éœåœ°å€ã€å•†æ¥­åœ°å€ã€ç§äººåœ°å€æ´¾é€ã€‚å ±åƒ¹ç‚ºæ™®è²¨åƒ¹æ ¼ï¼Œç‰¹æ®Šè²¨ç‰©éœ€è«®è©¢å®¢æœã€‚',
                lblNote: 'å‚™è¨»èªªæ˜ï¼š',
                lblNote1: 'äºé¦¬éœåœ°å€13å…¬æ–¤èµ·æ”¶ï¼Œå…¶ä»–å•†æ¥­/ç§äººåœ°å€101å…¬æ–¤èµ·æ”¶',
                lblNote2: 'ç§äººåœ°å€å–®åƒ¹ +1 CNY/KGï¼Œåé åœ°å€æ”¶å–åé é™„åŠ è²»',
                lblNote3: 'å–®ä»¶ä¸è¶³12å…¬æ–¤æŒ‰12å…¬æ–¤è¨ˆè²»ï¼Œå–®ç¥¨ä¸è¶³101KGæŒ‰101KGè¨ˆè²»',
                lblNote4: 'è¶…é•·è¶…é‡é™åˆ¶ï¼š2å¯¬+2é«˜+1é•·â‰¤260CMï¼Œæœ€é•·é‚Šâ‰¤110CM',
                lblTableTitle: 'å®Œæ•´å ±åƒ¹è¡¨æ ¼',
                thChannel: 'æ¸ é“',
                thZone: 'éƒµéå€è™Ÿé¦–ä½',
                thTimings: 'åƒè€ƒæ™‚æ•ˆ / å‚™è¨»',
                lblDisclaimer: 'è¡¨æ ¼æ•¸æ“šåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›åƒ¹æ ¼ä»¥å‡ºè²¨æ™‚ç‚ºæº–ã€‚',
                optMatsonReg: 'ç¾æ£®æ­£ç­',
                optMatsonExt: 'ç¾æ£®åŠ ç­',
                optCommon: 'æ™®é€šå¿«èˆ¹',
                optAmazon: 'äºé¦¬éœåœ°å€',
                optCommercial: 'å•†æ¥­åœ°å€',
                optPrivate: 'ç§äººåœ°å€',
                errZip: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„éƒµéå€è™Ÿé¦–ä½ (0-9)',
                errWeight: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é‡é‡',
                btnEdit: 'ä¿®æ”¹å ±åƒ¹',
                btnSave: 'ä¿å­˜è¨­ç½®',
                btnResetDefault: 'æ¢å¾©é»˜èª'
            },
            'en': {
                appTitle: 'USA Sea Shipping Calculator',
                calcTitle: 'Estimate Shipping',
                lblChannel: 'Shipping Channel',
                lblAddressType: 'Address Type',
                lblZipFirstDigit: 'Zip Code First Digit (0-9)',
                lblWeight: 'Cargo Weight (KG)',
                btnCalculate: 'Calculate',
                lblResultTitle: 'Calculation Result',
                lblChargedWeight: 'Charged Weight',
                lblUnitPrice: 'Applied Rate',
                lblTotalFee: 'Estimated Total',
                lblPrivateNote: 'Includes Private Address Surcharge +1 CNY/KG',
                lblMinWeightNote: 'Minimum weight charge applied',
                lblIntroTitle: 'Service Intro',
                lblIntroContent: 'Services include Matson CLX, Matson CLX+, and Regular Sea Freight. Pricing based on Zip Code Zone. Supports Amazon, Commercial, and Private addresses.',
                lblNote: 'Notes:',
                lblNote1: 'Min 13KG for Amazon; Min 101KG for Commercial/Private',
                lblNote2: 'Private address surcharge +1 CNY/KG',
                lblNote3: 'Package under 12KG charged as 12KG',
                lblNote4: 'Max size: 2W+2H+1L â‰¤ 260CM, Longest side â‰¤ 110CM',
                lblTableTitle: 'Full Rate Table',
                thChannel: 'Channel',
                thZone: 'Zip Zone',
                thTimings: 'Transit Time / Notes',
                lblDisclaimer: 'Rates are for reference only.',
                optMatsonReg: 'Matson Regular',
                optMatsonExt: 'Matson Extra',
                optCommon: 'Regular Boat',
                optAmazon: 'Amazon',
                optCommercial: 'Commercial',
                optPrivate: 'Private',
                errZip: 'Enter valid Zip Digit (0-9)',
                errWeight: 'Enter valid weight',
                btnEdit: 'Edit Rates',
                btnSave: 'Save Settings',
                btnResetDefault: 'Reset Defaults'
            },
            'ja': {
                appTitle: 'ç±³å›½æµ·ä¸Šè¼¸é€é€æ–™è¨ˆç®—æ©Ÿ',
                calcTitle: 'é€æ–™è¨ˆç®—',
                lblChannel: 'è¼¸é€ãƒãƒ£ãƒãƒ«',
                lblAddressType: 'é…é€å…ˆã‚¿ã‚¤ãƒ—',
                lblZipFirstDigit: 'éƒµä¾¿ç•ªå·å…ˆé ­æ¡ (0-9)',
                lblWeight: 'è²¨ç‰©é‡é‡ (KG)',
                btnCalculate: 'è¨ˆç®—ã™ã‚‹',
                lblResultTitle: 'è¨ˆç®—çµæœ',
                lblChargedWeight: 'è«‹æ±‚é‡é‡',
                lblUnitPrice: 'é©ç”¨å˜ä¾¡',
                lblTotalFee: 'åˆè¨ˆé€æ–™ï¼ˆæ¦‚ç®—ï¼‰',
                lblPrivateNote: 'å€‹äººä½æ‰€è¿½åŠ æ–™é‡‘ +1 CNY/KG ã‚’å«ã‚€',
                lblMinWeightNote: 'æœ€ä½é‡é‡æ–™é‡‘ãŒé©ç”¨ã•ã‚Œã¾ã—ãŸ',
                lblIntroTitle: 'ã‚µãƒ¼ãƒ“ã‚¹ç´¹ä»‹',
                lblIntroContent: 'ãƒãƒƒãƒˆã‚½ãƒ³å®šæœŸä¾¿ã€ãƒãƒƒãƒˆã‚½ãƒ³è‡¨æ™‚ä¾¿ã€é€šå¸¸ä¾¿ã‚’å«ã¿ã¾ã™ã€‚ç±³å›½ã®éƒµä¾¿ç•ªå·ã®æœ€åˆã®æ•°å­—ã«åŸºã¥ã„ã¦æ–™é‡‘ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚Amazonã€å•†æ¥­ã€å€‹äººã®ä½æ‰€ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚',
                lblNote: 'å‚™è€ƒï¼š',
                lblNote1: 'Amazonã¯13kgã‹ã‚‰ã€ãã®ä»–ã¯101kgã‹ã‚‰',
                lblNote2: 'å€‹äººä½æ‰€ã¯ +1 CNY/KG',
                lblNote3: '12kgæœªæº€ã®è·ç‰©ã¯12kgã¨ã—ã¦è¨ˆç®—',
                lblNote4: 'ã‚µã‚¤ã‚ºåˆ¶é™ï¼š2å¹…+2é«˜ã•+1é•·ã•â‰¤260CM',
                lblTableTitle: 'æ–™é‡‘è¡¨å®Œå…¨ç‰ˆ',
                thChannel: 'ãƒãƒ£ãƒãƒ«',
                thZone: 'éƒµä¾¿ç•ªå·',
                thTimings: 'é…é€æœŸé–“ / å‚™è€ƒ',
                lblDisclaimer: 'ä¾¡æ ¼ã¯å‚è€ƒç”¨ã§ã™',
                optMatsonReg: 'ãƒãƒƒãƒˆã‚½ãƒ³å®šæœŸä¾¿',
                optMatsonExt: 'ãƒãƒƒãƒˆã‚½ãƒ³è‡¨æ™‚ä¾¿',
                optCommon: 'é€šå¸¸ä¾¿',
                optAmazon: 'Amazonä½æ‰€',
                optCommercial: 'å•†æ¥­ä½æ‰€',
                optPrivate: 'å€‹äººä½æ‰€',
                errZip: 'æœ‰åŠ¹ãªæ•°å­—(0-9)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                errWeight: 'æœ‰åŠ¹ãªé‡é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                btnEdit: 'ä¾¡æ ¼ä¿®æ­£',
                btnSave: 'ä¿å­˜',
                btnResetDefault: 'åˆæœŸåŒ–'
            }
        };

        // --- 3. æ ¸å¿ƒé€»è¾‘ (Logic) ---

        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–: 1.è¯»å–URLè¯­è¨€ 2.åŠ è½½æ•°æ® 3.æ¸²æŸ“
            initLanguageFromURL();
            loadRates();
            renderFullRateTable();
            
            // ç›‘å¬å™¨
            document.getElementById('lang-select').addEventListener('change', (e) => {
                const newLang = e.target.value;
                changeLanguageURL(newLang);
                currentLang = newLang;
                updateLanguageUI();
                if (!document.getElementById('result-area').classList.contains('hidden')) {
                    calculateFreight();
                }
            });
        });

        // URL è¯­è¨€å‚æ•°å¤„ç†
        function initLanguageFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const langParam = urlParams.get('lang');
                if (langParam && langResources[langParam]) {
                    currentLang = langParam;
                    document.getElementById('lang-select').value = currentLang;
                }
            } catch (e) {
                console.log('URL param init failed', e);
            }
            updateLanguageUI();
        }

        function changeLanguageURL(lang) {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                urlParams.set('lang', lang);
                window.history.replaceState(null, null, '?' + urlParams.toString());
            } catch (e) {
                console.warn('History API not supported');
            }
        }

        // æ¸²æŸ“è¡¨æ ¼ (æ”¯æŒæ™®é€šæ¨¡å¼å’Œç¼–è¾‘æ¨¡å¼)
        function renderFullRateTable() {
            const tbody = document.getElementById('rate-table-body');
            tbody.innerHTML = '';
            
            const channelKeys = ['matson_regular', 'matson_extra', 'common_boat'];
            const channelNames = {
                'matson_regular': 'ç¾æ£®æ­£ç­ (Matson CLX)',
                'matson_extra': 'ç¾æ£®åŠ ç­ (Matson CLX+)',
                'common_boat': 'æ™®é€šå¿«èˆ¹ (Regular)'
            };

            channelKeys.forEach(chKey => {
                const chData = ratesData[chKey];
                
                for (let z = 0; z <= 9; z++) {
                    const zoneKey = z.toString();
                    const rates = chData[zoneKey];
                    
                    const tr = document.createElement('tr');
                    tr.className = "bg-white border-b hover:bg-gray-50 transition-colors group";
                    
                    // ç”Ÿæˆå•å…ƒæ ¼å†…å®¹ï¼šå¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œç”Ÿæˆ input
                    const cell101 = isEditMode 
                        ? `<input type="number" step="0.1" class="edit-input bg-blue-50" data-ch="${chKey}" data-zone="${zoneKey}" data-field="price101" value="${rates.price101}">`
                        : rates.price101;
                    
                    const cell213 = isEditMode 
                        ? `<input type="number" step="0.1" class="edit-input bg-green-50" data-ch="${chKey}" data-zone="${zoneKey}" data-field="price213" value="${rates.price213}">`
                        : rates.price213;

                    const cell272 = isEditMode 
                        ? `<input type="number" step="0.1" class="edit-input bg-green-50" data-ch="${chKey}" data-zone="${zoneKey}" data-field="price272" value="${rates.price272}">`
                        : rates.price272;
                    
                    const cellSail = isEditMode 
                        ? `<input type="text" class="edit-input text-xs mb-1" data-ch="${chKey}" data-zone="${zoneKey}" data-field="sailing" value="${rates.sailing}">`
                        : rates.sailing;
                        
                    const cellDel = isEditMode 
                        ? `<input type="text" class="edit-input text-xs" data-ch="${chKey}" data-zone="${zoneKey}" data-field="delivery" value="${rates.delivery}">`
                        : rates.delivery;

                    tr.innerHTML = `
                        <td class="px-4 py-3 font-medium text-gray-900">${channelNames[chKey]}</td>
                        <td class="px-4 py-3 text-center font-bold text-gray-800 border-l border-gray-100">${zoneKey}</td>
                        <td class="px-4 py-3 text-center text-gray-600 border-l border-gray-100">${cell101}</td>
                        <td class="px-4 py-3 text-center text-green-600 font-medium border-l border-gray-100">${cell213}</td>
                        <td class="px-4 py-3 text-center text-green-600 font-medium border-l border-gray-100">${cell272}</td>
                        <td class="px-4 py-3 text-xs text-gray-500 border-l border-gray-100">
                            <div>${!isEditMode ? '<i class="fa-solid fa-ship text-blue-300"></i> ' : ''}${cellSail}</div>
                            <div>${!isEditMode ? '<i class="fa-solid fa-truck text-blue-300"></i> ' : ''}${cellDel}</div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                }
            });
        }

        // ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
        function toggleEditMode() {
            isEditMode = true;
            updateEditUI();
            renderFullRateTable();
        }

        // ä¿å­˜ç¼–è¾‘
        function saveRates() {
            // æ”¶é›†æ‰€æœ‰ input çš„æ•°æ®
            const inputs = document.querySelectorAll('#rate-table-body input');
            inputs.forEach(input => {
                const ch = input.dataset.ch;
                const zone = input.dataset.zone;
                const field = input.dataset.field;
                let val = input.value;
                
                // æ•°å­—ç±»å‹è½¬æ¢
                if (field.startsWith('price')) {
                    val = parseFloat(val);
                    if (isNaN(val)) val = 0;
                }
                
                if (ratesData[ch] && ratesData[ch][zone]) {
                    ratesData[ch][zone][field] = val;
                }
            });

            saveRatesToStorage();
            isEditMode = false;
            updateEditUI();
            renderFullRateTable();
            
            // æ˜¾ç¤º Toast
            const toast = document.getElementById('save-toast');
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 2000);
            
            // å¦‚æœæœ‰ç»“æœï¼Œåˆ·æ–°è®¡ç®—
            if (!document.getElementById('result-area').classList.contains('hidden')) {
                calculateFreight();
            }
        }

        function updateEditUI() {
            const btnEdit = document.getElementById('btn-edit-mode');
            const btnSave = document.getElementById('btn-save-mode');
            const btnReset = document.getElementById('btn-reset-default');
            
            if (isEditMode) {
                btnEdit.classList.add('hidden');
                btnSave.classList.remove('hidden');
                btnReset.classList.remove('hidden');
            } else {
                btnEdit.classList.remove('hidden');
                btnSave.classList.add('hidden');
                btnReset.classList.add('hidden');
            }
        }

        // æ ¸å¿ƒè®¡ç®—å‡½æ•° (æ— å˜åŒ–ï¼Œåªæ˜¯ä½¿ç”¨ ratesData)
        function calculateFreight() {
            const t = langResources[currentLang];
            const channel = document.getElementById('channel').value;
            const addressType = document.getElementById('addressType').value;
            const zipInput = document.getElementById('zipCode').value;
            const weightInput = parseFloat(document.getElementById('weight').value);
            
            const errorArea = document.getElementById('error-area');
            const resultArea = document.getElementById('result-area');
            const placeholder = document.getElementById('result-placeholder');
            const errorMsg = document.getElementById('error-msg');

            if (zipInput === '' || isNaN(zipInput) || zipInput < 0 || zipInput > 9) {
                errorMsg.textContent = t.errZip;
                errorArea.classList.remove('hidden');
                resultArea.classList.add('hidden');
                placeholder.classList.add('hidden');
                return;
            }
            if (!weightInput || weightInput <= 0) {
                errorMsg.textContent = t.errWeight;
                errorArea.classList.remove('hidden');
                resultArea.classList.add('hidden');
                placeholder.classList.add('hidden');
                return;
            }

            errorArea.classList.add('hidden');
            placeholder.classList.add('hidden');

            let chargedWeight = weightInput;
            let isMinWeightApplied = false;

            if (addressType === 'amazon') {
                if (chargedWeight < 13) {
                    chargedWeight = 13;
                    isMinWeightApplied = true;
                }
            } else {
                if (chargedWeight < 101) {
                    chargedWeight = 101;
                    isMinWeightApplied = true;
                }
            }

            const zone = zipInput.toString().charAt(0);
            const rateObj = ratesData[channel][zone];
            
            let unitPrice = rateObj.price101; 
            let tierName = "101KG+";

            if (addressType === 'amazon') {
                if (chargedWeight >= 272) {
                    unitPrice = rateObj.price272;
                    tierName = "272KG+ (Amz)";
                } else if (chargedWeight >= 213) {
                    unitPrice = rateObj.price213;
                    tierName = "213KG+ (Amz)";
                }
            }

            let isPrivateSurcharge = false;
            if (addressType === 'private') {
                unitPrice += 1;
                isPrivateSurcharge = true;
                tierName += " + Pvt";
            }

            const totalFee = chargedWeight * unitPrice;

            document.getElementById('res-weight').textContent = chargedWeight.toFixed(2);
            document.getElementById('res-price').textContent = unitPrice.toFixed(2);
            document.getElementById('res-total').textContent = totalFee.toFixed(2);
            document.getElementById('res-zone-badge').textContent = `Zone ${zone}`;
            document.getElementById('tier-badge').textContent = tierName;

            const privateNoteEl = document.getElementById('private-surcharge-note');
            const minWeightNoteEl = document.getElementById('min-weight-note');

            if (isPrivateSurcharge) privateNoteEl.classList.remove('hidden');
            else privateNoteEl.classList.add('hidden');

            if (isMinWeightApplied) minWeightNoteEl.classList.remove('hidden');
            else minWeightNoteEl.classList.add('hidden');

            resultArea.classList.remove('hidden');
        }

        function resetForm() {
            document.getElementById('calculator-form').reset();
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('error-area').classList.add('hidden');
            document.getElementById('result-placeholder').classList.remove('hidden');
        }

        function updateLanguageUI() {
            const t = langResources[currentLang];
            if (!t) return;
            
            // Removed 'btn-calculate' from here because it's a container button with an icon.
            // Automatically setting its textContent destroys the child span and icon.
            const ids = ['app-title', 'calc-title', 'lbl-channel', 'lbl-addressType', 
                         'lbl-zipFirstDigit', 'lbl-weight', 'lbl-resultTitle',
                         'lbl-chargedWeight', 'lbl-unitPrice', 'lbl-totalFee', 'lbl-privateNote',
                         'lbl-minWeightNote', 'lbl-introTitle', 'lbl-introContent', 'lbl-note',
                         'lbl-note1', 'lbl-note2', 'lbl-note3', 'lbl-note4', 'lbl-tableTitle',
                         'th-channel', 'th-zone', 'th-timings', 'lbl-disclaimer'];
            
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el && t[camelCase(id)]) el.textContent = t[camelCase(id)];
            });

            // Added safety checks for manual updates
            if(document.getElementById('btn-calc-text')) document.getElementById('btn-calc-text').textContent = t.btnCalculate;
            if(document.getElementById('btn-edit-text')) document.getElementById('btn-edit-text').textContent = t.btnEdit;
            if(document.getElementById('btn-save-text')) document.getElementById('btn-save-text').textContent = t.btnSave;
            if(document.getElementById('btn-reset-text')) document.getElementById('btn-reset-text').textContent = t.btnResetDefault;
            
            updateSelectOptions('channel', {
                'matson_regular': t.optMatsonReg,
                'matson_extra': t.optMatsonExt,
                'common_boat': t.optCommon
            });
            updateSelectOptions('addressType', {
                'amazon': t.optAmazon,
                'commercial': t.optCommercial,
                'private': t.optPrivate
            });
        }
        
        function camelCase(str) {
            return str.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
        }

        function updateSelectOptions(id, map) {
            const select = document.getElementById(id);
            Array.from(select.options).forEach(opt => {
                if (map[opt.value]) {
                    opt.text = map[opt.value];
                }
            });
        }
    </script>

    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
    

    <div id="toolbox-seo-wrapper-unique-id" class="max-w-4xl mx-auto px-4"></div>
    <script src="/scripts/seo-loader.js"></script>

</body>
</html>