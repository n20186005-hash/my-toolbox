<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Unit Converter Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0fdf4; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="unit_conv" 
         data-category="tools" 
         data-title="Unit Converter" 
         data-icon="üîÑ">
        
        <div class="absolute top-4 right-4">
            <select id="uc-lang" onchange="UnitConv.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en">English</option>
                <option value="zh-CN">Á∞°È´î‰∏≠Êñá</option>
                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">üîÑ Unit Converter</h2>

        <!-- Category Selector -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="lbl_cat">Category</label>
            <select id="uc-cat" class="w-full p-2 border rounded focus:ring-2 focus:ring-emerald-500 bg-white" onchange="UnitConv.updateUnits()">
                <option value="len" data-i18n="cat_len">Length</option>
                <option value="wgt" data-i18n="cat_wgt">Weight</option>
                <option value="temp" data-i18n="cat_temp">Temperature</option>
            </select>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-4">
            <!-- Input Side -->
            <div>
                <label class="block text-xs text-gray-500 mb-1" data-i18n="lbl_from">From</label>
                <input type="number" id="uc-val-from" class="w-full p-2 border rounded mb-2 focus:ring-1 focus:ring-emerald-500" value="1" oninput="UnitConv.convert('from')">
                <select id="uc-unit-from" class="w-full p-2 border rounded bg-white text-sm" onchange="UnitConv.convert('from')">
                    <!-- Dynamic Options -->
                </select>
            </div>

            <!-- Output Side -->
            <div>
                <label class="block text-xs text-gray-500 mb-1" data-i18n="lbl_to">To</label>
                <input type="number" id="uc-val-to" class="w-full p-2 border rounded mb-2 focus:ring-1 focus:ring-emerald-500 bg-gray-50" oninput="UnitConv.convert('to')">
                <select id="uc-unit-to" class="w-full p-2 border rounded bg-white text-sm" onchange="UnitConv.convert('from')">
                    <!-- Dynamic Options -->
                </select>
            </div>
        </div>
    </div>

    <script>
        const UnitConv = {
            i18n: {
                'en': {
                    title: 'üîÑ Unit Converter',
                    lbl_cat: 'Category',
                    lbl_from: 'From',
                    lbl_to: 'To',
                    cat_len: 'Length',
                    cat_wgt: 'Weight',
                    cat_temp: 'Temperature',
                    // Units
                    u_m: 'Meter (m)', u_km: 'Kilometer (km)', u_cm: 'Centimeter (cm)', u_mm: 'Millimeter (mm)',
                    u_mi: 'Mile', u_yd: 'Yard', u_ft: 'Foot', u_in: 'Inch',
                    u_kg: 'Kilogram (kg)', u_g: 'Gram (g)', u_lb: 'Pound (lb)', u_oz: 'Ounce (oz)',
                    u_c: 'Celsius (¬∞C)', u_f: 'Fahrenheit (¬∞F)', u_k: 'Kelvin (K)'
                },
                'zh-CN': {
                    title: 'üîÑ Âçï‰ΩçÊç¢ÁÆóÂô®',
                    lbl_cat: 'Á±ªÂà´',
                    lbl_from: '‰ªé',
                    lbl_to: 'Âà∞',
                    cat_len: 'ÈïøÂ∫¶',
                    cat_wgt: 'ÈáçÈáè',
                    cat_temp: 'Ê∏©Â∫¶',
                    u_m: 'Á±≥ (m)', u_km: 'ÂçÉÁ±≥ (km)', u_cm: 'ÂéòÁ±≥ (cm)', u_mm: 'ÊØ´Á±≥ (mm)',
                    u_mi: 'Ëã±Èáå', u_yd: 'Á†Å', u_ft: 'Ëã±Â∞∫', u_in: 'Ëã±ÂØ∏',
                    u_kg: 'ÂçÉÂÖã (kg)', u_g: 'ÂÖã (g)', u_lb: 'Á£Ö (lb)', u_oz: 'ÁõéÂè∏ (oz)',
                    u_c: 'ÊëÑÊ∞èÂ∫¶ (¬∞C)', u_f: 'ÂçéÊ∞èÂ∫¶ (¬∞F)', u_k: 'ÂºÄÂ∞îÊñá (K)'
                },
                'zh-TW': {
                    title: 'üîÑ ÂñÆ‰ΩçÊèõÁÆóÂô®',
                    lbl_cat: 'È°ûÂà•',
                    lbl_from: 'Âæû',
                    lbl_to: 'Âà∞',
                    cat_len: 'Èï∑Â∫¶',
                    cat_wgt: 'ÈáçÈáè',
                    cat_temp: 'Ê∫´Â∫¶',
                    u_m: 'ÂÖ¨Â∞∫ (m)', u_km: 'ÂÖ¨Èáå (km)', u_cm: 'ÂÖ¨ÂàÜ (cm)', u_mm: 'ÊØ´Á±≥ (mm)',
                    u_mi: 'Ëã±Èáå', u_yd: 'Á¢º', u_ft: 'Ëã±Â∞∫', u_in: 'Ëã±ÂØ∏',
                    u_kg: 'ÂÖ¨Êñ§ (kg)', u_g: 'ÂÖ¨ÂÖã (g)', u_lb: 'Á£Ö (lb)', u_oz: 'ÁõéÂè∏ (oz)',
                    u_c: 'ÊîùÊ∞èÂ∫¶ (¬∞C)', u_f: 'ËèØÊ∞èÂ∫¶ (¬∞F)', u_k: 'ÈñãÁàæÊñá (K)'
                },
                'ja': {
                    title: 'üîÑ Âçò‰ΩçÊèõÁÆó',
                    lbl_cat: '„Ç´„ÉÜ„Ç¥„É™„Éº',
                    lbl_from: 'Â§âÊèõÂÖÉ',
                    lbl_to: 'Â§âÊèõÂÖà',
                    cat_len: 'Èï∑„Åï',
                    cat_wgt: 'Èáç„Åï',
                    cat_temp: 'Ê∏©Â∫¶',
                    u_m: '„É°„Éº„Éà„É´ (m)', u_km: '„Ç≠„É≠ (km)', u_cm: '„Çª„É≥„ÉÅ (cm)', u_mm: '„Éü„É™ (mm)',
                    u_mi: '„Éû„Ç§„É´', u_yd: '„É§„Éº„Éâ', u_ft: '„Éï„Ç£„Éº„Éà', u_in: '„Ç§„É≥„ÉÅ',
                    u_kg: '„Ç≠„É≠„Ç∞„É©„É† (kg)', u_g: '„Ç∞„É©„É† (g)', u_lb: '„Éù„É≥„Éâ (lb)', u_oz: '„Ç™„É≥„Çπ (oz)',
                    u_c: 'ÊëÇÊ∞è (¬∞C)', u_f: 'ËèØÊ∞è (¬∞F)', u_k: '„Ç±„É´„Éì„É≥ (K)'
                },
                'ru': {
                    title: 'üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü',
                    lbl_cat: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è',
                    lbl_from: '–ò–∑',
                    lbl_to: '–í',
                    cat_len: '–î–ª–∏–Ω–∞',
                    cat_wgt: '–í–µ—Å',
                    cat_temp: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
                    u_m: '–ú–µ—Ç—Ä (–º)', u_km: '–ö–∏–ª–æ–º–µ—Ç—Ä (–∫–º)', u_cm: '–°–∞–Ω—Ç–∏–º–µ—Ç—Ä (—Å–º)', u_mm: '–ú–∏–ª–ª–∏–º–µ—Ç—Ä (–º–º)',
                    u_mi: '–ú–∏–ª—è', u_yd: '–Ø—Ä–¥', u_ft: '–§—É—Ç', u_in: '–î—é–π–º',
                    u_kg: '–ö–∏–ª–æ–≥—Ä–∞–º–º (–∫–≥)', u_g: '–ì—Ä–∞–º–º (–≥)', u_lb: '–§—É–Ω—Ç (lb)', u_oz: '–£–Ω—Ü–∏—è (oz)',
                    u_c: '–¶–µ–ª—å—Å–∏–π (¬∞C)', u_f: '–§–∞—Ä–µ–Ω–≥–µ–π—Ç (¬∞F)', u_k: '–ö–µ–ª—å–≤–∏–Ω (K)'
                },
                'es': {
                    title: 'üîÑ Conversor de Unidades',
                    lbl_cat: 'Categor√≠a',
                    lbl_from: 'De',
                    lbl_to: 'A',
                    cat_len: 'Longitud',
                    cat_wgt: 'Peso',
                    cat_temp: 'Temperatura',
                    u_m: 'Metro (m)', u_km: 'Kil√≥metro (km)', u_cm: 'Cent√≠metro (cm)', u_mm: 'Mil√≠metro (mm)',
                    u_mi: 'Milla', u_yd: 'Yarda', u_ft: 'Pie', u_in: 'Pulgada',
                    u_kg: 'Kilogramo (kg)', u_g: 'Gramo (g)', u_lb: 'Libra (lb)', u_oz: 'Onza (oz)',
                    u_c: 'Celsius (¬∞C)', u_f: 'Fahrenheit (¬∞F)', u_k: 'Kelvin (K)'
                }
            },

            // Definitions: key -> i18n_key, factor (to base)
            defs: {
                len: [
                    { k: 'm', i: 'u_m', f: 1 },
                    { k: 'km', i: 'u_km', f: 1000 },
                    { k: 'cm', i: 'u_cm', f: 0.01 },
                    { k: 'mm', i: 'u_mm', f: 0.001 },
                    { k: 'mi', i: 'u_mi', f: 1609.344 },
                    { k: 'yd', i: 'u_yd', f: 0.9144 },
                    { k: 'ft', i: 'u_ft', f: 0.3048 },
                    { k: 'in', i: 'u_in', f: 0.0254 }
                ],
                wgt: [
                    { k: 'kg', i: 'u_kg', f: 1 },
                    { k: 'g', i: 'u_g', f: 0.001 },
                    { k: 'lb', i: 'u_lb', f: 0.45359237 },
                    { k: 'oz', i: 'u_oz', f: 0.02834952 }
                ],
                temp: [
                    { k: 'c', i: 'u_c' },
                    { k: 'f', i: 'u_f' },
                    { k: 'k', i: 'u_k' }
                ]
            },

            init: () => {
                UnitConv.updateUnits();
            },

            changeLang: () => {
                const lang = document.getElementById('uc-lang').value;
                const texts = UnitConv.i18n[lang];
                const elements = document.querySelectorAll('[data-id="unit_conv"] [data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });
                // Update options in selects
                const catSel = document.querySelectorAll('#uc-cat option');
                catSel.forEach(op => {
                    const key = op.getAttribute('data-i18n');
                    if(texts[key]) op.text = texts[key];
                });
                UnitConv.updateUnits(false); // don't reset values
            },

            updateUnits: (reset = true) => {
                const cat = document.getElementById('uc-cat').value;
                const lang = document.getElementById('uc-lang').value;
                const texts = UnitConv.i18n[lang];
                const units = UnitConv.defs[cat];

                const createOpts = (selId) => {
                    const sel = document.getElementById(selId);
                    const currentVal = sel.value;
                    sel.innerHTML = '';
                    units.forEach(u => {
                        const opt = document.createElement('option');
                        opt.value = u.k;
                        opt.text = texts[u.i];
                        sel.appendChild(opt);
                    });
                    // Try to restore selection or default
                    if (!reset && [...sel.options].some(o => o.value === currentVal)) {
                        sel.value = currentVal;
                    }
                };

                createOpts('uc-unit-from');
                createOpts('uc-unit-to');
                
                if (reset) {
                    // Set defaults for better UX
                    if (cat === 'len') { document.getElementById('uc-unit-from').value = 'm'; document.getElementById('uc-unit-to').value = 'ft'; }
                    else if (cat === 'wgt') { document.getElementById('uc-unit-from').value = 'kg'; document.getElementById('uc-unit-to').value = 'lb'; }
                    else { document.getElementById('uc-unit-from').value = 'c'; document.getElementById('uc-unit-to').value = 'f'; }
                    
                    UnitConv.convert('from');
                } else {
                    UnitConv.convert('from'); // refresh labels
                }
            },

            convert: (direction) => {
                const cat = document.getElementById('uc-cat').value;
                const fromUnit = document.getElementById('uc-unit-from').value;
                const toUnit = document.getElementById('uc-unit-to').value;
                
                let valFrom, valTo;
                
                if (direction === 'from') {
                    valFrom = parseFloat(document.getElementById('uc-val-from').value);
                    if (isNaN(valFrom)) { document.getElementById('uc-val-to').value = ''; return; }
                } else {
                    valTo = parseFloat(document.getElementById('uc-val-to').value);
                    if (isNaN(valTo)) { document.getElementById('uc-val-from').value = ''; return; }
                }

                let res = 0;

                if (cat === 'temp') {
                    // Special logic for Temp
                    let cVal;
                    // convert input to C first
                    const inputVal = direction === 'from' ? valFrom : valTo;
                    const inputUnit = direction === 'from' ? fromUnit : toUnit;
                    const targetUnit = direction === 'from' ? toUnit : fromUnit;

                    if (inputUnit === 'c') cVal = inputVal;
                    else if (inputUnit === 'f') cVal = (inputVal - 32) * 5/9;
                    else if (inputUnit === 'k') cVal = inputVal - 273.15;

                    // convert C to target
                    if (targetUnit === 'c') res = cVal;
                    else if (targetUnit === 'f') res = (cVal * 9/5) + 32;
                    else if (targetUnit === 'k') res = cVal + 273.15;

                } else {
                    // Standard Factor conversion
                    const uList = UnitConv.defs[cat];
                    const u1 = uList.find(u => u.k === fromUnit);
                    const u2 = uList.find(u => u.k === toUnit);

                    if (direction === 'from') {
                        // val * u1.f / u2.f
                        res = valFrom * u1.f / u2.f;
                    } else {
                        // val * u2.f / u1.f
                        res = valTo * u2.f / u1.f;
                    }
                }

                // formatting
                const format = (n) => {
                    if (Math.abs(n) < 0.000001 && n !== 0) return n.toExponential(4);
                    return parseFloat(n.toPrecision(7)); // clean up floating point errors
                };

                if (direction === 'from') {
                    document.getElementById('uc-val-to').value = format(res);
                } else {
                    document.getElementById('uc-val-from').value = format(res);
                }
            }
        };

        UnitConv.init();
    </script>
</body>
</html>