<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Calculator</title>
    
    <!-- åŸºç¡€ä¿¡æ¯ -->
    <meta name="tool-id" content="scientific_calc">
    <meta name="category" content="calculators">
    <meta name="icon" content="ğŸ”¢">
    
    <!-- é»˜è®¤è‹±æ–‡å†…å®¹ -->
    <meta name="title" content="Scientific Calculator">
    <meta name="description" content="Advanced scientific calculator with trigonometric, logarithmic, and exponential functions.">
    
    <!-- å¤šè¯­è¨€é…ç½® -->
    <meta name="lang-title-zh-CN" content="ç§‘å­¦è®¡ç®—å™¨">
    <meta name="lang-description-zh-CN" content="é«˜çº§ç§‘å­¦è®¡ç®—å™¨ï¼Œå…·å¤‡ä¸‰è§’å‡½æ•°ã€å¯¹æ•°å’ŒæŒ‡æ•°å‡½æ•°ç­‰åŠŸèƒ½ã€‚">
    
    <meta name="lang-title-zh-TW" content="ç§‘å­¸è¨ˆç®—å™¨">
    <meta name="lang-description-zh-TW" content="é«˜ç´šç§‘å­¸è¨ˆç®—å™¨ï¼Œå…·å‚™ä¸‰è§’å‡½æ•¸ã€å°æ•¸å’ŒæŒ‡æ•¸å‡½æ•¸ç­‰åŠŸèƒ½ã€‚">
    
    <meta name="lang-title-ja" content="ç§‘å­¦é›»å“">
    <meta name="lang-description-ja" content="ä¸‰è§’é–¢æ•°ã€å¯¾æ•°é–¢æ•°ã€æŒ‡æ•°é–¢æ•°ãªã©ã‚’å‚™ãˆãŸé«˜ç´šç§‘å­¦é›»å“ã€‚">
    
    <meta name="lang-title-ru" content="ĞĞ°ÑƒÑ‡Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€">
    <meta name="lang-description-ru" content="Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ½Ğ°ÑƒÑ‡Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ñ Ñ‚Ñ€Ğ¸Ğ³Ğ¾Ğ½Ğ¾Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼Ğ¸, Ğ»Ğ¾Ğ³Ğ°Ñ€Ğ¸Ñ„Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼Ğ¸ Ğ¸ ÑĞºÑĞ¿Ğ¾Ğ½ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑĞ¼Ğ¸.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            padding: 20px; 
            background: #f0f9ff; 
            font-family: sans-serif; 
        }
        .tool-module { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            max-width: 500px; 
            margin: 0 auto; 
            position: relative; 
        }
        .calculator-display {
            background: #f8fafc;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: right;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .calculator-display input {
            width: 100%;
            background: transparent;
            border: none;
            text-align: right;
            font-size: 24px;
            font-weight: bold;
            padding: 0;
            margin: 0;
            outline: none;
        }
        .calculator-display .history {
            font-size: 14px;
            color: #666;
            min-height: 18px;
        }
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        .calc-btn {
            padding: 12px 5px;
            border-radius: 6px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .calc-btn:hover {
            filter: brightness(0.9);
        }
        .number-btn {
            background: #f1f5f9;
            color: #1e293b;
        }
        .operator-btn {
            background: #dbeafe;
            color: #1e40af;
        }
        .function-btn {
            background: #eff6ff;
            color: #0c4a6e;
        }
        .equals-btn {
            background: #3b82f6;
            color: white;
        }
        .clear-btn {
            background: #fee2e2;
            color: #dc2626;
        }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="scientific_calc" 
         data-category="calculators" 
         data-title="Scientific Calculator" 
         data-icon="ğŸ”¢">
        
        <!-- è¯­è¨€é€‰æ‹©å™¨ -->
        <div class="absolute top-4 right-4">
            <select id="sci-calc-lang" onchange="ScientificCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en" selected>English</option>
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">ğŸ”¢ Scientific Calculator</h2>
        
        <!-- è®¡ç®—å™¨ä¸»ä½“ -->
        <div class="calculator">
            <div class="calculator-display">
                <div class="history" id="calc-history"></div>
                <input type="text" id="calc-display" value="0" readonly>
            </div>
            
            <div class="calculator-buttons">
                <!-- ç¬¬ä¸€è¡Œ -->
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('(')" data-i18n="btn_open_paren">(</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press(')')" data-i18n="btn_close_paren">)</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('Â±')" data-i18n="btn_negate">Â±</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('%')" data-i18n="btn_percent">%</button>
                <button class="calc-btn clear-btn" onclick="ScientificCalc.clearAll()" data-i18n="btn_clear">C</button>
                
                <!-- ç¬¬äºŒè¡Œ -->
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('sin')" data-i18n="btn_sin">sin</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('cos')" data-i18n="btn_cos">cos</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('tan')" data-i18n="btn_tan">tan</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('^')" data-i18n="btn_power">x^y</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('âˆš')" data-i18n="btn_sqrt">âˆš</button>
                
                <!-- ç¬¬ä¸‰è¡Œ -->
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('log')" data-i18n="btn_log">log</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('ln')" data-i18n="btn_ln">ln</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('!')" data-i18n="btn_factorial">x!</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('Ï€')" data-i18n="btn_pi">Ï€</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('e')" data-i18n="btn_e">e</button>
                
                <!-- ç¬¬å››è¡Œ -->
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('7')">7</button>
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('8')">8</button>
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('9')">9</button>
                <button class="calc-btn operator-btn" onclick="ScientificCalc.press('Ã—')" data-i18n="btn_multiply">Ã—</button>
                <button class="calc-btn operator-btn" onclick="ScientificCalc.press('Ã·')" data-i18n="btn_divide">Ã·</button>
                
                <!-- ç¬¬äº”è¡Œ -->
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('4')">4</button>
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('5')">5</button>
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('6')">6</button>
                <button class="calc-btn operator-btn" onclick="ScientificCalc.press('+')" data-i18n="btn_add">+</button>
                <button class="calc-btn operator-btn" onclick="ScientificCalc.press('-')" data-i18n="btn_subtract">-</button>
                
                <!-- ç¬¬å…­è¡Œ -->
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('1')">1</button>
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('2')">2</button>
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('3')">3</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.backspace()" data-i18n="btn_backspace">âŒ«</button>
                <button class="calc-btn equals-btn" onclick="ScientificCalc.calculate()" data-i18n="btn_equals">=</button>
                
                <!-- ç¬¬ä¸ƒè¡Œ -->
                <button class="calc-btn function-btn" onclick="ScientificCalc.toggleDegRad()" data-i18n="btn_deg">DEG</button>
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('0')">0</button>
                <button class="calc-btn number-btn" onclick="ScientificCalc.press('.')" data-i18n="btn_decimal">.</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('1/x')" data-i18n="btn_reciprocal">1/x</button>
                <button class="calc-btn function-btn" onclick="ScientificCalc.press('xÂ²')" data-i18n="btn_square">xÂ²</button>
            </div>
        </div>
        
        <!-- é”™è¯¯æç¤º -->
        <div id="calc-error" class="text-sm text-red-600 mt-4 hidden"></div>
        
        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600">
            <p class="font-medium mb-2" data-i18n="instructions">Instructions:</p>
            <ul class="list-disc list-inside space-y-1" data-i18n="instructions_list">
                <li>Use the buttons or keyboard for input</li>
                <li>Trigonometric functions: DEG (degrees) or RAD (radians)</li>
                <li>Factorial (!) is only valid for non-negative integers</li>
                <li>Supports parentheses for complex expressions</li>
            </ul>
        </div>
    </div>

    <script>
        const ScientificCalc = {
            currentValue: '0',
            history: '',
            isRadian: false,
            lastKey: '',
            operators: ['+', '-', 'Ã—', 'Ã·', '^'],
            
            i18n: {
                'en': {
                    title: 'ğŸ”¢ Scientific Calculator',
                    btn_open_paren: '(',
                    btn_close_paren: ')',
                    btn_negate: 'Â±',
                    btn_percent: '%',
                    btn_clear: 'C',
                    btn_sin: 'sin',
                    btn_cos: 'cos',
                    btn_tan: 'tan',
                    btn_power: 'x^y',
                    btn_sqrt: 'âˆš',
                    btn_log: 'log',
                    btn_ln: 'ln',
                    btn_factorial: 'x!',
                    btn_pi: 'Ï€',
                    btn_e: 'e',
                    btn_multiply: 'Ã—',
                    btn_divide: 'Ã·',
                    btn_add: '+',
                    btn_subtract: '-',
                    btn_backspace: 'âŒ«',
                    btn_equals: '=',
                    btn_deg: 'DEG',
                    btn_decimal: '.',
                    btn_reciprocal: '1/x',
                    btn_square: 'xÂ²',
                    instructions: 'Instructions:',
                    instructions_list: `
                        <li>Use the buttons or keyboard for input</li>
                        <li>Trigonometric functions: DEG (degrees) or RAD (radians)</li>
                        <li>Factorial (!) is only valid for non-negative integers</li>
                        <li>Supports parentheses for complex expressions</li>
                    `,
                    error_invalid: 'Invalid expression',
                    error_factorial: 'Factorial only for non-negative integers',
                    error_divide_zero: 'Cannot divide by zero'
                },
                'zh-CN': {
                    title: 'ğŸ”¢ ç§‘å­¦è®¡ç®—å™¨',
                    btn_open_paren: '(',
                    btn_close_paren: ')',
                    btn_negate: 'Â±',
                    btn_percent: '%',
                    btn_clear: 'æ¸…é™¤',
                    btn_sin: 'æ­£å¼¦',
                    btn_cos: 'ä½™å¼¦',
                    btn_tan: 'æ­£åˆ‡',
                    btn_power: 'å¹‚è¿ç®—',
                    btn_sqrt: 'å¼€æ–¹',
                    btn_log: 'å¯¹æ•°',
                    btn_ln: 'è‡ªç„¶å¯¹æ•°',
                    btn_factorial: 'é˜¶ä¹˜',
                    btn_pi: 'Ï€',
                    btn_e: 'e',
                    btn_multiply: 'Ã—',
                    btn_divide: 'Ã·',
                    btn_add: '+',
                    btn_subtract: '-',
                    btn_backspace: 'é€€æ ¼',
                    btn_equals: '=',
                    btn_deg: 'è§’åº¦',
                    btn_decimal: '.',
                    btn_reciprocal: 'å€’æ•°',
                    btn_square: 'å¹³æ–¹',
                    instructions: 'ä½¿ç”¨è¯´æ˜ï¼š',
                    instructions_list: `
                        <li>ä½¿ç”¨æŒ‰é’®æˆ–é”®ç›˜è¾“å…¥</li>
                        <li>ä¸‰è§’å‡½æ•°ï¼šè§’åº¦ï¼ˆDEGï¼‰æˆ–å¼§åº¦ï¼ˆRADï¼‰æ¨¡å¼</li>
                        <li>é˜¶ä¹˜ï¼ˆ!ï¼‰ä»…é€‚ç”¨äºéè´Ÿæ•´æ•°</li>
                        <li>æ”¯æŒæ‹¬å·è¿›è¡Œå¤æ‚è¡¨è¾¾å¼è®¡ç®—</li>
                    `,
                    error_invalid: 'è¡¨è¾¾å¼æ— æ•ˆ',
                    error_factorial: 'é˜¶ä¹˜ä»…é€‚ç”¨äºéè´Ÿæ•´æ•°',
                    error_divide_zero: 'ä¸èƒ½é™¤ä»¥é›¶'
                },
                'zh-TW': {
                    title: 'ğŸ”¢ ç§‘å­¸è¨ˆç®—å™¨',
                    btn_open_paren: '(',
                    btn_close_paren: ')',
                    btn_negate: 'Â±',
                    btn_percent: '%',
                    btn_clear: 'æ¸…é™¤',
                    btn_sin: 'æ­£å¼¦',
                    btn_cos: 'é¤˜å¼¦',
                    btn_tan: 'æ­£åˆ‡',
                    btn_power: 'å†ªé‹ç®—',
                    btn_sqrt: 'é–‹æ–¹',
                    btn_log: 'å°æ•¸',
                    btn_ln: 'è‡ªç„¶å°æ•¸',
                    btn_factorial: 'éšä¹˜',
                    btn_pi: 'Ï€',
                    btn_e: 'e',
                    btn_multiply: 'Ã—',
                    btn_divide: 'Ã·',
                    btn_add: '+',
                    btn_subtract: '-',
                    btn_backspace: 'é€€æ ¼',
                    btn_equals: '=',
                    btn_deg: 'è§’åº¦',
                    btn_decimal: '.',
                    btn_reciprocal: 'å€’æ•¸',
                    btn_square: 'å¹³æ–¹',
                    instructions: 'ä½¿ç”¨èªªæ˜ï¼š',
                    instructions_list: `
                        <li>ä½¿ç”¨æŒ‰éˆ•æˆ–éµç›¤è¼¸å…¥</li>
                        <li>ä¸‰è§’å‡½æ•¸ï¼šè§’åº¦ï¼ˆDEGï¼‰æˆ–å¼§åº¦ï¼ˆRADï¼‰æ¨¡å¼</li>
                        <li>éšä¹˜ï¼ˆ!ï¼‰åƒ…é©ç”¨æ–¼éè² æ•´æ•¸</li>
                        <li>æ”¯æŒæ‹¬è™Ÿé€²è¡Œè¤‡é›œè¡¨é”å¼è¨ˆç®—</li>
                    `,
                    error_invalid: 'è¡¨é”å¼ç„¡æ•ˆ',
                    error_factorial: 'éšä¹˜åƒ…é©ç”¨æ–¼éè² æ•´æ•¸',
                    error_divide_zero: 'ä¸èƒ½é™¤ä»¥é›¶'
                },
                'ja': {
                    title: 'ğŸ”¢ ç§‘å­¦é›»å“',
                    btn_open_paren: '(',
                    btn_close_paren: ')',
                    btn_negate: 'Â±',
                    btn_percent: '%',
                    btn_clear: 'ã‚¯ãƒªã‚¢',
                    btn_sin: 'sin',
                    btn_cos: 'cos',
                    btn_tan: 'tan',
                    btn_power: 'ç´¯ä¹—',
                    btn_sqrt: 'å¹³æ–¹æ ¹',
                    btn_log: 'å¯¾æ•°',
                    btn_ln: 'è‡ªç„¶å¯¾æ•°',
                    btn_factorial: 'éšä¹—',
                    btn_pi: 'Ï€',
                    btn_e: 'e',
                    btn_multiply: 'Ã—',
                    btn_divide: 'Ã·',
                    btn_add: '+',
                    btn_subtract: '-',
                    btn_backspace: 'æˆ»ã‚‹',
                    btn_equals: '=',
                    btn_deg: 'åº¦æ•°',
                    btn_decimal: '.',
                    btn_reciprocal: 'é€†æ•°',
                    btn_square: '2ä¹—',
                    instructions: 'ä½¿ç”¨æ–¹æ³•ï¼š',
                    instructions_list: `
                        <li>ãƒœã‚¿ãƒ³ã¾ãŸã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦å…¥åŠ›ã—ã¾ã™</li>
                        <li>ä¸‰è§’é–¢æ•°ï¼šåº¦æ•°ï¼ˆDEGï¼‰ã¾ãŸã¯ãƒ©ã‚¸ã‚¢ãƒ³ï¼ˆRADï¼‰ãƒ¢ãƒ¼ãƒ‰</li>
                        <li>éšä¹—ï¼ˆ!ï¼‰ã¯éè² ã®æ•´æ•°ã«ã®ã¿æœ‰åŠ¹ã§ã™</li>
                        <li>è¤‡é›‘ãªå¼ã®è¨ˆç®—ã«ã¯æ‹¬å¼§ãŒä½¿ç”¨ã§ãã¾ã™</li>
                    `,
                    error_invalid: 'å¼ãŒç„¡åŠ¹ã§ã™',
                    error_factorial: 'éšä¹—ã¯éè² ã®æ•´æ•°ã«ã®ã¿é©ç”¨ã•ã‚Œã¾ã™',
                    error_divide_zero: 'ã‚¼ãƒ­ã§é™¤ç®—ã§ãã¾ã›ã‚“'
                },
                'ru': {
                    title: 'ğŸ”¢ ĞĞ°ÑƒÑ‡Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€',
                    btn_open_paren: '(',
                    btn_close_paren: ')',
                    btn_negate: 'Â±',
                    btn_percent: '%',
                    btn_clear: 'Ğ¡',
                    btn_sin: 'ÑĞ¸Ğ½',
                    btn_cos: 'ĞºĞ¾Ñ',
                    btn_tan: 'Ñ‚Ğ°Ğ½',
                    btn_power: 'x^y',
                    btn_sqrt: 'âˆš',
                    btn_log: 'Ğ»Ğ¾Ğ³',
                    btn_ln: 'Ğ»Ğ½',
                    btn_factorial: 'x!',
                    btn_pi: 'Ï€',
                    btn_e: 'e',
                    btn_multiply: 'Ã—',
                    btn_divide: 'Ã·',
                    btn_add: '+',
                    btn_subtract: '-',
                    btn_backspace: 'âŒ«',
                    btn_equals: '=',
                    btn_deg: 'Ğ“Ğ ',
                    btn_decimal: '.',
                    btn_reciprocal: '1/x',
                    btn_square: 'xÂ²',
                    instructions: 'Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸:',
                    instructions_list: `
                        <li>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¸Ğ»Ğ¸ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ğ´Ğ»Ñ Ğ²Ğ²Ğ¾Ğ´Ğ°</li>
                        <li>Ğ¢Ñ€Ğ¸Ğ³Ğ¾Ğ½Ğ¾Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸: Ğ“Ğ ĞĞ” (Ğ³Ñ€Ğ°Ğ´ÑƒÑÑ‹) Ğ¸Ğ»Ğ¸ Ğ ĞĞ” (Ñ€Ğ°Ğ´Ğ¸Ğ°Ğ½Ñ‹)</li>
                        <li>Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ°Ğ» (!) Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ĞµĞ½ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ½ĞµĞ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ñ†ĞµĞ»Ñ‹Ñ… Ñ‡Ğ¸ÑĞµĞ»</li>
                        <li>ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ´Ğ»Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹</li>
                    `,
                    error_invalid: 'ĞĞµĞ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ğ¾Ğµ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
                    error_factorial: 'Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ°Ğ» Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ½ĞµĞ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ñ†ĞµĞ»Ñ‹Ñ… Ñ‡Ğ¸ÑĞµĞ»',
                    error_divide_zero: 'Ğ”ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ½Ğ¾Ğ»ÑŒ Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾'
                }
            },
            
            // åˆå§‹åŒ–è®¡ç®—å™¨
            init: function() {
                this.updateDisplay();
                this.setupKeyboardSupport();
            },
            
            // æŒ‰é”®å¤„ç†
            press: function(key) {
                this.clearError();
                
                // å¤„ç†æ•°å­—è¾“å…¥
                if (!isNaN(key) || key === '.') {
                    this.handleNumberInput(key);
                } 
                // å¤„ç†è¿ç®—ç¬¦
                else if (this.operators.includes(key)) {
                    this.handleOperatorInput(key);
                } 
                // å¤„ç†ç‰¹æ®Šå‡½æ•°
                else {
                    this.handleFunctionInput(key);
                }
                
                this.lastKey = key;
                this.updateDisplay();
            },
            
            // å¤„ç†æ•°å­—è¾“å…¥
            handleNumberInput: function(key) {
                if (this.currentValue === '0' && key !== '.') {
                    this.currentValue = key;
                } else if (key === '.' && this.currentValue.includes('.')) {
                    return; // é¿å…å¤šä¸ªå°æ•°ç‚¹
                } else {
                    this.currentValue += key;
                }
            },
            
            // å¤„ç†è¿ç®—ç¬¦è¾“å…¥
            handleOperatorInput: function(operator) {
                const lastChar = this.currentValue.slice(-1);
                
                // å¦‚æœæœ€åä¸€ä¸ªå­—ç¬¦æ˜¯è¿ç®—ç¬¦ï¼Œåˆ™æ›¿æ¢å®ƒ
                if (this.operators.includes(lastChar)) {
                    this.currentValue = this.currentValue.slice(0, -1) + operator;
                } else {
                    this.currentValue += operator;
                }
            },
            
            // å¤„ç†å‡½æ•°è¾“å…¥
            handleFunctionInput: function(func) {
                switch(func) {
                    case '(':
                    case ')':
                        this.currentValue += func;
                        break;
                    case 'Â±':
                        this.negateValue();
                        break;
                    case '%':
                        this.calculatePercentage();
                        break;
                    case 'Ï€':
                        this.currentValue += Math.PI;
                        break;
                    case 'e':
                        this.currentValue += Math.E;
                        break;
                    case 'âˆš':
                        this.currentValue += 'âˆš(';
                        break;
                    case 'xÂ²':
                        this.currentValue += '^2';
                        break;
                    case '1/x':
                        this.currentValue += '^(-1)';
                        break;
                    case 'sin':
                    case 'cos':
                    case 'tan':
                    case 'log':
                    case 'ln':
                        this.currentValue += func + '(';
                        break;
                    case '!':
                        this.currentValue += '!';
                        break;
                }
            },
            
            // è®¡ç®—ç»“æœ
            calculate: function() {
                try {
                    this.clearError();
                    let expression = this.currentValue;
                    
                    // æ›¿æ¢è¡¨è¾¾å¼ä¸­çš„ç¬¦å·ä¸ºJavaScriptå…¼å®¹çš„ç¬¦å·
                    expression = expression.replace(/Ã—/g, '*')
                                          .replace(/Ã·/g, '/')
                                          .replace(/âˆš/g, 'Math.sqrt')
                                          .replace(/sin/g, 'this.sin')
                                          .replace(/cos/g, 'this.cos')
                                          .replace(/tan/g, 'this.tan')
                                          .replace(/log/g, 'Math.log10')
                                          .replace(/ln/g, 'Math.log');
                    
                    // å¤„ç†é˜¶ä¹˜
                    while (expression.includes('!')) {
                        expression = this.processFactorial(expression);
                    }
                    
                    // ä¿å­˜å†å²è®°å½•
                    this.history = this.currentValue + ' =';
                    
                    // è®¡ç®—ç»“æœ
                    const result = eval(expression);
                    
                    // å¤„ç†å¤§æ•°å’Œå°æ•°çš„æ˜¾ç¤º
                    if (Math.abs(result) > 1e10 || Math.abs(result) < 1e-10 && result !== 0) {
                        this.currentValue = result.toExponential(8);
                    } else {
                        this.currentValue = result.toString();
                    }
                } catch (error) {
                    if (error.message.includes('division by zero')) {
                        this.showError('error_divide_zero');
                    } else if (error.message.includes('factorial')) {
                        this.showError('error_factorial');
                    } else {
                        this.showError('error_invalid');
                    }
                    this.currentValue = '0';
                }
                
                this.updateDisplay();
            },
            
            // å¤„ç†é˜¶ä¹˜
            processFactorial: function(expr) {
                const factIndex = expr.indexOf('!');
                let numStr = '';
                let i = factIndex - 1;
                
                // æå–é˜¶ä¹˜å‰çš„æ•°å­—
                while (i >= 0 && (/\d|\./.test(expr[i]) || expr[i] === '-')) {
                    numStr = expr[i] + numStr;
                    i--;
                }
                
                if (numStr === '' || isNaN(numStr) || parseFloat(numStr) < 0 || !Number.isInteger(parseFloat(numStr))) {
                    throw new Error('factorial');
                }
                
                const num = parseInt(numStr);
                const factResult = this.factorial(num);
                
                // æ›¿æ¢é˜¶ä¹˜è¡¨è¾¾å¼ä¸ºè®¡ç®—ç»“æœ
                return expr.substring(0, i + 1) + factResult + expr.substring(factIndex + 1);
            },
            
            // é˜¶ä¹˜è®¡ç®—
            factorial: function(n) {
                if (n === 0 || n === 1) return 1;
                let result = 1;
                for (let i = 2; i <= n; i++) {
                    result *= i;
                }
                return result;
            },
            
            // ä¸‰è§’å‡½æ•°ï¼ˆæ”¯æŒè§’åº¦å’Œå¼§åº¦ï¼‰
            sin: function(x) {
                return this.isRadian ? Math.sin(x) : Math.sin(x * Math.PI / 180);
            },
            
            cos: function(x) {
                return this.isRadian ? Math.cos(x) : Math.cos(x * Math.PI / 180);
            },
            
            tan: function(x) {
                return this.isRadian ? Math.tan(x) : Math.tan(x * Math.PI / 180);
            },
            
            // åˆ‡æ¢è§’åº¦/å¼§åº¦æ¨¡å¼
            toggleDegRad: function() {
                this.isRadian = !this.isRadian;
                const degBtn = document.querySelector('[data-i18n="btn_deg"]');
                degBtn.textContent = this.isRadian ? 
                    (this.getCurrentLang() === 'en' ? 'RAD' : 
                     this.getCurrentLang() === 'zh-CN' ? 'å¼§åº¦' : 
                     this.getCurrentLang() === 'zh-TW' ? 'å¼§åº¦' : 
                     this.getCurrentLang() === 'ja' ? 'ãƒ©ã‚¸ã‚¢ãƒ³' : 'Ğ ĞĞ”') : 
                    this.i18n[this.getCurrentLang()]['btn_deg'];
            },
            
            // å–å
            negateValue: function() {
                if (this.currentValue === '0') return;
                
                if (this.currentValue.startsWith('-')) {
                    this.currentValue = this.currentValue.substring(1);
                } else {
                    this.currentValue = '-' + this.currentValue;
                }
            },
            
            // è®¡ç®—ç™¾åˆ†æ¯”
            calculatePercentage: function() {
                try {
                    const value = parseFloat(this.currentValue);
                    this.currentValue = (value / 100).toString();
                } catch (e) {
                    this.showError('error_invalid');
                }
            },
            
            // æ¸…é™¤æ‰€æœ‰å†…å®¹
            clearAll: function() {
                this.currentValue = '0';
                this.history = '';
                this.clearError();
                this.updateDisplay();
            },
            
            // é€€æ ¼
            backspace: function() {
                if (this.currentValue.length > 1) {
                    this.currentValue = this.currentValue.substring(0, this.currentValue.length - 1);
                } else {
                    this.currentValue = '0';
                }
                this.updateDisplay();
            },
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay: function() {
                document.getElementById('calc-display').value = this.currentValue;
                document.getElementById('calc-history').textContent = this.history;
            },
            
            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            showError: function(key) {
                const errorEl = document.getElementById('calc-error');
                errorEl.textContent = this.i18n[this.getCurrentLang()][key];
                errorEl.classList.remove('hidden');
            },
            
            // æ¸…é™¤é”™è¯¯ä¿¡æ¯
            clearError: function() {
                const errorEl = document.getElementById('calc-error');
                errorEl.classList.add('hidden');
                errorEl.textContent = '';
            },
            
            // è·å–å½“å‰è¯­è¨€
            getCurrentLang: function() {
                return document.getElementById('sci-calc-lang').value;
            },
            
            // åˆ‡æ¢è¯­è¨€
            changeLang: function() {
                const lang = this.getCurrentLang();
                const elements = document.querySelectorAll('[data-i18n]');
                
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (this.i18n[lang][key]) {
                        if (key === 'instructions_list') {
                            el.innerHTML = this.i18n[lang][key];
                        } else {
                            el.textContent = this.i18n[lang][key];
                        }
                    }
                });
                
                // æ›´æ–°è§’åº¦/å¼§åº¦æŒ‰é’®æ–‡æœ¬
                const degBtn = document.querySelector('[data-i18n="btn_deg"]');
                degBtn.textContent = this.isRadian ? 
                    (lang === 'en' ? 'RAD' : 
                     lang === 'zh-CN' ? 'å¼§åº¦' : 
                     lang === 'zh-TW' ? 'å¼§åº¦' : 
                     lang === 'ja' ? 'ãƒ©ã‚¸ã‚¢ãƒ³' : 'Ğ ĞĞ”') : 
                    this.i18n[lang]['btn_deg'];
            },
            
            // è®¾ç½®é”®ç›˜æ”¯æŒ
            setupKeyboardSupport: function() {
                document.addEventListener('keydown', (e) => {
                    const key = e.key;
                    
                    // æ•°å­—é”®
                    if (!isNaN(key) || key === '.') {
                        e.preventDefault();
                        this.press(key);
                    }
                    // è¿ç®—ç¬¦
                    else if (['+', '-', '*', '/', '^'].includes(key)) {
                        e.preventDefault();
                        this.press(key === '*' ? 'Ã—' : key === '/' ? 'Ã·' : key);
                    }
                    // å›è½¦é”®
                    else if (key === 'Enter') {
                        e.preventDefault();
                        this.calculate();
                    }
                    // åˆ é™¤é”®
                    else if (key === 'Backspace') {
                        e.preventDefault();
                        this.backspace();
                    }
                    // æ¸…é™¤é”®
                    else if (key === 'Escape') {
                        e.preventDefault();
                        this.clearAll();
                    }
                    // æ‹¬å·
                    else if (key === '(' || key === ')') {
                        e.preventDefault();
                        this.press(key);
                    }
                });
            }
        };
        
        // åˆå§‹åŒ–è®¡ç®—å™¨
        document.addEventListener('DOMContentLoaded', () => {
            ScientificCalc.init();
        });
    </script>
</body>
</html>