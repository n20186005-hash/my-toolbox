<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="category" content="E-commerce Operations">
    <meta name="icon" content="üõçÔ∏è">
    <title>Operation Position Salary Designer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0fdf4; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 900px; margin: 0 auto; position: relative; }
        .section { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group { margin-bottom: 10px; }
        label { display: block; font-size: 0.9rem; color: #4b5563; margin-bottom: 4px; }
        input, select { width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; }
        .result-card { background: #ecfdf5; border: 1px solid #d1fae5; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .result-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px dashed #a7f3d0; }
        .result-row:last-child { border-bottom: none; }
        .result-label { color: #1e3a8a; }
        .result-value { font-weight: 600; color: #065f46; }
        .intro-section { margin-top: 30px; padding: 20px; background-color: #f8fafc; border-radius: 8px; font-size: 0.95rem; color: #475569; }
        .badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }
        .badge-s { background: #dcfce7; color: #166534; }
        .badge-a { background: #dbeafe; color: #1e40af; }
        .badge-b { background: #fef9c3; color: #854d0e; }
        .badge-c { background: #fee2e2; color: #991b1b; }
        
        /* New styles for dynamic rules */
        .rules-panel { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #e5e7eb; }
        .rules-grid { display: grid; grid-template-columns: 40px 1fr 1fr; gap: 8px; align-items: center; margin-bottom: 4px; }
        .rules-header { font-size: 0.75rem; color: #6b7280; font-weight: bold; text-align: center; margin-bottom: 4px; }
        .rule-input { padding: 4px 8px; font-size: 0.85rem; height: 30px; }
        .rule-label { font-weight: bold; text-align: center; font-size: 0.85rem; }
        .rule-toggle-btn { font-size: 0.8rem; color: #2563eb; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>

    <div class="tool-module" id="salary-design-tool">
        <div class="absolute top-4 right-4">
            <select id="lang-selector" onchange="SalaryDesign.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en" selected>English</option>
                <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-6 text-gray-800 border-b pb-2" data-i18n="title">üí∞ Operation Position Salary Design</h2>

        <div class="space-y-6">
            
            <div class="section">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-i18n="basic_settings">Basic Settings</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label data-i18n="position_level">Position Level Name</label>
                        <input type="text" id="position_level" value="Senior Operation Specialist" placeholder="e.g. Manager" class="focus:ring-2 focus:ring-green-500 outline-none font-semibold text-gray-700">
                    </div>
                    <div class="form-group">
                        <label data-i18n="base_salary">Base Salary (¬•)</label>
                        <input type="number" id="base_salary" value="5000" oninput="SalaryDesign.calculate()" class="focus:ring-2 focus:ring-green-500 outline-none">
                    </div>
                    <div class="form-group">
                        <label data-i18n="position_allowance">Position Allowance (¬•)</label>
                        <input type="number" id="position_allowance" value="1000" oninput="SalaryDesign.calculate()" class="focus:ring-2 focus:ring-green-500 outline-none">
                    </div>
                    <div class="form-group">
                        <label data-i18n="overtime_pay">Overtime Pay (¬•)</label>
                        <input type="number" id="overtime_pay" value="2500" oninput="SalaryDesign.calculate()" class="focus:ring-2 focus:ring-green-500 outline-none">
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-700" data-i18n="performance_metrics">Performance Metrics</h3>
                    <span class="text-xs text-gray-400">Edit rules below to customize logic</span>
                </div>
                
                <div class="bg-gray-50 p-4 rounded mb-4 border border-gray-200">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium text-gray-800" data-i18n="metric_new_product">1. New Product Success Count</h4>
                        <span class="rule-toggle-btn" onclick="SalaryDesign.toggleRules('rules-new-prod')" data-i18n="edit_rules">Edit Rules</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label data-i18n="actual_count">Actual Count</label>
                            <input type="number" id="perf_new_product_val" value="8" oninput="SalaryDesign.calculate()" class="focus:ring-2 focus:ring-green-500 outline-none bg-white">
                        </div>
                        <div class="form-group">
                            <label data-i18n="achieved_grade">Achieved Grade</label>
                            <div id="grade_new_product" class="font-bold text-lg text-blue-600 mt-1">-</div>
                        </div>
                    </div>

                    <div id="rules-new-prod" class="rules-panel hidden">
                        <div class="rules-grid">
                            <div></div>
                            <div class="rules-header" data-i18n="hdr_min">Min Value (‚â•)</div>
                            <div class="rules-header" data-i18n="hdr_bonus">Bonus (¬•)</div>
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-green-700">S</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="np" data-grade="S" value="10" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="np" data-grade="S" value="1000" oninput="SalaryDesign.calculate()">
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-blue-700">A</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="np" data-grade="A" value="8" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="np" data-grade="A" value="800" oninput="SalaryDesign.calculate()">
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-yellow-700">B</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="np" data-grade="B" value="5" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="np" data-grade="B" value="500" oninput="SalaryDesign.calculate()">
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-red-700">C</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="np" data-grade="C" value="1" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="np" data-grade="C" value="200" oninput="SalaryDesign.calculate()">
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded mb-4 border border-gray-200">
                     <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium text-gray-800" data-i18n="metric_growth">2. Existing Product Growth Rate (%)</h4>
                        <span class="rule-toggle-btn" onclick="SalaryDesign.toggleRules('rules-growth')" data-i18n="edit_rules">Edit Rules</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label data-i18n="actual_rate">Actual Rate (%)</label>
                            <input type="number" id="perf_growth_val" value="40" oninput="SalaryDesign.calculate()" class="focus:ring-2 focus:ring-green-500 outline-none bg-white">
                        </div>
                        <div class="form-group">
                            <label data-i18n="achieved_grade">Achieved Grade</label>
                            <div id="grade_growth" class="font-bold text-lg text-blue-600 mt-1">-</div>
                        </div>
                    </div>

                    <div id="rules-growth" class="rules-panel hidden">
                        <div class="rules-grid">
                            <div></div>
                            <div class="rules-header" data-i18n="hdr_min">Min Value (‚â•)</div>
                            <div class="rules-header" data-i18n="hdr_bonus">Bonus (¬•)</div>
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-green-700">S</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="gr" data-grade="S" value="100" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="gr" data-grade="S" value="1000" oninput="SalaryDesign.calculate()">
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-blue-700">A</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="gr" data-grade="A" value="50" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="gr" data-grade="A" value="800" oninput="SalaryDesign.calculate()">
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-yellow-700">B</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="gr" data-grade="B" value="30" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="gr" data-grade="B" value="500" oninput="SalaryDesign.calculate()">
                        </div>
                         <div class="rules-grid">
                            <div class="rule-label text-red-700">C</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="gr" data-grade="C" value="10" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="gr" data-grade="C" value="200" oninput="SalaryDesign.calculate()">
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded mb-4 border border-gray-200">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium text-gray-800" data-i18n="metric_margin">3. Gross Profit Margin (%)</h4>
                        <span class="rule-toggle-btn" onclick="SalaryDesign.toggleRules('rules-margin')" data-i18n="edit_rules">Edit Rules</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label data-i18n="actual_margin">Actual Margin (%)</label>
                            <input type="number" id="perf_margin_val" value="22" oninput="SalaryDesign.calculate()" class="focus:ring-2 focus:ring-green-500 outline-none bg-white">
                        </div>
                        <div class="form-group">
                            <label data-i18n="achieved_grade">Achieved Grade</label>
                            <div id="grade_margin" class="font-bold text-lg text-blue-600 mt-1">-</div>
                        </div>
                    </div>

                    <div id="rules-margin" class="rules-panel hidden">
                        <div class="rules-grid">
                            <div></div>
                            <div class="rules-header" data-i18n="hdr_min">Min Value (‚â•)</div>
                            <div class="rules-header" data-i18n="hdr_bonus">Bonus (¬•)</div>
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-green-700">S</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="mg" data-grade="S" value="25" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="mg" data-grade="S" value="2000" oninput="SalaryDesign.calculate()">
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-blue-700">A</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="mg" data-grade="A" value="20" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="mg" data-grade="A" value="1000" oninput="SalaryDesign.calculate()">
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-yellow-700">B</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="mg" data-grade="B" value="15" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="mg" data-grade="B" value="500" oninput="SalaryDesign.calculate()">
                        </div>
                        <div class="rules-grid">
                            <div class="rule-label text-red-700">C</div>
                            <input type="number" class="rule-input rule-threshold" data-metric="mg" data-grade="C" value="10" oninput="SalaryDesign.calculate()">
                            <input type="number" class="rule-input rule-bonus" data-metric="mg" data-grade="C" value="200" oninput="SalaryDesign.calculate()">
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="SalaryDesign.calculate()" class="w-full bg-green-600 text-white py-3 rounded font-bold hover:bg-green-700 transition mb-6" data-i18n="btn_calc">Calculate Total Salary</button>

            <div class="summary-section">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-i18n="results">Salary Breakdown</h3>
                <div class="result-card">
                    <div class="result-row">
                        <span class="result-label" data-i18n="res_fixed">Fixed Income (Base+Allowance+Overtime)</span>
                        <span class="result-value" id="res_fixed_val">¬•0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label" data-i18n="res_perf">Total Performance Bonus</span>
                        <span class="result-value" id="res_perf_val">¬•0</span>
                    </div>
                    <div class="result-row border-t border-gray-300 mt-2 pt-2">
                        <span class="result-label font-bold text-lg text-gray-900" data-i18n="res_total">Total Estimated Salary</span>
                        <span class="result-value font-bold text-xl text-green-700" id="res_total_val">¬•0</span>
                    </div>
                </div>
            </div>

            <div class="intro-section">
                <h3 class="text-lg font-semibold mb-2 text-gray-800" data-i18n="intro_title">About This Tool</h3>
                <p data-i18n="intro_text">This tool is designed to structure and calculate salaries for e-commerce operation roles. It combines fixed salary components with customizable dynamic performance modules. You can edit the rules (Thresholds and Bonuses) for S/A/B/C grades to fit your specific company policy.</p>
            </div>
        </div>
    </div>

    <script>
        const SalaryDesign = {
            i18n: {
                'en': {
                    title: 'üí∞ Operation Position Salary Designer',
                    basic_settings: 'Basic Settings',
                    position_level: 'Position Level Name',
                    base_salary: 'Base Salary (¬•)',
                    position_allowance: 'Position Allowance (¬•)',
                    overtime_pay: 'Overtime Pay (¬•)',
                    performance_metrics: 'Performance Metrics',
                    edit_rules: 'Edit Rules',
                    hdr_min: 'Min Value (‚â•)',
                    hdr_bonus: 'Bonus (¬•)',
                    metric_new_product: '1. New Product Success Count',
                    actual_count: 'Actual Count',
                    achieved_grade: 'Achieved Grade & Bonus',
                    metric_growth: '2. Existing Product Growth Rate (%)',
                    actual_rate: 'Actual Rate (%)',
                    metric_margin: '3. Gross Profit Margin (%)',
                    actual_margin: 'Actual Margin (%)',
                    btn_calc: 'Calculate Total Salary',
                    results: 'Salary Breakdown',
                    res_fixed: 'Fixed Income',
                    res_perf: 'Total Performance Bonus',
                    res_total: 'Total Estimated Salary',
                    intro_title: 'About This Tool',
                    intro_text: 'This tool is designed to structure and calculate salaries for e-commerce operation roles. It combines fixed salary components with customizable dynamic performance modules. You can edit the rules (Thresholds and Bonuses) for S/A/B/C grades to fit your specific company policy.'
                },
                'zh-CN': {
                    title: 'üí∞ ËøêËê•Â≤ó‰ΩçÂ∑•ËµÑËÆæËÆ°ËÆ°ÁÆóÂô®',
                    basic_settings: 'Âü∫Á°ÄËÆæÁΩÆ',
                    position_level: 'Â≤ó‰ΩçÁ∫ßÂà´ÂêçÁß∞',
                    base_salary: 'Âü∫Êú¨Â∫ïËñ™ (¬•)',
                    position_allowance: 'Â≤ó‰ΩçË°•Ë¥¥ (¬•)',
                    overtime_pay: 'Âä†Áè≠/ÂÖ®Âã§Â∑•ËµÑ (¬•)',
                    performance_metrics: 'Áª©ÊïàËÄÉÊ†∏ÊåáÊ†á',
                    edit_rules: '‰øÆÊîπËßÑÂàô',
                    hdr_min: 'ËææÊ†áÈó®Êßõ (‚â•)',
                    hdr_bonus: 'Â•ñÈáëÈáëÈ¢ù (¬•)',
                    metric_new_product: '1. Êñ∞ÂìÅÊâìÁàÜÊ¨æÊàêÂäü‰∏™Êï∞',
                    actual_count: 'ÂÆûÈôÖ‰∏™Êï∞',
                    achieved_grade: 'Ëé∑ÂæóÁ≠âÁ∫ß & Â•ñÈáë',
                    metric_growth: '2. ËÄÅÂìÅ‰∏öÁª©Â¢ûÈïøÁéá (%)',
                    actual_rate: 'ÂÆûÈôÖÂ¢ûÈïøÁéá (%)',
                    metric_margin: '3. ÊØõÂà©Áéá (%)',
                    actual_margin: 'ÂÆûÈôÖÊØõÂà©Áéá (%)',
                    btn_calc: 'ËÆ°ÁÆóÊÄªÂ∑•ËµÑ',
                    results: 'Ëñ™ËµÑÊûÑÊàêËØ¶ÊÉÖ',
                    res_fixed: 'Âõ∫ÂÆöÊî∂ÂÖ• (Â∫ïËñ™+Ë°•Ë¥¥+Âä†Áè≠)',
                    res_perf: 'Áª©ÊïàÂ•ñÈáëÊÄªÈ¢ù',
                    res_total: 'È¢Ñ‰º∞ÊÄªÂ∑•ËµÑ',
                    intro_title: 'Â∑•ÂÖ∑‰ªãÁªç',
                    intro_text: 'Êú¨Â∑•ÂÖ∑Áî®‰∫éÁîµÂïÜËøêËê•Â≤ó‰ΩçÁöÑÂ∑•ËµÑÁªìÊûÑËÆæËÆ°‰∏éËÆ°ÁÆó„ÄÇÁµêÂêà‰∫ÜÂõ∫ÂÆöËñ™ËµÑÊ®°Âùó‰∏éÂèØËá™ÂÆö‰πâÁöÑÂä®ÊÄÅÁª©ÊïàÊ®°Âùó„ÄÇÊÇ®ÂèØ‰ª•ÁÇπÂáª‚Äú‰øÆÊîπËßÑÂàô‚ÄùÊù•Ë∞ÉÊï¥S/A/B/CÂêÑÁ≠âÁ∫ßÁöÑËææÊ†áÈó®ÊßõÂíåÂ•ñÈáëÈáëÈ¢ùÔºå‰ª•ÂåπÈÖçÂÖ¨Âè∏ÁöÑÂÖ∑‰ΩìÊîøÁ≠ñ„ÄÇ'
                },
                'zh-TW': {
                    title: 'üí∞ ÈÅãÁáüÂ¥ó‰ΩçÂ∑•Ë≥áË®≠Ë®àË®àÁÆóÂô®',
                    basic_settings: 'Âü∫Á§éË®≠ÁΩÆ',
                    position_level: 'Â¥ó‰ΩçÁ¥öÂà•ÂêçÁ®±',
                    base_salary: 'Âü∫Êú¨Â∫ïËñ™ (¬•)',
                    position_allowance: 'Â¥ó‰ΩçË£úË≤º (¬•)',
                    overtime_pay: 'Âä†Áè≠/ÂÖ®Âã§Â∑•Ë≥á (¬•)',
                    performance_metrics: 'Á∏æÊïàËÄÉÊ†∏ÊåáÊ®ô',
                    edit_rules: '‰øÆÊîπË¶èÂâá',
                    hdr_min: 'ÈÅîÊ®ôÈñÄÊ™ª (‚â•)',
                    hdr_bonus: 'ÁçéÈáëÈáëÈ°ç (¬•)',
                    metric_new_product: '1. Êñ∞Áî¢ÂìÅÊâìÁàÜÊ¨æÊàêÂäüÂÄãÊï∏',
                    actual_count: 'ÂØ¶ÈöõÂÄãÊï∏',
                    achieved_grade: 'Áç≤ÂæóÁ≠âÁ¥ö & ÁçéÈáë',
                    metric_growth: '2. ËÄÅÁî¢ÂìÅÊ•≠Á∏æÂ¢ûÈï∑Áéá (%)',
                    actual_rate: 'ÂØ¶ÈöõÂ¢ûÈï∑Áéá (%)',
                    metric_margin: '3. ÊØõÂà©Áéá (%)',
                    actual_margin: 'ÂØ¶ÈöõÊØõÂà©Áéá (%)',
                    btn_calc: 'Ë®àÁÆóÁ∏ΩÂ∑•Ë≥á',
                    results: 'Ëñ™Ë≥áÊßãÊàêË©≥ÊÉÖ',
                    res_fixed: 'Âõ∫ÂÆöÊî∂ÂÖ• (Â∫ïËñ™+Ë£úË≤º+Âä†Áè≠)',
                    res_perf: 'Á∏æÊïàÁçéÈáëÁ∏ΩÈ°ç',
                    res_total: 'È†ê‰º∞Á∏ΩÂ∑•Ë≥á',
                    intro_title: 'Â∑•ÂÖ∑‰ªãÁ¥π',
                    intro_text: 'Êú¨Â∑•ÂÖ∑Áî®ÊñºÈõªÂïÜÈÅãÁáüÂ¥ó‰ΩçÁöÑÂ∑•Ë≥áÁµêÊßãË®≠Ë®àËàáË®àÁÆó„ÄÇÁµêÂêà‰∫ÜÂõ∫ÂÆöËñ™Ë≥áÊ®°ÁµÑËàáÂèØËá™ÂÆöÁæ©ÁöÑÂãïÊÖãÁ∏æÊïàÊ®°ÁµÑ„ÄÇÊÇ®ÂèØ‰ª•ÈªûÊìä‚Äú‰øÆÊîπË¶èÂâá‚Äù‰æÜË™øÊï¥S/A/B/CÂêÑÁ≠âÁ¥öÁöÑÈÅîÊ®ôÈñÄÊ™ªÂíåÁçéÈáëÈáëÈ°çÔºå‰ª•ÂåπÈÖçÂÖ¨Âè∏ÁöÑÂÖ∑È´îÊîøÁ≠ñ„ÄÇ'
                },
                'ja': {
                    title: 'üí∞ ÈÅãÂñ∂ËÅ∑Áµ¶‰∏é„Éá„Ç∂„Ç§„É≥Ë®àÁÆóÊ©ü',
                    basic_settings: 'Âü∫Êú¨Ë®≠ÂÆö',
                    position_level: 'ÂΩπËÅ∑Âêç',
                    base_salary: 'Âü∫Êú¨Áµ¶ (¬•)',
                    position_allowance: 'ÂΩπËÅ∑ÊâãÂΩì (¬•)',
                    overtime_pay: 'ÊÆãÊ•≠/ÁöÜÂã§ÊâãÂΩì (¬•)',
                    performance_metrics: '„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊåáÊ®ô',
                    edit_rules: '„É´„Éº„É´Á∑®ÈõÜ',
                    hdr_min: 'ÈñæÂÄ§ (‚â•)',
                    hdr_bonus: '„Éú„Éº„Éä„Çπ (¬•)',
                    metric_new_product: '1. Êñ∞Ë£ΩÂìÅ„Éí„ÉÉ„ÉàÊàêÂäüÊï∞',
                    actual_count: 'ÂÆüÁ∏æÊï∞',
                    achieved_grade: 'Áç≤Âæó„É©„É≥„ÇØ & „Éú„Éº„Éä„Çπ',
                    metric_growth: '2. Êó¢Â≠òË£ΩÂìÅÊàêÈï∑Áéá (%)',
                    actual_rate: 'ÂÆüÁ∏æÊàêÈï∑Áéá (%)',
                    metric_margin: '3. Á≤óÂà©Áéá (%)',
                    actual_margin: 'ÂÆüÁ∏æÁ≤óÂà©Áéá (%)',
                    btn_calc: 'Á∑èÁµ¶‰∏é„ÇíË®àÁÆó',
                    results: 'Áµ¶‰∏éÂÜÖË®≥',
                    res_fixed: 'Âõ∫ÂÆöÂèéÂÖ•',
                    res_perf: '„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Éú„Éº„Éä„ÇπÁ∑èÈ°ç',
                    res_total: 'Êé®ÂÆöÁ∑èÁµ¶‰∏é',
                    intro_title: '„ÉÑ„Éº„É´Á¥π‰ªã',
                    intro_text: 'ECÈÅãÂñ∂ËÅ∑„ÅÆÁµ¶‰∏éÊßãÈÄ†„ÇíË®≠Ë®à„ÉªË®àÁÆó„Åô„Çã„ÉÑ„Éº„É´„Åß„Åô„ÄÇÂõ∫ÂÆöÁµ¶„Å®„Ç´„Çπ„Çø„Éû„Ç§„Ç∫ÂèØËÉΩ„Å™ÂãïÁöÑ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„É¢„Ç∏„É•„Éº„É´„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Äå„É´„Éº„É´Á∑®ÈõÜ„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÄÅÂêÑ„É©„É≥„ÇØ„ÅÆÈñæÂÄ§„Å®„Éú„Éº„Éä„ÇπÈ°ç„ÇíË™øÊï¥„Åß„Åç„Åæ„Åô„ÄÇ'
                },
                'ru': {
                    title: 'üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞—Ä–ø–ª–∞—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞',
                    basic_settings: '–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏',
                    position_level: '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏',
                    base_salary: '–ë–∞–∑–æ–≤—ã–π –æ–∫–ª–∞–¥ (¬•)',
                    position_allowance: '–ù–∞–¥–±–∞–≤–∫–∞ –∑–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å (¬•)',
                    overtime_pay: '–û–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫ (¬•)',
                    performance_metrics: '–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',
                    edit_rules: '–ò–∑–º. –ø—Ä–∞–≤–∏–ª–∞',
                    hdr_min: '–ü–æ—Ä–æ–≥ (‚â•)',
                    hdr_bonus: '–ë–æ–Ω—É—Å (¬•)',
                    metric_new_product: '1. –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
                    actual_count: '–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª-–≤–æ',
                    achieved_grade: '–ö–ª–∞—Å—Å –∏ –ë–æ–Ω—É—Å',
                    metric_growth: '2. –†–æ—Å—Ç —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (%)',
                    actual_rate: '–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç (%)',
                    metric_margin: '3. –í–∞–ª–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å (%)',
                    actual_margin: '–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–±—ã–ª—å (%)',
                    btn_calc: '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏—Ç–æ–≥',
                    results: '–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—Ä–ø–ª–∞—Ç—ã',
                    res_fixed: '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Ö–æ–¥',
                    res_perf: '–ò—Ç–æ–≥–æ –±–æ–Ω—É—Å—ã',
                    res_total: '–û–∂–∏–¥–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞',
                    intro_title: '–û –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ',
                    intro_text: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—á–µ—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã –≤ E-commerce. –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ—Ä–æ–≥–∏ –∏ –±–æ–Ω—É—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ (S/A/B/C) –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏.'
                }
            },

            init: function() {
                // ‰ºòÂÖà‰ªé URL Ëé∑ÂèñËØ≠Ë®ÄÂèÇÊï∞
                const params = new URLSearchParams(window.location.search);
                const lang = params.get('lang');
                
                if (lang && this.i18n[lang]) {
                    document.getElementById('lang-selector').value = lang;
                    // changeLang ‰ºöÊõ¥Êñ∞ URL Âπ∂Ë∞ÉÁî® calculate
                    this.changeLang(); 
                } else {
                    // Ê≤°Êúâ URL ÂèÇÊï∞ÂàôÈªòËÆ§ËÆ°ÁÆó‰∏ÄÊ¨°
                    this.calculate();
                }
            },

            changeLang: function() {
                const lang = document.getElementById('lang-selector').value;
                
                // Êõ¥Êñ∞ URL ÂèÇÊï∞ (‰∏çÂà∑Êñ∞È°µÈù¢)
                const newUrl = new URL(window.location);
                newUrl.searchParams.set('lang', lang);
                window.history.pushState({}, '', newUrl);

                const texts = this.i18n[lang];
                if (!texts) return;
                
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });
                this.calculate(); 
            },

            toggleRules: function(id) {
                const el = document.getElementById(id);
                el.classList.toggle('hidden');
            },

            // Helper to get rule values from DOM
            getRuleConfig: function(metricCode) {
                // Collect inputs with data-metric="{metricCode}"
                // data-grade="S", "A", etc.
                const rules = [];
                const grades = ['S', 'A', 'B', 'C'];
                
                grades.forEach(grade => {
                    const threshInput = document.querySelector(`.rule-threshold[data-metric="${metricCode}"][data-grade="${grade}"]`);
                    const bonusInput = document.querySelector(`.rule-bonus[data-metric="${metricCode}"][data-grade="${grade}"]`);
                    
                    if (threshInput && bonusInput) {
                        rules.push({
                            grade: grade,
                            min: parseFloat(threshInput.value) || 0,
                            bonus: parseFloat(bonusInput.value) || 0
                        });
                    }
                });
                return rules;
            },

            getGradeAndBonus: function(metricCode, value) {
                const rules = this.getRuleConfig(metricCode);
                // Sort rules descending by min threshold to find highest match first
                rules.sort((a, b) => b.min - a.min);

                for (let rule of rules) {
                    if (value >= rule.min) {
                        let css = 'text-gray-600';
                        if(rule.grade === 'S') css = 'badge badge-s';
                        if(rule.grade === 'A') css = 'badge badge-a';
                        if(rule.grade === 'B') css = 'badge badge-b';
                        if(rule.grade === 'C') css = 'badge badge-c';
                        
                        return { grade: rule.grade, bonus: rule.bonus, css: css };
                    }
                }

                return { grade: 'D/E', bonus: 0, css: 'text-gray-400' };
            },

            calculate: function() {
                // Fixed
                const base = parseFloat(document.getElementById('base_salary').value) || 0;
                const allow = parseFloat(document.getElementById('position_allowance').value) || 0;
                const overtime = parseFloat(document.getElementById('overtime_pay').value) || 0;
                const fixedTotal = base + allow + overtime;

                // Perf 1: New Product (code 'np')
                const val1 = parseFloat(document.getElementById('perf_new_product_val').value) || 0;
                const res1 = this.getGradeAndBonus('np', val1);
                const el1 = document.getElementById('grade_new_product');
                el1.innerHTML = `<span class="${res1.css}">${res1.grade}</span> <span class="text-sm ml-2">¬•${res1.bonus}</span>`;

                // Perf 2: Growth (code 'gr')
                const val2 = parseFloat(document.getElementById('perf_growth_val').value) || 0;
                const res2 = this.getGradeAndBonus('gr', val2);
                const el2 = document.getElementById('grade_growth');
                el2.innerHTML = `<span class="${res2.css}">${res2.grade}</span> <span class="text-sm ml-2">¬•${res2.bonus}</span>`;

                // Perf 3: Margin (code 'mg')
                const val3 = parseFloat(document.getElementById('perf_margin_val').value) || 0;
                const res3 = this.getGradeAndBonus('mg', val3);
                const el3 = document.getElementById('grade_margin');
                el3.innerHTML = `<span class="${res3.css}">${res3.grade}</span> <span class="text-sm ml-2">¬•${res3.bonus}</span>`;

                const perfTotal = res1.bonus + res2.bonus + res3.bonus;
                const total = fixedTotal + perfTotal;

                // Update UI
                document.getElementById('res_fixed_val').innerText = '¬•' + fixedTotal;
                document.getElementById('res_perf_val').innerText = '¬•' + perfTotal;
                document.getElementById('res_total_val').innerText = '¬•' + total;
            }
        };

        window.onload = function() { SalaryDesign.init(); };
    </script>
</body>
</html>
