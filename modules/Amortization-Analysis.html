<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Amortization Analysis Module</title>
    <meta name="tool-id" content="amort_calc">
    <meta name="category" content="finance">
    <meta name="icon" content="ğŸ“Š">
    <meta name="description" content="åˆ†æè´·æ¬¾çš„åˆ†æœŸæ‘Šæç»“æ„ï¼Œè®¡ç®—æ¯æœˆè¿˜æ¬¾é¢å’Œæ€»åˆ©æ¯å æ¯”ã€‚">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0f9ff; font-family: 'Inter', sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); max-width: 600px; margin: 0 auto; position: relative; border: 1px solid #bfdbfe; }
        
        .bar-container { width: 100%; height: 20px; background: #e5e7eb; border-radius: 10px; overflow: hidden; display: flex; }
        .bar-principal { height: 100%; background: #3b82f6; transition: width 0.5s; }
        .bar-interest { height: 100%; background: #f97316; transition: width 0.5s; }
        
        .result-box { padding: 12px; background-color: #eff6ff; border-radius: 8px; border: 1px solid #bfdbfe; }
        .result-label { font-size: 0.875rem; color: #6b7280; }
        .result-value { font-size: 1.5rem; font-weight: 700; color: #1d4ed8; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="amort_calc" 
         data-category="finance" 
         data-title="Amortization Analysis" 
         data-icon="ğŸ“Š">
        
        <div class="absolute top-4 right-4">
            <select id="ac-lang" onchange="AmortCalc.changeLang(this.value)" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none focus:ring-blue-300 focus:border-blue-300 transition">
                <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ğŸ‡­ğŸ‡° ç¹é«”ä¸­æ–‡</option>
                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>

        <h1 class="text-2xl font-bold text-gray-800 mb-6" data-i18n="title">Amortization Analysis</h1>

        <div class="space-y-4 mb-6">
            <!-- Principal -->
            <div>
                <label for="ac-principal" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="label_principal">Principal Amount ($)</label>
                <input type="number" id="ac-principal" value="100000" min="0" step="1000" oninput="AmortCalc.calculate()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
            </div>
            
            <!-- Rate -->
            <div>
                <label for="ac-rate" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="label_rate">Annual Interest Rate (%)</label>
                <input type="number" id="ac-rate" value="5" min="0" step="0.1" oninput="AmortCalc.calculate()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
            </div>

            <!-- Term -->
            <div>
                <label for="ac-term" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="label_term">Loan Term (Years)</label>
                <input type="number" id="ac-term" value="30" min="1" max="60" step="1" oninput="AmortCalc.calculate()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
            </div>
        </div>

        <div id="ac-result-box" class="mt-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4" data-i18n="result_title">Analysis Results</h2>

            <div class="grid grid-cols-2 gap-4 mb-6">
                <!-- Monthly Payment -->
                <div class="result-box">
                    <div class="result-label" data-i18n="res_monthly">Monthly Payment</div>
                    <div class="result-value" id="ac-res-monthly">$536</div>
                </div>

                <!-- Total Interest -->
                <div class="result-box">
                    <div class="result-label" data-i18n="res_interest">Total Interest Paid</div>
                    <div class="result-value" id="ac-res-interest">$93,126</div>
                </div>
            </div>

            <h3 class="text-lg font-bold text-gray-800 mb-3" data-i18n="res_total_breakdown">Total Payment Breakdown</h3>

            <div class="bar-container mb-2">
                <div id="bar-p" class="bar-principal flex items-center justify-end text-white pr-2 text-xs font-semibold" style="width: 52%;">
                    <span id="txt-p">52%</span>
                </div>
                <div id="bar-i" class="bar-interest flex items-center justify-start text-white pl-2 text-xs font-semibold" style="width: 48%;">
                    <span id="txt-i">48%</span>
                </div>
            </div>
            
            <div class="flex justify-between text-sm text-gray-600">
                <div class="flex items-center gap-2">
                    <span class="inline-block w-3 h-3 bg-blue-500 rounded-full"></span>
                    <span data-i18n="breakdown_principal">Principal</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="inline-block w-3 h-3 bg-orange-500 rounded-full"></span>
                    <span data-i18n="breakdown_interest">Interest</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            "en": {
                title: "Amortization Analysis",
                label_principal: "Principal Amount ($)",
                label_rate: "Annual Interest Rate (%)",
                label_term: "Loan Term (Years)",
                result_title: "Analysis Results",
                res_monthly: "Monthly Payment",
                res_interest: "Total Interest Paid",
                res_total_breakdown: "Total Payment Breakdown",
                breakdown_principal: "Principal",
                breakdown_interest: "Interest",
                currency_code: "USD",
                currency_symbol: "$",
                err_input: "Please enter valid Principal, Rate, and Term."
            },
            "zh-CN": {
                title: "åˆ†æœŸæ‘Šè¿˜åˆ†æ",
                label_principal: "æœ¬é‡‘é‡‘é¢ (ï¿¥)",
                label_rate: "å¹´åˆ©ç‡ (%)",
                label_term: "è´·æ¬¾æœŸé™ (å¹´)",
                result_title: "åˆ†æç»“æœ",
                res_monthly: "æ¯æœˆè¿˜æ¬¾é¢",
                res_interest: "æ€»åˆ©æ¯æ”¯å‡º",
                res_total_breakdown: "æ€»æ”¯å‡ºæ„æˆ",
                breakdown_principal: "æœ¬é‡‘",
                breakdown_interest: "åˆ©æ¯",
                currency_code: "CNY",
                currency_symbol: "ï¿¥",
                err_input: "è¯·è¾“å…¥æœ‰æ•ˆçš„æœ¬é‡‘ã€åˆ©ç‡å’ŒæœŸé™ã€‚"
            },
            "zh-TW": {
                title: "æ”¤é‚„åˆ†æ",
                label_principal: "æœ¬é‡‘é‡‘é¡ (NT$)",
                label_rate: "å¹´åˆ©ç‡ (%)",
                label_term: "è²¸æ¬¾æœŸé™ (å¹´)",
                result_title: "åˆ†æçµæœ",
                res_monthly: "æ¯æœˆé‚„æ¬¾é¡",
                res_interest: "ç¸½åˆ©æ¯æ”¯å‡º",
                res_total_breakdown: "ç¸½æ”¯å‡ºæ§‹æˆ",
                breakdown_principal: "æœ¬é‡‘",
                breakdown_interest: "åˆ©æ¯",
                currency_code: "TWD",
                currency_symbol: "NT$",
                err_input: "è«‹è¼¸å…¥æœ‰æ•ˆçš„æœ¬é‡‘ã€åˆ©ç‡å’ŒæœŸé™ã€‚"
            },
            "ja": {
                title: "å„Ÿå´åˆ†æ",
                label_principal: "å…ƒé‡‘ (Â¥)",
                label_rate: "å¹´åˆ© (%)",
                label_term: "ãƒ­ãƒ¼ãƒ³æœŸé–“ (å¹´)",
                result_title: "åˆ†æçµæœ",
                res_monthly: "æœˆã€…ã®è¿”æ¸ˆé¡",
                res_interest: "ç·æ”¯æ‰•åˆ©æ¯",
                res_total_breakdown: "ç·æ”¯æ‰•ã„ã®å†…è¨³",
                breakdown_principal: "å…ƒé‡‘",
                breakdown_interest: "åˆ©æ¯",
                currency_code: "JPY",
                currency_symbol: "Â¥",
                err_input: "æœ‰åŠ¹ãªå…ƒé‡‘ã€åˆ©ç‡ã€æœŸé–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"
            },
            "ru": {
                title: "ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ°Ğ¼Ğ¾Ñ€Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸",
                label_principal: "Ğ¡ÑƒĞ¼Ğ¼Ğ° ĞºÑ€ĞµĞ´Ğ¸Ñ‚Ğ° (â‚½)",
                label_rate: "Ğ“Ğ¾Ğ´Ğ¾Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ½Ğ°Ñ ÑÑ‚Ğ°Ğ²ĞºĞ° (%)",
                label_term: "Ğ¡Ñ€Ğ¾Ğº ĞºÑ€ĞµĞ´Ğ¸Ñ‚Ğ° (Ğ»ĞµÑ‚)",
                result_title: "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°",
                res_monthly: "Ğ•Ğ¶ĞµĞ¼ĞµÑÑÑ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶",
                res_interest: "ĞĞ±Ñ‰Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ° Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ¾Ğ²",
                res_total_breakdown: "ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹",
                breakdown_principal: "ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ´Ğ¾Ğ»Ğ³",
                breakdown_interest: "ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚Ñ‹",
                currency_code: "RUB",
                currency_symbol: "â‚½",
                err_input: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½ÑƒÑ ÑÑƒĞ¼Ğ¼Ñƒ, ÑÑ‚Ğ°Ğ²ĞºÑƒ Ğ¸ ÑÑ€Ğ¾Ğº."
            }
        };

        const AmortCalc = {
            currentLang: localStorage.getItem('app_lang') || 'en',

            init: () => {
                document.getElementById('ac-lang').value = AmortCalc.currentLang;
                AmortCalc.applyLanguage(AmortCalc.currentLang);
                AmortCalc.calculate(); // Calculate with default values
            },

            changeLang: (lang) => {
                AmortCalc.currentLang = lang;
                localStorage.setItem('app_lang', lang);
                AmortCalc.applyLanguage(lang);
                AmortCalc.calculate(); // Recalculate to update currency format
            },

            applyLanguage: (lang) => {
                const t = translations[lang] || translations['en'];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (t[key]) {
                        el.textContent = t[key];
                    }
                });
                // Update currency symbols in labels
                document.getElementById('ac-principal').previousElementSibling.textContent = t.label_principal;
            },

            // Formatter handles currency localization
            fmt: (num) => {
                const t = translations[AmortCalc.currentLang] || translations['en'];
                // Use Intl.NumberFormat for robust currency display
                const locale = AmortCalc.currentLang === 'zh-CN' ? 'zh-CN' : 
                               AmortCalc.currentLang === 'zh-TW' ? 'zh-TW' : 
                               AmortCalc.currentLang === 'ja' ? 'ja-JP' : 
                               AmortCalc.currentLang === 'ru' ? 'ru-RU' : 'en-US';
                
                return new Intl.NumberFormat(locale, {
                    style: 'currency',
                    currency: t.currency_code,
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(num);
            },

            calculate: () => {
                const t = translations[AmortCalc.currentLang] || translations['en'];
                
                // Inputs
                const p = parseFloat(document.getElementById('ac-principal').value);
                const r_annual = parseFloat(document.getElementById('ac-rate').value);
                const years = parseFloat(document.getElementById('ac-term').value);

                if (isNaN(p) || isNaN(r_annual) || isNaN(years) || p <= 0 || r_annual < 0 || years <= 0) {
                    // console.error(t.err_input); // Use console log for errors instead of alert
                    document.getElementById('ac-res-monthly').innerText = t.currency_symbol + "0";
                    document.getElementById('ac-res-interest').innerText = t.currency_symbol + "0";
                    document.getElementById('bar-p').style.width = "0%";
                    document.getElementById('bar-i').style.width = "0%";
                    document.getElementById('txt-p').innerText = "0%";
                    document.getElementById('txt-i').innerText = "0%";
                    return; 
                }

                const r = r_annual / 100 / 12; // Monthly rate
                const n = years * 12; // Total payments (months)
                
                let monthly, totalPay, totalInt;

                if (r === 0) {
                    // Zero interest
                    monthly = p / n;
                    totalPay = p;
                    totalInt = 0;
                } else {
                    // Standard Amortization formula
                    const x = Math.pow(1 + r, n);
                    monthly = (p * r * x) / (x - 1);
                    totalPay = monthly * n;
                    totalInt = totalPay - p;
                }

                // Display Results
                document.getElementById('ac-res-monthly').innerText = AmortCalc.fmt(monthly);
                document.getElementById('ac-res-interest').innerText = AmortCalc.fmt(totalInt);

                // Bar chart
                const pPercent = (p / totalPay) * 100;
                const iPercent = (totalInt / totalPay) * 100;

                document.getElementById('bar-p').style.width = pPercent.toFixed(0) + "%";
                document.getElementById('bar-i').style.width = iPercent.toFixed(0) + "%";
                
                document.getElementById('txt-p').innerText = pPercent.toFixed(0) + "%";
                document.getElementById('txt-i').innerText = iPercent.toFixed(0) + "%";
            }
        };

        window.addEventListener('DOMContentLoaded', AmortCalc.init);
    </script>
</body>
</html>