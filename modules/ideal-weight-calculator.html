<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ideal Weight Calculator Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0fdf4; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="ideal_weight" 
         data-category="health" 
         data-title="Ideal Weight Calculator" 
         data-icon="⚖️">
        
        <div class="absolute top-4 right-4">
            <select id="iw-lang" onchange="IdealWeight.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en">English</option>
                <option value="zh-CN">簡體中文</option>
                <option value="zh-TW">繁體中文</option>
                <option value="ja">日本語</option>
                <option value="ru">Русский</option>
                <option value="es">Español</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">⚖️ Ideal Weight Calculator</h2>

        <div class="flex justify-center mb-4 bg-gray-100 p-1 rounded-lg w-max mx-auto">
            <button class="px-3 py-1 text-sm rounded-md bg-white shadow text-emerald-600 font-medium transition" id="iw-btn-metric" onclick="IdealWeight.setUnit('metric')">Metric</button>
            <button class="px-3 py-1 text-sm rounded-md text-gray-500 hover:text-emerald-600 transition" id="iw-btn-imperial" onclick="IdealWeight.setUnit('imperial')">US Units</button>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div>
                <label class="block text-xs text-gray-500 mb-1" data-i18n="lbl_gender">Gender</label>
                <select id="iw-gender" class="w-full p-2 border rounded bg-white text-sm" onchange="IdealWeight.calc()">
                    <option value="m" data-i18n="g_male">Male</option>
                    <option value="f" data-i18n="g_female">Female</option>
                </select>
            </div>
            <div>
                <label class="block text-xs text-gray-500 mb-1" id="lbl-height">Height (cm)</label>
                <div class="flex gap-2">
                    <input type="number" id="iw-height" class="w-full p-2 border rounded focus:ring-1 focus:ring-emerald-500 outline-none" placeholder="175" oninput="IdealWeight.calc()">
                    <input type="number" id="iw-height-ft" class="hidden w-1/2 p-2 border rounded focus:ring-1 focus:ring-emerald-500 outline-none" placeholder="ft" oninput="IdealWeight.calc()">
                    <input type="number" id="iw-height-in" class="hidden w-1/2 p-2 border rounded focus:ring-1 focus:ring-emerald-500 outline-none" placeholder="in" oninput="IdealWeight.calc()">
                </div>
            </div>
        </div>

        <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-100 text-center">
            <span class="text-xs text-gray-500 uppercase tracking-wide block mb-1" data-i18n="res_range">Healthy BMI Range</span>
            <div id="iw-range" class="text-3xl font-bold text-emerald-800">-- - --</div>
            
            <div class="mt-3 pt-3 border-t border-emerald-200">
                <span class="text-xs text-gray-500 uppercase tracking-wide block mb-1" data-i18n="res_devine">Devine Formula (Ideal)</span>
                <div id="iw-devine" class="text-xl font-bold text-emerald-600">--</div>
            </div>
        </div>
    </div>

    <script>
        const IdealWeight = {
            unit: 'metric',
            i18n: {
                'en': {
                    title: '⚖️ Ideal Weight Calculator',
                    lbl_gender: 'Gender', g_male: 'Male', g_female: 'Female',
                    res_range: 'Healthy BMI Range (18.5 - 25)',
                    res_devine: 'Ideal Weight (Devine Formula)',
                    u_kg: 'kg', u_lbs: 'lbs'
                },
                'zh-CN': {
                    title: '⚖️ 理想体重计算器',
                    lbl_gender: '性别', g_male: '男性', g_female: '女性',
                    res_range: '健康体重范围 (BMI 18.5-25)',
                    res_devine: '理想体重 (Devine 公式)',
                    u_kg: '千克', u_lbs: '磅'
                },
                'zh-TW': {
                    title: '⚖️ 理想體重計算器',
                    lbl_gender: '性別', g_male: '男性', g_female: '女性',
                    res_range: '健康體重範圍 (BMI 18.5-25)',
                    res_devine: '理想體重 (Devine 公式)',
                    u_kg: '公斤', u_lbs: '磅'
                },
                'ja': {
                    title: '⚖️ 理想体重・適正体重',
                    lbl_gender: '性別', g_male: '男性', g_female: '女性',
                    res_range: '健康体重範囲 (BMI 18.5-25)',
                    res_devine: '理想体重 (Devine式)',
                    u_kg: 'kg', u_lbs: 'lbs'
                },
                'ru': {
                    title: '⚖️ Идеальный вес',
                    lbl_gender: 'Пол', g_male: 'Мужской', g_female: 'Женский',
                    res_range: 'Здоровый вес (BMI 18.5-25)',
                    res_devine: 'Идеал (Формула Девайна)',
                    u_kg: 'кг', u_lbs: 'фунт'
                },
                'es': {
                    title: '⚖️ Peso Ideal',
                    lbl_gender: 'Género', g_male: 'Hombre', g_female: 'Mujer',
                    res_range: 'Rango Saludable (IMC)',
                    res_devine: 'Peso Ideal (Fórmula Devine)',
                    u_kg: 'kg', u_lbs: 'lbs'
                }
            },

            setUnit: (u) => {
                IdealWeight.unit = u;
                const isM = u === 'metric';
                const s = (id, txt) => document.getElementById(id).innerText = txt;
                
                s('lbl-height', isM ? 'Height (cm)' : 'Height (ft/in)');
                
                const btnM = document.getElementById('iw-btn-metric');
                const btnI = document.getElementById('iw-btn-imperial');
                
                btnM.className = isM ? "px-3 py-1 text-sm rounded-md bg-white shadow text-emerald-600 font-medium transition" : "px-3 py-1 text-sm rounded-md text-gray-500 hover:text-emerald-600 transition";
                btnI.className = !isM ? "px-3 py-1 text-sm rounded-md bg-white shadow text-emerald-600 font-medium transition" : "px-3 py-1 text-sm rounded-md text-gray-500 hover:text-emerald-600 transition";

                if (isM) {
                    document.getElementById('iw-height').classList.remove('hidden');
                    document.getElementById('iw-height-ft').classList.add('hidden');
                    document.getElementById('iw-height-in').classList.add('hidden');
                } else {
                    document.getElementById('iw-height').classList.add('hidden');
                    document.getElementById('iw-height-ft').classList.remove('hidden');
                    document.getElementById('iw-height-in').classList.remove('hidden');
                }
                IdealWeight.calc();
            },

            changeLang: () => {
                const lang = document.getElementById('iw-lang').value;
                const texts = IdealWeight.i18n[lang];
                const elements = document.querySelectorAll('[data-id="ideal_weight"] [data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });
                IdealWeight.calc();
            },

            calc: () => {
                const gender = document.getElementById('iw-gender').value;
                let hCm = 0;

                if (IdealWeight.unit === 'metric') {
                    hCm = parseFloat(document.getElementById('iw-height').value);
                } else {
                    const ft = parseFloat(document.getElementById('iw-height-ft').value) || 0;
                    const inc = parseFloat(document.getElementById('iw-height-in').value) || 0;
                    if (ft || inc) hCm = (ft * 30.48) + (inc * 2.54);
                }

                if (!hCm || hCm < 50) return;

                const hM = hCm / 100;
                const lang = document.getElementById('iw-lang').value;
                const unitTxt = IdealWeight.i18n[lang][IdealWeight.unit === 'metric' ? 'u_kg' : 'u_lbs'];

                // 1. BMI Range (18.5 - 25)
                // W = BMI * H^2
                let minW = 18.5 * hM * hM;
                let maxW = 25 * hM * hM;

                // 2. Devine Formula
                // Male: 50kg + 2.3kg per inch over 5ft
                // Female: 45.5kg + 2.3kg per inch over 5ft
                const heightInInches = hCm / 2.54;
                const inchesOver60 = Math.max(0, heightInInches - 60);
                
                let devineW = 0;
                if (gender === 'm') {
                    devineW = 50 + (2.3 * inchesOver60);
                } else {
                    devineW = 45.5 + (2.3 * inchesOver60);
                }

                // Convert output if imperial
                if (IdealWeight.unit === 'imperial') {
                    minW *= 2.20462;
                    maxW *= 2.20462;
                    devineW *= 2.20462;
                }

                document.getElementById('iw-range').innerText = `${minW.toFixed(1)} - ${maxW.toFixed(1)} ${unitTxt}`;
                document.getElementById('iw-devine').innerText = `${devineW.toFixed(1)} ${unitTxt}`;
            }
        };
    </script>
</body>
</html>