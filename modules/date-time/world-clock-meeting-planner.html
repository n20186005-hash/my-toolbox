<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 1. å·¥å…·åˆ†ç±»æ ¼å¼ -->
    <meta name="category" content=" date-time">
    <title>World Clock Meeting Planner</title>
    <!-- ä½¿ç”¨ html2canvas ç”¨äºæˆªå›¾ä¿å­˜åŠŸèƒ½ -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f4f6f9;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #e1e4e8;
            
            /* æ—¶é—´æ®µé¢œè‰²çŠ¶æ€ */
            --status-work: #d4edda; /* ç»¿è‰² - å·¥ä½œæ—¶é—´ */
            --status-stretch: #fff3cd; /* é»„è‰² - éå·¥ä½œä½†é†’ç€ */
            --status-sleep: #f8f9fa; /* ç°è‰² - ç¡çœ æ—¶é—´ */
            --status-work-text: #155724;
            --status-stretch-text: #856404;
            --status-sleep-text: #6c757d;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { padding: 2rem; max-width: 1200px; margin: 0 auto; background-color: var(--bg-color); color: var(--text-color); }

        /* Header & Lang Switch */
        .header-controls { display: flex; justify-content: flex-end; margin-bottom: 1.5rem; }
        .lang-switch { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .lang-switch button { padding: 0.4rem 0.8rem; border: 1px solid #ddd; border-radius: 4px; background-color: var(--card-bg); cursor: pointer; transition: all 0.2s; font-size: 0.85rem; color: #555; }
        .lang-switch button:hover { border-color: var(--accent-color); color: var(--accent-color); }
        .lang-switch button.active { background-color: var(--accent-color); color: #fff; border-color: var(--accent-color); }

        /* Main Box */
        .calculator-box { background-color: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); margin-bottom: 2rem; }
        .calculator-box h2 { margin-bottom: 0.5rem; color: var(--primary-color); font-size: 1.8rem; display: flex; align-items: center; gap: 10px; }
        .calculator-box p.subtitle { color: #7f8c8d; margin-bottom: 1.5rem; font-size: 1rem; }
        
        /* Controls Area */
        .controls-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; align-items: end; }
        .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .control-group label { font-weight: 600; font-size: 0.9rem; color: #555; }
        .control-group select, .control-group input { padding: 0.6rem; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; outline: none; }
        .control-group select:focus, .control-group input:focus { border-color: var(--accent-color); }

        /* Buttons */
        .btn-group { display: flex; flex-wrap: wrap; gap: 0.8rem; margin-top: 1rem; }
        .btn { padding: 0.7rem 1.2rem; border: none; border-radius: 6px; cursor: pointer; transition: transform 0.1s, box-shadow 0.2s; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; font-size: 0.95rem; }
        .btn:active { transform: translateY(1px); }
        .btn-primary { background-color: #27ae60; color: #fff; } .btn-primary:hover { background-color: #219150; }
        .btn-action { background-color: #3498db; color: #fff; } .btn-action:hover { background-color: #2980b9; }
        .btn-danger { background-color: #e74c3c; color: #fff; } .btn-danger:hover { background-color: #c0392b; }
        .btn-info { background-color: #8e44ad; color: #fff; } .btn-info:hover { background-color: #732d91; }

        /* Selected Cities Tags */
        .selected-cities { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; border: 1px dashed #ccc; min-height: 50px; }
        .city-tag { background: white; border: 1px solid var(--accent-color); color: var(--accent-color); padding: 0.4rem 0.8rem; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .city-tag span.remove { cursor: pointer; font-weight: bold; padding: 0 4px; border-radius: 50%; }
        .city-tag span.remove:hover { background: #fee; color: #e74c3c; }

        /* The Grid Table */
        .table-container { background-color: var(--card-bg); padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); overflow-x: auto; margin-bottom: 2rem; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 800px; }
        th { position: sticky; top: 0; background: #fff; z-index: 10; padding: 1rem; text-align: center; border-bottom: 2px solid #eee; color: var(--primary-color); font-weight: 700; white-space: nowrap; }
        /* Sticky first column for Base Time */
        th:first-child, td:first-child { position: sticky; left: 0; background: #fff; z-index: 11; border-right: 2px solid #eee; }
        td:first-child { background: #fafafa; font-weight: bold; color: #555; }
        
        td { padding: 0.8rem; border-bottom: 1px solid #eee; text-align: center; vertical-align: middle; transition: background 0.2s; white-space: nowrap; font-variant-numeric: tabular-nums; }
        
        /* Cell States */
        .cell-work { background-color: var(--status-work); color: var(--status-work-text); }
        .cell-stretch { background-color: var(--status-stretch); color: var(--status-stretch-text); }
        .cell-sleep { background-color: var(--status-sleep); color: var(--status-sleep-text); opacity: 0.7; }
        
        /* Highlight Best Row */
        tr.best-time td { border-top: 2px solid #27ae60; border-bottom: 2px solid #27ae60; }
        tr.best-time td:first-child { border-left: 2px solid #27ae60; color: #27ae60; }
        tr.best-time td:last-child { border-right: 2px solid #27ae60; }

        /* Intro */
        .intro { background-color: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); color: #555; line-height: 1.8; }
        .intro h3 { color: var(--primary-color); margin-bottom: 1rem; }
        .legend { display: flex; gap: 1.5rem; margin-top: 1rem; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
        .color-box { width: 20px; height: 20px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); }

        .loading-tip { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(0,0,0,0.85); color: white; padding: 1rem 2rem; border-radius: 8px; z-index: 1000; display: none; backdrop-filter: blur(4px); }

        @media (max-width: 768px) { body { padding: 1rem; } .controls-grid { grid-template-columns: 1fr; } .btn { width: 100%; justify-content: center; } }
    </style>
</head>
<body>
    <div class="loading-tip" id="loadingTip">Generating Image...</div>

    <!-- Language Switcher -->
    <div class="header-controls">
        <div class="lang-switch">
            <button data-lang="zh-CN" class="active">ç®€ä½“ä¸­æ–‡</button>
            <button data-lang="zh-TW">ç¹é«”ä¸­æ–‡</button>
            <button data-lang="en">English</button>
            <button data-lang="ja">æ—¥æœ¬èª</button>
            <button data-lang="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
        </div>
    </div>

    <!-- Main Controller -->
    <div class="calculator-box">
        <h2 data-key="title">ğŸŒ ä¸–ç•Œæ—¶é’Ÿä¼šè®®ç­–åˆ’è€…</h2>
        <p class="subtitle" data-key="subtitle">è½»æ¾è·¨è¶Šæ—¶åŒºï¼Œå¯»æ‰¾æœ€ä½³çš„å›½é™…ä¼šè®®æ—¶é—´ã€‚</p>
        
        <div class="controls-grid">
            <!-- Date Picker -->
            <div class="control-group">
                <label data-key="labelDate">é€‰æ‹©æ—¥æœŸ</label>
                <input type="date" id="meetingDate">
            </div>

            <!-- City Selector -->
            <div class="control-group">
                <label data-key="labelCity">æ·»åŠ åŸå¸‚/æ—¶åŒº</label>
                <select id="timezoneSelect">
                    <!-- Populated by JS -->
                </select>
            </div>
            
            <div class="control-group" style="justify-content: flex-end;">
                 <button class="btn btn-action" id="btnAddCity" style="width: 100%;">
                    <span data-key="btnAdd">â• æ·»åŠ åŸå¸‚</span>
                </button>
            </div>
        </div>

        <!-- Selected Cities Container -->
        <div class="selected-cities" id="selectedCitiesContainer">
            <span style="color: #999; width: 100%; text-align: center; padding: 10px;" id="emptyTip" data-key="emptyTip">è¯·æ·»åŠ åŸå¸‚ä»¥å¼€å§‹...</span>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" id="btnUpdate" data-key="btnUpdate">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
            <button class="btn btn-danger" id="btnClear" data-key="btnClear">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
            <button class="btn btn-info" id="btnSaveImg" data-key="btnSave">ğŸ“· ä¿å­˜ä¸ºå›¾ç‰‡</button>
        </div>
    </div>

    <!-- Results Table -->
    <div class="table-container" id="tableToSave">
        <h3 style="text-align:center; margin-bottom:1rem; color:var(--primary-color);" id="displayDate"></h3>
        <table id="meetingTable">
            <thead>
                <!-- Headers injected by JS -->
            </thead>
            <tbody id="tableBody">
                <!-- Rows injected by JS -->
            </tbody>
        </table>
    </div>

    <!-- Description & Legend -->
    <div class="intro">
        <h3 data-key="legendTitle">é¢œè‰²è¯´æ˜</h3>
        <div class="legend">
            <div class="legend-item">
                <div class="color-box" style="background: var(--status-work)"></div>
                <span data-key="legendWork">å·¥ä½œæ—¶é—´ (09:00 - 17:00)</span>
            </div>
            <div class="legend-item">
                <div class="color-box" style="background: var(--status-stretch)"></div>
                <span data-key="legendStretch">ä¸€èˆ¬æ—¶é—´ (07-09, 17-22)</span>
            </div>
            <div class="legend-item">
                <div class="color-box" style="background: var(--status-sleep)"></div>
                <span data-key="legendSleep">ç¡çœ /ä¼‘æ¯ (22:00 - 07:00)</span>
            </div>
        </div>
        <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid #eee;">
        
        <h3 data-key="introTitle">å…³äºæ­¤å·¥å…·</h3>
        <p data-key="introText">
            è¿™æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„å›½é™…ä¼šè®®æ—¶é—´è§„åˆ’å·¥å…·ã€‚é€šè¿‡é¢œè‰²ç¼–ç ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿè¯†åˆ«å‡ºä½äºä¸åŒæ—¶åŒºçš„å‚ä¸è€…å…±åŒæ–¹ä¾¿çš„æ—¶é—´çª—å£ã€‚<br>
            â€¢ ç»¿è‰²è¡Œè¡¨ç¤ºå¯¹æ‰€æœ‰å‚ä¸è€…æ¥è¯´éƒ½æ˜¯å·¥ä½œæ—¶é—´ï¼Œæ˜¯ä¼šè®®çš„é»„é‡‘æ—¶æ®µã€‚<br>
            â€¢ æ”¯æŒä¿å­˜é…ç½®ä¸ºå›¾ç‰‡ï¼Œæ–¹ä¾¿é™„åŠ åœ¨ä¼šè®®é‚€è¯·é‚®ä»¶ä¸­ã€‚<br>
            â€¢ æ•°æ®å®Œå…¨åœ¨æœ¬åœ°è®¡ç®—ï¼Œä¿æŠ¤æ‚¨çš„éšç§ã€‚
        </p>
    </div>

    <script>
        // --- 1. Language Configuration ---
        const langConfig = {
            "zh-CN": {
                title: "ğŸŒ ä¸–ç•Œæ—¶é’Ÿä¼šè®®ç­–åˆ’è€…",
                subtitle: "è½»æ¾è·¨è¶Šæ—¶åŒºï¼Œå¯»æ‰¾æœ€ä½³çš„å›½é™…ä¼šè®®æ—¶é—´ã€‚",
                labelDate: "é€‰æ‹©æ—¥æœŸ",
                labelCity: "æ·»åŠ åŸå¸‚/æ—¶åŒº",
                btnAdd: "â• æ·»åŠ åŸå¸‚",
                emptyTip: "è¯·ä»ä¸Šæ–¹æ·»åŠ åŸå¸‚ä»¥å¼€å§‹...",
                btnUpdate: "ğŸ”„ åˆ·æ–°è¡¨æ ¼",
                btnClear: "ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰",
                btnSave: "ğŸ“· ä¿å­˜ä¸ºå›¾ç‰‡",
                legendTitle: "å›¾ä¾‹è¯´æ˜",
                legendWork: "å·¥ä½œæ—¶é—´ (09:00 - 17:00)",
                legendStretch: "ä¸€èˆ¬æ—¶é—´ (07-09, 17-22)",
                legendSleep: "ä¼‘æ¯æ—¶é—´ (22:00 - 07:00)",
                introTitle: "å…³äºæ­¤å·¥å…·",
                introText: "è¿™æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„å›½é™…ä¼šè®®æ—¶é—´è§„åˆ’å·¥å…·ã€‚é€šè¿‡é¢œè‰²ç¼–ç ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿè¯†åˆ«å‡ºä½äºä¸åŒæ—¶åŒºçš„å‚ä¸è€…å…±åŒæ–¹ä¾¿çš„æ—¶é—´çª—å£ã€‚ç»¿è‰²åŒºåŸŸä»£è¡¨æ‰€æœ‰äººçš„å·¥ä½œæ—¶é—´é‡å åŒºã€‚",
                savingTip: "æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...",
                confirmClear: "ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å·²é€‰åŸå¸‚å—ï¼Ÿ",
                baseTimeHeader: "åŸºå‡†æ—¶é—´",
                bestTimeLabel: "æœ€ä½³æ¨è",
                addCityFirst: "è¯·é€‰æ‹©ä¸€ä¸ªåŸå¸‚",
                cityAlreadyAdded: "è¯¥åŸå¸‚å·²æ·»åŠ "
            },
            "zh-TW": {
                title: "ğŸŒ ä¸–ç•Œæ™‚é˜æœƒè­°ç­–åŠƒè€…",
                subtitle: "è¼•é¬†è·¨è¶Šæ™‚å€ï¼Œå°‹æ‰¾æœ€ä½³çš„åœ‹éš›æœƒè­°æ™‚é–“ã€‚",
                labelDate: "é¸æ“‡æ—¥æœŸ",
                labelCity: "æ·»åŠ åŸå¸‚/æ™‚å€",
                btnAdd: "â• æ·»åŠ åŸå¸‚",
                emptyTip: "è«‹å¾ä¸Šæ–¹æ·»åŠ åŸå¸‚ä»¥é–‹å§‹...",
                btnUpdate: "ğŸ”„ åˆ·æ–°è¡¨æ ¼",
                btnClear: "ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰",
                btnSave: "ğŸ“· ä¿å­˜ç‚ºåœ–ç‰‡",
                legendTitle: "åœ–ä¾‹èªªæ˜",
                legendWork: "å·¥ä½œæ™‚é–“ (09:00 - 17:00)",
                legendStretch: "ä¸€èˆ¬æ™‚é–“ (07-09, 17-22)",
                legendSleep: "ä¼‘æ¯æ™‚é–“ (22:00 - 07:00)",
                introTitle: "é—œæ–¼æ­¤å·¥å…·",
                introText: "é€™æ˜¯ä¸€å€‹å¯è¦–åŒ–çš„åœ‹éš›æœƒè­°æ™‚é–“è¦åŠƒå·¥å…·ã€‚é€éé¡è‰²ç·¨ç¢¼ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿè­˜åˆ¥å‡ºä½æ–¼ä¸åŒæ™‚å€çš„åƒèˆ‡è€…å…±åŒæ–¹ä¾¿çš„æ™‚é–“çª—å£ã€‚ç¶ è‰²å€åŸŸä»£è¡¨æ‰€æœ‰äººçš„å·¥ä½œæ™‚é–“é‡ç–Šå€ã€‚",
                savingTip: "æ­£åœ¨ç”Ÿæˆåœ–ç‰‡...",
                confirmClear: "ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å·²é¸åŸå¸‚å—ï¼Ÿ",
                baseTimeHeader: "åŸºæº–æ™‚é–“",
                bestTimeLabel: "æœ€ä½³æ¨è–¦",
                addCityFirst: "è«‹é¸æ“‡ä¸€å€‹åŸå¸‚",
                cityAlreadyAdded: "è©²åŸå¸‚å·²æ·»åŠ "
            },
            "en": {
                title: "ğŸŒ World Clock Meeting Planner",
                subtitle: "Find the best time for cross-border meetings with ease.",
                labelDate: "Select Date",
                labelCity: "Add City/Timezone",
                btnAdd: "â• Add City",
                emptyTip: "Add cities from above to start...",
                btnUpdate: "ğŸ”„ Refresh Table",
                btnClear: "ğŸ—‘ï¸ Clear All",
                btnSave: "ğŸ“· Save Image",
                legendTitle: "Legend",
                legendWork: "Working Hours (09:00 - 17:00)",
                legendStretch: "General Hours (07-09, 17-22)",
                legendSleep: "Sleep/Off (22:00 - 07:00)",
                introTitle: "About This Tool",
                introText: "A visual planner for international meetings. Color coding helps you instantly spot overlapping convenient times for participants across different time zones. Green rows indicate the golden time slots.",
                savingTip: "Generating Image...",
                confirmClear: "Clear all selected cities?",
                baseTimeHeader: "Base Time",
                bestTimeLabel: "Best Slot",
                addCityFirst: "Please select a city",
                cityAlreadyAdded: "City already added"
            },
            "ja": {
                title: "ğŸŒ ä¸–ç•Œæ™‚è¨ˆãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼",
                subtitle: "æµ·å¤–ã¨ã®ä¼šè­°ã«æœ€é©ãªæ™‚é–“ã‚’ç°¡å˜ã«è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã™ã€‚",
                labelDate: "æ—¥ä»˜ã‚’é¸æŠ",
                labelCity: "éƒ½å¸‚/ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è¿½åŠ ",
                btnAdd: "â• éƒ½å¸‚ã‚’è¿½åŠ ",
                emptyTip: "ä¸Šè¨˜ã‹ã‚‰éƒ½å¸‚ã‚’è¿½åŠ ã—ã¦ãã ã•ã„...",
                btnUpdate: "ğŸ”„ æ›´æ–°",
                btnClear: "ğŸ—‘ï¸ å…¨æ¶ˆå»",
                btnSave: "ğŸ“· ç”»åƒä¿å­˜",
                legendTitle: "å‡¡ä¾‹",
                legendWork: "å–¶æ¥­æ™‚é–“ (09:00 - 17:00)",
                legendStretch: "é€šå¸¸æ™‚é–“ (07-09, 17-22)",
                legendSleep: "ç¡çœ /æ™‚é–“å¤– (22:00 - 07:00)",
                introTitle: "ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦",
                introText: "å›½éš›ä¼šè­°ã®ãŸã‚ã®è¦–è¦šçš„ãªãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã§ã™ã€‚è‰²åˆ†ã‘ã«ã‚ˆã‚Šã€ç•°ãªã‚‹ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å‚åŠ è€…å…¨å“¡ã«ã¨ã£ã¦éƒ½åˆã®è‰¯ã„æ™‚é–“ã‚’ç¬æ™‚ã«è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ç·‘è‰²ã®è¡Œã¯ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ã‚’ç¤ºã—ã¾ã™ã€‚",
                savingTip: "ç”»åƒã‚’ç”Ÿæˆä¸­...",
                confirmClear: "ã™ã¹ã¦ã®éƒ½å¸‚ã‚’æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ",
                baseTimeHeader: "åŸºæº–æ™‚é–“",
                bestTimeLabel: "æ¨å¥¨",
                addCityFirst: "éƒ½å¸‚ã‚’é¸æŠã—ã¦ãã ã•ã„",
                cityAlreadyAdded: "ã“ã®éƒ½å¸‚ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™"
            },
            "ru": {
                title: "ğŸŒ ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ñ‹Ñ… Ğ²ÑÑ‚Ñ€ĞµÑ‡",
                subtitle: "Ğ›ĞµĞ³ĞºĞ¾ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚Ğµ Ğ»ÑƒÑ‡ÑˆĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ»Ñ Ğ¼ĞµĞ¶Ğ´ÑƒĞ½Ğ°Ñ€Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ²ÑÑ‚Ñ€ĞµÑ‡.",
                labelDate: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ",
                labelCity: "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ñ‡Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ",
                btnAdd: "â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ³Ğ¾Ñ€Ğ¾Ğ´",
                emptyTip: "Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ...",
                btnUpdate: "ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ",
                btnClear: "ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ",
                btnSave: "ğŸ“· Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ",
                legendTitle: "Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ°",
                legendWork: "Ğ Ğ°Ğ±Ğ¾Ñ‡ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ (09:00 - 17:00)",
                legendStretch: "ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ (07-09, 17-22)",
                legendSleep: "Ğ¡Ğ¾Ğ½/ĞĞµÑ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞµ (22:00 - 07:00)",
                introTitle: "ĞĞ± Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğµ",
                introText: "Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ´Ğ»Ñ Ğ¼ĞµĞ¶Ğ´ÑƒĞ½Ğ°Ñ€Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ²ÑÑ‚Ñ€ĞµÑ‡. Ğ¦Ğ²ĞµÑ‚Ğ¾Ğ²Ğ¾Ğµ ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ»Ñ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‡Ğ°ÑĞ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑĞ¾Ğ². Ğ—ĞµĞ»ĞµĞ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ½Ğ° Ğ»ÑƒÑ‡ÑˆĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ.",
                savingTip: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ...",
                confirmClear: "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°?",
                baseTimeHeader: "Ğ‘Ğ°Ğ·. Ğ²Ñ€ĞµĞ¼Ñ",
                bestTimeLabel: "Ğ›ÑƒÑ‡ÑˆĞµĞµ",
                addCityFirst: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´",
                cityAlreadyAdded: "Ğ“Ğ¾Ñ€Ğ¾Ğ´ ÑƒĞ¶Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½"
            }
        };

        // --- 2. Data & Config ---
        // Common Timezones List
        const commonTimezones = [
            { region: "UTC", city: "UTC / GMT", zone: "UTC" },
            { region: "Asia", city: "Beijing / Shanghai", zone: "Asia/Shanghai" },
            { region: "Asia", city: "Hong Kong", zone: "Asia/Hong_Kong" },
            { region: "Asia", city: "Taipei", zone: "Asia/Taipei" },
            { region: "Asia", city: "Tokyo", zone: "Asia/Tokyo" },
            { region: "Asia", city: "Seoul", zone: "Asia/Seoul" },
            { region: "Asia", city: "Singapore", zone: "Asia/Singapore" },
            { region: "Asia", city: "Bangkok", zone: "Asia/Bangkok" },
            { region: "Asia", city: "Dubai", zone: "Asia/Dubai" },
            { region: "Asia", city: "Mumbai (India)", zone: "Asia/Kolkata" },
            { region: "Europe", city: "London", zone: "Europe/London" },
            { region: "Europe", city: "Paris / Berlin / Rome", zone: "Europe/Paris" },
            { region: "Europe", city: "Moscow", zone: "Europe/Moscow" },
            { region: "Europe", city: "Kyiv", zone: "Europe/Kyiv" },
            { region: "Americas", city: "New York (EST)", zone: "America/New_York" },
            { region: "Americas", city: "Los Angeles (PST)", zone: "America/Los_Angeles" },
            { region: "Americas", city: "Chicago (CST)", zone: "America/Chicago" },
            { region: "Americas", city: "Toronto", zone: "America/Toronto" },
            { region: "Americas", city: "Vancouver", zone: "America/Vancouver" },
            { region: "Americas", city: "SÃ£o Paulo", zone: "America/Sao_Paulo" },
            { region: "Pacific", city: "Sydney", zone: "Australia/Sydney" },
            { region: "Pacific", city: "Melbourne", zone: "Australia/Melbourne" },
            { region: "Pacific", city: "Auckland", zone: "Pacific/Auckland" }
        ];

        // State
        let selectedCities = []; // Array of { city, zone }
        let currentLang = 'zh-CN';

        // --- 3. Core Functions ---

        function init() {
            // Set default date to today
            document.getElementById('meetingDate').valueAsDate = new Date();

            // Populate Dropdown
            const select = document.getElementById('timezoneSelect');
            // Sort by region then city
            commonTimezones.sort((a,b) => a.region.localeCompare(b.region) || a.city.localeCompare(b.city));
            
            commonTimezones.forEach(tz => {
                const option = document.createElement('option');
                option.value = tz.zone;
                option.textContent = `[${tz.region}] ${tz.city}`;
                option.dataset.city = tz.city; // Store display name
                select.appendChild(option);
            });

            // Default Load: Beijing & London & New York
            addCity("Asia/Shanghai", "Beijing / Shanghai");
            addCity("Europe/London", "London");
            addCity("America/New_York", "New York (EST)");

            // URL Lang
            const urlLang = getLangFromUrl();
            setLang(urlLang);
        }

        function addCity(zone, cityName) {
            if (selectedCities.some(c => c.zone === zone)) {
                return false; // Already exists
            }
            selectedCities.push({ city: cityName, zone: zone });
            renderCityTags();
            renderTable();
            return true;
        }

        function removeCity(index) {
            selectedCities.splice(index, 1);
            renderCityTags();
            renderTable();
        }

        function renderCityTags() {
            const container = document.getElementById('selectedCitiesContainer');
            container.innerHTML = '';

            if (selectedCities.length === 0) {
                container.innerHTML = `<span style="color: #999; width: 100%; text-align: center; padding: 10px;">${langConfig[currentLang].emptyTip}</span>`;
                return;
            }

            selectedCities.forEach((item, index) => {
                const tag = document.createElement('div');
                tag.className = 'city-tag';
                tag.innerHTML = `${item.city} <span class="remove" onclick="removeCity(${index})">Ã—</span>`;
                container.appendChild(tag);
            });
        }

        function getHourStatus(hour) {
            // 09:00 - 17:00 = Work (Green)
            // 07:00 - 09:00 = Stretch (Yellow)
            // 17:00 - 22:00 = Stretch (Yellow)
            // 22:00 - 07:00 = Sleep (Gray)
            if (hour >= 9 && hour < 17) return 'cell-work';
            if ((hour >= 7 && hour < 9) || (hour >= 17 && hour < 22)) return 'cell-stretch';
            return 'cell-sleep';
        }

        function renderTable() {
            const dateVal = document.getElementById('meetingDate').value;
            if (!dateVal) return;

            const baseDate = new Date(dateVal);
            // Display formatted date title
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('displayDate').textContent = baseDate.toLocaleDateString(currentLang, dateOptions);

            const thead = document.querySelector('#meetingTable thead');
            const tbody = document.getElementById('tableBody');
            thead.innerHTML = '';
            tbody.innerHTML = '';

            if (selectedCities.length === 0) return;

            // 1. Build Header
            let headerHTML = `<tr><th>${langConfig[currentLang].baseTimeHeader}</th>`;
            selectedCities.forEach(c => {
                headerHTML += `<th>${c.city}</th>`;
            });
            headerHTML += `</tr>`;
            thead.innerHTML = headerHTML;

            // 2. Build Rows (0 - 23 hours)
            for (let i = 0; i < 24; i++) {
                const row = document.createElement('tr');
                
                // Base Time Column (using first city's time or just 0-23 index? 
                // Convention: Left column is usually "Base Date Time" or just 00:00 - 23:00)
                // Let's use the Date object set to hour i to format nicely
                const baseTimeObj = new Date(baseDate);
                baseTimeObj.setHours(i, 0, 0, 0);
                
                const timeStr = baseTimeObj.toLocaleTimeString(currentLang, { hour: '2-digit', minute: '2-digit', hour12: false });
                
                let rowHTML = `<td>${timeStr}</td>`;
                
                let workCount = 0; // Count how many cities are in "Work" status
                let totalScore = 0; // Higher is better

                selectedCities.forEach(city => {
                    // Calculate time in that zone
                    // We use Intl.DateTimeFormat to shift the date to that timezone
                    const localTimeStr = baseTimeObj.toLocaleTimeString('en-US', { timeZone: city.zone, hour12: false, hour: 'numeric' });
                    const localHour = parseInt(localTimeStr); // 0-23

                    // Format full string for display
                    const displayTime = baseTimeObj.toLocaleTimeString(currentLang, { timeZone: city.zone, hour: '2-digit', minute: '2-digit', hour12: false });
                    
                    // Determine Status
                    const statusClass = getHourStatus(localHour);
                    if (statusClass === 'cell-work') { workCount++; totalScore += 2; }
                    else if (statusClass === 'cell-stretch') { totalScore += 1; }

                    rowHTML += `<td class="${statusClass}">${displayTime}</td>`;
                });

                row.innerHTML = rowHTML;

                // Highlight Best Row (if all are working, or mostly working)
                // Simple heuristic: if score is high relative to city count
                if (workCount === selectedCities.length && selectedCities.length > 0) {
                    row.classList.add('best-time');
                }

                tbody.appendChild(row);
            }
        }

        // --- 4. Event Listeners ---
        
        document.getElementById('btnAddCity').addEventListener('click', () => {
            const select = document.getElementById('timezoneSelect');
            const zone = select.value;
            const text = select.options[select.selectedIndex].text;
            // extract city name only from "[Region] City"
            const cityName = select.options[select.selectedIndex].dataset.city; 

            if (!addCity(zone, cityName)) {
                alert(langConfig[currentLang].cityAlreadyAdded);
            }
        });

        document.getElementById('btnClear').addEventListener('click', () => {
            if (confirm(langConfig[currentLang].confirmClear)) {
                selectedCities = [];
                renderCityTags();
                renderTable();
            }
        });

        document.getElementById('btnUpdate').addEventListener('click', renderTable);
        document.getElementById('meetingDate').addEventListener('change', renderTable);

        // Language Switch Logic (Same as template)
        function updateUrlLang(lang) {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                urlParams.set('lang', lang);
                window.history.replaceState({}, '', `${window.location.pathname}?${urlParams.toString()}`);
            } catch (e) { }
        }

        function getLangFromUrl() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const lang = urlParams.get('lang');
                return lang && langConfig[lang] ? lang : 'zh-CN';
            } catch(e) { return 'zh-CN'; }
        }

        function setLang(lang) {
            currentLang = lang;
            // Update Text
            document.querySelectorAll('[data-key]').forEach(el => {
                if (el.tagName === 'INPUT' && el.type === 'text') {
                    // placeholder logic if needed
                } else {
                    el.innerText = langConfig[lang][el.dataset.key];
                }
            });
            // Update Active Button
            document.querySelectorAll('.lang-switch button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // Re-render empty tip if needed
            if (selectedCities.length === 0) renderCityTags();
            // Re-render table for date formats
            renderTable();
            updateUrlLang(lang);
            document.title = langConfig[lang].title;
        }

        document.querySelectorAll('.lang-switch button').forEach(btn => {
            btn.addEventListener('click', () => setLang(btn.dataset.lang));
        });

        // Screenshot
        document.getElementById('btnSaveImg').addEventListener('click', () => {
            const loadingTip = document.getElementById('loadingTip');
            loadingTip.style.display = 'block';
            loadingTip.textContent = langConfig[currentLang].savingTip;
            
            const tableEl = document.getElementById('tableToSave');
            const originalOverflow = tableEl.style.overflow;
            tableEl.style.overflow = 'visible'; // Ensure full capture

            html2canvas(tableEl, { scale: 2, backgroundColor: '#ffffff' }).then(canvas => {
                tableEl.style.overflow = originalOverflow;
                loadingTip.style.display = 'none';
                const link = document.createElement('a');
                link.download = `Meeting_Plan_${new Date().toISOString().slice(0,10)}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(err => {
                loadingTip.style.display = 'none';
                alert('Error generating image.');
            });
        });

        // Init
        window.addEventListener('DOMContentLoaded', init);

    </script>
    
    <!-- 4. ç»“å°¾å¿…é¡»åŒ…å«çš„ä»£ç  -->
    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
</body>
</html>