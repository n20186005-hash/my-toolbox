<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HD Dot Matrix World Map</title>
    
    <!-- Meta Info -->
    <meta name="tool-id" content="timezone_map_hd_dots">
    <meta name="category" content="date-time">
    <meta name="icon" content="ğŸŒ">
    <meta name="title" content="High-Def Dot Matrix World Map">
    <meta name="description" content="A high-resolution dot matrix world map rendering real-time daylight zones and city times.">

    <!-- Multilingual Meta -->
    <meta name="lang-title-zh-CN" content="é«˜æ¸…ä¸–ç•Œæ—¶åŒºç‚¹é˜µåœ°å›¾">
    <meta name="lang-description-zh-CN" content="é«˜åˆ†è¾¨ç‡çš„ç‚¹é˜µé£æ ¼ä¸–ç•Œåœ°å›¾ï¼Œå®æ—¶æ¸²æŸ“æ˜¼å¤œåˆ†å¸ƒåŠå…¨çƒåŸå¸‚æ—¶é—´ã€‚">
    <meta name="lang-title-ja" content="é«˜è§£åƒåº¦ãƒ‰ãƒƒãƒˆä¸–ç•Œåœ°å›³">
    <meta name="lang-title-ru" content="HD Ğ¢Ğ¾Ñ‡ĞµÑ‡Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ğ¼Ğ¸Ñ€Ğ°">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            /* æ·±è‰²æ¨¡å¼é…è‰²ï¼Œæ›´æ˜¾ç§‘æŠ€æ„Ÿå’Œå¯¹æ¯”åº¦ */
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            
            --dot-day: #38bdf8;      /* ç™½æ˜¼ç‚¹é¢œè‰² (äº®è“) */
            --dot-night: #1e3a8a;    /* é»‘å¤œç‚¹é¢œè‰² (æ·±è“) */
            --dot-grid: #334155;     /* è¾…åŠ©ç½‘æ ¼ç‚¹ (ææ·¡) */
            
            --city-bg: #ef4444;      /* åŸå¸‚ç‚¹çº¢ */
            --city-glow: rgba(239, 68, 68, 0.6);
        }

        body { 
            background: var(--bg-body); 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 20px;
            color: var(--text-main);
        }

        .tool-container {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            max-width: 1200px;
            margin: 0 auto;
            border: 1px solid #334155;
        }

        /* æ ‡é¢˜åŒº */
        h2 { text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        /* åœ°å›¾ç”»å¸ƒå®¹å™¨ */
        .map-stage {
            position: relative;
            width: 100%;
            /* 2:1 æ¯”ä¾‹ */
            padding-bottom: 50%; 
            background: #020617; /* ææ·±è“é»‘èƒŒæ™¯ */
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #334155;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
            cursor: crosshair;
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }

        /* åŸå¸‚æ ‡è®° (HTMLå±‚) */
        .city-marker {
            position: absolute;
            width: 8px; height: 8px;
            background: var(--city-bg);
            border: 1.5px solid #fff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            cursor: pointer;
            box-shadow: 0 0 8px var(--city-glow);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .city-marker:hover {
            transform: translate(-50%, -50%) scale(1.8);
            box-shadow: 0 0 15px var(--city-bg);
            z-index: 20;
            border-color: #fff;
        }
        /* åŸå¸‚åç§°æ ‡ç­¾ (é»˜è®¤éšè—ï¼Œhoveræ˜¾ç¤º) */
        .city-label {
            position: absolute;
            top: 12px; left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        .city-marker:hover .city-label { opacity: 1; }

        /* Tooltip */
        .map-tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            color: #f8fafc;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            z-index: 50;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.15);
            white-space: nowrap;
            transform: translate(-50%, -120%);
            backdrop-filter: blur(8px);
        }
        .map-tooltip::after {
            content: ''; position: absolute; top: 100%; left: 50%; margin-left: -6px;
            border-width: 6px; border-style: solid;
            border-color: rgba(15, 23, 42, 0.95) transparent transparent transparent;
        }
        .clock-highlight { color: #38bdf8; font-weight: 700; font-family: monospace; font-size: 1.25em; margin: 4px 0; }
        .date-sub { color: #94a3b8; font-size: 0.9em; }

        /* åº•éƒ¨æ—¶åŒºæ¡ */
        .timezone-strip {
            display: flex;
            margin-top: 24px;
            border: 1px solid #334155;
            border-radius: 8px;
            overflow: hidden;
            background: #0f172a;
        }
        .tz-cell {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            border-right: 1px solid #1e293b;
            font-size: 11px;
            color: #64748b;
            transition: background 0.2s;
            cursor: default;
        }
        .tz-cell:last-child { border: none; }
        .tz-cell:hover { background: #1e293b; color: #cbd5e1; }
        .tz-cell.active-utc { background: #1e3a8a; color: #bfdbfe; font-weight: bold; border-top: 2px solid #3b82f6; }
        .tz-offset { font-size: 9px; opacity: 0.6; margin-bottom: 2px; }

        /* ä¸‹æ‹‰èœå•ç¾åŒ– */
        select {
            background-color: #334155;
            color: white;
            border: 1px solid #475569;
        }
        
        .loading-overlay {
            position: absolute; inset:0; background:#020617; z-index:40; display:flex; justify-content:center; align-items:center;
            color: #38bdf8; font-size: 14px; transition: opacity 0.5s;
        }
    </style>
</head>
<body>

<div class="tool-container">
    
    <!-- é¡¶éƒ¨ -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
        <div>
            <h2 class="text-2xl font-bold text-white flex items-center gap-3">
                <span class="text-blue-500 text-3xl">ğŸŒ</span>
                <span data-i18n="title">High-Def Dot Matrix Map</span>
            </h2>
            <p class="text-gray-400 text-sm mt-1" data-i18n="subtitle">Real-time daylight visualization â€¢ 25,000+ Data Points</p>
        </div>
        
        <div class="flex items-center gap-4">
            <div class="px-4 py-2 bg-slate-800 rounded-lg border border-slate-700 flex flex-col items-center min-w-[100px]">
                <div class="text-[10px] text-gray-400 font-bold tracking-wider uppercase">UTC Time</div>
                <div id="utc-display" class="font-mono font-bold text-xl text-blue-400 leading-none mt-1">--:--</div>
            </div>
            
            <select id="lang-select" onchange="WorldMap.changeLang()" class="px-3 py-2 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer">
                <option value="en">English</option>
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>
    </div>

    <!-- åœ°å›¾æ ¸å¿ƒ -->
    <div class="map-stage" id="map-stage">
        <div id="loading" class="loading-overlay">Generating Map Data...</div>
        <canvas id="map-canvas"></canvas>
        <div id="cities-layer"></div>
        <div id="tooltip" class="map-tooltip"></div>
    </div>

    <!-- åº•éƒ¨æ—¶åŒºæ¡ -->
    <div class="timezone-strip" id="tz-strip"></div>

    <!-- å›¾ä¾‹ -->
    <div class="flex justify-center gap-8 mt-6 text-xs text-gray-400 font-medium">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#38bdf8] shadow-[0_0_8px_#38bdf8]"></div>
            <span data-i18n="day">Daylight</span>
        </div>
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#1e3a8a] border border-[#334155]"></div>
            <span data-i18n="night">Night</span>
        </div>
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#ef4444] border border-white"></div>
            <span data-i18n="city">Major City</span>
        </div>
    </div>

</div>

<script>
/**
 * çŸ¢é‡åœ°ç†æ•°æ® (ç®€åŒ–ç‰ˆä½†é«˜ç²¾åº¦å¤šè¾¹å½¢)
 * æ ¼å¼: [ [x,y], [x,y]... ] å½’ä¸€åŒ–åæ ‡ 0-1000
 */
const geoPolygons = [
    // North America (Complex)
    [[160,50],[200,50],[250,30],[300,50],[320,100],[280,150],[250,200],[230,220],[200,200],[180,210],[150,180],[100,120],[80,80],[120,60]], 
    [[180,210],[210,240],[220,260],[200,250],[190,230]], // Mexico tip
    [[250,30],[350,20],[400,10],[380,80],[320,100]], // Greenland/Islands
    
    // South America
    [[240,260],[280,260],[320,300],[350,350],[340,400],[300,480],[280,500],[260,450],[240,350],[230,300]],
    
    // Europe (Rough but recognizable)
    [[450,80],[500,70],[550,80],[530,130],[500,140],[480,130],[460,110],[440,100]], // Mainland
    [[420,90],[440,90],[440,110],[430,120],[420,110]], // UK
    
    // Africa
    [[440,150],[500,150],[550,160],[600,200],[620,250],[580,350],[550,420],[500,380],[460,300],[430,200]],
    [[600,200],[640,210],[630,230]], // Horn
    
    // Asia
    [[550,80],[650,70],[800,70],[900,80],[950,100],[920,150],[880,180],[850,220],[800,250],[750,280],[700,250],[650,200],[600,160]], // Main
    [[750,280],[780,320],[800,300]], // India
    [[850,220],[880,260],[900,250]], // SE Asia
    [[920,130],[950,140],[940,160],[920,150]], // Japan
    
    // Australia & Islands
    [[850,350],[950,350],[960,420],[900,450],[850,420],[840,380]],
    [[970,450],[990,480],[980,490],[960,460]], // NZ
    [[800,300],[850,300],[860,320],[800,310]] // Indonesia
];

const cities = [
    { n: "Beijing", tz: "Asia/Shanghai", lat: 39.9, lon: 116.4 },
    { n: "Tokyo", tz: "Asia/Tokyo", lat: 35.6, lon: 139.7 },
    { n: "London", tz: "Europe/London", lat: 51.5, lon: -0.1 },
    { n: "New York", tz: "America/New_York", lat: 40.7, lon: -74.0 },
    { n: "San Francisco", tz: "America/Los_Angeles", lat: 37.7, lon: -122.4 },
    { n: "Sydney", tz: "Australia/Sydney", lat: -33.8, lon: 151.2 },
    { n: "Moscow", tz: "Europe/Moscow", lat: 55.7, lon: 37.6 },
    { n: "Dubai", tz: "Asia/Dubai", lat: 25.2, lon: 55.3 },
    { n: "Paris", tz: "Europe/Paris", lat: 48.8, lon: 2.3 },
    { n: "Berlin", tz: "Europe/Berlin", lat: 52.5, lon: 13.4 },
    { n: "Singapore", tz: "Asia/Singapore", lat: 1.3, lon: 103.8 },
    { n: "Rio de Janeiro", tz: "America/Sao_Paulo", lat: -22.9, lon: -43.2 },
    { n: "Cape Town", tz: "Africa/Johannesburg", lat: -33.9, lon: 18.4 },
    { n: "New Delhi", tz: "Asia/Kolkata", lat: 28.6, lon: 77.2 },
    { n: "Cairo", tz: "Africa/Cairo", lat: 30.0, lon: 31.2 },
    { n: "Bangkok", tz: "Asia/Bangkok", lat: 13.7, lon: 100.5 },
    { n: "Honolulu", tz: "Pacific/Honolulu", lat: 21.3, lon: -157.8 },
    { n: "Vancouver", tz: "America/Vancouver", lat: 49.2, lon: -123.1 }
];

const WorldMap = {
    cols: 240, // Horizontal dots (High Res)
    rows: 120, // Vertical dots
    dotMap: [], // Stores {x, y, isLand} for all dots
    
    canvas: null,
    ctx: null,
    
    i18n: {
        'en': { title: 'High-Def Dot Matrix Map', subtitle: 'Real-time daylight visualization â€¢ 25,000+ Data Points', day: 'Daylight', night: 'Night', city: 'Major City' },
        'zh-CN': { title: 'é«˜æ¸…ä¸–ç•Œæ—¶åŒºç‚¹é˜µåœ°å›¾', subtitle: 'å®æ—¶æ˜¼å¤œå¯è§†åŒ– â€¢ 25,000+ æ•°æ®ç‚¹', day: 'ç™½æ˜¼', night: 'é»‘å¤œ', city: 'ä¸»è¦åŸå¸‚' },
        'zh-TW': { title: 'é«˜æ¸…ä¸–ç•Œæ™‚å€é»é™£åœ°åœ–', subtitle: 'å¯¦æ™‚æ™å¤œå¯è¦–åŒ– â€¢ 25,000+ æ•¸æ“šé»', day: 'ç™½æ™', night: 'é»‘å¤œ', city: 'ä¸»è¦åŸå¸‚' },
        'ja': { title: 'é«˜è§£åƒåº¦ãƒ‰ãƒƒãƒˆä¸–ç•Œåœ°å›³', subtitle: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ˜¼å¤œè¡¨ç¤º â€¢ 25,000+ ãƒã‚¤ãƒ³ãƒˆ', day: 'æ˜¼', night: 'å¤œ', city: 'ä¸»è¦éƒ½å¸‚' },
        'ru': { title: 'HD Ğ¢Ğ¾Ñ‡ĞµÑ‡Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ğ¼Ğ¸Ñ€Ğ°', subtitle: 'Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ½Ñ/Ğ½Ğ¾Ñ‡Ğ¸ â€¢ 25,000+ Ñ‚Ğ¾Ñ‡ĞµĞº', day: 'Ğ”ĞµĞ½ÑŒ', night: 'ĞĞ¾Ñ‡ÑŒ', city: 'Ğ“Ğ¾Ñ€Ğ¾Ğ´' }
    },

    init: () => {
        WorldMap.canvas = document.getElementById('map-canvas');
        WorldMap.ctx = WorldMap.canvas.getContext('2d');
        
        // 1. Generate the Dot Grid based on Polygons (Rasterization)
        // This runs once on load
        setTimeout(() => {
            WorldMap.generateMapData();
            document.getElementById('loading').style.opacity = 0;
            setTimeout(() => document.getElementById('loading').remove(), 500);
            
            // 2. Start Loop
            
            WorldMap.detectLang();
            
            // FIX: Render cities BEFORE resizing/positioning them
            WorldMap.renderCities(); 
            
            // Now safe to resize and position
            WorldMap.resize();
            window.addEventListener('resize', WorldMap.resize);
            
            WorldMap.tick();
            setInterval(WorldMap.tick, 1000); // Clock
            setInterval(WorldMap.draw, 1000 * 60); // Map Shadow update (1 min)
            
        }, 100); // Slight delay to allow UI to paint loading state
    },

    detectLang: () => {
        try {
            const p = new URLSearchParams(location.search);
            const l = p.get('lang') || navigator.language;
            let t = 'en';
            if(l.includes('zh')) t = (l.includes('TW')||l.includes('HK')) ? 'zh-TW' : 'zh-CN';
            else if(l.includes('ja')) t = 'ja';
            else if(l.includes('ru')) t = 'ru';
            document.getElementById('lang-select').value = t;
            WorldMap.changeLang();
        } catch(e) {}
    },

    changeLang: () => {
        const lang = document.getElementById('lang-select').value;
        const txt = WorldMap.i18n[lang];
        
        try {
            const u = new URL(location); u.searchParams.set('lang', lang);
            history.replaceState({},'',u);
        } catch(e) {}

        document.querySelectorAll('[data-i18n]').forEach(e => {
            const k = e.dataset.i18n;
            if(txt[k]) e.innerText = txt[k];
        });
        WorldMap.tick(); 
    },

    // --- Core Algorithm: Point in Polygon Rasterizer ---
    generateMapData: () => {
        const data = [];
        // Coordinate system for polygons is 0-1000
        // We map our grid (cols x rows) to this 1000x500 space
        
        for(let r=0; r<WorldMap.rows; r++) {
            for(let c=0; c<WorldMap.cols; c++) {
                // Map grid to geo space (0-1000, 0-500)
                const gx = (c / WorldMap.cols) * 1000;
                const gy = (r / WorldMap.rows) * 500;
                
                // Check if this point is inside any continent polygon
                let isLand = false;
                for(let poly of geoPolygons) {
                    if(WorldMap.pointInPoly(gx, gy, poly)) {
                        isLand = true;
                        break;
                    }
                }
                
                // Only store land dots to save memory/perf? 
                // No, we might want faint ocean dots. Let's store land status.
                // Storing normalized coords 0-1
                data.push({
                    x: c / WorldMap.cols,
                    y: r / WorldMap.rows,
                    isLand: isLand,
                    lon: (c / WorldMap.cols) * 360 - 180 // For daylight calc
                });
            }
        }
        WorldMap.dotMap = data;
    },

    // Ray-casting algorithm
    pointInPoly: (x, y, poly) => {
        let inside = false;
        for (let i = 0, j = poly.length - 1; i < poly.length; j = i++) {
            const xi = poly[i][0], yi = poly[i][1];
            const xj = poly[j][0], yj = poly[j][1];
            
            const intersect = ((yi > y) != (yj > y))
                && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
            if (intersect) inside = !inside;
        }
        return inside;
    },

    resize: () => {
        const stage = document.getElementById('map-stage');
        if (!stage) return;
        const rect = stage.getBoundingClientRect();
        
        // High DPI support
        const dpr = window.devicePixelRatio || 1;
        WorldMap.canvas.width = rect.width * dpr;
        WorldMap.canvas.height = rect.height * dpr;
        
        WorldMap.ctx.scale(dpr, dpr);
        
        WorldMap.draw();
        WorldMap.updateCityPositions();
    },

    draw: () => {
        if(WorldMap.dotMap.length === 0) return;
        
        const ctx = WorldMap.ctx;
        const rect = document.getElementById('map-stage').getBoundingClientRect();
        const w = rect.width;
        const h = rect.height;
        const now = new Date();

        // 1. Clear
        ctx.clearRect(0, 0, w, h);

        // 2. Calc Sun Position
        const utcH = now.getUTCHours() + now.getUTCMinutes()/60;
        let sunLon = (12 - utcH) * 15;
        // Normalize sunLon to -180 to 180
        if(sunLon > 180) sunLon -= 360; 
        if(sunLon <= -180) sunLon += 360;

        // 3. Draw Dots
        // Dot size depends on canvas width
        const dotSize = (w / WorldMap.cols) * 0.55; 
        
        // Iterate all 28,000 dots
        for(let i=0; i<WorldMap.dotMap.length; i++) {
            const dot = WorldMap.dotMap[i];
            
            if(!dot.isLand) continue; // Skip ocean for cleaner look (or draw faint)
            
            // Calculate Day/Night
            let diff = Math.abs(dot.lon - sunLon);
            if(diff > 180) diff = 360 - diff;
            
            const isNight = diff > 85; // Twilight zone approx
            
            ctx.fillStyle = isNight ? '#1e3a8a' : '#38bdf8'; // Dark Blue vs Cyan
            ctx.globalAlpha = isNight ? 0.3 : 0.9; // Night dots are dimmer
            
            const px = dot.x * w;
            const py = dot.y * h;
            
            ctx.beginPath();
            ctx.arc(px, py, dotSize, 0, Math.PI*2);
            ctx.fill();
        }
        ctx.globalAlpha = 1.0;

        // 4. Draw Timezone Grid (Subtle lines)
        ctx.strokeStyle = 'rgba(255,255,255,0.03)';
        ctx.lineWidth = 1;
        for(let i=1; i<24; i++) {
            const x = (i/24) * w;
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, h);
            ctx.stroke();
        }
    },

    renderCities: () => {
        const container = document.getElementById('cities-layer');
        if (!container) return;
        container.innerHTML = '';
        cities.forEach(city => {
            const el = document.createElement('div');
            el.className = 'city-marker';
            el.innerHTML = `<div class="city-label">${city.n}</div>`;
            
            // Events
            el.addEventListener('mouseenter', (e) => WorldMap.showTooltip(e, city));
            el.addEventListener('mousemove', WorldMap.moveTooltip);
            el.addEventListener('mouseleave', WorldMap.hideTooltip);
            
            container.appendChild(el);
        });
        // We do NOT call updateCityPositions here immediately if it's called by init, 
        // because updateCityPositions relies on map-stage dimensions which might be calculating.
        // But resize() calls it anyway.
    },

    updateCityPositions: () => {
        const stage = document.getElementById('map-stage');
        if (!stage) return;
        
        const markers = document.querySelectorAll('.city-marker');
        // If markers are empty, it means renderCities hasn't run yet or failed.
        if (markers.length === 0) return; 
        
        cities.forEach((city, i) => {
            const el = markers[i];
            if (!el) return; // FIX: Guard clause
            
            const xPct = (city.lon + 180) / 360;
            const yPct = (90 - city.lat) / 180;
            
            el.style.left = (xPct * 100) + '%';
            el.style.top = (yPct * 100) + '%';
        });
    },

    tick: () => {
        const now = new Date();
        // Update Top Clock
        document.getElementById('utc-display').innerText = now.toUTCString().split(' ')[4].substring(0,5);
        
        // Update Strip
        WorldMap.renderStrip(now);
    },

    renderStrip: (now) => {
        const container = document.getElementById('tz-strip');
        if (!container) return;
        const utcH = now.getUTCHours();
        let html = '';
        
        for(let offset=-11; offset<=12; offset++) {
            let h = utcH + offset;
            if(h >= 24) h -= 24;
            if(h < 0) h += 24;
            
            const isUtc = offset === 0;
            html += `
                <div class="tz-cell ${isUtc?'active-utc':''}">
                    <div class="tz-offset">${offset>0?'+'+offset:offset}</div>
                    <div>${h}:00</div>
                </div>
            `;
        }
        container.innerHTML = html;
    },

    showTooltip: (e, city) => {
        const tip = document.getElementById('tooltip');
        const lang = document.getElementById('lang-select').value;
        const now = new Date();
        
        const timeStr = now.toLocaleTimeString('en-US', { timeZone: city.tz, hour:'2-digit', minute:'2-digit', hour12:false });
        const dateStr = now.toLocaleDateString('en-US', { timeZone: city.tz, weekday:'short', month:'short', day:'numeric' });
        const gmt = now.toLocaleString('en-US', {timeZone:city.tz, timeZoneName:'shortOffset'}).split('GMT')[1] || '+0';

        // Translation fallback (Demo purpose)
        let name = city.n;
        if(lang.startsWith('zh')) {
            const zhMap = {'New York':'çº½çº¦','London':'ä¼¦æ•¦','Tokyo':'ä¸œäº¬','Beijing':'åŒ—äº¬','Sydney':'æ‚‰å°¼','Moscow':'è«æ–¯ç§‘','Dubai':'è¿ªæ‹œ','Paris':'å·´é»','Singapore':'æ–°åŠ å¡','Los Angeles':'æ´›æ‰çŸ¶','San Francisco':'æ—§é‡‘å±±'};
            if(zhMap[name]) name = zhMap[name];
        }

        tip.innerHTML = `
            <div class="font-bold text-slate-200">${name}</div>
            <div class="clock-highlight">${timeStr}</div>
            <div class="date-sub">${dateStr} â€¢ UTC${gmt}</div>
        `;
        tip.style.display = 'block';
        WorldMap.moveTooltip(e);
    },

    moveTooltip: (e) => {
        const tip = document.getElementById('tooltip');
        const rect = document.getElementById('map-stage').getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        tip.style.left = x + 'px';
        tip.style.top = y + 'px';
    },
    
    hideTooltip: () => {
        document.getElementById('tooltip').style.display = 'none';
    }
};

window.addEventListener('DOMContentLoaded', WorldMap.init);
</script>

<!-- ç»“å°¾å¿…é¡»åŒ…å«çš„ä»£ç  -->
<div id="related-tools-container"></div>
<script src="/scripts/related.js"></script>
</body>
</html>