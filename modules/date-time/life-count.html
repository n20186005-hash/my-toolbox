<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="category" content="Date & Time">
    <meta name="icon" content="ğŸ“…">
    <title>Life Count Calendar - äººç”Ÿå°æ ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .tool-module { background: white; padding: 24px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); max-width: 1100px; margin: 0 auto; position: relative; }
        
        /* æ ¸å¿ƒä¿®å¾©ï¼šç¶²æ ¼ä½ˆå±€æ”¹ç‚º 13 åˆ— (1åˆ—å¹´ä»½ + 12åˆ—æœˆä»½) */
        .life-grid { 
            display: grid; 
            /* å¹´ä»½å¯¬åº¦å›ºå®šï¼Œæœˆä»½è‡ªé©æ‡‰ */
            grid-template-columns: 40px repeat(12, 1fr); 
            gap: 3px; 
            margin-top: 20px; 
        }

        .year-label { 
            text-align: right; 
            padding-right: 8px; 
            font-size: 0.75rem; 
            color: #94a3b8; 
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        /* æ‰‹æ©Ÿé©é…ï¼šå¹´ä»½æ¯5å¹´é¡¯ç¤ºä¸€æ¬¡ï¼Œæˆ–è€…ç¸®å°å­—é«” */
        @media (max-width: 640px) {
            .life-grid { gap: 1px; }
            .year-label { font-size: 0.6rem; padding-right: 4px; }
        }

        .month-cell { 
            aspect-ratio: 1; 
            border-radius: 2px; 
            background: #f1f5f9; 
            transition: all 0.2s; 
            position: relative;
        }
        
        .month-cell:hover {
            transform: scale(1.3);
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* é¡è‰²ä¸»é¡Œ */
        .month-past { background: #cbd5e1; } /* éå»ï¼šç°è‰² */
        .month-past-active { background: #3b82f6; } /* éå»ï¼ˆæ´»èºæœŸï¼‰ï¼šè—è‰² - å¯é¸æ“´å±• */
        
        /* ç•¶å‰æœˆä»½ */
        .month-current { 
            background: #ef4444; 
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
            animation: pulse 2s infinite;
        }

        /* æœªä¾† */
        .month-future { background: #e2e8f0; }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 4px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .summary-card {
            background: linear-gradient(to right, #ecfdf5, #f0fdf4);
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            padding: 20px;
        }

        .intro-section { margin-top: 30px; padding: 20px; background-color: #f8fafc; border-radius: 8px; font-size: 0.95rem; color: #475569; border: 1px dashed #cbd5e1; }
        
        button.btn-primary { 
            background: #22c55e; color: white; border: none; padding: 10px 24px; 
            border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(34, 197, 94, 0.2);
        }
        button.btn-primary:hover { background: #16a34a; transform: translateY(-1px); }
        button.btn-primary:active { transform: translateY(0); }

        input, select { 
            transition: border-color 0.2s; 
            background-color: #fff;
        }
        input:focus, select:focus { border-color: #22c55e; box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1); }
        
        /* Tooltip */
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 4px 8px;
            background: rgba(0,0,0,0.8);
            color: white;
            font-size: 12px;
            border-radius: 4px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 20;
            margin-bottom: 5px;
        }
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/date-time/life-count.html" />
</head>
<body>
    <div class="tool-module" id="life-count-tool">
        <!-- Language Selector -->
        <div class="absolute top-6 right-6 z-10">
            <select id="lang-selector" onchange="LifeCount.changeLang()" class="text-xs border border-gray-300 rounded-md py-1 px-2 bg-gray-50 text-gray-600 focus:outline-none cursor-pointer">
                <option value="zh-TW" selected>ç¹é«”ä¸­æ–‡</option>
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="en">English</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>

        <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center gap-2">
            <span class="text-3xl">ğŸ“…</span> 
            <span data-i18n="title">äººç”Ÿå°æ ¼æ—¥æ›†</span>
        </h2>

        <div class="space-y-8">
            <!-- Input Section -->
            <div class="bg-white rounded-xl">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="birth_date">å‡ºç”Ÿæ—¥æœŸ</label>
                        <input type="date" id="birth_date" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 focus:outline-none" onchange="LifeCount.calculate()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="life_expectancy">é æœŸå£½å‘½ (æ­²)</label>
                        <input type="number" id="life_expectancy" value="80" min="1" max="120" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 focus:outline-none" oninput="LifeCount.calculate()">
                    </div>
                    <div>
                        <button onclick="LifeCount.calculate()" class="btn-primary w-full md:w-auto" data-i18n="generate_calendar">æ›´æ–°åœ–è¡¨</button>
                    </div>
                </div>
            </div>

            <!-- Summary -->
            <div class="summary-card grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div class="p-2">
                    <div class="text-xs text-green-600 font-medium uppercase tracking-wider mb-1" data-i18n="summary_age">ç•¶å‰å¹´é½¡</div>
                    <div class="text-2xl font-bold text-gray-800" id="summary_age">--</div>
                </div>
                <div class="p-2 border-l border-green-200">
                    <div class="text-xs text-green-600 font-medium uppercase tracking-wider mb-1" data-i18n="summary_months_lived">å·²ç”Ÿæ´»æœˆæ•¸</div>
                    <div class="text-2xl font-bold text-gray-600" id="summary_months_lived">--</div>
                </div>
                <div class="p-2 border-l border-green-200">
                    <div class="text-xs text-green-600 font-medium uppercase tracking-wider mb-1" data-i18n="summary_months_remaining">å‰©é¤˜æœˆæ•¸</div>
                    <div class="text-2xl font-bold text-blue-600" id="summary_months_remaining">--</div>
                </div>
                <div class="p-2 border-l border-green-200">
                    <div class="text-xs text-green-600 font-medium uppercase tracking-wider mb-1" data-i18n="summary_percentage">äººç”Ÿé€²åº¦</div>
                    <div class="text-2xl font-bold text-purple-600" id="summary_percentage">--</div>
                </div>
            </div>

            <!-- Life Grid Visualization -->
            <div>
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2" data-i18n="life_calendar">
                        ä½ çš„äººç”Ÿæ—¥æ›† 
                        <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded-full ml-2">1 æ ¼ = 1 å€‹æœˆ</span>
                    </h3>
                    <div class="flex gap-4 text-xs">
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-slate-300 rounded-sm"></div> <span data-i18n="legend_past">éå»</span></div>
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-red-500 rounded-sm animate-pulse"></div> <span data-i18n="legend_present">ç¾åœ¨</span></div>
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-slate-100 border border-slate-200 rounded-sm"></div> <span data-i18n="legend_future">æœªä¾†</span></div>
                    </div>
                </div>
                
                <div id="life_grid" class="life-grid">
                    <!-- Grid generated by JS -->
                </div>
            </div>

            <!-- Intro -->
            <div class="intro-section">
                <h3 class="font-bold mb-2 text-gray-700" data-i18n="intro_title">é—œæ–¼æœ¬å·¥å…·</h3>
                <p class="leading-relaxed" data-i18n="intro_text">
                    å¦‚æœæˆ‘å€‘æ´»åˆ° 80 æ­²ï¼Œäººç”Ÿå¤§ç´„åªæœ‰ 960 å€‹æœˆã€‚
                    <br>é€™å¼µè¡¨æ ¼å°‡ä½ çš„ä¸€ç”Ÿè¦–è¦ºåŒ–ã€‚æ¯ä¸€å€‹æ ¼å­ä»£è¡¨ä¸€å€‹æœˆã€‚
                    <br>ç°è‰²çš„æ ¼å­æ˜¯ä½ å·²ç¶“åº¦éçš„æ™‚å…‰ï¼Œå½©è‰²çš„æ ¼å­ä»£è¡¨ç•¶ä¸‹ï¼Œç™½è‰²çš„æ ¼å­å‰‡æ˜¯å……æ»¿å¯èƒ½æ€§çš„æœªä¾†ã€‚
                    <br>çœ‹è‘—é€™äº›æ ¼å­ï¼Œæˆ–è¨±èƒ½è®“æˆ‘å€‘æ›´æ¸…æ™°åœ°æ„Ÿå—åˆ°æ™‚é–“çš„æµé€ï¼Œå¾è€Œæ›´çæƒœçœ¼å‰çš„æ¯ä¸€å¤©ã€‚
                </p>
            </div>
        </div>
    </div>

    <script>
        const LifeCount = {
            i18n: {
                'zh-TW': {
                    title: 'äººç”Ÿå°æ ¼æ—¥æ›†',
                    birth_date: 'å‡ºç”Ÿæ—¥æœŸ',
                    life_expectancy: 'é æœŸå£½å‘½ (æ­²)',
                    generate_calendar: 'æ›´æ–°åœ–è¡¨',
                    life_calendar: 'ä½ çš„äººç”Ÿæ—¥æ›†',
                    legend_past: 'å·²é€',
                    legend_present: 'ç•¶ä¸‹',
                    legend_future: 'æœªä¾†',
                    summary_age: 'ç•¶å‰å¹´é½¡',
                    summary_months_lived: 'å·²ç”Ÿæ´»æœˆæ•¸',
                    summary_months_remaining: 'å‰©é¤˜æœˆæ•¸',
                    summary_percentage: 'äººç”Ÿé€²åº¦',
                    intro_title: 'é—œæ–¼æœ¬å·¥å…·',
                    intro_text: 'å¦‚æœæˆ‘å€‘æ´»åˆ° 80 æ­²ï¼Œäººç”Ÿå¤§ç´„åªæœ‰ 960 å€‹æœˆã€‚é€™å¼µè¡¨æ ¼å°‡ä½ çš„ä¸€ç”Ÿè¦–è¦ºåŒ–ã€‚æ¯ä¸€å€‹æ ¼å­ä»£è¡¨ä¸€å€‹æœˆã€‚ç°è‰²çš„æ ¼å­æ˜¯ä½ å·²ç¶“åº¦éçš„æ™‚å…‰ï¼Œç´…è‰²çš„æ ¼å­ä»£è¡¨ç•¶ä¸‹ï¼Œç™½è‰²çš„æ ¼å­å‰‡æ˜¯å……æ»¿å¯èƒ½æ€§çš„æœªä¾†ã€‚çœ‹è‘—é€™äº›æ ¼å­ï¼Œæˆ–è¨±èƒ½è®“æˆ‘å€‘æ›´æ¸…æ™°åœ°æ„Ÿå—åˆ°æ™‚é–“çš„æµé€ï¼Œå¾è€Œæ›´çæƒœçœ¼å‰çš„æ¯ä¸€å¤©ã€‚'
                },
                'zh-CN': {
                    title: 'äººç”Ÿå°æ ¼æ—¥å†',
                    birth_date: 'å‡ºç”Ÿæ—¥æœŸ',
                    life_expectancy: 'é¢„æœŸå¯¿å‘½ (å²)',
                    generate_calendar: 'æ›´æ–°å›¾è¡¨',
                    life_calendar: 'ä½ çš„äººç”Ÿæ—¥å†',
                    legend_past: 'å·²é€',
                    legend_present: 'å½“ä¸‹',
                    legend_future: 'æœªæ¥',
                    summary_age: 'å½“å‰å¹´é¾„',
                    summary_months_lived: 'å·²ç”Ÿæ´»æœˆæ•°',
                    summary_months_remaining: 'å‰©ä½™æœˆæ•°',
                    summary_percentage: 'äººç”Ÿè¿›åº¦',
                    intro_title: 'å…³äºæœ¬å·¥å…·',
                    intro_text: 'å¦‚æœæˆ‘ä»¬æ´»åˆ° 80 å²ï¼Œäººç”Ÿå¤§çº¦åªæœ‰ 960 ä¸ªæœˆã€‚è¿™å¼ è¡¨æ ¼å°†ä½ çš„ä¸€ç”Ÿå¯è§†åŒ–ã€‚æ¯ä¸€ä¸ªæ ¼å­ä»£è¡¨ä¸€ä¸ªæœˆã€‚ç°è‰²çš„æ ¼å­æ˜¯ä½ å·²ç»åº¦è¿‡çš„æ—¶å…‰ï¼Œçº¢è‰²çš„æ ¼å­ä»£è¡¨å½“ä¸‹ï¼Œç™½è‰²çš„æ ¼å­åˆ™æ˜¯å……æ»¡å¯èƒ½æ€§çš„æœªæ¥ã€‚çœ‹ç€è¿™äº›æ ¼å­ï¼Œæˆ–è®¸èƒ½è®©æˆ‘ä»¬æ›´æ¸…æ™°åœ°æ„Ÿå—åˆ°æ—¶é—´çš„æµé€ï¼Œä»è€Œæ›´çæƒœçœ¼å‰çš„æ¯ä¸€å¤©ã€‚'
                },
                'en': {
                    title: 'Life Count Calendar',
                    birth_date: 'Date of Birth',
                    life_expectancy: 'Life Expectancy',
                    generate_calendar: 'Update Chart',
                    life_calendar: 'Your Life Calendar',
                    legend_past: 'Past',
                    legend_present: 'Now',
                    legend_future: 'Future',
                    summary_age: 'Current Age',
                    summary_months_lived: 'Months Lived',
                    summary_months_remaining: 'Months Left',
                    summary_percentage: 'Life Progress',
                    intro_title: 'About',
                    intro_text: 'If we live to 80, we have about 960 months. This grid visualizes your life in months. Gray squares are time passed, the red square is now, and empty squares are your future. Seeing your life laid out can help appreciate the time we have.'
                },
                'ja': {
                    title: 'äººç”Ÿã‚«ã‚¦ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼',
                    birth_date: 'ç”Ÿå¹´æœˆæ—¥',
                    life_expectancy: 'å¹³å‡ä½™å‘½ (æ­³)',
                    generate_calendar: 'æ›´æ–°',
                    life_calendar: 'ã‚ãªãŸã®äººç”Ÿã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼',
                    legend_past: 'éå»',
                    legend_present: 'ç¾åœ¨',
                    legend_future: 'æœªæ¥',
                    summary_age: 'ç¾åœ¨ã®å¹´é½¢',
                    summary_months_lived: 'ç”ŸããŸæœˆæ•°',
                    summary_months_remaining: 'æ®‹ã‚Šã®æœˆæ•°',
                    summary_percentage: 'äººç”Ÿã®é€²æ—',
                    intro_title: 'ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦',
                    intro_text: '80æ­³ã¾ã§ç”Ÿãã‚‹ã¨ä»®å®šã™ã‚‹ã¨ã€äººç”Ÿã¯ç´„960ãƒ¶æœˆã§ã™ã€‚ã“ã®ã‚°ãƒªãƒƒãƒ‰ã¯ã‚ãªãŸã®äººç”Ÿã‚’æœˆå˜ä½ã§å¯è¦–åŒ–ã—ã¾ã™ã€‚ç°è‰²ã®ãƒã‚¹ã¯éãå»ã£ãŸæ™‚é–“ã€èµ¤ã¯ç¾åœ¨ã€ç™½ã¯æœªæ¥ã‚’è¡¨ã—ã¾ã™ã€‚æ™‚é–“ã‚’è¦–è¦šçš„ã«æ‰ãˆã‚‹ã“ã¨ã§ã€ä¸€æ—¥ä¸€æ—¥ã‚’ã‚ˆã‚Šå¤§åˆ‡ã«éã”ã™ãã£ã‹ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚'
                },
                'ru': {
                    title: 'ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ğ¶Ğ¸Ğ·Ğ½Ğ¸',
                    birth_date: 'Ğ”Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ',
                    life_expectancy: 'ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ (Ğ»ĞµÑ‚)',
                    generate_calendar: 'ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ³Ñ€Ğ°Ñ„Ğ¸Ğº',
                    life_calendar: 'Ğ’Ğ°Ñˆ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ğ¶Ğ¸Ğ·Ğ½Ğ¸',
                    legend_past: 'ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾Ğµ',
                    legend_present: 'Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ',
                    legend_future: 'Ğ‘ÑƒĞ´ÑƒÑ‰ĞµĞµ',
                    summary_age: 'Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚',
                    summary_months_lived: 'ĞŸÑ€Ğ¾Ğ¶Ğ¸Ñ‚Ğ¾ Ğ¼ĞµÑÑÑ†ĞµĞ²',
                    summary_months_remaining: 'ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ğ¼ĞµÑÑÑ†ĞµĞ²',
                    summary_percentage: 'ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¶Ğ¸Ğ·Ğ½Ğ¸',
                    intro_title: 'Ğ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğµ',
                    intro_text: 'Ğ•ÑĞ»Ğ¸ Ğ¶Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ 80 Ğ»ĞµÑ‚, ÑÑ‚Ğ¾ Ğ²ÑĞµĞ³Ğ¾ Ğ¾ĞºĞ¾Ğ»Ğ¾ 960 Ğ¼ĞµÑÑÑ†ĞµĞ². Ğ­Ñ‚Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²Ğ°ÑˆÑƒ Ğ¶Ğ¸Ğ·Ğ½ÑŒ. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚ â€” ÑÑ‚Ğ¾ Ğ¾Ğ´Ğ¸Ğ½ Ğ¼ĞµÑÑÑ†. Ğ¡ĞµÑ€Ñ‹Ğµ â€” Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğµ, ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹ â€” Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞµ, Ğ±ĞµĞ»Ñ‹Ğµ â€” Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ. Ğ’Ğ·Ğ³Ğ»ÑĞ´ Ğ½Ğ° Ğ¶Ğ¸Ğ·Ğ½ÑŒ Ñ†ĞµĞ»Ğ¸ĞºĞ¾Ğ¼ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ñ†ĞµĞ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ.'
                }
            },

            init: function() {
                // Initialize language
                // Fix: Use localStorage instead of URL params to avoid SecurityError in iframe
                let lang = 'zh-TW';
                try {
                    const savedLang = localStorage.getItem('life-count-lang');
                    const params = new URLSearchParams(window.location.search);
                    lang = savedLang || params.get('lang') || 'zh-TW';
                } catch (e) {
                    console.warn('Cannot access localStorage or URL params', e);
                }

                const langSelector = document.getElementById('lang-selector');
                if (this.i18n[lang]) {
                    langSelector.value = lang;
                }
                
                // Set default birth date (25 years ago)
                const birthInput = document.getElementById('birth_date');
                if (!birthInput.value) {
                    const defaultBirth = new Date();
                    defaultBirth.setFullYear(defaultBirth.getFullYear() - 25);
                    birthInput.value = defaultBirth.toISOString().split('T')[0];
                }

                this.changeLang(false); // Update text without reload
                this.calculate(); // Auto calculate on load
            },

            changeLang: function(saveToStorage = true) {
                const lang = document.getElementById('lang-selector').value;
                
                if (saveToStorage) {
                    try {
                        localStorage.setItem('life-count-lang', lang);
                    } catch (e) {
                        console.warn('LocalStorage not available');
                    }
                    // Fix: Removed history.pushState causing SecurityError
                }
                
                const texts = this.i18n[lang] || this.i18n['en'];
                
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) {
                        // Preserve HTML tags if needed, simple text replacement here
                        if (el.children.length === 0) {
                             el.innerText = texts[key];
                        } else {
                             // Handle complex elements manually or use innerHTML if text contains tags
                             if (key === 'intro_text') el.innerHTML = texts[key];
                             else el.childNodes[0].nodeValue = texts[key]; 
                        }
                    }
                });
            },

            calculate: function() {
                const birthDateStr = document.getElementById('birth_date').value;
                if (!birthDateStr) return;

                const birthDate = new Date(birthDateStr);
                const lifeExpectancy = parseInt(document.getElementById('life_expectancy').value) || 80;
                const today = new Date();
                
                // --- Logic Calculations ---
                
                // Exact Age Calculation
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                // Total months lived (approximate but sufficient for visual)
                const monthsInYear = 12;
                const totalMonthsLived = ((today.getFullYear() - birthDate.getFullYear()) * 12) + (today.getMonth() - birthDate.getMonth());
                
                const totalExpectedMonths = lifeExpectancy * 12;
                const monthsRemaining = Math.max(0, totalExpectedMonths - totalMonthsLived);
                const percentageComplete = Math.min(100, Math.max(0, (totalMonthsLived / totalExpectedMonths) * 100)).toFixed(1);

                // --- Update Summary UI ---
                document.getElementById('summary_age').innerText = `${age}`;
                document.getElementById('summary_months_lived').innerText = totalMonthsLived.toLocaleString();
                document.getElementById('summary_months_remaining').innerText = monthsRemaining.toLocaleString();
                document.getElementById('summary_percentage').innerText = `${percentageComplete}%`;

                // --- Generate Grid ---
                this.generateLifeGrid(birthDate, today, lifeExpectancy, totalMonthsLived);
            },

            generateLifeGrid: function(birthDate, today, lifeExpectancy, monthsLived) {
                const gridContainer = document.getElementById('life_grid');
                gridContainer.innerHTML = '';
                
                const startYear = birthDate.getFullYear();
                const endYear = startYear + lifeExpectancy;
                const birthMonthIndex = birthDate.getMonth(); // 0-11
                
                // Fragment for better performance
                const fragment = document.createDocumentFragment();

                for (let year = startYear; year < endYear; year++) {
                    // 1. Add Year Label (Column 1)
                    const yearLabel = document.createElement('div');
                    yearLabel.className = 'year-label';
                    // Show age instead of year number usually more impactful, or Year number
                    const ageAtYear = year - startYear;
                    yearLabel.innerText = ageAtYear % 5 === 0 ? ageAtYear : (year === startYear || year === endYear -1 ? ageAtYear : ''); 
                    // Or show actual year: yearLabel.innerText = year;
                    // Let's show Age, but every 5 years to reduce clutter
                    yearLabel.setAttribute('data-year', year);
                    if (ageAtYear === 0) yearLabel.innerText = "å‡ºç”Ÿ";
                    else if (ageAtYear % 10 === 0) yearLabel.innerText = ageAtYear + "æ­²";
                    else yearLabel.innerText = "";
                    
                    // Hover to see exact year
                    yearLabel.title = `Year: ${year}, Age: ${ageAtYear}`;
                    fragment.appendChild(yearLabel);
                    
                    // 2. Add 12 Months (Columns 2-13)
                    for (let month = 0; month < 12; month++) {
                        const monthCell = document.createElement('div');
                        
                        // Calculate absolute month index from birth
                        // (Year difference * 12) + (month index - birth month index)
                        // Note: Grid is calendar aligned (Jan-Dec), so logic needs to map correctly
                        
                        // Is this month before birth?
                        if (year === startYear && month < birthMonthIndex) {
                            monthCell.className = 'month-cell opacity-0 pointer-events-none'; // Invisible placeholder
                        } else {
                            monthCell.className = 'month-cell month-future'; // Default future
                            
                            // Compare with today
                            const cellDate = new Date(year, month, 1);
                            // Avoid time issues by comparing YYYY-MM
                            const currentYM = today.getFullYear() * 12 + today.getMonth();
                            const cellYM = year * 12 + month;
                            
                            if (cellYM < currentYM) {
                                monthCell.className = 'month-cell month-past';
                                monthCell.setAttribute('data-tooltip', `${year}å¹´${month+1}æœˆ (å·²é)`);
                            } else if (cellYM === currentYM) {
                                monthCell.className = 'month-cell month-current';
                                monthCell.setAttribute('data-tooltip', `${year}å¹´${month+1}æœˆ (ç¾åœ¨)`);
                            } else {
                                monthCell.setAttribute('data-tooltip', `${year}å¹´${month+1}æœˆ (æœªä¾†)`);
                            }
                        }
                        fragment.appendChild(monthCell);
                    }
                }
                
                gridContainer.appendChild(fragment);
            }
        };

        window.onload = function() { LifeCount.init(); };
    </script>

    <div id="related-tools-container"></div>
    <script src="../../scripts/related.js"></script>
    
</body>

</html>
