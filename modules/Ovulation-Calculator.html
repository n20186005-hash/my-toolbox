<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ovulation Calculator Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #fff1f2; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="ovul_calc" 
         data-category="health" 
         data-title="Ovulation Calculator" 
         data-icon="üå∏">
        
        <div class="absolute top-4 right-4">
            <select id="oc-lang" onchange="OvulCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en">English</option>
                <option value="zh-CN">Á∞°È´î‰∏≠Êñá</option>
                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">üå∏ Ovulation Calculator</h2>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="lbl_lmp">First Day of Last Period</label>
            <input type="date" id="oc-lmp" class="w-full p-2 border rounded focus:ring-2 focus:ring-rose-400 outline-none">
        </div>

        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="lbl_cycle">Cycle Length (Days)</label>
            <div class="flex items-center">
                <input type="range" id="oc-cycle-range" min="21" max="40" value="28" class="flex-1 mr-3 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-rose-500" oninput="document.getElementById('oc-cycle').value=this.value">
                <input type="number" id="oc-cycle" class="w-16 p-2 border rounded text-center focus:ring-2 focus:ring-rose-400 outline-none" value="28" oninput="document.getElementById('oc-cycle-range').value=this.value">
            </div>
        </div>

        <button onclick="OvulCalc.calc()" class="w-full bg-rose-500 text-white py-2 rounded font-bold hover:bg-rose-600 transition mb-6" data-i18n="btn_calc">Calculate Fertile Window</button>

        <div class="bg-rose-50 p-4 rounded-lg border border-rose-100 hidden" id="oc-results">
            <div class="flex justify-between items-center mb-4 border-b border-rose-200 pb-2">
                <span class="text-sm text-gray-600 font-bold" data-i18n="res_ovulation">Ovulation Day</span>
                <span id="res-ovul-date" class="text-lg font-bold text-rose-700">--</span>
            </div>
            
            <div class="mb-4">
                <span class="text-xs text-gray-500 uppercase tracking-wide block mb-1" data-i18n="res_fertile">Fertile Window (Most Fertile)</span>
                <div id="res-fertile-range" class="text-sm font-medium text-gray-800 bg-white p-2 rounded shadow-sm text-center">--</div>
            </div>

            <div class="flex justify-between items-center text-xs text-gray-500 mt-2">
                <span data-i18n="res_next">Next Period:</span>
                <span id="res-next-period" class="font-bold">--</span>
            </div>
        </div>
    </div>

    <script>
        const OvulCalc = {
            i18n: {
                'en': {
                    title: 'üå∏ Ovulation Calculator',
                    lbl_lmp: 'First Day of Last Period',
                    lbl_cycle: 'Cycle Length (Days)',
                    btn_calc: 'Calculate Fertile Window',
                    res_ovulation: 'Ovulation Day',
                    res_fertile: 'Fertile Window (Best Chance)',
                    res_next: 'Next Period Starts:',
                    fmt_date: 'MMM dd, yyyy'
                },
                'zh-CN': {
                    title: 'üå∏ ÊéíÂçµÊúüËÆ°ÁÆóÂô®',
                    lbl_lmp: 'Êú´Ê¨°ÊúàÁªèÁ¨¨‰∏ÄÂ§©',
                    lbl_cycle: 'ÊúàÁªèÂë®Êúü (Â§©)',
                    btn_calc: 'ËÆ°ÁÆóÊéíÂçµÊúü',
                    res_ovulation: 'ÊéíÂçµÊó•',
                    res_fertile: 'ÊòìÂèóÂ≠ïÊúü (ÊúÄ‰Ω≥ÂèóÂ≠ïÁ™óÂè£)',
                    res_next: '‰∏ãÊ¨°ÊúàÁªè:',
                    fmt_date: 'yyyyÂπ¥MMÊúàddÊó•'
                },
                'zh-TW': {
                    title: 'üå∏ ÊéíÂçµÊúüË®àÁÆóÂô®',
                    lbl_lmp: 'Êú´Ê¨°ÊúàÁ∂ìÁ¨¨‰∏ÄÂ§©',
                    lbl_cycle: 'ÊúàÁ∂ìÈÄ±Êúü (Â§©)',
                    btn_calc: 'Ë®àÁÆóÊéíÂçµÊúü',
                    res_ovulation: 'ÊéíÂçµÊó•',
                    res_fertile: 'ÊòìÂèóÂ≠ïÊúü (ÊúÄ‰Ω≥ÂèóÂ≠ïÁ™óÂè£)',
                    res_next: '‰∏ãÊ¨°ÊúàÁ∂ì:',
                    fmt_date: 'yyyyÂπ¥MMÊúàddÊó•'
                },
                'ja': {
                    title: 'üå∏ ÊéíÂçµÊó•Ë®àÁÆó',
                    lbl_lmp: 'ÊúÄÁµÇÊúàÁµåÈñãÂßãÊó•',
                    lbl_cycle: 'ÊúàÁµåÂë®Êúü (Êó•)',
                    btn_calc: 'Ë®àÁÆó„Åô„Çã',
                    res_ovulation: 'ÊéíÂçµ‰∫àÂÆöÊó•',
                    res_fertile: 'Â¶äÂ®†„Åó„ÇÑ„Åô„ÅÑÊúüÈñì',
                    res_next: 'Ê¨°„ÅÆÁîüÁêÜ‰∫àÂÆöÊó•:',
                    fmt_date: 'yyyy/MM/dd'
                },
                'ru': {
                    title: 'üå∏ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–≤—É–ª—è—Ü–∏–∏',
                    lbl_lmp: '–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –ø–æ—Å–ª. –º–µ—Å—è—á–Ω—ã—Ö',
                    lbl_cycle: '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ (–¥–Ω–µ–π)',
                    btn_calc: '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å',
                    res_ovulation: '–î–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏',
                    res_fertile: '–§–µ—Ä—Ç–∏–ª—å–Ω–æ–µ –æ–∫–Ω–æ',
                    res_next: '–°–ª–µ–¥. –º–µ—Å—è—á–Ω—ã–µ:',
                    fmt_date: 'dd.MM.yyyy'
                },
                'es': {
                    title: 'üå∏ Calculadora de Ovulaci√≥n',
                    lbl_lmp: 'Primer d√≠a √∫ltima regla',
                    lbl_cycle: 'Duraci√≥n del ciclo (d√≠as)',
                    btn_calc: 'Calcular',
                    res_ovulation: 'D√≠a de Ovulaci√≥n',
                    res_fertile: 'Ventana F√©rtil',
                    res_next: 'Pr√≥ximo periodo:',
                    fmt_date: 'dd/MM/yyyy'
                }
            },

            changeLang: () => {
                const lang = document.getElementById('oc-lang').value;
                const texts = OvulCalc.i18n[lang];
                const elements = document.querySelectorAll('[data-id="ovul_calc"] [data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });
                if(document.getElementById('oc-results').style.display !== 'none') OvulCalc.calc();
            },

            formatDate: (dateObj) => {
                const lang = document.getElementById('oc-lang').value;
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                if (lang === 'zh-CN' || lang === 'zh-TW' || lang === 'ja') {
                    // Simple manual format for Asian langs to ensure YMD order
                    return `${dateObj.getFullYear()}/${dateObj.getMonth()+1}/${dateObj.getDate()}`;
                }
                return dateObj.toLocaleDateString(lang === 'en' ? 'en-US' : lang, options);
            },

            calc: () => {
                const lmpStr = document.getElementById('oc-lmp').value;
                const cycle = parseInt(document.getElementById('oc-cycle').value);

                if (!lmpStr || isNaN(cycle)) return;

                const lmp = new Date(lmpStr);
                
                // Logic: Ovulation is typically 14 days before NEXT period.
                // Next period = LMP + Cycle
                // Ovulation = (LMP + Cycle) - 14
                
                const nextPeriod = new Date(lmp.getTime() + (cycle * 24 * 60 * 60 * 1000));
                const ovulation = new Date(nextPeriod.getTime() - (14 * 24 * 60 * 60 * 1000));
                
                // Fertile window: 5 days before ovulation + ovulation day + 1 day after
                const fertileStart = new Date(ovulation.getTime() - (5 * 24 * 60 * 60 * 1000));
                const fertileEnd = new Date(ovulation.getTime() + (1 * 24 * 60 * 60 * 1000));

                document.getElementById('res-ovul-date').innerText = OvulCalc.formatDate(ovulation);
                document.getElementById('res-fertile-range').innerText = 
                    `${OvulCalc.formatDate(fertileStart)} - ${OvulCalc.formatDate(fertileEnd)}`;
                document.getElementById('res-next-period').innerText = OvulCalc.formatDate(nextPeriod);

                document.getElementById('oc-results').classList.remove('hidden');
            }
        };

        // Init
        document.getElementById('oc-lmp').valueAsDate = new Date();
    </script>
</body>
</html>