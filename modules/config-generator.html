<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å·¥å…·ç®±é…ç½®ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .json-output { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; white-space: pre-wrap; }
    </style>
</head>
<body class="bg-gray-100 p-8 h-screen flex flex-col">

    <div class="max-w-5xl mx-auto w-full flex-1 flex flex-col">
        <div class="bg-white p-6 rounded-xl shadow-md mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-4">ğŸ› ï¸ è‡ªåŠ¨åŒ–é…ç½®ç”Ÿæˆå™¨</h1>
            <p class="text-gray-600 mb-4">è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œæ‰¹é‡é€‰æ‹©æ‚¨çš„æ‰€æœ‰æ¨¡å— HTML æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šovulation-calculator.html ç­‰ï¼‰ã€‚ç³»ç»Ÿå°†è‡ªåŠ¨è§£ææ–‡ä»¶å†…å®¹å¹¶ç”Ÿæˆ `index.html` æ‰€éœ€çš„é…ç½®ä»£ç ã€‚</p>
            
            <div class="flex gap-4 items-center">
                <!-- æ–‡ä»¶é€‰æ‹©å™¨ -->
                <label class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold transition shadow-lg flex items-center gap-2">
                    <span>ğŸ“‚ é€‰æ‹©æ¨¡å—æ–‡ä»¶ (å¯å¤šé€‰)</span>
                    <input type="file" id="fileInput" multiple accept=".html" class="hidden">
                </label>
                <span id="status" class="text-gray-500 font-medium">ç­‰å¾…é€‰æ‹©æ–‡ä»¶...</span>
            </div>
        </div>

        <div class="flex-1 bg-gray-900 rounded-xl shadow-inner p-4 overflow-hidden flex flex-col relative border border-gray-700">
            <div class="flex justify-between items-center mb-2 pb-2 border-b border-gray-700">
                <span class="text-gray-400 text-sm">ç”Ÿæˆçš„é…ç½®ä»£ç  (Tools Config)</span>
                <button onclick="copyCode()" class="text-xs bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded transition">å¤åˆ¶ä»£ç </button>
            </div>
            <textarea id="output" class="flex-1 w-full h-full bg-transparent text-green-400 text-sm font-mono outline-none resize-none p-2" readonly>// è¯·é€‰æ‹©æ–‡ä»¶ç”Ÿæˆé…ç½®...</textarea>
        </div>
    </div>

    <script>
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            const status = document.getElementById('status');
            const output = document.getElementById('output');
            
            if (files.length === 0) return;

            status.innerText = `æ­£åœ¨å¤„ç† ${files.length} ä¸ªæ–‡ä»¶...`;
            
            const configs = [];

            // æŒ‰ç…§æ–‡ä»¶åæ’åºï¼Œä¿è¯ç”Ÿæˆé¡ºåºå›ºå®š
            files.sort((a, b) => a.name.localeCompare(b.name));

            for (const file of files) {
                // è·³è¿‡ index.html, A.html æˆ–è¿™ä¸ªç”Ÿæˆå™¨æœ¬èº«
                if (file.name === 'index.html' || file.name === 'A.html' || file.name === 'config-generator.html') continue;

                const text = await readFile(file);
                const info = parseHtml(text, file.name);
                if (info) {
                    configs.push(info);
                }
            }

            // ç”Ÿæˆä»£ç å­—ç¬¦ä¸²
            const jsonString = generateJsCode(configs);
            output.value = jsonString;
            status.innerText = `âœ… æˆåŠŸè§£æ ${configs.length} ä¸ªæ¨¡å—ï¼`;
        });

        function readFile(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.readAsText(file);
            });
        }

        function parseHtml(html, filename) {
            // 1. æå– tool-module div ä¸­çš„ data å±æ€§
            // æ­£åˆ™åŒ¹é…: <div class="tool-module ... data-id="xxx" ... >
            const divMatch = html.match(/<div[^>]*class=["'][^"']*tool-module[^"']*["'][^>]*>/i);
            
            if (!divMatch) return null; // ä¸æ˜¯æœ‰æ•ˆçš„æ¨¡å—æ–‡ä»¶
            
            const tag = divMatch[0];
            
            const getId = (attr) => {
                const match = tag.match(new RegExp(`${attr}=["']([^"']+)["']`));
                return match ? match[1] : '';
            };

            const id = getId('data-id');
            const title = getId('data-title');
            const category = getId('data-category') || 'tools';
            const icon = getId('data-icon') || 'ğŸ”§';

            // 2. æå–æè¿° (ä» JS çš„ i18n 'en' éƒ¨åˆ†æå– desc)
            // åŒ¹é…: desc: 'Some text',
            let desc = '';
            const descMatch = html.match(/desc:\s*['"]([^'"]+)['"]/);
            if (descMatch) {
                desc = descMatch[1];
            } else {
                // å¤‡ç”¨ï¼šå°è¯•ä» HTML æ ‡ç­¾ä¸­æå– data-i18n="desc"
                const htmlDescMatch = html.match(/<[^>]+data-i18n=["']desc["'][^>]*>([^<]+)</);
                if (htmlDescMatch) desc = htmlDescMatch[1];
            }

            return {
                id,
                title,
                icon,
                category,
                file: filename,
                desc
            };
        }

        function generateJsCode(configs) {
            let code = "const toolsConfig = [\n";
            
            configs.forEach(tool => {
                code += `    { 
        id: '${tool.id}', 
        title: '${tool.title}', 
        icon: '${tool.icon}', 
        category: '${tool.category}', 
        file: '${tool.file}', 
        desc: '${tool.desc.replace(/'/g, "\\'")}' 
    },\n`;
            });

            code += "];";
            return code;
        }

        function copyCode() {
            const copyText = document.getElementById("output");
            copyText.select();
            copyText.setSelectionRange(0, 99999); 
            navigator.clipboard.writeText(copyText.value).then(() => {
                alert("é…ç½®ä»£ç å·²å¤åˆ¶ï¼è¯·ç²˜è´´åˆ° index.html çš„ toolsConfig å˜é‡ä¸­ã€‚");
            });
        }
    </script>
</body>
</html>