<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¤‡åˆ©è¨ˆç®—å™¨æ¨¡å¡Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0f9ff; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="compound_calc" 
         data-category="finance" 
         data-title="è¤‡åˆ©è¨ˆç®—å™¨" 
         data-icon="ğŸ“ˆ">
        
        <div class="absolute top-4 right-4">
            <select id="cc-lang" onchange="CompoundCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="zh-CN">ç°¡é«”ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="en">English</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                <option value="es">EspaÃ±ol</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">ğŸ“ˆ è¤‡åˆ©è¨ˆç®—å™¨</h2>
        
        <div class="grid grid-cols-1 gap-4 mb-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="principal">æœ¬é‡‘</label>
                    <input type="number" id="cc-principal" class="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="10000">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="rate">å¹´åˆ©ç‡ (%)</label>
                    <input type="number" id="cc-rate" class="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="5.0" step="0.01">
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="years">å¹´é™</label>
                    <input type="number" id="cc-years" class="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="10">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="frequency">è¤‡åˆ©é »ç‡</label>
                    <select id="cc-frequency" class="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                        <option value="12" data-i18n="freq_monthly">æ¯æœˆ</option>
                        <option value="1" data-i18n="freq_annually">æ¯å¹´</option>
                        <option value="4" data-i18n="freq_quarterly">æ¯å­£</option>
                        <option value="365" data-i18n="freq_daily">æ¯æ—¥</option>
                    </select>
                </div>
            </div>

            <div>
                 <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="monthly_add">æ¯æœˆè¿½åŠ  (å¯é¸)</label>
                 <input type="number" id="cc-addition" class="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="0">
            </div>
        </div>

        <button onclick="CompoundCalc.calc()" class="w-full bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700 transition mb-6" data-i18n="btn_calc">è¨ˆç®—</button>

        <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-600" data-i18n="res_future">æœªä¾†åƒ¹å€¼</span>
                <div class="text-right">
                    <div id="cc-result" class="text-2xl font-bold text-indigo-700">--</div>
                </div>
            </div>
            <div class="flex justify-between items-center text-sm">
                <span class="text-gray-500" data-i18n="res_interest">è¤‡åˆ©æ”¶ç›Š</span>
                <span id="cc-interest" class="font-semibold text-gray-700">--</span>
            </div>
        </div>
    </div>

    <script>
        const CompoundCalc = {
            i18n: {
                'zh-CN': {
                    title: 'ğŸ“ˆ å¤åˆ©è®¡ç®—å™¨',
                    principal: 'æœ¬é‡‘',
                    rate: 'å¹´åˆ©ç‡ (%)',
                    years: 'å¹´é™',
                    frequency: 'å¤åˆ©é¢‘ç‡',
                    freq_monthly: 'æ¯æœˆ',
                    freq_annually: 'æ¯å¹´',
                    freq_quarterly: 'æ¯å­£',
                    freq_daily: 'æ¯æ—¥',
                    monthly_add: 'æ¯æœˆè¿½åŠ  (å¯é€‰)',
                    btn_calc: 'è®¡ç®—',
                    res_future: 'æœªæ¥ä»·å€¼',
                    res_interest: 'å¤åˆ©æ”¶ç›Š'
                },
                'zh-TW': {
                    title: 'ğŸ“ˆ è¤‡åˆ©è¨ˆç®—å™¨',
                    principal: 'æœ¬é‡‘',
                    rate: 'å¹´åˆ©ç‡ (%)',
                    years: 'å¹´é™',
                    frequency: 'è¤‡åˆ©é »ç‡',
                    freq_monthly: 'æ¯æœˆ',
                    freq_annually: 'æ¯å¹´',
                    freq_quarterly: 'æ¯å­£',
                    freq_daily: 'æ¯æ—¥',
                    monthly_add: 'æ¯æœˆè¿½åŠ  (å¯é¸)',
                    btn_calc: 'è¨ˆç®—',
                    res_future: 'æœªä¾†åƒ¹å€¼',
                    res_interest: 'è¤‡åˆ©æ”¶ç›Š'
                },
                'en': {
                    title: 'ğŸ“ˆ Compound Interest',
                    principal: 'Principal',
                    rate: 'Interest Rate (%)',
                    years: 'Years',
                    frequency: 'Compound Freq',
                    freq_monthly: 'Monthly',
                    freq_annually: 'Annually',
                    freq_quarterly: 'Quarterly',
                    freq_daily: 'Daily',
                    monthly_add: 'Monthly Addition (Opt)',
                    btn_calc: 'Calculate',
                    res_future: 'Future Value',
                    res_interest: 'Interest Earned'
                },
                'ja': {
                    title: 'ğŸ“ˆ è¤‡åˆ©è¨ˆç®—',
                    principal: 'å…ƒæœ¬',
                    rate: 'å¹´åˆ© (%)',
                    years: 'æœŸé–“ (å¹´)',
                    frequency: 'è¤‡åˆ©é »åº¦',
                    freq_monthly: 'æ¯æœˆ',
                    freq_annually: 'æ¯å¹´',
                    freq_quarterly: 'å››åŠæœŸ',
                    freq_daily: 'æ¯æ—¥',
                    monthly_add: 'æ¯æœˆã®ç©ç«‹ (ä»»æ„)',
                    btn_calc: 'è¨ˆç®—ã™ã‚‹',
                    res_future: 'å°†æ¥ä¾¡å€¤',
                    res_interest: 'åˆ©æ¯åˆè¨ˆ'
                },
                'ru': {
                    title: 'ğŸ“ˆ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ñ‹',
                    principal: 'ĞšĞ°Ğ¿Ğ¸Ñ‚Ğ°Ğ»',
                    rate: 'Ğ¡Ñ‚Ğ°Ğ²ĞºĞ° (%)',
                    years: 'Ğ›ĞµÑ‚',
                    frequency: 'Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°',
                    freq_monthly: 'Ğ•Ğ¶ĞµĞ¼ĞµÑÑÑ‡Ğ½Ğ¾',
                    freq_annually: 'Ğ•Ğ¶ĞµĞ³Ğ¾Ğ´Ğ½Ğ¾',
                    freq_quarterly: 'Ğ•Ğ¶ĞµĞºĞ²Ğ°Ñ€Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾',
                    freq_daily: 'Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾',
                    monthly_add: 'Ğ•Ğ¶ĞµĞ¼ĞµÑ. Ğ²ĞºĞ»Ğ°Ğ´ (Ğ¾Ğ¿Ñ†.)',
                    btn_calc: 'Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ',
                    res_future: 'Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°',
                    res_interest: 'Ğ”Ğ¾Ñ…Ğ¾Ğ´'
                },
                'es': {
                    title: 'ğŸ“ˆ InterÃ©s Compuesto',
                    principal: 'Capital Inicial',
                    rate: 'Tasa Anual (%)',
                    years: 'AÃ±os',
                    frequency: 'Frecuencia',
                    freq_monthly: 'Mensual',
                    freq_annually: 'Anual',
                    freq_quarterly: 'Trimestral',
                    freq_daily: 'Diaria',
                    monthly_add: 'AdiciÃ³n Mensual (Opc)',
                    btn_calc: 'Calcular',
                    res_future: 'Valor Futuro',
                    res_interest: 'InterÃ©s Ganado'
                }
            },

            changeLang: () => {
                const lang = document.getElementById('cc-lang').value;
                const texts = CompoundCalc.i18n[lang];
                const elements = document.querySelectorAll('[data-id="compound_calc"] [data-i18n]');
                
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) {
                        if (el.tagName === 'OPTION') el.text = texts[key];
                        else el.innerText = texts[key];
                    }
                });
                CompoundCalc.calc(true);
            },

            calc: (isLangUpdate = false) => {
                const p = parseFloat(document.getElementById('cc-principal').value);
                const r_annual = parseFloat(document.getElementById('cc-rate').value);
                const years = parseFloat(document.getElementById('cc-years').value);
                const n = parseFloat(document.getElementById('cc-frequency').value);
                const pmt = parseFloat(document.getElementById('cc-addition').value) || 0;

                const lang = document.getElementById('cc-lang').value;
                const fmt = (num) => num.toLocaleString(lang === 'en' ? 'en-US' : 'zh-CN', { style: 'currency', currency: lang === 'en' ? 'USD' : (lang === 'ja' ? 'JPY' : 'CNY') });

                if (isNaN(p) || isNaN(r_annual) || isNaN(years)) return;

                const r = r_annual / 100;
                
                // è¤‡åˆ©å…¬å¼ (æœ¬é‡‘éƒ¨åˆ†): A = P(1 + r/n)^(nt)
                const amountPrincipal = p * Math.pow(1 + (r / n), n * years);

                // è¤‡åˆ©å…¬å¼ (å®šæœŸå®šé¡éƒ¨åˆ†) - ç°¡åŒ–ï¼šå‡è¨­è¿½åŠ æ¬¾é …ä¹Ÿæ˜¯æŒ‰è¤‡åˆ©é »ç‡æŠ•å…¥ï¼Œæˆ–è€…è¿‘ä¼¼è¨ˆç®—
                // é€™è£¡ä½¿ç”¨ç²¾ç¢ºå…¬å¼ï¼šPMT * [ (1 + r/n)^(nt) - 1 ] / (r/n)
                // æ³¨æ„ï¼šå¦‚æœPMTæ˜¯æ¯æœˆï¼Œä½†næ˜¯æ¯å¹´ï¼Œè¨ˆç®—æœƒå¾ˆè¤‡é›œã€‚
                // ç‚ºäº†ç”¨æˆ¶é«”é©—ï¼Œæˆ‘å€‘é€™è£¡å‡è¨­ PMT æ˜¯ã€Œæ¯æœŸè¿½åŠ ã€ï¼Œå³å¦‚æœé¸æ¯å¹´è¤‡åˆ©ï¼Œå°±æ˜¯æ¯å¹´è¿½åŠ ã€‚
                // ä½†UIå¯«çš„æ˜¯ã€Œæ¯æœˆè¿½åŠ ã€ï¼Œé€™æœƒé€ æˆæ­§ç¾©ã€‚
                // **ä¿®æ­£é‚è¼¯**ï¼šç‚ºäº†æ¨¡å¡Šç°¡å–®æ€§ï¼Œæˆ‘å€‘å°‡è¿½åŠ é »ç‡èˆ‡è¤‡åˆ©é »ç‡è§£è€¦è¼ƒé›£ã€‚
                // æˆ‘å€‘é€™è£¡æ¡ç”¨ç°¡å–®é‚è¼¯ï¼šå°‡æ¯æœˆè¿½åŠ è½‰æ›ç‚ºå¹´åŒ–ç¸½é¡é€²è¡Œä¼°ç®—ï¼Œæˆ–è€…é™åˆ¶PMTåƒ…åœ¨n=12æ™‚ç²¾ç¢ºã€‚
                // **å„ªåŒ–æ–¹æ¡ˆ**ï¼šä½¿ç”¨é€šç”¨è¿­ä»£è¨ˆç®—ï¼Œç¢ºä¿æº–ç¢ºæ€§ã€‚
                
                let totalAmount = p;
                const months = years * 12;
                const ratePerMonth = r / 12;
                
                // è¿­ä»£è¨ˆç®—æ¯æœˆ (è¼ƒç‚ºæº–ç¢ºä¸”é€šç”¨)
                // é »ç‡è™•ç†ï¼šå¦‚æœæ˜¯æ¯å­£(n=4)ï¼Œå‰‡æ¯3å€‹æœˆçµç®—ä¸€æ¬¡åˆ©æ¯ã€‚
                // å¦‚æœæ˜¯æ¯å¹´(n=1)ï¼Œå‰‡æ¯12å€‹æœˆçµç®—ä¸€æ¬¡ã€‚
                
                const compoundInterval = 12 / n; // å¤šå°‘å€‹æœˆè¤‡åˆ©ä¸€æ¬¡
                
                for (let i = 1; i <= months; i++) {
                    // æ¯æœˆè¿½åŠ 
                    totalAmount += pmt;
                    
                    // æª¢æŸ¥æ˜¯å¦åˆ°é”è¤‡åˆ©çµç®—é»
                    // æµ®é»æ•¸æ¨¡é™¤éœ€å°å¿ƒï¼Œé€™è£¡ç”¨ç°¡å–®åˆ¤å®š
                    if (i % (12/n) < 0.01 || Math.abs(i % (12/n) - (12/n)) < 0.01) { 
                        // é€™ç¨®åˆ¤å®šå° daily (365) æœ‰é»é›£ï¼Œä½†å° 1, 4, 12 æ²’å•é¡Œã€‚
                        // å°æ–¼ Dailyï¼Œæˆ‘å€‘ç›´æ¥ç”¨å…¬å¼æ³•æ›´ä½³ã€‚
                    }
                }

                // ç‚ºäº†æ€§èƒ½å’Œæº–ç¢ºæ€§ï¼Œæ··åˆä½¿ç”¨å…¬å¼ï¼š
                // ç¸½å€¼ = æœ¬é‡‘è¤‡åˆ© + æœˆä¾›è¤‡åˆ©
                // æœˆä¾›è¤‡åˆ© (å‡è¨­æœˆä¾›åœ¨æœˆåº•)ï¼šFV = PMT * ( ((1 + r/k)^(k*t) - 1) / ((1 + r/k)^(k/12) - 1) )
                // k = è¤‡åˆ©é »ç‡ (n)
                
                const k = n;
                const ratePerCompound = r / k;
                const totalCompounds = k * years;
                
                // æœ¬é‡‘æˆé•·
                const fvP = p * Math.pow(1 + ratePerCompound, totalCompounds);
                
                // æœˆä¾›æˆé•· (å¹¾ä½•ç´šæ•¸æ±‚å’Œå…¬å¼èª¿æ•´ç‰ˆ)
                // å¯¦éš›æœˆåˆ©ç‡æ•ˆæ‡‰ effective monthly rate = (1 + r/k)^(k/12) - 1
                const effMonthlyRate = Math.pow(1 + ratePerCompound, k/12) - 1;
                
                let fvPMT = 0;
                if (pmt > 0) {
                    if (effMonthlyRate === 0) {
                        fvPMT = pmt * months;
                    } else {
                        fvPMT = pmt * ( (Math.pow(1 + effMonthlyRate, months) - 1) / effMonthlyRate );
                    }
                }

                totalAmount = fvP + fvPMT;
                const totalContributed = p + (pmt * months);
                const totalInterest = totalAmount - totalContributed;

                document.getElementById('cc-result').innerText = fmt(totalAmount);
                document.getElementById('cc-interest').innerText = fmt(totalInterest);
            }
        };
    </script>
</body>
</html>