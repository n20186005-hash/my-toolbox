<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æˆ¿è²¸è¨ˆç®—å™¨æ¨¡å¡Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* æ¨¡æ“¬ä¸»ç¨‹å¼ç’°å¢ƒæ¨£å¼ */
        body { padding: 20px; background: #f0f9ff; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
    </style>
</head>
<body>

    <!-- ================================================================= -->
    <!-- ğŸ”´ å€åŸŸ 1ï¼šHTML ç©æœ¨ (è¤‡è£½åˆ° tools-wrapper) -->
    <!-- ================================================================= -->
    
    <div class="tool-module active" 
         data-id="mortgage_calc" 
         data-category="finance" 
         data-title="æˆ¿è²¸è¨ˆç®—å™¨" 
         data-icon="ğŸ ">
        
        <!-- èªè¨€é¸æ“‡å™¨ (å³ä¸Šè§’) -->
        <div class="absolute top-4 right-4">
            <select id="mc-lang" onchange="MortgageCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="zh-CN">ç°¡é«”ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="en">English</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                <option value="es">EspaÃ±ol</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">ğŸ  æˆ¿è²¸è¨ˆç®—å™¨</h2>
        
        <div class="grid grid-cols-1 gap-4 mb-4">
            <!-- é‚„æ¬¾æ–¹å¼ -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="method_label">é‚„æ¬¾æ–¹å¼</label>
                <div class="flex gap-4">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="mc-type" value="interest" checked class="text-blue-600 focus:ring-blue-500" onchange="MortgageCalc.calc()">
                        <span class="ml-2 text-sm" data-i18n="method_interest">ç­‰é¡æœ¬æ¯</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="mc-type" value="principal" class="text-blue-600 focus:ring-blue-500" onchange="MortgageCalc.calc()">
                        <span class="ml-2 text-sm" data-i18n="method_principal">ç­‰é¡æœ¬é‡‘</span>
                    </label>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="amount_label">è²¸æ¬¾é‡‘é¡ (å…ƒ)</label>
                    <input type="number" id="mc-amount" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="1000000">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="rate_label">å¹´åˆ©ç‡ (%)</label>
                    <input type="number" id="mc-rate" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="3.5" step="0.01">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="years_label">è²¸æ¬¾æœŸé™ (å¹´)</label>
                    <input type="number" id="mc-years" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="30">
                </div>
            </div>
        </div>

        <button onclick="MortgageCalc.calc()" class="w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 transition mb-6" data-i18n="btn_calc">è¨ˆç®—æœˆä¾›</button>

        <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-600" id="mc-monthly-label" data-i18n="res_monthly">æ¯æœˆé‚„æ¬¾</span>
                <div class="text-right">
                    <div id="mc-monthly" class="text-2xl font-bold text-blue-700">--</div>
                    <div id="mc-monthly-note" class="text-xs text-gray-500 hidden"></div>
                </div>
            </div>
            <div class="flex justify-between items-center text-sm mb-1">
                <span class="text-gray-500" data-i18n="res_interest">æ”¯ä»˜åˆ©æ¯ç¸½é¡</span>
                <span id="mc-total-interest" class="font-semibold text-gray-700">--</span>
            </div>
            <div class="flex justify-between items-center text-sm">
                <span class="text-gray-500" data-i18n="res_total">é‚„æ¬¾ç¸½é¡</span>
                <span id="mc-total-payment" class="font-semibold text-gray-700">--</span>
            </div>
        </div>
    </div>

    <!-- ================================================================= -->
    <!-- ğŸ”´ å€åŸŸ 1 çµæŸ -->
    <!-- ================================================================= -->


    <!-- ================================================================= -->
    <!-- ğŸ”´ å€åŸŸ 2ï¼šJS ç©æœ¨ (è¤‡è£½åˆ° script æ¨™ç±¤ä¸­) -->
    <!-- ================================================================= -->
    <script>
        const MortgageCalc = {
            // 1. å¤šèªè¨€é…ç½®
            i18n: {
                'zh-CN': {
                    title: 'ğŸ  æˆ¿è´·è®¡ç®—å™¨',
                    method_label: 'è¿˜æ¬¾æ–¹å¼',
                    method_interest: 'ç­‰é¢æœ¬æ¯ (æ¯æœˆå›ºå®š)',
                    method_principal: 'ç­‰é¢æœ¬é‡‘ (é¦–æœˆæœ€å¤š)',
                    amount_label: 'è´·æ¬¾é‡‘é¢ (å…ƒ)',
                    rate_label: 'å¹´åˆ©ç‡ (%)',
                    years_label: 'è´·æ¬¾æœŸé™ (å¹´)',
                    btn_calc: 'è®¡ç®—æœˆä¾›',
                    res_monthly: 'æ¯æœˆè¿˜æ¬¾',
                    res_first_month: 'é¦–æœˆè¿˜æ¬¾',
                    res_interest: 'æ”¯ä»˜åˆ©æ¯æ€»é¢',
                    res_total: 'è¿˜æ¬¾æ€»é¢',
                    note_decrease: 'æ¯æœˆé€’å‡'
                },
                'zh-TW': {
                    title: 'ğŸ  æˆ¿è²¸è¨ˆç®—å™¨',
                    method_label: 'é‚„æ¬¾æ–¹å¼',
                    method_interest: 'ç­‰é¡æœ¬æ¯ (æ¯æœˆå›ºå®š)',
                    method_principal: 'ç­‰é¡æœ¬é‡‘ (é¦–æœˆæœ€å¤š)',
                    amount_label: 'è²¸æ¬¾é‡‘é¡ (å…ƒ)',
                    rate_label: 'å¹´åˆ©ç‡ (%)',
                    years_label: 'è²¸æ¬¾æœŸé™ (å¹´)',
                    btn_calc: 'è¨ˆç®—æœˆä¾›',
                    res_monthly: 'æ¯æœˆé‚„æ¬¾',
                    res_first_month: 'é¦–æœˆé‚„æ¬¾',
                    res_interest: 'æ”¯ä»˜åˆ©æ¯ç¸½é¡',
                    res_total: 'é‚„æ¬¾ç¸½é¡',
                    note_decrease: 'æ¯æœˆéæ¸›'
                },
                'en': {
                    title: 'ğŸ  Mortgage Calculator',
                    method_label: 'Repayment Type',
                    method_interest: 'Equal Interest (Fixed)',
                    method_principal: 'Equal Principal (Decreasing)',
                    amount_label: 'Loan Amount',
                    rate_label: 'Annual Rate (%)',
                    years_label: 'Term (Years)',
                    btn_calc: 'Calculate',
                    res_monthly: 'Monthly Pay',
                    res_first_month: 'First Month Pay',
                    res_interest: 'Total Interest',
                    res_total: 'Total Payment',
                    note_decrease: 'Decr. by'
                },
                'ja': {
                    title: 'ğŸ  ä½å®…ãƒ­ãƒ¼ãƒ³è¨ˆç®—',
                    method_label: 'è¿”æ¸ˆæ–¹æ³•',
                    method_interest: 'å…ƒåˆ©å‡ç­‰ (æ¯æœˆå›ºå®š)',
                    method_principal: 'å…ƒé‡‘å‡ç­‰ (åˆå›æœ€å¤§)',
                    amount_label: 'å€Ÿå…¥é‡‘é¡ (å††)',
                    rate_label: 'å¹´åˆ© (%)',
                    years_label: 'è¿”æ¸ˆæœŸé–“ (å¹´)',
                    btn_calc: 'è¨ˆç®—ã™ã‚‹',
                    res_monthly: 'æ¯æœˆã®è¿”æ¸ˆé¡',
                    res_first_month: 'åˆå›è¿”æ¸ˆé¡',
                    res_interest: 'ç·æ”¯æ‰•åˆ©æ¯',
                    res_total: 'ç·è¿”æ¸ˆé¡',
                    note_decrease: 'æ¯æœˆæ¸›å°‘é¡'
                },
                'ru': {
                    title: 'ğŸ  Ğ˜Ğ¿Ğ¾Ñ‚ĞµÑ‡Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€',
                    method_label: 'Ğ¢Ğ¸Ğ¿ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°',
                    method_interest: 'ĞĞ½Ğ½ÑƒĞ¸Ñ‚ĞµÑ‚Ğ½Ñ‹Ğ¹ (Ğ Ğ°Ğ²Ğ½Ñ‹Ğ¹)',
                    method_principal: 'Ğ”Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ (Ğ£Ğ±Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹)',
                    amount_label: 'Ğ¡ÑƒĞ¼Ğ¼Ğ° ĞºÑ€ĞµĞ´Ğ¸Ñ‚Ğ°',
                    rate_label: 'Ğ“Ğ¾Ğ´Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ğ°Ğ²ĞºĞ° (%)',
                    years_label: 'Ğ¡Ñ€Ğ¾Ğº (Ğ»ĞµÑ‚)',
                    btn_calc: 'Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ',
                    res_monthly: 'Ğ•Ğ¶ĞµĞ¼ĞµÑÑÑ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶',
                    res_first_month: 'ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶',
                    res_interest: 'ĞĞ±Ñ‰Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ¿Ğ»Ğ°Ñ‚Ğ°',
                    res_total: 'ĞĞ±Ñ‰Ğ°Ñ Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚Ğ°',
                    note_decrease: 'Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞµĞ½Ğ¸Ğµ Ğ½Ğ°'
                },
                'es': {
                    title: 'ğŸ  Calculadora de Hipoteca',
                    method_label: 'Tipo de Pago',
                    method_interest: 'InterÃ©s Igual (Fijo)',
                    method_principal: 'Capital Igual (Decreciente)',
                    amount_label: 'Monto del PrÃ©stamo',
                    rate_label: 'Tasa Anual (%)',
                    years_label: 'Plazo (AÃ±os)',
                    btn_calc: 'Calcular',
                    res_monthly: 'Pago Mensual',
                    res_first_month: 'Primer Pago',
                    res_interest: 'InterÃ©s Total',
                    res_total: 'Pago Total',
                    note_decrease: 'Dism. por'
                }
            },

            // 2. åˆ‡æ›èªè¨€
            changeLang: () => {
                const lang = document.getElementById('mc-lang').value;
                const texts = MortgageCalc.i18n[lang];
                
                // æ›´æ–°éœæ…‹æ–‡æœ¬
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });

                // é‡æ–°è¨ˆç®—ä»¥æ›´æ–°å‹•æ…‹æ–‡æœ¬ï¼ˆå¦‚â€œé¦–æœˆé‚„æ¬¾â€æ¨™ç±¤ï¼‰
                MortgageCalc.calc(true); 
            },

            // 3. è¨ˆç®—é‚è¼¯
            calc: (isLangUpdate = false) => {
                // ç²å–è¼¸å…¥
                const p = parseFloat(document.getElementById('mc-amount').value); // æœ¬é‡‘
                const r_annual = parseFloat(document.getElementById('mc-rate').value); // å¹´åˆ©ç‡
                const years = parseFloat(document.getElementById('mc-years').value); // å¹´é™
                
                // ç²å–é‚„æ¬¾æ–¹å¼
                const typeRadios = document.getElementsByName('mc-type');
                let type = 'interest';
                for(let radio of typeRadios) { if(radio.checked) type = radio.value; }

                // ç²å–ç•¶å‰èªè¨€åŒ…
                const lang = document.getElementById('mc-lang').value;
                const t = MortgageCalc.i18n[lang];

                // æ ¼å¼åŒ–è²¨å¹£
                const fmt = (num) => num.toLocaleString(lang === 'en' ? 'en-US' : 'zh-CN', { style: 'currency', currency: lang === 'en' ? 'USD' : (lang === 'ja' ? 'JPY' : 'CNY') });

                // å¦‚æœæ²’æœ‰è¼¸å…¥å€¼ï¼Œåƒ…æ›´æ–°æ¨™ç±¤ä¸¦è¿”å›ï¼ˆç”¨æ–¼èªè¨€åˆ‡æ›æ™‚ï¼‰
                if (!p || !r_annual || !years) {
                    if (isLangUpdate) {
                         document.getElementById('mc-monthly-label').innerText = (type === 'principal') ? t.res_first_month : t.res_monthly;
                    }
                    // å¦‚æœä¸æ˜¯éœé»˜æ›´æ–°ä¸”è¼¸å…¥ç‚ºç©ºï¼Œæç¤ºç”¨æˆ¶
                    if (!isLangUpdate && (document.getElementById('mc-amount').value || document.getElementById('mc-rate').value)) {
                        // åªæœ‰ç•¶ç”¨æˆ¶å˜—è©¦è¨ˆç®—æ™‚æ‰å½ˆçª—
                    }
                    return;
                }

                const r = r_annual / 100 / 12; // æœˆåˆ©ç‡
                const n = years * 12; // ç¸½æœˆæ•¸

                let monthlyDisplay = "";
                let totalInterest = 0;
                let totalPayment = 0;
                let noteText = "";

                if (type === 'interest') {
                    // === ç­‰é¡æœ¬æ¯ ===
                    // å…¬å¼: M = P * [r(1+r)^n] / [(1+r)^n - 1]
                    const x = Math.pow(1 + r, n);
                    const monthly = (p * r * x) / (x - 1);
                    
                    totalPayment = monthly * n;
                    totalInterest = totalPayment - p;
                    monthlyDisplay = fmt(monthly);
                    
                    document.getElementById('mc-monthly-label').innerText = t.res_monthly;
                } else {
                    // === ç­‰é¡æœ¬é‡‘ ===
                    // æ¯æœˆæœ¬é‡‘
                    const monthlyPrincipal = p / n;
                    // é¦–æœˆæœˆä¾› = æ¯æœˆæœ¬é‡‘ + (å‰©é¤˜æœ¬é‡‘ * æœˆåˆ©ç‡)
                    const firstMonth = monthlyPrincipal + (p * r);
                    // æ¯æœˆéæ¸›é‡‘é¡ = æ¯æœˆæœ¬é‡‘ * æœˆåˆ©ç‡
                    const decrease = monthlyPrincipal * r;
                    
                    // ç¸½åˆ©æ¯ = (n+1) * P * r / 2
                    totalInterest = (n + 1) * p * r / 2;
                    totalPayment = p + totalInterest;

                    monthlyDisplay = fmt(firstMonth);
                    noteText = `${t.note_decrease} ${fmt(decrease)}`;
                    
                    document.getElementById('mc-monthly-label').innerText = t.res_first_month;
                }

                // æ›´æ–°ç•Œé¢
                document.getElementById('mc-monthly').innerText = monthlyDisplay;
                document.getElementById('mc-total-interest').innerText = fmt(totalInterest);
                document.getElementById('mc-total-payment').innerText = fmt(totalPayment);
                
                const noteEl = document.getElementById('mc-monthly-note');
                if (noteText) {
                    noteEl.innerText = noteText;
                    noteEl.classList.remove('hidden');
                } else {
                    noteEl.classList.add('hidden');
                }
            }
        };
    </script>
    <!-- ================================================================= -->
    <!-- ğŸ”´ å€åŸŸ 2 çµæŸ -->
    <!-- ================================================================= -->

</body>
</html>