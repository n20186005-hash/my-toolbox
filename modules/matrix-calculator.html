<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Calculator</title>
    
    <!-- Âü∫Á°Ä‰ø°ÊÅØ -->
    <meta name="tool-id" content="matrix_calc">
    <meta name="category" content="Math">
    <meta name="icon" content="üßÆ">
    
    <!-- ÈªòËÆ§Ëã±ÊñáÂÜÖÂÆπ -->
    <meta name="title" content="Matrix Calculator">
    <meta name="description" content="Perform matrix operations like addition, subtraction, multiplication, and inversion.">
    
    <!-- Â§öËØ≠Ë®ÄÈÖçÁΩÆ -->
    <meta name="lang-title-zh-CN" content="Áü©ÈòµËÆ°ÁÆóÂô®">
    <meta name="lang-description-zh-CN" content="ÊâßË°åÁü©ÈòµËøêÁÆóÔºåÂ¶ÇÂä†Ê≥ï„ÄÅÂáèÊ≥ï„ÄÅ‰πòÊ≥ïÂíåÊ±ÇÈÄÜ„ÄÇ">
    
    <meta name="lang-title-zh-TW" content="Áü©Èô£Ë®àÁÆóÂô®">
    <meta name="lang-description-zh-TW" content="Âü∑Ë°åÁü©Èô£ÈÅãÁÆóÔºåÂ¶ÇÂä†Ê≥ï„ÄÅÊ∏õÊ≥ï„ÄÅ‰πòÊ≥ïÂíåÊ±ÇÈÄÜ„ÄÇ">
    
    <meta name="lang-title-ja" content="Ë°åÂàóË®àÁÆó„ÉÑ„Éº„É´">
    <meta name="lang-description-ja" content="Ë°åÂàó„ÅÆÂä†ÁÆó„ÄÅÊ∏õÁÆó„ÄÅ‰πóÁÆó„ÄÅÈÄÜË°åÂàó„Å™„Å©„ÅÆÊºîÁÆó„ÇíÂÆüË°å„Åó„Åæ„Åô„ÄÇ">
    
    <meta name="lang-title-ru" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ç—Ä–∏—Ü">
    <meta name="lang-description-ru" content="–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞—Ç—Ä–∏—Ü–∞–º–∏: —Å–ª–æ–∂–µ–Ω–∏–µ, –≤—ã—á–∏—Ç–∞–Ω–∏–µ, —É–º–Ω–æ–∂–µ–Ω–∏–µ –∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0f9ff; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto; position: relative; }
        .matrix-input { display: grid; gap: 5px; margin: 10px 0; }
        .matrix-row { display: flex; gap: 5px; }
        .matrix-cell { width: 60px; height: 40px; text-align: center; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="matrix_calc" 
         data-category="math" 
         data-title="Matrix Calculator" 
         data-icon="üßÆ">
        
        <!-- ËØ≠Ë®ÄÈÄâÊã©Âô® -->
        <div class="absolute top-4 right-4">
            <select id="matrix-lang" onchange="MatrixCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en" selected>English</option>
                <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">üßÆ Matrix Calculator</h2>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="matrix_a">Matrix A</label>
            <div class="flex items-center gap-2 mb-2">
                <select id="rows-a" onchange="MatrixCalc.updateMatrix('a')" class="text-sm border rounded p-1">
                    <option value="2">2x2</option>
                    <option value="3" selected>3x3</option>
                    <option value="4">4x4</option>
                </select>
            </div>
            <div id="matrix-a" class="matrix-input grid-cols-3">
                <!-- Áü©ÈòµAËæìÂÖ•Ê°ÜÂ∞ÜÈÄöËøáJSÁîüÊàê -->
            </div>
        </div>

        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="matrix_b">Matrix B</label>
            <div class="flex items-center gap-2 mb-2">
                <select id="rows-b" onchange="MatrixCalc.updateMatrix('b')" class="text-sm border rounded p-1">
                    <option value="2">2x2</option>
                    <option value="3" selected>3x3</option>
                    <option value="4">4x4</option>
                </select>
            </div>
            <div id="matrix-b" class="matrix-input grid-cols-3">
                <!-- Áü©ÈòµBËæìÂÖ•Ê°ÜÂ∞ÜÈÄöËøáJSÁîüÊàê -->
            </div>
        </div>

        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="operation">Operation</label>
            <select id="operation" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                <option value="add" data-i18n="add">Addition</option>
                <option value="subtract" data-i18n="subtract">Subtraction</option>
                <option value="multiply" data-i18n="multiply">Multiplication</option>
                <option value="invert-a" data-i18n="invert_a">Invert Matrix A</option>
                <option value="invert-b" data-i18n="invert_b">Invert Matrix B</option>
            </select>
        </div>

        <button onclick="MatrixCalc.calc()" class="w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 transition mb-6" data-i18n="btn_calc">Calculate</button>

        <div class="bg-blue-50 p-6 rounded-lg border border-blue-100">
            <div class="text-sm text-gray-500 mb-2" data-i18n="result">Result</div>
            <div id="matrix-result" class="text-lg text-blue-800 min-h-[120px]">--</div>
            <div id="matrix-error" class="text-sm text-red-600 mt-2 hidden"></div>
        </div>
    </div>

    <script>
        const MatrixCalc = {
            i18n: {
                'en': {
                    title: 'üßÆ Matrix Calculator',
                    matrix_a: 'Matrix A',
                    matrix_b: 'Matrix B',
                    operation: 'Operation',
                    add: 'Addition (A + B)',
                    subtract: 'Subtraction (A - B)',
                    multiply: 'Multiplication (A √ó B)',
                    invert_a: 'Invert Matrix A',
                    invert_b: 'Invert Matrix B',
                    btn_calc: 'Calculate',
                    result: 'Result',
                    err_invalid: 'Invalid matrix values',
                    err_dimensions: 'Incompatible dimensions',
                    err_singular: 'Matrix is singular (non-invertible)'
                },
                'zh-CN': {
                    title: 'üßÆ Áü©ÈòµËÆ°ÁÆóÂô®',
                    matrix_a: 'Áü©Èòµ A',
                    matrix_b: 'Áü©Èòµ B',
                    operation: 'ËøêÁÆó',
                    add: 'Âä†Ê≥ï (A + B)',
                    subtract: 'ÂáèÊ≥ï (A - B)',
                    multiply: '‰πòÊ≥ï (A √ó B)',
                    invert_a: 'Áü©Èòµ A Ê±ÇÈÄÜ',
                    invert_b: 'Áü©Èòµ B Ê±ÇÈÄÜ',
                    btn_calc: 'ËÆ°ÁÆó',
                    result: 'ÁªìÊûú',
                    err_invalid: 'Êó†ÊïàÁöÑÁü©ÈòµÂÄº',
                    err_dimensions: 'Áª¥Â∫¶‰∏çÂÖºÂÆπ',
                    err_singular: 'Áü©Èòµ‰∏∫Â•áÂºÇÁü©ÈòµÔºà‰∏çÂèØÈÄÜÔºâ'
                },
                'zh-TW': {
                    title: 'üßÆ Áü©Èô£Ë®àÁÆóÂô®',
                    matrix_a: 'Áü©Èô£ A',
                    matrix_b: 'Áü©Èô£ B',
                    operation: 'ÈÅãÁÆó',
                    add: 'Âä†Ê≥ï (A + B)',
                    subtract: 'Ê∏õÊ≥ï (A - B)',
                    multiply: '‰πòÊ≥ï (A √ó B)',
                    invert_a: 'Áü©Èô£ A Ê±ÇÈÄÜ',
                    invert_b: 'Áü©Èô£ B Ê±ÇÈÄÜ',
                    btn_calc: 'Ë®àÁÆó',
                    result: 'ÁµêÊûú',
                    err_invalid: 'ÁÑ°ÊïàÁöÑÁü©Èô£ÂÄº',
                    err_dimensions: 'Á∂≠Â∫¶‰∏çÁõ∏ÂÆπ',
                    err_singular: 'Áü©Èô£ÁÇ∫Â•áÁï∞Áü©Èô£Ôºà‰∏çÂèØÈÄÜÔºâ'
                },
                'ja': {
                    title: 'üßÆ Ë°åÂàóË®àÁÆó„ÉÑ„Éº„É´',
                    matrix_a: 'Ë°åÂàó A',
                    matrix_b: 'Ë°åÂàó B',
                    operation: 'ÊºîÁÆó',
                    add: 'Âä†ÁÆó (A + B)',
                    subtract: 'Ê∏õÁÆó (A - B)',
                    multiply: '‰πóÁÆó (A √ó B)',
                    invert_a: 'Ë°åÂàó A „ÅÆÈÄÜË°åÂàó',
                    invert_b: 'Ë°åÂàó B „ÅÆÈÄÜË°åÂàó',
                    btn_calc: 'Ë®àÁÆó„Åô„Çã',
                    result: 'ÁµêÊûú',
                    err_invalid: 'ÁÑ°Âäπ„Å™Ë°åÂàóÂÄ§',
                    err_dimensions: 'Ê¨°ÂÖÉ„Åå‰∫íÊèõÊÄß„Åå„ÅÇ„Çä„Åæ„Åõ„Çì',
                    err_singular: 'Ë°åÂàó„ÅØÁâπÁï∞Ë°åÂàó„Åß„ÅôÔºàÈÄÜË°åÂàó„ÅåÂ≠òÂú®„Åó„Åæ„Åõ„ÇìÔºâ'
                },
                'ru': {
                    title: 'üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ç—Ä–∏—Ü',
                    matrix_a: '–ú–∞—Ç—Ä–∏—Ü–∞ A',
                    matrix_b: '–ú–∞—Ç—Ä–∏—Ü–∞ B',
                    operation: '–û–ø–µ—Ä–∞—Ü–∏—è',
                    add: '–°–ª–æ–∂–µ–Ω–∏–µ (A + B)',
                    subtract: '–í—ã—á–∏—Ç–∞–Ω–∏–µ (A - B)',
                    multiply: '–£–º–Ω–æ–∂–µ–Ω–∏–µ (A √ó B)',
                    invert_a: '–û–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ A',
                    invert_b: '–û–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ B',
                    btn_calc: '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å',
                    result: '–†–µ–∑—É–ª—å—Ç–∞—Ç',
                    err_invalid: '–ù–µ–≤–µ—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–∞—Ç—Ä–∏—Ü—ã',
                    err_dimensions: '–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ä–∞–∑–º–µ—Ä—ã',
                    err_singular: '–ú–∞—Ç—Ä–∏—Ü–∞ —Å–∏–Ω–≥—É–ª—è—Ä–Ω–∞ (–Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞)'
                }
            },

            init: () => {
                // ÂàùÂßãÂåñÁü©ÈòµËæìÂÖ•Ê°Ü
                MatrixCalc.updateMatrix('a');
                MatrixCalc.updateMatrix('b');
                // ËÆæÁΩÆÈªòËÆ§ÂÄº
                MatrixCalc.setDefaultValues();
            },

            setDefaultValues: () => {
                // ‰∏∫3x3Áü©ÈòµËÆæÁΩÆÈªòËÆ§ÂÄº
                const cellsA = document.querySelectorAll('#matrix-a input');
                const cellsB = document.querySelectorAll('#matrix-b input');
                
                [1, 2, 3, 4, 5, 6, 7, 8, 9].forEach((val, i) => {
                    if (cellsA[i]) cellsA[i].value = val;
                });
                
                [9, 8, 7, 6, 5, 4, 3, 2, 1].forEach((val, i) => {
                    if (cellsB[i]) cellsB[i].value = val;
                });
            },

            updateMatrix: (matrixId) => {
                const rows = parseInt(document.getElementById(`rows-${matrixId}`).value);
                const container = document.getElementById(`matrix-${matrixId}`);
                container.innerHTML = '';
                container.className = `matrix-input grid-cols-${rows}`;
                
                for (let i = 0; i < rows; i++) {
                    const row = document.createElement('div');
                    row.className = 'matrix-row';
                    
                    for (let j = 0; j < rows; j++) {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.className = 'matrix-cell border rounded focus:ring-2 focus:ring-blue-500 outline-none';
                        input.placeholder = `${i+1},${j+1}`;
                        row.appendChild(input);
                    }
                    container.appendChild(row);
                }
            },

            changeLang: () => {
                const lang = document.getElementById('matrix-lang').value;
                const texts = MatrixCalc.i18n[lang];
                
                // Êõ¥Êñ∞ÊôÆÈÄöÊñáÊú¨
                document.querySelectorAll('[data-id="matrix_calc"] [data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });
                
                // Êõ¥Êñ∞‰∏ãÊãâÈÄâÈ°π
                const operation = document.getElementById('operation');
                Object.keys(texts).forEach(key => {
                    const option = operation.querySelector(`option[value="${key}"]`);
                    if (option) option.innerText = texts[key];
                });
            },

            getMatrix: (matrixId) => {
                const container = document.getElementById(`matrix-${matrixId}`);
                const rows = container.querySelectorAll('.matrix-row');
                const matrix = [];
                
                rows.forEach(row => {
                    const cells = row.querySelectorAll('input');
                    const rowData = [];
                    cells.forEach(cell => {
                        const value = parseFloat(cell.value);
                        if (isNaN(value)) return null;
                        rowData.push(value);
                    });
                    matrix.push(rowData);
                });
                
                return matrix;
            },

            renderMatrix: (matrix) => {
                if (!matrix || matrix.length === 0) return '';
                
                let html = '<div class="matrix-input inline-block">';
                matrix.forEach(row => {
                    html += '<div class="matrix-row">';
                    row.forEach(cell => {
                        html += `<div class="matrix-cell border rounded bg-white flex items-center justify-center">${cell.toFixed(4).replace(/\.?0+$/, '')}</div>`;
                    });
                    html += '</div>';
                });
                html += '</div>';
                return html;
            },

            showError: (message) => {
                const resultEl = document.getElementById('matrix-result');
                const errorEl = document.getElementById('matrix-error');
                
                resultEl.innerHTML = '';
                errorEl.innerText = message;
                errorEl.classList.remove('hidden');
            },

            calc: () => {
                const lang = document.getElementById('matrix-lang').value;
                const texts = MatrixCalc.i18n[lang];
                const operation = document.getElementById('operation').value;
                const resultEl = document.getElementById('matrix-result');
                const errorEl = document.getElementById('matrix-error');
                
                // ÈáçÁΩÆÁªìÊûúÂå∫Âüü
                errorEl.classList.add('hidden');
                resultEl.innerHTML = '';
                
                // Ëé∑ÂèñÁü©ÈòµÊï∞ÊçÆ
                const matrixA = MatrixCalc.getMatrix('a');
                const matrixB = MatrixCalc.getMatrix('b');
                
                // È™åËØÅÁü©Èòµ
                if (!matrixA || !matrixB) {
                    return MatrixCalc.showError(texts.err_invalid);
                }
                
                let result;
                try {
                    switch (operation) {
                        case 'add':
                            result = MatrixCalc.add(matrixA, matrixB);
                            break;
                        case 'subtract':
                            result = MatrixCalc.subtract(matrixA, matrixB);
                            break;
                        case 'multiply':
                            result = MatrixCalc.multiply(matrixA, matrixB);
                            break;
                        case 'invert-a':
                            result = MatrixCalc.invert(matrixA);
                            break;
                        case 'invert-b':
                            result = MatrixCalc.invert(matrixB);
                            break;
                    }
                } catch (e) {
                    return MatrixCalc.showError(e.message || texts.err_invalid);
                }
                
                resultEl.innerHTML = MatrixCalc.renderMatrix(result);
            },

            // Áü©ÈòµÂä†Ê≥ï
            add: (a, b) => {
                const lang = document.getElementById('matrix-lang').value;
                const texts = MatrixCalc.i18n[lang];
                
                if (a.length !== b.length || a[0].length !== b[0].length) {
                    throw new Error(texts.err_dimensions);
                }
                
                return a.map((row, i) => 
                    row.map((val, j) => val + b[i][j])
                );
            },

            // Áü©ÈòµÂáèÊ≥ï
            subtract: (a, b) => {
                const lang = document.getElementById('matrix-lang').value;
                const texts = MatrixCalc.i18n[lang];
                
                if (a.length !== b.length || a[0].length !== b[0].length) {
                    throw new Error(texts.err_dimensions);
                }
                
                return a.map((row, i) => 
                    row.map((val, j) => val - b[i][j])
                );
            },

            // Áü©Èòµ‰πòÊ≥ï
            multiply: (a, b) => {
                const lang = document.getElementById('matrix-lang').value;
                const texts = MatrixCalc.i18n[lang];
                
                if (a[0].length !== b.length) {
                    throw new Error(texts.err_dimensions);
                }
                
                const result = [];
                for (let i = 0; i < a.length; i++) {
                    result[i] = [];
                    for (let j = 0; j < b[0].length; j++) {
                        let sum = 0;
                        for (let k = 0; k < a[0].length; k++) {
                            sum += a[i][k] * b[k][j];
                        }
                        result[i][j] = sum;
                    }
                }
                return result;
            },

            // Áü©ÈòµÊ±ÇÈÄÜ (ÁÆÄÂåñÁâàÔºå‰ªÖÊîØÊåÅ2x2Âíå3x3)
            invert: (matrix) => {
                const lang = document.getElementById('matrix-lang').value;
                const texts = MatrixCalc.i18n[lang];
                const n = matrix.length;
                
                if (n !== 2 && n !== 3) {
                    throw new Error(texts.err_dimensions);
                }
                
                // ËÆ°ÁÆóË°åÂàóÂºè
                const det = n === 2 
                    ? matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0]
                    : MatrixCalc.determinant3x3(matrix);
                
                if (Math.abs(det) < 1e-9) {
                    throw new Error(texts.err_singular);
                }
                
                // ËÆ°ÁÆó‰º¥ÈöèÁü©Èòµ
                const adjugate = n === 2 
                    ? [
                        [matrix[1][1], -matrix[0][1]],
                        [-matrix[1][0], matrix[0][0]]
                    ]
                    : MatrixCalc.adjugate3x3(matrix);
                
                // ‰º¥ÈöèÁü©ÈòµÈô§‰ª•Ë°åÂàóÂºè
                return adjugate.map(row => row.map(val => val / det));
            },

            // 3x3Áü©ÈòµË°åÂàóÂºè
            determinant3x3: (m) => {
                return m[0][0] * (m[1][1] * m[2][2] - m[1][2] * m[2][1])
                     - m[0][1] * (m[1][0] * m[2][2] - m[1][2] * m[2][0])
                     + m[0][2] * (m[1][0] * m[2][1] - m[1][1] * m[2][0]);
            },

            // 3x3Áü©Èòµ‰º¥ÈöèÁü©Èòµ
            adjugate3x3: (m) => {
                return [
                    [
                        m[1][1] * m[2][2] - m[1][2] * m[2][1],
                        m[0][2] * m[2][1] - m[0][1] * m[2][2],
                        m[0][1] * m[1][2] - m[0][2] * m[1][1]
                    ],
                    [
                        m[1][2] * m[2][0] - m[1][0] * m[2][2],
                        m[0][0] * m[2][2] - m[0][2] * m[2][0],
                        m[0][2] * m[1][0] - m[0][0] * m[1][2]
                    ],
                    [
                        m[1][0] * m[2][1] - m[1][1] * m[2][0],
                        m[0][1] * m[2][0] - m[0][0] * m[2][1],
                        m[0][0] * m[1][1] - m[0][1] * m[1][0]
                    ]
                ];
            }
        };

        document.addEventListener('DOMContentLoaded', MatrixCalc.init);
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Ëá™Âä®ÂåπÈÖçÊµèËßàÂô®ËØ≠Ë®Ä
            const userLang = navigator.language || navigator.userLanguage;
            let targetLang = 'en'; 
            if (userLang.startsWith('zh')) {
                targetLang = userLang.includes('TW') || userLang.includes('HK') ? 'zh-TW' : 'zh-CN';
            } else if (userLang.startsWith('ja')) {
                targetLang = 'ja';
            } else if (userLang.startsWith('ru')) {
                targetLang = 'ru';
            }
            
            if (targetLang !== 'en') {
                const langSelect = document.getElementById('matrix-lang');
                if(langSelect) {
                    langSelect.value = targetLang;
                    MatrixCalc.changeLang();
                }
            }
        });
    </script>

</body>

</html>
