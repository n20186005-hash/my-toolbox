<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Insurance Calculator</title>
    <meta name="tool-id" content="medical_insurance_calculator">
    <meta name="category" content="finance">
    <meta name="icon" content="üè•">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif; background-color: #f3f4f6; }
        
        /* Ê†áÁ≠æÈ°µÊ†∑Âºè */
        .nav-btn { position: relative; transition: all 0.3s; }
        .nav-btn.active { color: #10b981; background-color: #dcfce7; }
        .nav-btn.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background-color: #10b981; border-radius: 3px 3px 0 0;
        }

        /* Âä®Áîª */
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ËæìÂÖ•Ê°ÜÂéªÁÆ≠Â§¥ */
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* Ë°®Ê†ºÊªöÂä®Êù° */
        .custom-scroll::-webkit-scrollbar { height: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col">

    <div class="max-w-6xl mx-auto w-full flex-grow">
        
        <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-6 sticky top-2 z-20">
            <div class="flex flex-col md:flex-row justify-between items-center p-3 md:px-6">
                <!-- Logo & Title -->
                <div class="flex items-center gap-3 mb-3 md:mb-0 w-full md:w-auto">
                    <div class="bg-gradient-to-br from-emerald-600 to-emerald-500 text-white p-2.5 rounded-lg shadow-md">
                        <i class="fa-solid fa-heartbeat text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-800 leading-tight" data-i18n="app_title">Medical Insurance Calculator</h1>
                        <p class="text-xs text-gray-400" data-i18n="app_subtitle">Healthcare Cost Assistant</p>
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex items-center gap-3 w-full md:w-auto justify-between md:justify-end">
                    <!-- Language Selector -->
                    <div class="relative group">
                        <select id="lang-select" onchange="I18nModule.changeLanguage(this.value)" class="appearance-none bg-white border border-gray-200 text-gray-700 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block p-2 pr-8 cursor-pointer font-medium hover:border-emerald-300 transition">
                            <option value="en">üá∫üá∏ English</option>
                            <option value="zh-CN">üá®üá≥ ÁÆÄ‰Ωì‰∏≠Êñá</option>
                            <option value="zh-TW">üá≠üá∞ ÁπÅÈ´î‰∏≠Êñá</option>
                            <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                            <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                            <i class="fa-solid fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden min-h-[600px] relative">
            
            <!-- Âåª‰øùËÆ°ÁÆóÊ®°Âùó -->
            <div id="view-insurance" class="fade-in p-6 md:p-8">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-full">
                    <!-- Â∑¶‰æß: ËæìÂÖ• -->
                    <div class="lg:col-span-4 flex flex-col gap-6">
                        <div class="bg-emerald-50 p-6 rounded-2xl border border-emerald-100 shadow-sm">
                            <h3 class="text-lg font-bold text-gray-800 mb-5 flex items-center gap-2">
                                <i class="fa-solid fa-user-doctor text-emerald-500"></i> <span data-i18n="params_title">Insurance Parameters</span>
                            </h3>
                            
                            <div class="space-y-4">
                                <div class="group">
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="salary_label">Monthly Salary</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400"><i class="fa-solid fa-money-bill"></i></div>
                                        <input type="number" id="insurance-salary" step="100" class="w-full pl-9 pr-3 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition bg-white" placeholder="5000">
                                    </div>
                                </div>

                                <div class="group">
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="rate_label">Company Contribution (%)</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400"><i class="fa-solid fa-building"></i></div>
                                        <input type="number" id="insurance-company" step="0.1" value="12" class="w-full pl-9 pr-3 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none transition bg-white" placeholder="12">
                                    </div>
                                </div>

                                <div class="group">
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="personal_label">Personal Contribution (%)</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400"><i class="fa-solid fa-user"></i></div>
                                        <input type="number" id="insurance-personal" step="0.1" value="8" class="w-full pl-9 pr-3 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none transition bg-white" placeholder="8">
                                    </div>
                                </div>

                                <div class="group">
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="threshold_label">Minimum Threshold</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400"><i class="fa-solid fa-line-horizontal"></i></div>
                                        <input type="number" id="insurance-threshold" step="100" value="3000" class="w-full pl-9 pr-3 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none transition bg-white" placeholder="3000">
                                    </div>
                                </div>

                                <button onclick="InsuranceModule.calculate()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3.5 rounded-xl shadow-lg hover:shadow-emerald-500/30 transition-all transform active:scale-95 mt-2 flex justify-center items-center gap-2 group">
                                    <i class="fa-solid fa-calculator group-hover:animate-pulse"></i> <span data-i18n="btn_calc">Calculate</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- ÊèêÁ§∫Âç°Áâá -->
                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-100 text-xs text-gray-500 leading-relaxed">
                            <i class="fa-solid fa-circle-info text-emerald-400 mr-1"></i> <span data-i18n="insurance_formula_hint">Formula: Contribution = Max(Salary, Minimum Threshold) √ó Rate</span>
                        </div>
                    </div>

                    <!-- Âè≥‰æß: ÁªìÊûú -->
                    <div class="lg:col-span-8 flex flex-col h-full">
                        <div class="flex justify-between items-end mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800" data-i18n="results_title">Calculation Results</h3>
                                <p class="text-sm text-gray-400 mt-1" data-i18n="results_subtitle">Insurance contribution breakdown</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="App.exportCSV('insurance')" class="text-xs font-medium text-emerald-600 hover:text-emerald-800 px-3 py-2 bg-emerald-50 rounded-lg hover:bg-emerald-100 transition flex items-center gap-1">
                                    <i class="fa-solid fa-download"></i> <span data-i18n="btn_export">Export</span>
                                </button>
                                <button onclick="App.clearData('insurance')" class="text-xs font-medium text-red-500 hover:text-red-700 px-3 py-2 bg-red-50 rounded-lg hover:bg-red-100 transition flex items-center gap-1">
                                    <i class="fa-regular fa-trash-can"></i> <span data-i18n="btn_clear">Clear</span>
                                </button>
                            </div>
                        </div>

                        <div class="flex-grow overflow-hidden rounded-xl border border-gray-200 bg-white relative">
                            <div class="absolute inset-0 overflow-auto custom-scroll">
                                <table class="w-full text-sm text-left text-gray-600">
                                    <thead class="text-xs text-gray-500 uppercase bg-gray-50/80 sticky top-0 backdrop-blur-sm z-10">
                                        <tr>
                                            <th class="px-5 py-3 font-semibold" data-i18n="col_salary">Salary</th>
                                            <th class="px-5 py-3 font-semibold" data-i18n="col_company">Company</th>
                                            <th class="px-5 py-3 font-semibold" data-i18n="col_personal">Personal</th>
                                            <th class="px-5 py-3 font-semibold text-emerald-600" data-i18n="col_total">Total</th>
                                            <th class="px-5 py-3 text-center" data-i18n="col_action">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="insurance-list" class="divide-y divide-gray-100">
                                        <!-- Data Injected Here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        
        <div class="text-center mt-6 text-gray-400 text-xs">
            &copy; 2024 Medical Insurance Tools. All calculations are performed locally.
        </div>
    </div>

    <script>
        /**
         * ÂõΩÈôÖÂåñÊ®°Âùó (I18N Module)
         */
        const I18nModule = {
            currentLang: 'en',
            
            data: {
                'en': {
                    app_title: 'Medical Insurance Calculator',
                    app_subtitle: 'Healthcare Cost Assistant',
                    params_title: 'Insurance Parameters',
                    salary_label: 'Monthly Salary',
                    rate_label: 'Company Contribution (%)',
                    personal_label: 'Personal Contribution (%)',
                    threshold_label: 'Minimum Threshold',
                    btn_calc: 'Calculate',
                    insurance_formula_hint: 'Formula: Contribution = Max(Salary, Minimum Threshold) √ó Rate',
                    results_title: 'Calculation Results',
                    results_subtitle: 'Insurance contribution breakdown',
                    btn_export: 'Export CSV',
                    btn_clear: 'Clear',
                    col_salary: 'Salary',
                    col_company: 'Company Pay',
                    col_personal: 'Personal Pay',
                    col_total: 'Total Contribution',
                    col_action: 'Action',
                    empty_data: 'No data yet. Enter parameters to start.',
                    confirm_clear: 'Are you sure you want to clear all data?'
                },
                'zh-CN': {
                    app_title: 'Âåª‰øùËÆ°ÁÆóÂô®',
                    app_subtitle: 'ÂåªÁñó‰øùÈöúËÆ°ÁÆóÂä©Êâã',
                    params_title: 'ÂèÇ‰øùÂèÇÊï∞',
                    salary_label: 'ÊúàÂ∑•ËµÑÊî∂ÂÖ•',
                    rate_label: 'Âçï‰ΩçÁº¥Á∫≥ÊØî‰æã (%)',
                    personal_label: '‰∏™‰∫∫Áº¥Á∫≥ÊØî‰æã (%)',
                    threshold_label: 'ÊúÄ‰ΩéÁº¥Ë¥πÂü∫Êï∞',
                    btn_calc: 'ÂºÄÂßãËÆ°ÁÆó',
                    insurance_formula_hint: 'ËÆ°ÁÆóÂÖ¨ÂºèÔºöÁº¥Ë¥πÈáëÈ¢ù =  max(Â∑•ËµÑ, ÊúÄ‰ΩéÂü∫Êï∞) √ó Áº¥Ë¥πÊØî‰æã',
                    results_title: 'ËÆ°ÁÆóÁªìÊûú',
                    results_subtitle: 'Âåª‰øùÁº¥Ë¥πÊòéÁªÜ',
                    btn_export: 'ÂØºÂá∫Ë°®Ê†º',
                    btn_clear: 'Ê∏ÖÁ©∫',
                    col_salary: 'Â∑•ËµÑÊî∂ÂÖ•',
                    col_company: 'Âçï‰ΩçÁº¥Á∫≥',
                    col_personal: '‰∏™‰∫∫Áº¥Á∫≥',
                    col_total: 'ÊÄªÁº¥Ë¥πÈ¢ù',
                    col_action: 'Êìç‰Ωú',
                    empty_data: 'ÊöÇÊó†Êï∞ÊçÆÔºåËØ∑Âú®Â∑¶‰æßËæìÂÖ•ÂèÇÊï∞Âπ∂ËÆ°ÁÆó„ÄÇ',
                    confirm_clear: 'Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆÂêóÔºü'
                },
                'zh-TW': {
                    app_title: 'ÈÜ´‰øùË®àÁÆóÂô®',
                    app_subtitle: 'ÈÜ´ÁôÇ‰øùÈöúË®àÁÆóÂä©Êâã',
                    params_title: 'ÂèÉ‰øùÂèÉÊï∏',
                    salary_label: 'ÊúàÂ∑•Ë≥áÊî∂ÂÖ•',
                    rate_label: 'ÂñÆ‰ΩçÁπ≥Á¥çÊØî‰æã (%)',
                    personal_label: 'ÂÄã‰∫∫Áπ≥Á¥çÊØî‰æã (%)',
                    threshold_label: 'ÊúÄ‰ΩéÁπ≥Ë≤ªÂü∫Êï∏',
                    btn_calc: 'ÈñãÂßãË®àÁÆó',
                    insurance_formula_hint: 'Ë®àÁÆóÂÖ¨ÂºèÔºöÁπ≥Ë≤ªÈáëÈ°ç =  max(Â∑•Ë≥á, ÊúÄ‰ΩéÂü∫Êï∏) √ó Áπ≥Ë≤ªÊØî‰æã',
                    results_title: 'Ë®àÁÆóÁµêÊûú',
                    results_subtitle: 'ÈÜ´‰øùÁπ≥Ë≤ªÊòéÁ¥∞',
                    btn_export: 'Â∞éÂá∫Ë°®Ê†º',
                    btn_clear: 'Ê∏ÖÁ©∫',
                    col_salary: 'Â∑•Ë≥áÊî∂ÂÖ•',
                    col_company: 'ÂñÆ‰ΩçÁπ≥Á¥ç',
                    col_personal: 'ÂÄã‰∫∫Áπ≥Á¥ç',
                    col_total: 'Á∏ΩÁπ≥Ë≤ªÈ°ç',
                    col_action: 'Êìç‰Ωú',
                    empty_data: 'Êö´ÁÑ°Êï∏ÊìöÔºåË´ãÂú®Â∑¶ÂÅ¥Ëº∏ÂÖ•ÂèÉÊï∏‰∏¶Ë®àÁÆó„ÄÇ',
                    confirm_clear: 'Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊï∏ÊìöÂóéÔºü'
                },
                'ja': {
                    app_title: 'ÂåªÁôÇ‰øùÈô∫Ë®àÁÆóÊ©ü',
                    app_subtitle: 'ÂåªÁôÇË≤ªÊîØÊè¥„ÉÑ„Éº„É´',
                    params_title: '‰øùÈô∫„Éë„É©„É°„Éº„Çø',
                    salary_label: 'ÊúàÂèé',
                    rate_label: '‰ºöÁ§æË≤†ÊãÖÁéá (%)',
                    personal_label: 'ÂÄã‰∫∫Ë≤†ÊãÖÁéá (%)',
                    threshold_label: 'ÊúÄ‰ΩéÂü∫Ê∫ñÈ°ç',
                    btn_calc: 'Ë®àÁÆó„Åô„Çã',
                    insurance_formula_hint: 'Ë®àÁÆóÂºèÔºöË≤†ÊãÖÈ°ç = max(Áµ¶‰∏é, ÊúÄ‰ΩéÂü∫Ê∫ñÈ°ç) √ó Ë≤†ÊãÖÁéá',
                    results_title: 'Ë®àÁÆóÁµêÊûú',
                    results_subtitle: 'ÂåªÁôÇ‰øùÈô∫Ë≤†ÊãÖÊòéÁ¥∞',
                    btn_export: 'CSVÂá∫Âäõ',
                    btn_clear: '„ÇØ„É™„Ç¢',
                    col_salary: 'Áµ¶‰∏é',
                    col_company: '‰ºöÁ§æË≤†ÊãÖ',
                    col_personal: 'ÂÄã‰∫∫Ë≤†ÊãÖ',
                    col_total: 'Á∑èË≤†ÊãÖÈ°ç',
                    col_action: 'Êìç‰Ωú',
                    empty_data: '„Éá„Éº„Çø„Å™„Åó„ÄÇÂ∑¶ÂÅ¥„Åß„Éë„É©„É°„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                    confirm_clear: '„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü'
                },
                'ru': {
                    app_title: '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è',
                    app_subtitle: '–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º —Ä–∞—Å—Ö–æ–¥–∞–º',
                    params_title: '–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è',
                    salary_label: '–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞',
                    rate_label: '–í–∫–ª–∞–¥ –∫–æ–º–ø–∞–Ω–∏–∏ (%)',
                    personal_label: '–õ–∏—á–Ω—ã–π –≤–∫–ª–∞–¥ (%)',
                    threshold_label: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–∞–Ω–∫–∞',
                    btn_calc: '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å',
                    insurance_formula_hint: '–§–æ—Ä–º—É–ª–∞: –í–∫–ª–∞–¥ = Max(–ó–∞—Ä–ø–ª–∞—Ç–∞, –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–∞–Ω–∫–∞) √ó –°—Ç–∞–≤–∫–∞',
                    results_title: '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞',
                    results_subtitle: '–†–∞–∑–±–∏–≤–∫–∞ –≤–∑–Ω–æ—Å–æ–≤ –ø–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—é',
                    btn_export: '–≠–∫—Å–ø–æ—Ä—Ç',
                    btn_clear: '–û—á–∏—Å—Ç–∏—Ç—å',
                    col_salary: '–ó–∞—Ä–ø–ª–∞—Ç–∞',
                    col_company: '–ö–æ–º–ø–∞–Ω–∏—è –ø–ª–∞—Ç–∏—Ç',
                    col_personal: '–õ–∏—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂',
                    col_total: '–û–±—â–∏–π –≤–∑–Ω–æ—Å',
                    col_action: '–î–µ–π—Å—Ç–≤–∏–µ',
                    empty_data: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –Ω–∞—á–∞–ª–∞.',
                    confirm_clear: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?'
                }
            },

            init: () => {
                const saved = localStorage.getItem('insurance_lang');
                if (saved && I18nModule.data[saved]) {
                    I18nModule.currentLang = saved;
                } else {
                    const navLang = navigator.language;
                    if (navLang.startsWith('zh')) I18nModule.currentLang = navLang.includes('TW') || navLang.includes('HK') ? 'zh-TW' : 'zh-CN';
                    else if (navLang.startsWith('ja')) I18nModule.currentLang = 'ja';
                    else if (navLang.startsWith('ru')) I18nModule.currentLang = 'ru';
                    else I18nModule.currentLang = 'en';
                }
                document.getElementById('lang-select').value = I18nModule.currentLang;
                I18nModule.apply();
            },

            changeLanguage: (lang) => {
                I18nModule.currentLang = lang;
                localStorage.setItem('insurance_lang', lang);
                I18nModule.apply();
                InsuranceModule.render();
            },

            apply: () => {
                const texts = I18nModule.data[I18nModule.currentLang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(texts[key]) {
                        if (el.tagName === 'INPUT') el.placeholder = texts[key];
                        else el.innerText = texts[key];
                    }
                });
                document.documentElement.lang = I18nModule.currentLang;
            },

            t: (key) => {
                return I18nModule.data[I18nModule.currentLang][key] || key;
            }
        };

        /**
         * Â≠òÂÇ®Ê®°Âùó (Storage Module)
         */
        const StorageModule = {
            get: (key) => JSON.parse(localStorage.getItem(key)) || [],
            set: (key, data) => localStorage.setItem(key, JSON.stringify(data))
        };

        /**
         * Âåª‰øùËÆ°ÁÆóÊ®°Âùó (Insurance Module)
         */
        const InsuranceModule = {
            data: [],
            
            init: () => {
                InsuranceModule.data = StorageModule.get('insurance_history');
                InsuranceModule.render();
            },

            calculate: () => {
                const salary = parseFloat(document.getElementById('insurance-salary').value);
                const companyRate = parseFloat(document.getElementById('insurance-company').value) || 0;
                const personalRate = parseFloat(document.getElementById('insurance-personal').value) || 0;
                const threshold = parseFloat(document.getElementById('insurance-threshold').value) || 0;

                if (isNaN(salary) || salary <= 0) return alert(I18nModule.t('empty_data'));

                // Calculate based on max of salary and threshold
                const base = Math.max(salary, threshold);
                const companyPay = (base * companyRate / 100).toFixed(2);
                const personalPay = (base * personalRate / 100).toFixed(2);
                const total = (parseFloat(companyPay) + parseFloat(personalPay)).toFixed(2);

                const record = {
                    id: Date.now(),
                    salary: salary.toFixed(2),
                    threshold: threshold.toFixed(2),
                    companyRate: companyRate,
                    personalRate: personalRate,
                    companyPay: companyPay,
                    personalPay: personalPay,
                    total: total
                };

                InsuranceModule.data.unshift(record);
                if (InsuranceModule.data.length > 50) InsuranceModule.data.pop();
                
                StorageModule.set('insurance_history', InsuranceModule.data);
                InsuranceModule.render();
            },

            delete: (id) => {
                InsuranceModule.data = InsuranceModule.data.filter(item => item.id !== id);
                StorageModule.set('insurance_history', InsuranceModule.data);
                InsuranceModule.render();
            },

            clear: () => {
                if(confirm(I18nModule.t('confirm_clear'))) {
                    InsuranceModule.data = [];
                    StorageModule.set('insurance_history', InsuranceModule.data);
                    InsuranceModule.render();
                }
            },

            render: () => {
                const tbody = document.getElementById('insurance-list');
                if (InsuranceModule.data.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-gray-400 italic">${I18nModule.t('empty_data')}</td></tr>`;
                    return;
                }
                
                tbody.innerHTML = InsuranceModule.data.map(item => `
                    <tr class="hover:bg-emerald-50/50 transition border-b border-gray-50 last:border-0">
                        <td class="px-5 py-3 font-mono">¬•${item.salary}</td>
                        <td class="px-5 py-3 text-gray-700">¬•${item.companyPay} (${item.companyRate}%)</td>
                        <td class="px-5 py-3 text-gray-700">¬•${item.personalPay} (${item.personalRate}%)</td>
                        <td class="px-5 py-3 font-bold text-emerald-600">¬•${item.total}</td>
                        <td class="px-5 py-3 text-center">
                            <button onclick="InsuranceModule.delete(${item.id})" class="text-gray-300 hover:text-red-500 transition px-2">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        };

        /**
         * Â∫îÁî®Â∑•ÂÖ∑Ê®°Âùó (App Module)
         */
        const App = {
            exportCSV: (type) => {
                if (type === 'insurance' && InsuranceModule.data.length === 0) {
                    return alert(I18nModule.t('empty_data'));
                }

                let data, headers;
                if (type === 'insurance') {
                    headers = [
                        I18nModule.t('col_salary'),
                        I18nModule.t('col_company'),
                        I18nModule.t('col_personal'),
                        I18nModule.t('col_total')
                    ];
                    data = InsuranceModule.data.map(item => [
                        item.salary,
                        `${item.companyPay} (${item.companyRate}%)`,
                        `${item.personalPay} (${item.personalRate}%)`,
                        item.total
                    ]);
                }

                // Create CSV content
                let csv = headers.join(',') + '\n';
                data.forEach(row => {
                    csv += row.map(field => `"${field}"`).join(',') + '\n';
                });

                // Download
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.setAttribute('href', url);
                a.setAttribute('download', `${type}_calculations_${new Date().toISOString().slice(0,10)}.csv`);
                a.style.visibility = 'hidden';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            },

            clearData: (type) => {
                if (type === 'insurance') InsuranceModule.clear();
            }
        };

        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', () => {
            I18nModule.init();
            InsuranceModule.init();
        });
    </script>
</body>
</html>