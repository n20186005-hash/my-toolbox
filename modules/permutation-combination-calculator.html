<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permutation and Combination Calculator</title>
    
    <!-- åŸºç¡€ä¿¡æ¯ -->
    <meta name="tool-id" content="perm_comb_calc">
    <meta name="category" content="Math">
    <meta name="icon" content="ğŸ”¢">
    
    <!-- é»˜è®¤è‹±æ–‡å†…å®¹ -->
    <meta name="title" content="Permutation and Combination Calculator">
    <meta name="description" content="Calculate permutations (nPr) and combinations (nCr) with or without repetition.">
    
    <!-- å¤šè¯­è¨€é…ç½® -->
    <meta name="lang-title-zh-CN" content="æ’åˆ—ç»„åˆè®¡ç®—å™¨">
    <meta name="lang-description-zh-CN" content="è®¡ç®—æœ‰é‡å¤æˆ–æ— é‡å¤çš„æ’åˆ—ï¼ˆnPrï¼‰å’Œç»„åˆï¼ˆnCrï¼‰ã€‚">
    
    <meta name="lang-title-zh-TW" content="æ’åˆ—çµ„åˆè¨ˆç®—å™¨">
    <meta name="lang-description-zh-TW" content="è¨ˆç®—æœ‰é‡è¤‡æˆ–ç„¡é‡è¤‡çš„æ’åˆ—ï¼ˆnPrï¼‰å’Œçµ„åˆï¼ˆnCrï¼‰ã€‚">
    
    <meta name="lang-title-ja" content="é †åˆ—ã¨çµ„ã¿åˆã‚ã›è¨ˆç®—ãƒ„ãƒ¼ãƒ«">
    <meta name="lang-description-ja" content="é‡è¤‡ã‚ã‚Š/ãªã—ã®é †åˆ—ï¼ˆnPrï¼‰ã¨çµ„ã¿åˆã‚ã›ï¼ˆnCrï¼‰ã‚’è¨ˆç®—ã—ã¾ã™ã€‚">
    
    <meta name="lang-title-ru" content="ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğº Ğ¸ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¹">
    <meta name="lang-description-ru" content="Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ (nPr) Ğ¸ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ (nCr) Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¸Ğ»Ğ¸ Ğ±ĞµĞ· Ğ½Ğ¸Ñ….">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0f9ff; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
        .result-container { word-break: break-all; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
        .radio-item { display: flex; align-items: center; gap: 5px; }
        .formula-box { background: #f8fafc; padding: 10px; border-radius: 6px; font-family: monospace; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="perm_comb_calc" 
         data-category="math" 
         data-title="Permutation and Combination Calculator" 
         data-icon="ğŸ”¢">
        
        <!-- è¯­è¨€é€‰æ‹©å™¨ -->
        <div class="absolute top-4 right-4">
            <select id="pc-lang" onchange="PermCombCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en" selected>English</option>
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">ğŸ”¢ Permutation & Combination Calculator</h2>
        
        <div class="space-y-4 mb-6">
            <!-- æ€»æ•°è¾“å…¥ -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="total_items">Total Items (n)</label>
                <input type="number" id="pc-n" min="1" max="1000" value="10" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                <div class="text-xs text-gray-500 mt-1" data-i18n="n_note">Total number of items in the set (positive integer)</div>
            </div>
            
            <!-- é€‰å–æ•°è¾“å…¥ -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="chosen_items">Chosen Items (r)</label>
                <input type="number" id="pc-r" min="1" max="1000" value="3" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                <div class="text-xs text-gray-500 mt-1" data-i18n="r_note">Number of items to choose (r â‰¤ n)</div>
            </div>
            
            <!-- è®¡ç®—ç±»å‹é€‰æ‹© -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="calc_type">Calculation Type</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" name="pc-type" id="pc-permutation" value="permutation" checked>
                        <label for="pc-permutation" data-i18n="permutation">Permutation (nPr) - Order matters</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="pc-type" id="pc-combination" value="combination">
                        <label for="pc-combination" data-i18n="combination">Combination (nCr) - Order doesn't matter</label>
                    </div>
                </div>
            </div>
            
            <!-- é‡å¤é€‰é¡¹ -->
            <div>
                <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-1">
                    <input type="checkbox" id="pc-repetition" class="rounded">
                    <span data-i18n="allow_repetition">Allow Repetition</span>
                </label>
            </div>
            
            <!-- æ˜¾ç¤ºå…¬å¼ -->
            <div>
                <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-1">
                    <input type="checkbox" id="show-formula" checked class="rounded">
                    <span data-i18n="show_formula">Show Calculation Formula</span>
                </label>
            </div>
            
            <!-- è®¡ç®—æŒ‰é’® -->
            <button onclick="PermCombCalc.calc()" class="w-full bg-green-600 text-white py-3 rounded font-bold hover:bg-green-700 transition" data-i18n="calculate">Calculate Result</button>
        </div>

        <!-- é”™è¯¯æç¤º -->
        <div id="pc-error" class="text-sm text-red-600 mt-2 hidden mb-4"></div>
        
        <!-- ç»“æœå±•ç¤º -->
        <div class="bg-blue-50 p-6 rounded-lg border border-blue-100">
            <div class="text-sm text-gray-500 mb-2" data-i18n="result">Result</div>
            <div id="pc-result" class="text-xl font-bold text-blue-800 min-h-[60px] result-container">--</div>
            
            <!-- å…¬å¼å±•ç¤º -->
            <div id="formula-container" class="mt-4">
                <div class="text-sm text-gray-500 mb-2" data-i18n="formula">Formula Used:</div>
                <div id="pc-formula" class="formula-box"></div>
                <div id="pc-calculation" class="mt-2 text-sm text-gray-600"></div>
            </div>
        </div>

        <!-- å¿«é€Ÿç¤ºä¾‹ -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600">
            <p data-i18n="examples">Quick Examples:</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-2">
                <div class="p-2 bg-white rounded text-center cursor-pointer hover:bg-gray-100" onclick="PermCombCalc.loadExample(10, 3, 'permutation', false)">10P3</div>
                <div class="p-2 bg-white rounded text-center cursor-pointer hover:bg-gray-100" onclick="PermCombCalc.loadExample(10, 3, 'combination', false)">10C3</div>
                <div class="p-2 bg-white rounded text-center cursor-pointer hover:bg-gray-100" onclick="PermCombCalc.loadExample(5, 2, 'permutation', true)">5P2 (repetition)</div>
                <div class="p-2 bg-white rounded text-center cursor-pointer hover:bg-gray-100" onclick="PermCombCalc.loadExample(5, 2, 'combination', true)">5C2 (repetition)</div>
            </div>
        </div>

        <!-- è¯´æ˜ä¿¡æ¯ -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600">
            <p data-i18n="notes">Notes:</p>
            <ul class="list-disc list-inside mt-2 space-y-1" data-i18n="notes_list">
                <li>Permutation (nPr): n! / (n-r)! (without repetition)</li>
                <li>Permutation with repetition: n^r</li>
                <li>Combination (nCr): n! / (r! Ã— (n-r)!) (without repetition)</li>
                <li>Combination with repetition: (n+r-1)! / (r! Ã— (n-1)!)</li>
                <li>n! (factorial) = n Ã— (n-1) Ã— ... Ã— 1 (0! = 1)</li>
            </ul>
        </div>
    </div>

    <script>
        const PermCombCalc = {
            i18n: {
                'en': {
                    title: 'ğŸ”¢ Permutation & Combination Calculator',
                    total_items: 'Total Items (n)',
                    n_note: 'Total number of items in the set (positive integer)',
                    chosen_items: 'Chosen Items (r)',
                    r_note: 'Number of items to choose (r â‰¤ n)',
                    calc_type: 'Calculation Type',
                    permutation: 'Permutation (nPr) - Order matters',
                    combination: 'Combination (nCr) - Order doesn\'t matter',
                    allow_repetition: 'Allow Repetition',
                    show_formula: 'Show Calculation Formula',
                    calculate: 'Calculate Result',
                    result: 'Result',
                    formula: 'Formula Used:',
                    examples: 'Quick Examples:',
                    notes: 'Notes:',
                    notes_list: `
                        <li>Permutation (nPr): n! / (n-r)! (without repetition)</li>
                        <li>Permutation with repetition: n^r</li>
                        <li>Combination (nCr): n! / (r! Ã— (n-r)!) (without repetition)</li>
                        <li>Combination with repetition: (n+r-1)! / (r! Ã— (n-1)!)</li>
                        <li>n! (factorial) = n Ã— (n-1) Ã— ... Ã— 1 (0! = 1)</li>
                    `,
                    err_invalid_n: 'Total items (n) must be a positive integer',
                    err_invalid_r: 'Chosen items (r) must be a positive integer',
                    err_r_greater_n: 'Chosen items (r) cannot be greater than total items (n)',
                    err_large_value: 'Values are too large (max n=1000, r=1000)',
                    formula_perm: 'nPr = n! / (n-r)! = {n}! / ({n}-{r})!',
                    formula_perm_rep: 'nPr (repetition) = n^r = {n}^{r}',
                    formula_comb: 'nCr = n! / (r! Ã— (n-r)!) = {n}! / ({r}! Ã— ({n}-{r})!)',
                    formula_comb_rep: 'nCr (repetition) = (n+r-1)! / (r! Ã— (n-1)!) = ({n}+{r}-1)! / ({r}! Ã— ({n}-1)!)'
                },
                'zh-CN': {
                    title: 'ğŸ”¢ æ’åˆ—ç»„åˆè®¡ç®—å™¨',
                    total_items: 'æ€»é¡¹ç›®æ•° (n)',
                    n_note: 'é›†åˆä¸­çš„æ€»é¡¹ç›®æ•°ï¼ˆæ­£æ•´æ•°ï¼‰',
                    chosen_items: 'é€‰å–é¡¹ç›®æ•° (r)',
                    r_note: 'è¦é€‰æ‹©çš„é¡¹ç›®æ•°ï¼ˆr â‰¤ nï¼‰',
                    calc_type: 'è®¡ç®—ç±»å‹',
                    permutation: 'æ’åˆ— (nPr) - é¡ºåºé‡è¦',
                    combination: 'ç»„åˆ (nCr) - é¡ºåºä¸é‡è¦',
                    allow_repetition: 'å…è®¸é‡å¤',
                    show_formula: 'æ˜¾ç¤ºè®¡ç®—å…¬å¼',
                    calculate: 'è®¡ç®—ç»“æœ',
                    result: 'ç»“æœ',
                    formula: 'ä½¿ç”¨å…¬å¼ï¼š',
                    examples: 'å¿«é€Ÿç¤ºä¾‹ï¼š',
                    notes: 'æ³¨æ„ï¼š',
                    notes_list: `
                        <li>æ’åˆ— (nPr)ï¼šn! / (n-r)!ï¼ˆæ— é‡å¤ï¼‰</li>
                        <li>å¯é‡å¤æ’åˆ—ï¼šn^r</li>
                        <li>ç»„åˆ (nCr)ï¼šn! / (r! Ã— (n-r)!)ï¼ˆæ— é‡å¤ï¼‰</li>
                        <li>å¯é‡å¤ç»„åˆï¼š(n+r-1)! / (r! Ã— (n-1)!)</li>
                        <li>n!ï¼ˆé˜¶ä¹˜ï¼‰= n Ã— (n-1) Ã— ... Ã— 1ï¼ˆ0! = 1ï¼‰</li>
                    `,
                    err_invalid_n: 'æ€»é¡¹ç›®æ•° (n) å¿…é¡»æ˜¯æ­£æ•´æ•°',
                    err_invalid_r: 'é€‰å–é¡¹ç›®æ•° (r) å¿…é¡»æ˜¯æ­£æ•´æ•°',
                    err_r_greater_n: 'é€‰å–é¡¹ç›®æ•° (r) ä¸èƒ½å¤§äºæ€»é¡¹ç›®æ•° (n)',
                    err_large_value: 'æ•°å€¼è¿‡å¤§ï¼ˆæœ€å¤§ n=1000, r=1000ï¼‰',
                    formula_perm: 'nPr = n! / (n-r)! = {n}! / ({n}-{r})!',
                    formula_perm_rep: 'å¯é‡å¤æ’åˆ— nPr = n^r = {n}^{r}',
                    formula_comb: 'nCr = n! / (r! Ã— (n-r)!) = {n}! / ({r}! Ã— ({n}-{r})!)',
                    formula_comb_rep: 'å¯é‡å¤ç»„åˆ nCr = (n+r-1)! / (r! Ã— (n-1)!) = ({n}+{r}-1)! / ({r}! Ã— ({n}-1)!)'
                },
                'zh-TW': {
                    title: 'ğŸ”¢ æ’åˆ—çµ„åˆè¨ˆç®—å™¨',
                    total_items: 'ç¸½é …ç›®æ•¸ (n)',
                    n_note: 'é›†åˆä¸­çš„ç¸½é …ç›®æ•¸ï¼ˆæ­£æ•´æ•¸ï¼‰',
                    chosen_items: 'é¸å–é …ç›®æ•¸ (r)',
                    r_note: 'è¦é¸æ“‡çš„é …ç›®æ•¸ï¼ˆr â‰¤ nï¼‰',
                    calc_type: 'è¨ˆç®—é¡å‹',
                    permutation: 'æ’åˆ— (nPr) - é †åºé‡è¦',
                    combination: 'çµ„åˆ (nCr) - é †åºä¸é‡è¦',
                    allow_repetition: 'å…è¨±é‡è¤‡',
                    show_formula: 'é¡¯ç¤ºè¨ˆç®—å…¬å¼',
                    calculate: 'è¨ˆç®—çµæœ',
                    result: 'çµæœ',
                    formula: 'ä½¿ç”¨å…¬å¼ï¼š',
                    examples: 'å¿«é€Ÿç¤ºä¾‹ï¼š',
                    notes: 'æ³¨æ„ï¼š',
                    notes_list: `
                        <li>æ’åˆ— (nPr)ï¼šn! / (n-r)!ï¼ˆç„¡é‡è¤‡ï¼‰</li>
                        <li>å¯é‡è¤‡æ’åˆ—ï¼šn^r</li>
                        <li>çµ„åˆ (nCr)ï¼šn! / (r! Ã— (n-r)!)ï¼ˆç„¡é‡è¤‡ï¼‰</li>
                        <li>å¯é‡è¤‡çµ„åˆï¼š(n+r-1)! / (r! Ã— (n-1)!)</li>
                        <li>n!ï¼ˆéšä¹˜ï¼‰= n Ã— (n-1) Ã— ... Ã— 1ï¼ˆ0! = 1ï¼‰</li>
                    `,
                    err_invalid_n: 'ç¸½é …ç›®æ•¸ (n) å¿…é ˆæ˜¯æ­£æ•´æ•¸',
                    err_invalid_r: 'é¸å–é …ç›®æ•¸ (r) å¿…é ˆæ˜¯æ­£æ•´æ•¸',
                    err_r_greater_n: 'é¸å–é …ç›®æ•¸ (r) ä¸èƒ½å¤§æ–¼ç¸½é …ç›®æ•¸ (n)',
                    err_large_value: 'æ•¸å€¼éå¤§ï¼ˆæœ€å¤§ n=1000, r=1000ï¼‰',
                    formula_perm: 'nPr = n! / (n-r)! = {n}! / ({n}-{r})!',
                    formula_perm_rep: 'å¯é‡è¤‡æ’åˆ— nPr = n^r = {n}^{r}',
                    formula_comb: 'nCr = n! / (r! Ã— (n-r)!) = {n}! / ({r}! Ã— ({n}-{r})!)',
                    formula_comb_rep: 'å¯é‡è¤‡çµ„åˆ nCr = (n+r-1)! / (r! Ã— (n-1)!) = ({n}+{r}-1)! / ({r}! Ã— ({n}-1)!)'
                },
                'ja': {
                    title: 'ğŸ”¢ é †åˆ—ã¨çµ„ã¿åˆã‚ã›è¨ˆç®—ãƒ„ãƒ¼ãƒ«',
                    total_items: 'ç·ã‚¢ã‚¤ãƒ†ãƒ æ•° (n)',
                    n_note: 'é›†åˆå†…ã®ç·ã‚¢ã‚¤ãƒ†ãƒ æ•°ï¼ˆæ­£ã®æ•´æ•°ï¼‰',
                    chosen_items: 'é¸æŠã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ æ•° (r)',
                    r_note: 'é¸æŠã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ æ•°ï¼ˆr â‰¤ nï¼‰',
                    calc_type: 'è¨ˆç®—ã‚¿ã‚¤ãƒ—',
                    permutation: 'é †åˆ— (nPr) - é †åºãŒé‡è¦',
                    combination: 'çµ„ã¿åˆã‚ã› (nCr) - é †åºãŒä¸é‡è¦',
                    allow_repetition: 'é‡è¤‡ã‚’è¨±å¯',
                    show_formula: 'è¨ˆç®—å¼ã‚’è¡¨ç¤º',
                    calculate: 'çµæœã‚’è¨ˆç®—',
                    result: 'çµæœ',
                    formula: 'ä½¿ç”¨ã—ãŸå…¬å¼ï¼š',
                    examples: 'ã‚¯ã‚¤ãƒƒã‚¯ã‚µãƒ³ãƒ—ãƒ«ï¼š',
                    notes: 'æ³¨æ„ï¼š',
                    notes_list: `
                        <li>é †åˆ— (nPr)ï¼šn! / (n-r)!ï¼ˆé‡è¤‡ãªã—ï¼‰</li>
                        <li>é‡è¤‡ã‚ã‚Šé †åˆ—ï¼šn^r</li>
                        <li>çµ„ã¿åˆã‚ã› (nCr)ï¼šn! / (r! Ã— (n-r)!)ï¼ˆé‡è¤‡ãªã—ï¼‰</li>
                        <li>é‡è¤‡ã‚ã‚Šçµ„ã¿åˆã‚ã›ï¼š(n+r-1)! / (r! Ã— (n-1)!)</li>
                        <li>n!ï¼ˆéšä¹—ï¼‰= n Ã— (n-1) Ã— ... Ã— 1ï¼ˆ0! = 1ï¼‰</li>
                    `,
                    err_invalid_n: 'ç·ã‚¢ã‚¤ãƒ†ãƒ æ•° (n) ã¯æ­£ã®æ•´æ•°ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“',
                    err_invalid_r: 'é¸æŠã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ æ•° (r) ã¯æ­£ã®æ•´æ•°ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“',
                    err_r_greater_n: 'é¸æŠã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ æ•° (r) ã¯ç·ã‚¢ã‚¤ãƒ†ãƒ æ•° (n) ã‚ˆã‚Šå¤§ããã§ãã¾ã›ã‚“',
                    err_large_value: 'å€¤ãŒå¤§ãã™ãã¾ã™ï¼ˆæœ€å¤§ n=1000, r=1000ï¼‰',
                    formula_perm: 'nPr = n! / (n-r)! = {n}! / ({n}-{r})!',
                    formula_perm_rep: 'é‡è¤‡ã‚ã‚Šé †åˆ— nPr = n^r = {n}^{r}',
                    formula_comb: 'nCr = n! / (r! Ã— (n-r)!) = {n}! / ({r}! Ã— ({n}-{r})!)',
                    formula_comb_rep: 'é‡è¤‡ã‚ã‚Šçµ„ã¿åˆã‚ã› nCr = (n+r-1)! / (r! Ã— (n-1)!) = ({n}+{r}-1)! / ({r}! Ã— ({n}-1)!)'
                },
                'ru': {
                    title: 'ğŸ”¢ ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğº Ğ¸ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¹',
                    total_items: 'Ğ’ÑĞµĞ³Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (n)',
                    n_note: 'ĞĞ±Ñ‰ĞµĞµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğµ (Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ñ†ĞµĞ»Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾)',
                    chosen_items: 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ (r)',
                    r_note: 'ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼Ñ‹Ñ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (r â‰¤ n)',
                    calc_type: 'Ğ¢Ğ¸Ğ¿ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ°',
                    permutation: 'ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° (nPr) - ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ²Ğ°Ğ¶ĞµĞ½',
                    combination: 'ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ (nCr) - ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ½Ğµ Ğ²Ğ°Ğ¶ĞµĞ½',
                    allow_repetition: 'Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ',
                    show_formula: 'ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñƒ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ°',
                    calculate: 'Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚',
                    result: 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚',
                    formula: 'Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:',
                    examples: 'Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹:',
                    notes: 'ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ:',
                    notes_list: `
                        <li>ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° (nPr)ï¼šn! / (n-r)! (Ğ±ĞµĞ· Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹)</li>
                        <li>ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸ÑĞ¼Ğ¸ï¼šn^r</li>
                        <li>ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ (nCr)ï¼šn! / (r! Ã— (n-r)!) (Ğ±ĞµĞ· Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹)</li>
                        <li>ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸ÑĞ¼Ğ¸ï¼š(n+r-1)! / (r! Ã— (n-1)!)</li>
                        <li>n! (Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ°Ğ») = n Ã— (n-1) Ã— ... Ã— 1 (0! = 1)</li>
                    `,
                    err_invalid_n: 'Ğ’ÑĞµĞ³Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (n) Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ†ĞµĞ»Ñ‹Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼',
                    err_invalid_r: 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ (r) Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ†ĞµĞ»Ñ‹Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼',
                    err_r_greater_n: 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ (r) Ğ½Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¾Ğ±Ñ‰ĞµĞ³Ğ¾ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (n)',
                    err_large_value: 'Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ (Ğ¼Ğ°ĞºÑ n=1000, r=1000)',
                    formula_perm: 'nPr = n! / (n-r)! = {n}! / ({n}-{r})!',
                    formula_perm_rep: 'ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸ÑĞ¼Ğ¸ nPr = n^r = {n}^{r}',
                    formula_comb: 'nCr = n! / (r! Ã— (n-r)!) = {n}! / ({r}! Ã— ({n}-{r})!)',
                    formula_comb_rep: 'ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸ÑĞ¼Ğ¸ nCr = (n+r-1)! / (r! Ã— (n-1)!) = ({n}+{r}-1)! / ({r}! Ã— ({n}-1)!)'
                }
            },

            init: () => {
                // è®¾ç½®é»˜è®¤å€¼
                document.getElementById('pc-n').value = '10';
                document.getElementById('pc-r').value = '3';
                
                // ç›‘å¬å…¬å¼æ˜¾ç¤ºåˆ‡æ¢
                document.getElementById('show-formula').addEventListener('change', () => {
                    const formulaContainer = document.getElementById('formula-container');
                    formulaContainer.style.display = document.getElementById('show-formula').checked ? 'block' : 'none';
                });
            },

            loadExample: (n, r, type, repetition) => {
                document.getElementById('pc-n').value = n;
                document.getElementById('pc-r').value = r;
                document.querySelector(`input[name="pc-type"][value="${type}"]`).checked = true;
                document.getElementById('pc-repetition').checked = repetition;
                PermCombCalc.calc();
            },

            changeLang: () => {
                const lang = document.getElementById('pc-lang').value;
                const texts = PermCombCalc.i18n[lang];
                
                // æ›´æ–°æ™®é€šæ–‡æœ¬
                document.querySelectorAll('[data-id="perm_comb_calc"] [data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) {
                        if (key === 'notes_list') {
                            el.innerHTML = texts[key];
                        } else {
                            el.innerText = texts[key];
                        }
                    }
                });
                
                // æ›´æ–°å•é€‰æ¡†æ ‡ç­¾
                document.querySelectorAll('.radio-item label').forEach(label => {
                    const key = label.getAttribute('data-i18n');
                    if (texts[key]) label.innerText = texts[key];
                });
            },

            showError: (message) => {
                const errorEl = document.getElementById('pc-error');
                errorEl.innerText = message;
                errorEl.classList.remove('hidden');
            },

            clearError: () => {
                const errorEl = document.getElementById('pc-error');
                errorEl.classList.add('hidden');
                errorEl.innerText = '';
            },

            // è®¡ç®—é˜¶ä¹˜
            factorial: (num) => {
                if (num === 0 || num === 1) return 1;
                if (num > 170) return Infinity; // é˜²æ­¢æ•°å€¼æº¢å‡º
                let result = 1;
                for (let i = 2; i <= num; i++) {
                    result *= i;
                }
                return result;
            },

            // æ ¼å¼åŒ–å¤§æ•°æ˜¾ç¤º
            formatNumber: (num) => {
                if (num > 1e15) {
                    return num.toExponential(4);
                }
                return num.toLocaleString();
            },

            calc: () => {
                const lang = document.getElementById('pc-lang').value;
                const texts = PermCombCalc.i18n[lang];
                
                PermCombCalc.clearError();
                
                try {
                    // è·å–è¾“å…¥å€¼
                    const n = parseInt(document.getElementById('pc-n').value);
                    const r = parseInt(document.getElementById('pc-r').value);
                    const type = document.querySelector('input[name="pc-type"]:checked').value;
                    const repetition = document.getElementById('pc-repetition').checked;
                    
                    // éªŒè¯è¾“å…¥
                    if (isNaN(n) || n < 1 || n > 1000) {
                        throw new Error(texts.err_invalid_n);
                    }
                    if (isNaN(r) || r < 1 || r > 1000) {
                        throw new Error(texts.err_invalid_r);
                    }
                    if (r > n && !repetition) {
                        throw new Error(texts.err_r_greater_n);
                    }
                    
                    let result, formula, calculation;
                    
                    // è®¡ç®—æ’åˆ—/ç»„åˆ
                    if (type === 'permutation') {
                        if (repetition) {
                            // å¯é‡å¤æ’åˆ—
                            result = Math.pow(n, r);
                            formula = texts.formula_perm_rep
                                .replace(/{n}/g, n)
                                .replace(/{r}/g, r);
                            calculation = `${n}^${r} = ${result}`;
                        } else {
                            // æ— é‡å¤æ’åˆ—
                            const nFact = PermCombCalc.factorial(n);
                            const nrFact = PermCombCalc.factorial(n - r);
                            result = nFact / nrFact;
                            formula = texts.formula_perm
                                .replace(/{n}/g, n)
                                .replace(/{r}/g, r);
                            calculation = `${n}! / (${n}-${r})! = ${nFact} / ${nrFact} = ${result}`;
                        }
                    } else {
                        if (repetition) {
                            // å¯é‡å¤ç»„åˆ
                            const npr1 = n + r - 1;
                            const npr1Fact = PermCombCalc.factorial(npr1);
                            const rFact = PermCombCalc.factorial(r);
                            const n1Fact = PermCombCalc.factorial(n - 1);
                            result = npr1Fact / (rFact * n1Fact);
                            formula = texts.formula_comb_rep
                                .replace(/{n}/g, n)
                                .replace(/{r}/g, r);
                            calculation = `${npr1}! / (${r}! Ã— ${n-1}!) = ${npr1Fact} / (${rFact} Ã— ${n1Fact}) = ${result}`;
                        } else {
                            // æ— é‡å¤ç»„åˆ
                            const nFact = PermCombCalc.factorial(n);
                            const rFact = PermCombCalc.factorial(r);
                            const nrFact = PermCombCalc.factorial(n - r);
                            result = nFact / (rFact * nrFact);
                            formula = texts.formula_comb
                                .replace(/{n}/g, n)
                                .replace(/{r}/g, r);
                            calculation = `${n}! / (${r}! Ã— ${n}-${r}!) = ${nFact} / (${rFact} Ã— ${nrFact}) = ${result}`;
                        }
                    }
                    
                    // æ£€æŸ¥æ•°å€¼æº¢å‡º
                    if (result === Infinity || isNaN(result)) {
                        throw new Error(texts.err_large_value);
                    }
                    
                    // æ˜¾ç¤ºç»“æœ
                    document.getElementById('pc-result').innerText = PermCombCalc.formatNumber(result);
                    
                    // æ˜¾ç¤ºå…¬å¼å’Œè®¡ç®—è¿‡ç¨‹
                    if (document.getElementById('show-formula').checked) {
                        document.getElementById('pc-formula').innerText = formula;
                        document.getElementById('pc-calculation').innerText = calculation;
                    }
                    
                } catch (e) {
                    PermCombCalc.showError(e.message);
                    document.getElementById('pc-result').innerText = '--';
                    document.getElementById('pc-formula').innerText = '';
                    document.getElementById('pc-calculation').innerText = '';
                }
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', PermCombCalc.init);
        
        // è‡ªåŠ¨åŒ¹é…æµè§ˆå™¨è¯­è¨€
        document.addEventListener('DOMContentLoaded', () => {
            const userLang = navigator.language || navigator.userLanguage;
            let targetLang = 'en'; 
            if (userLang.startsWith('zh')) {
                targetLang = userLang.includes('TW') || userLang.includes('HK') ? 'zh-TW' : 'zh-CN';
            } else if (userLang.startsWith('ja')) {
                targetLang = 'ja';
            } else if (userLang.startsWith('ru')) {
                targetLang = 'ru';
            }
            
            if (targetLang !== 'en') {
                const langSelect = document.getElementById('pc-lang');
                if(langSelect) {
                    langSelect.value = targetLang;
                    PermCombCalc.changeLang();
                }
            }
        });
    </script>

</body>

</html>
