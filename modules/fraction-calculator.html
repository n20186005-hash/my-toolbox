<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractions Calculator</title>
    
    <!-- 基础信息 -->
    <meta name="tool-id" content="fraction_calculator">
    <meta name="category" content="math">
    <meta name="icon" content="½">
    
    <!-- 默认英文内容 -->
    <meta name="title" content="Fractions Calculator">
    <meta name="description" content="Perform calculations with fractions.">
    
    <!-- 多语言配置 -->
    <meta name="lang-title-zh-CN" content="分数计算器">
    <meta name="lang-description-zh-CN" content="进行分数计算。">
    
    <meta name="lang-title-zh-TW" content="分數計算器">
    <meta name="lang-description-zh-TW" content="進行分數計算。">
    
    <meta name="lang-title-ja" content="分数計算機">
    <meta name="lang-description-ja" content="分数の計算を実行します。">
    
    <meta name="lang-title-ru" content="Калькулятор дробей">
    <meta name="lang-description-ru" content="Выполняйте вычисления с дробями.">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0f9ff; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
        .fraction-input { display: flex; align-items: center; gap: 5px; }
        .fraction-input input { width: 100%; }
        .operation-btn { width: 100%; margin: 5px 0; padding: 8px; }
        .fraction-display { font-size: 24px; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="fraction_calculator" 
         data-category="math" 
         data-title="Fractions Calculator" 
         data-icon="½">
        
        <!-- 语言选择器 -->
        <div class="absolute top-4 right-4">
            <select id="fraction-lang" onchange="FractionCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en" selected>English</option>
                <option value="zh-CN">简体中文</option>
                <option value="zh-TW">繁體中文</option>
                <option value="ja">日本語</option>
                <option value="ru">Русский</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">½ Fractions Calculator</h2>
        
        <div class="grid grid-cols-1 gap-4 mb-4">
            <div data-i18n="fraction1">Fraction 1</div>
            <div class="grid grid-cols-3 gap-2">
                <input type="number" id="num1_whole" class="p-2 border rounded focus:ring-2 focus:ring-purple-500 outline-none" placeholder="0" value="0" min="0">
                <div class="flex flex-col">
                    <input type="number" id="num1_num" class="p-2 border rounded focus:ring-2 focus:ring-purple-500 outline-none" placeholder="1" value="1" min="1">
                    <div class="border-t border-gray-300 my-1"></div>
                    <input type="number" id="num1_den" class="p-2 border rounded focus:ring-2 focus:ring-purple-500 outline-none" placeholder="2" value="2" min="1">
                </div>
            </div>
            
            <div class="text-center my-2">
                <div class="inline-block bg-gray-100 px-4 py-2 rounded" id="operation-display">+</div>
            </div>
            
            <div data-i18n="fraction2">Fraction 2</div>
            <div class="grid grid-cols-3 gap-2">
                <input type="number" id="num2_whole" class="p-2 border rounded focus:ring-2 focus:ring-purple-500 outline-none" placeholder="0" value="0" min="0">
                <div class="flex flex-col">
                    <input type="number" id="num2_num" class="p-2 border rounded focus:ring-2 focus:ring-purple-500 outline-none" placeholder="1" value="1" min="1">
                    <div class="border-t border-gray-300 my-1"></div>
                    <input type="number" id="num2_den" class="p-2 border rounded focus:ring-2 focus:ring-purple-500 outline-none" placeholder="3" value="3" min="1">
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="operation">Operation</label>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="FractionCalc.setOperation('add')" class="operation-btn bg-purple-600 text-white rounded hover:bg-purple-700 transition" data-i18n="op_add">+</button>
                    <button onclick="FractionCalc.setOperation('subtract')" class="operation-btn bg-purple-600 text-white rounded hover:bg-purple-700 transition" data-i18n="op_subtract">-</button>
                    <button onclick="FractionCalc.setOperation('multiply')" class="operation-btn bg-purple-600 text-white rounded hover:bg-purple-700 transition" data-i18n="op_multiply">×</button>
                    <button onclick="FractionCalc.setOperation('divide')" class="operation-btn bg-purple-600 text-white rounded hover:bg-purple-700 transition" data-i18n="op_divide">÷</button>
                </div>
            </div>
            
            <button onclick="FractionCalc.calc()" class="w-full bg-purple-600 text-white py-2 rounded font-bold hover:bg-purple-700 transition" data-i18n="btn_calc">Calculate Result</button>
        </div>

        <div class="bg-purple-50 p-6 rounded-lg border border-purple-100 text-center">
            <div class="text-sm text-gray-500 mb-2" data-i18n="result">Result</div>
            <div id="fraction-result" class="fraction-display font-bold text-purple-800">--</div>
            
            <div class="mt-4 p-3 bg-white rounded border border-gray-100 text-left text-sm">
                <div data-i18n="decimal_value" class="font-medium mb-1">Decimal Value:</div>
                <div id="decimal-value" class="text-gray-600">--</div>
            </div>
        </div>
    </div>

    <script>
        const FractionCalc = {
            i18n: {
                'en': {
                    title: '½ Fractions Calculator',
                    fraction1: 'Fraction 1',
                    fraction2: 'Fraction 2',
                    operation: 'Operation',
                    op_add: '+',
                    op_subtract: '-',
                    op_multiply: '×',
                    op_divide: '÷',
                    btn_calc: 'Calculate Result',
                    result: 'Result',
                    decimal_value: 'Decimal Value:',
                    err_invalid: 'Please enter valid numbers',
                    err_zero_denominator: 'Denominator cannot be zero'
                },
                'zh-CN': {
                    title: '½ 分数计算器',
                    fraction1: '分数 1',
                    fraction2: '分数 2',
                    operation: '运算',
                    op_add: '+',
                    op_subtract: '-',
                    op_multiply: '×',
                    op_divide: '÷',
                    btn_calc: '计算结果',
                    result: '结果',
                    decimal_value: '小数形式：',
                    err_invalid: '请输入有效的数字',
                    err_zero_denominator: '分母不能为零'
                },
                'zh-TW': {
                    title: '½ 分數計算器',
                    fraction1: '分數 1',
                    fraction2: '分數 2',
                    operation: '運算',
                    op_add: '+',
                    op_subtract: '-',
                    op_multiply: '×',
                    op_divide: '÷',
                    btn_calc: '計算結果',
                    result: '結果',
                    decimal_value: '小數形式：',
                    err_invalid: '請輸入有效的數字',
                    err_zero_denominator: '分母不能為零'
                },
                'ja': {
                    title: '½ 分数計算機',
                    fraction1: '分数 1',
                    fraction2: '分数 2',
                    operation: '演算',
                    op_add: '+',
                    op_subtract: '-',
                    op_multiply: '×',
                    op_divide: '÷',
                    btn_calc: '結果を計算',
                    result: '結果',
                    decimal_value: '小数値：',
                    err_invalid: '有効な数字を入力してください',
                    err_zero_denominator: '分母はゼロにできません'
                },
                'ru': {
                    title: '½ Калькулятор дробей',
                    fraction1: 'Дробь 1',
                    fraction2: 'Дробь 2',
                    operation: 'Операция',
                    op_add: '+',
                    op_subtract: '-',
                    op_multiply: '×',
                    op_divide: '÷',
                    btn_calc: 'Вычислить результат',
                    result: 'Результат',
                    decimal_value: 'Десятичное значение:',
                    err_invalid: 'Пожалуйста, введите действительные числа',
                    err_zero_denominator: 'Знаменатель не может быть нулевым'
                }
            },

            currentOperation: 'add',
            
            init: () => {},

            changeLang: () => {
                const lang = document.getElementById('fraction-lang').value;
                const texts = FractionCalc.i18n[lang];
                const elements = document.querySelectorAll('[data-id="fraction_calculator"] [data-i18n]');
                
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) el.innerText = texts[key];
                });
            },

            setOperation: (operation) => {
                FractionCalc.currentOperation = operation;
                const opSymbols = {
                    'add': '+',
                    'subtract': '-',
                    'multiply': '×',
                    'divide': '÷'
                };
                document.getElementById('operation-display').innerText = opSymbols[operation];
            },

            // 计算最大公约数
            gcd: (a, b) => {
                a = Math.abs(a);
                b = Math.abs(b);
                while (b) {
                    [a, b] = [b, a % b];
                }
                return a;
            },

            // 将带分数转换为假分数
            toImproper: (whole, num, den) => {
                const sign = den < 0 ? -1 : 1;
                den = Math.abs(den);
                return {
                    num: sign * (whole * den + num),
                    den: den
                };
            },

            // 简化分数
            simplify: (num, den) => {
                if (den === 0) return { num: 0, den: 1 };
                
                const gcd = FractionCalc.gcd(num, den);
                num /= gcd;
                den /= gcd;
                
                // 确保分母为正数
                if (den < 0) {
                    num *= -1;
                    den *= -1;
                }
                
                return { num, den };
            },

            // 格式化分数显示
            formatFraction: (num, den) => {
                if (den === 1) return num.toString();
                
                const whole = Math.floor(Math.abs(num) / den);
                const remainder = Math.abs(num) % den;
                
                if (whole === 0) {
                    return `${num < 0 ? '-' : ''}${remainder}/${den}`;
                } else {
                    return `${num < 0 ? '-' : ''}${whole} ${remainder}/${den}`;
                }
            },

            calc: () => {
                // 获取输入值
                const num1_whole = parseInt(document.getElementById('num1_whole').value) || 0;
                const num1_num = parseInt(document.getElementById('num1_num').value) || 0;
                const num1_den = parseInt(document.getElementById('num1_den').value) || 0;
                const num2_whole = parseInt(document.getElementById('num2_whole').value) || 0;
                const num2_num = parseInt(document.getElementById('num2_num').value) || 0;
                const num2_den = parseInt(document.getElementById('num2_den').value) || 0;
                const lang = document.getElementById('fraction-lang').value;
                const texts = FractionCalc.i18n[lang];

                const resultEl = document.getElementById('fraction-result');
                const decimalEl = document.getElementById('decimal-value');

                // 验证输入
                if (isNaN(num1_whole) || isNaN(num1_num) || isNaN(num1_den) || 
                    isNaN(num2_whole) || isNaN(num2_num) || isNaN(num2_den)) {
                    resultEl.innerText = texts.err_invalid;
                    resultEl.className = "text-xl font-bold text-red-600";
                    decimalEl.innerText = "";
                    return;
                }

                // 验证分母不为零
                if (num1_den === 0 || num2_den === 0) {
                    resultEl.innerText = texts.err_zero_denominator;
                    resultEl.className = "text-xl font-bold text-red-600";
                    decimalEl.innerText = "";
                    return;
                }

                // 转换为假分数
                const f1 = FractionCalc.toImproper(num1_whole, num1_num, num1_den);
                const f2 = FractionCalc.toImproper(num2_whole, num2_num, num2_den);

                let result_num, result_den;

                // 执行运算
                switch (FractionCalc.currentOperation) {
                    case 'add':
                        result_num = f1.num * f2.den + f2.num * f1.den;
                        result_den = f1.den * f2.den;
                        break;
                    case 'subtract':
                        result_num = f1.num * f2.den - f2.num * f1.den;
                        result_den = f1.den * f2.den;
                        break;
                    case 'multiply':
                        result_num = f1.num * f2.num;
                        result_den = f1.den * f2.den;
                        break;
                    case 'divide':
                        result_num = f1.num * f2.den;
                        result_den = f1.den * f2.num;
                        break;
                }

                // 简化结果
                const simplified = FractionCalc.simplify(result_num, result_den);
                
                // 计算小数形式
                const decimal = (simplified.num / simplified.den).toFixed(6);

                // 显示结果
                resultEl.className = "fraction-display font-bold text-purple-800";
                resultEl.innerText = FractionCalc.formatFraction(simplified.num, simplified.den);
                decimalEl.innerText = decimal;
            }
        };

        document.addEventListener('DOMContentLoaded', FractionCalc.init);
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 自动匹配浏览器语言
            const userLang = navigator.language || navigator.userLanguage;
            let targetLang = 'en'; 
            if (userLang.startsWith('zh')) {
                targetLang = userLang.includes('TW') || userLang.includes('HK') ? 'zh-TW' : 'zh-CN';
            } else if (userLang.startsWith('ja')) {
                targetLang = 'ja';
            } else if (userLang.startsWith('ru')) {
                targetLang = 'ru';
            }
            
            if (targetLang !== 'en') {
                const langSelect = document.getElementById('fraction-lang');
                if(langSelect) {
                    langSelect.value = targetLang;
                    FractionCalc.changeLang();
                }
            }
        });
    </script>

</body>
</html>