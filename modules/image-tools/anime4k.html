<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="tool-id" content="anime4k">
    <meta name="category" content="Image Tools">
    <meta name="icon" content="ğŸ–¼ï¸">
    <title>å›¾ç‰‡æ— æŸæ”¾å¤§å·¥å…· Pro (Local)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #f8fafc; font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        .tool-module { background: white; border-radius: 16px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); max-width: 1000px; margin: 40px auto; position: relative; overflow: hidden; }
        
        /* Upload Zone */
        .upload-zone { border: 2px dashed #cbd5e1; border-radius: 12px; transition: all 0.3s ease; background: #f8fafc; }
        .upload-zone:hover, .upload-zone.dragover { border-color: #3b82f6; background: #eff6ff; }
        
        /* Custom Radio Inputs for Options */
        .option-card input[type="radio"] { display: none; }
        .option-card label { display: block; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .option-card input[type="radio"]:checked + label { border-color: #22c55e; background: #f0fdf4; color: #15803d; font-weight: bold; }
        
        /* Comparison Slider */
        .compare-container { position: relative; width: 100%; max-width: 800px; margin: 0 auto; overflow: hidden; border-radius: 8px; cursor: col-resize; user-select: none; line-height: 0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .compare-image { width: 100%; height: auto; display: block; }
        .img-overlay { position: absolute; top: 0; left: 0; width: 50%; height: 100%; overflow: hidden; border-right: 3px solid white; box-shadow: 5px 0 15px rgba(0,0,0,0.2); z-index: 10; background: white; }
        .img-overlay img { width: auto; height: 100%; max-width: none; } /* Important to keep aspect ratio in overlay */
        
        .slider-handle { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; background: white; border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.3); z-index: 20; display: flex; align-items: center; justify-content: center; color: #64748b; pointer-events: none; }
        
        .label-badge { position: absolute; top: 10px; padding: 4px 10px; background: rgba(0,0,0,0.6); color: white; font-size: 12px; border-radius: 4px; pointer-events: none; backdrop-filter: blur(2px); }
        .label-before { right: 10px; }
        .label-after { left: 10px; z-index: 11; }

        /* Animations */
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        .scan-line { position: absolute; left: 0; width: 100%; height: 2px; background: #22c55e; box-shadow: 0 0 10px #22c55e; animation: scan 2s linear infinite; z-index: 5; display: none; }
        .processing .scan-line { display: block; }
        
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .options-grid { grid-template-columns: 1fr; }
            .tool-module { margin: 10px; border-radius: 10px; }
        }
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/image-tools/anime4k.html" />
</head>
<body>

    <div class="tool-module" id="image-upscale-tool">
        <!-- Header -->
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 border-b border-gray-100 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-white p-2 rounded-lg shadow-sm text-2xl">ğŸ–¼ï¸</div>
                <div>
                    <h2 class="text-xl font-bold text-gray-800" data-i18n="title">å›¾ç‰‡æ— æŸæ”¾å¤§å·¥å…·</h2>
                    <p class="text-xs text-gray-500 mt-0.5" data-i18n="subtitle">æœ¬åœ°è¿ç®— Â· å…è´¹æ— é™åˆ¶ Â· ç”»è´¨å¢å¼º</p>
                </div>
            </div>
            <select id="lang-selector" onchange="ImageTool.changeLang()" class="text-xs border border-gray-300 rounded px-2 py-1 bg-white text-gray-600 focus:outline-none hover:border-green-400 transition-colors cursor-pointer">
                <option value="en">English</option>
                <option value="zh-CN" selected>ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>

        <div class="p-6 space-y-8">
            <!-- 1. Upload Section -->
            <div class="section">
                <div class="upload-zone p-8 flex flex-col items-center justify-center cursor-pointer relative" id="drop_zone" onclick="document.getElementById('file_input').click()">
                    <input type="file" id="file_input" accept="image/jpeg, image/png, image/webp" class="hidden">
                    <div id="upload_prompt" class="text-center">
                        <div class="w-16 h-16 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2" data-i18n="drag_drop">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</h3>
                        <p class="text-sm text-gray-400" data-i18n="formats">æ”¯æŒ JPG, PNG, WebP (å»ºè®® < 5MB ä»¥ä¿è¯é€Ÿåº¦)</p>
                    </div>
                    
                    <!-- Preview when file selected -->
                    <div id="file_preview_container" class="hidden w-full flex flex-col items-center">
                         <div class="relative group">
                            <img id="preview_thumb" class="h-48 object-contain rounded-lg shadow-md border border-gray-200" src="" alt="Preview">
                            <button onclick="event.stopPropagation(); ImageTool.clearAll()" class="absolute -top-3 -right-3 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-md hover:bg-red-600 transition-colors">
                                <i class="fas fa-times"></i>
                            </button>
                         </div>
                         <div class="mt-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                            <span id="original_info">-- x --</span>
                         </div>
                    </div>
                </div>
            </div>

            <!-- 2. Configuration -->
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Scale Factor -->
                <div>
                    <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wide mb-3 flex items-center gap-2">
                        <i class="fas fa-expand text-green-500"></i> <span data-i18n="scale_factor">æ”¾å¤§å€æ•°</span>
                    </h3>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="option-card">
                            <input type="radio" name="scale" id="scale_2" value="2" checked>
                            <label for="scale_2" class="shadow-sm hover:shadow-md">2x</label>
                        </div>
                        <div class="option-card">
                            <input type="radio" name="scale" id="scale_4" value="4">
                            <label for="scale_4" class="shadow-sm hover:shadow-md">4x</label>
                        </div>
                        <!-- 8x disabled for performance in JS version -->
                        <div class="option-card opacity-50 cursor-not-allowed" title="Webç‰ˆæœ¬é™åˆ¶æœ€å¤§4å€">
                            <input type="radio" name="scale" id="scale_8" value="8" disabled>
                            <label for="scale_8" class="shadow-sm bg-gray-100 text-gray-400 cursor-not-allowed">8x</label>
                        </div>
                    </div>
                </div>

                <!-- Algorithm -->
                <div>
                    <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wide mb-3 flex items-center gap-2">
                        <i class="fas fa-magic text-purple-500"></i> <span data-i18n="algorithm">å¢å¼ºæ¨¡å¼</span>
                    </h3>
                    <div class="grid grid-cols-1 gap-2">
                        <select id="algorithm" class="w-full p-3 border border-gray-200 rounded-lg bg-white focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition-shadow shadow-sm">
                            <option value="sharp" data-i18n="anime4k_algorithm">æ™ºèƒ½é”åŒ– (æ¨è/é€šç”¨)</option>
                            <option value="smooth" data-i18n="general_algorithm">å¹³æ»‘é™å™ª (é€‚åˆåŠ¨æ¼«/è€ç…§ç‰‡)</option>
                            <option value="basic" data-i18n="restoration_algorithm">åŸºç¡€æ”¾å¤§ (æ— é¢å¤–å¤„ç†)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="pt-4">
                <button id="process_btn" onclick="ImageTool.upscaleImage()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-xl font-bold text-lg hover:from-green-600 hover:to-emerald-700 transition transform hover:-translate-y-0.5 shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-rocket"></i> <span data-i18n="btn_upscale">å¼€å§‹å¤„ç† (æœ¬åœ°è¿ç®—)</span>
                </button>
            </div>

            <!-- 3. Results Section (Hidden initially) -->
            <div id="result_section" class="hidden border-t border-gray-100 pt-8 animate-fade-in">
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-xl font-bold text-gray-800" data-i18n="results">å¤„ç†ç»“æœ</h3>
                    <div class="text-sm text-green-600 font-medium bg-green-50 px-3 py-1 rounded-full border border-green-100">
                        <i class="fas fa-check-circle mr-1"></i> <span id="process_time_display">0.0s</span>
                    </div>
                </div>

                <!-- Comparison Slider -->
                <div class="bg-gray-900 rounded-xl p-1 shadow-inner mb-6 relative group">
                    <div class="compare-container" id="compare_container">
                        <!-- Background: Original (scaled to fit) -->
                        <img id="img_before" class="compare-image opacity-80 transition-all duration-300" src="" alt="Before">
                        <div class="label-badge label-before">Original</div>
                        
                        <!-- Foreground: Result (Clipped) -->
                        <div class="img-overlay" id="img_overlay">
                            <!-- This image will be manipulated to match size of container for overlay effect -->
                            <img id="img_after" src="" alt="After" style="height: 100%; width: auto; max-width: none;"> 
                            <div class="label-badge label-after" style="background: rgba(34, 197, 94, 0.8);">Processed</div>
                        </div>

                        <!-- Handle -->
                        <div class="slider-handle" id="slider_handle">
                            <i class="fas fa-arrows-alt-h"></i>
                        </div>
                        
                        <!-- Scanline animation for processing effect (optional) -->
                        <div class="scan-line"></div>
                    </div>
                    <p class="text-center text-gray-400 text-xs mt-2" data-i18n="drag_compare">â†”ï¸ æ‹–åŠ¨æ»‘å—å¯¹æ¯”æ•ˆæœ</p>
                </div>

                <!-- Result Stats & Download -->
                <div class="bg-white border border-gray-100 rounded-xl p-5 shadow-sm flex flex-wrap gap-4 items-center justify-between">
                    <div class="flex gap-6">
                        <div>
                            <span class="text-gray-400 text-xs uppercase" data-i18n="original_size">åŸå§‹å°ºå¯¸</span>
                            <div class="font-mono text-gray-700 font-bold" id="res_original_size">--</div>
                        </div>
                        <div class="w-px bg-gray-200"></div>
                        <div>
                            <span class="text-gray-400 text-xs uppercase" data-i18n="new_size">æ”¾å¤§åå°ºå¯¸</span>
                            <div class="font-mono text-green-600 font-bold text-lg" id="res_new_size">--</div>
                        </div>
                    </div>
                    
                    <button onclick="ImageTool.downloadResult()" class="flex-1 md:flex-none bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 transition shadow-md flex items-center justify-center gap-2">
                        <i class="fas fa-download"></i> <span data-i18n="btn_download">ä¸‹è½½ç»“æœ</span>
                    </button>
                </div>
            </div>

            <!-- Intro Info -->
            <div class="bg-blue-50 rounded-xl p-5 flex gap-4 items-start text-sm text-blue-800 border border-blue-100 mt-8">
                <i class="fas fa-info-circle text-xl mt-0.5 text-blue-500"></i>
                <div>
                    <h4 class="font-bold mb-1" data-i18n="intro_title">åŠŸèƒ½è¯´æ˜</h4>
                    <p class="opacity-80" data-i18n="intro_text">æ­¤ç‰ˆæœ¬å·²å‡çº§ä¸ºæœ¬åœ° Canvas è¿ç®—ã€‚ä½¿ç”¨åŒä¸‰æ¬¡æ’å€¼ç®—æ³•è¿›è¡Œæ— æŸæ”¾å¤§ï¼Œå¹¶åº”ç”¨å·ç§¯æ»¤é•œè¿›è¡Œé”åŒ–å¢å¼ºã€‚æ‰€æœ‰å¤„ç†å‡åœ¨æµè§ˆå™¨å†…å®Œæˆï¼Œæ‚¨çš„å›¾ç‰‡ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå®‰å…¨ä¸”å…è´¹ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ImageTool = {
            originalImage: null,
            processedDataUrl: null, // Store result
            isProcessing: false,
            i18n: {
                'en': {
                    title: 'Image Upscaler (Local)',
                    subtitle: 'Browser-based Â· Free Â· Enhancement',
                    drag_drop: 'Click or Drag & Drop Image Here',
                    formats: 'Supports JPG, PNG, WebP (Recommend < 5MB)',
                    scale_factor: 'Scale Factor',
                    algorithm: 'Enhance Mode',
                    anime4k_algorithm: 'Smart Sharpen (Recommended)',
                    general_algorithm: 'Smooth Denoise (Anime)',
                    restoration_algorithm: 'Basic Upscale (No filter)',
                    btn_upscale: 'Start Processing (Local)',
                    results: 'Results',
                    drag_compare: 'â†”ï¸ Drag slider to compare',
                    original_size: 'Original Size',
                    new_size: 'Upscaled Size',
                    btn_download: 'Download Result',
                    intro_title: 'How it works',
                    intro_text: 'This version uses local Canvas computing. It uses bicubic interpolation for resizing and applies convolution filters for sharpening. All processing is done in your browser, images are not uploaded.',
                    please_upload: 'Please upload an image first',
                    processing: 'Processing...',
                    success: 'Processing Complete!'
                },
                'zh-CN': {
                    title: 'å›¾ç‰‡æ— æŸæ”¾å¤§å·¥å…· (æœ¬åœ°ç‰ˆ)',
                    subtitle: 'æœ¬åœ°è¿ç®— Â· å…è´¹æ— é™åˆ¶ Â· ç”»è´¨å¢å¼º',
                    drag_drop: 'ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡',
                    formats: 'æ”¯æŒ JPG, PNG, WebP (å»ºè®® < 5MB ä»¥ä¿è¯é€Ÿåº¦)',
                    scale_factor: 'æ”¾å¤§å€æ•°',
                    algorithm: 'å¢å¼ºæ¨¡å¼',
                    anime4k_algorithm: 'æ™ºèƒ½é”åŒ– (æ¨è/é€šç”¨)',
                    general_algorithm: 'å¹³æ»‘é™å™ª (é€‚åˆåŠ¨æ¼«/è€ç…§ç‰‡)',
                    restoration_algorithm: 'åŸºç¡€æ”¾å¤§ (æ— é¢å¤–å¤„ç†)',
                    btn_upscale: 'å¼€å§‹å¤„ç† (æœ¬åœ°è¿ç®—)',
                    results: 'å¤„ç†ç»“æœ',
                    drag_compare: 'â†”ï¸ æ‹–åŠ¨æ»‘å—å¯¹æ¯”æ•ˆæœ',
                    original_size: 'åŸå§‹å°ºå¯¸',
                    new_size: 'æ”¾å¤§åå°ºå¯¸',
                    btn_download: 'ä¸‹è½½ç»“æœ',
                    intro_title: 'åŠŸèƒ½è¯´æ˜',
                    intro_text: 'æ­¤ç‰ˆæœ¬å·²å‡çº§ä¸ºæœ¬åœ° Canvas è¿ç®—ã€‚ä½¿ç”¨åŒä¸‰æ¬¡æ’å€¼ç®—æ³•è¿›è¡Œæ— æŸæ”¾å¤§ï¼Œå¹¶åº”ç”¨å·ç§¯æ»¤é•œè¿›è¡Œé”åŒ–å¢å¼ºã€‚æ‰€æœ‰å¤„ç†å‡åœ¨æµè§ˆå™¨å†…å®Œæˆï¼Œæ‚¨çš„å›¾ç‰‡ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå®‰å…¨ä¸”å…è´¹ã€‚',
                    please_upload: 'è¯·å…ˆä¸Šä¼ å›¾ç‰‡',
                    processing: 'æ­£åœ¨è¿ç®—ä¸­...',
                    success: 'å¤„ç†å®Œæˆï¼'
                },
                'zh-TW': {
                    title: 'åœ–ç‰‡ç„¡ææ”¾å¤§å·¥å…· (æœ¬åœ°ç‰ˆ)',
                    subtitle: 'æœ¬åœ°é‹ç®— Â· å…è²»ç„¡é™åˆ¶ Â· ç•«è³ªå¢å¼·',
                    drag_drop: 'é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³åœ–ç‰‡',
                    formats: 'æ”¯æ´ JPG, PNG, WebP (å»ºè­° < 5MB ä»¥ä¿è­‰é€Ÿåº¦)',
                    scale_factor: 'æ”¾å¤§å€æ•¸',
                    algorithm: 'å¢å¼·æ¨¡å¼',
                    anime4k_algorithm: 'æ™ºèƒ½éŠ³åŒ– (æ¨è–¦/é€šç”¨)',
                    general_algorithm: 'å¹³æ»‘é™å™ª (é©åˆå‹•æ¼«/è€ç…§ç‰‡)',
                    restoration_algorithm: 'åŸºç¤æ”¾å¤§ (ç„¡é¡å¤–è™•ç†)',
                    btn_upscale: 'é–‹å§‹è™•ç† (æœ¬åœ°é‹ç®—)',
                    results: 'è™•ç†çµæœ',
                    drag_compare: 'â†”ï¸ æ‹–æ›³æ»‘å¡Šå°æ¯”æ•ˆæœ',
                    original_size: 'åŸå§‹å°ºå¯¸',
                    new_size: 'æ”¾å¤§å¾Œå°ºå¯¸',
                    btn_download: 'ä¸‹è¼‰çµæœ',
                    intro_title: 'åŠŸèƒ½èªªæ˜',
                    intro_text: 'æ­¤ç‰ˆæœ¬å·²å‡ç´šç‚ºæœ¬åœ° Canvas é‹ç®—ã€‚ä½¿ç”¨é›™ä¸‰æ¬¡æ’å€¼æ¼”ç®—æ³•é€²è¡Œç„¡ææ”¾å¤§ï¼Œä¸¦æ‡‰ç”¨å·ç©æ¿¾é¡é€²è¡ŒéŠ³åŒ–å¢å¼·ã€‚æ‰€æœ‰è™•ç†å‡åœ¨ç€è¦½å™¨å…§å®Œæˆï¼Œæ‚¨çš„åœ–ç‰‡ä¸æœƒä¸Šå‚³åˆ°ä¼ºæœå™¨ï¼Œå®‰å…¨ä¸”å…è²»ã€‚',
                    please_upload: 'è«‹å…ˆä¸Šå‚³åœ–ç‰‡',
                    processing: 'æ­£åœ¨é‹ç®—ä¸­...',
                    success: 'è™•ç†å®Œæˆï¼'
                },
                'ja': {
                    title: 'ç”»åƒé«˜ç”»è³ªåŒ–ãƒ„ãƒ¼ãƒ« (Local)',
                    subtitle: 'ãƒ–ãƒ©ã‚¦ã‚¶å‡¦ç† Â· ç„¡æ–™ Â· ç”»è³ªå¼·åŒ–',
                    drag_drop: 'ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—',
                    formats: 'JPG, PNG, WebPå¯¾å¿œ (æ¨å¥¨ < 5MB)',
                    scale_factor: 'æ‹¡å¤§å€ç‡',
                    algorithm: 'å¼·åŒ–ãƒ¢ãƒ¼ãƒ‰',
                    anime4k_algorithm: 'ã‚¹ãƒãƒ¼ãƒˆã‚·ãƒ£ãƒ¼ãƒ— (æ¨å¥¨)',
                    general_algorithm: 'ã‚¹ãƒ ãƒ¼ã‚¹ãƒã‚¤ã‚ºé™¤å» (ã‚¢ãƒ‹ãƒ¡)',
                    restoration_algorithm: 'åŸºæœ¬æ‹¡å¤§ (ãƒ•ã‚£ãƒ«ã‚¿ãªã—)',
                    btn_upscale: 'å‡¦ç†é–‹å§‹ (ãƒ­ãƒ¼ã‚«ãƒ«)',
                    results: 'å‡¦ç†çµæœ',
                    drag_compare: 'â†”ï¸ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æ¯”è¼ƒ',
                    original_size: 'å…ƒã®ã‚µã‚¤ã‚º',
                    new_size: 'æ‹¡å¤§å¾Œã®ã‚µã‚¤ã‚º',
                    btn_download: 'çµæœã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
                    intro_title: 'æ©Ÿèƒ½èª¬æ˜',
                    intro_text: 'ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒ­ãƒ¼ã‚«ãƒ«Canvasæ¼”ç®—ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸã€‚ãƒã‚¤ã‚­ãƒ¥ãƒ¼ãƒ“ãƒƒã‚¯è£œé–“ã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚¹ãƒ¬ã‚¹æ‹¡å¤§ã‚’è¡Œã„ã€ç•³ã¿è¾¼ã¿ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨ã—ã¦ã‚·ãƒ£ãƒ¼ãƒ—ãƒã‚¹ã‚’å¼·åŒ–ã—ã¾ã™ã€‚ã™ã¹ã¦ã®å‡¦ç†ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å®Œäº†ã—ã€ç”»åƒã¯ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã›ã‚“ã€‚',
                    please_upload: 'å…ˆã«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„',
                    processing: 'å‡¦ç†ä¸­...',
                    success: 'å‡¦ç†å®Œäº†ï¼'
                },
                'ru': {
                    title: 'AI ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Local)',
                    subtitle: 'Ğ’ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ Â· Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ Â· Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ',
                    drag_drop: 'ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
                    formats: 'JPG, PNG, WebP (Ğ ĞµĞº. < 5ĞœĞ‘)',
                    scale_factor: 'ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±',
                    algorithm: 'Ğ ĞµĞ¶Ğ¸Ğ¼',
                    anime4k_algorithm: 'Ğ£Ğ¼Ğ½Ğ°Ñ Ñ€ĞµĞ·ĞºĞ¾ÑÑ‚ÑŒ (Ğ ĞµĞº.)',
                    general_algorithm: 'Ğ¡Ğ³Ğ»Ğ°Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ (ĞĞ½Ğ¸Ğ¼Ğµ)',
                    restoration_algorithm: 'Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ (Ğ‘ĞµĞ· Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²)',
                    btn_upscale: 'ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ',
                    results: 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚',
                    drag_compare: 'â†”ï¸ Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚',
                    original_size: 'Ğ˜ÑÑ…. Ñ€Ğ°Ğ·Ğ¼ĞµÑ€',
                    new_size: 'ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€',
                    btn_download: 'Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚',
                    intro_title: 'ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚',
                    intro_text: 'Ğ­Ñ‚Ğ° Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ Canvas. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ±Ğ¸ĞºÑƒĞ±Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ ÑĞ²ĞµÑ€Ñ‚ĞºĞ¸ Ğ´Ğ»Ñ Ñ€ĞµĞ·ĞºĞ¾ÑÑ‚Ğ¸. Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ, Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ÑÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€.',
                    please_upload: 'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
                    processing: 'ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°...',
                    success: 'Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!'
                }
            },

            init: function() {
                // Drag & Drop Init
                const dropZone = document.getElementById('drop_zone');
                const fileInput = document.getElementById('file_input');

                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, preventDefaults, false);
                });

                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
                });

                dropZone.addEventListener('drop', (e) => this.handleFileUpload(e.dataTransfer), false);
                fileInput.addEventListener('change', (e) => this.handleFileUpload(e.target), false);

                // Language Init
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const lang = urlParams.get('lang');
                    if (lang && this.i18n[lang]) {
                        document.getElementById('lang-selector').value = lang;
                    }
                } catch(e) {
                    console.warn("Cannot access URL params in this environment");
                }
                
                this.updateLanguage();

                // Slider Init
                this.initSlider();
            },

            changeLang: function() {
                const selectedLang = document.getElementById('lang-selector').value;
                // Basic fallback for languages not fully defined in this snippet
                if(!this.i18n[selectedLang]) return; 
                
                // Removed history.replaceState to prevent SecurityError in blob/iframe contexts
                
                this.updateLanguage();
            },

            updateLanguage: function() {
                const lang = document.getElementById('lang-selector').value;
                const dict = this.i18n[lang] || this.i18n['en']; // Fallback
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (dict[key]) {
                        el.textContent = dict[key];
                    }
                });
            },

            handleFileUpload: function(target) {
                const file = target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        this.originalImage = img;
                        this.processedDataUrl = null; // Clear previous
                        
                        // Show Preview
                        document.getElementById('upload_prompt').classList.add('hidden');
                        document.getElementById('file_preview_container').classList.remove('hidden');
                        document.getElementById('preview_thumb').src = event.target.result;
                        document.getElementById('original_info').textContent = `${img.width} x ${img.height} px`;
                        
                        // Hide results if new file uploaded
                        document.getElementById('result_section').classList.add('hidden');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            },

            upscaleImage: function() {
                if (!this.originalImage) {
                    const lang = document.getElementById('lang-selector').value;
                    const dict = this.i18n[lang] || this.i18n['en'];
                    alert(dict.please_upload);
                    return;
                }

                this.isProcessing = true;
                const lang = document.getElementById('lang-selector').value;
                const dict = this.i18n[lang] || this.i18n['en'];
                const btn = document.getElementById('process_btn');
                const btnText = btn.querySelector('span');
                const originalBtnText = btnText.textContent;
                
                // UI Loading State
                btn.disabled = true;
                btn.classList.add('opacity-75', 'cursor-not-allowed');
                btnText.textContent = dict.processing;
                btn.querySelector('i').className = "fas fa-spinner fa-spin";
                
                document.getElementById('result_section').classList.remove('hidden');
                document.getElementById('compare_container').classList.add('processing'); 
                
                const scale = parseInt(document.querySelector('input[name="scale"]:checked').value);
                const mode = document.getElementById('algorithm').value;
                const startTime = performance.now();

                // Use requestAnimationFrame to prevent UI freezing immediately
                requestAnimationFrame(() => {
                    setTimeout(() => {
                        try {
                            // --- REAL PROCESSING LOGIC START ---
                            
                            // 1. Create Offscreen Canvas
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            const newWidth = this.originalImage.width * scale;
                            const newHeight = this.originalImage.height * scale;
                            
                            canvas.width = newWidth;
                            canvas.height = newHeight;
                            
                            // 2. High Quality Resize (Bicubic-like via browser API)
                            ctx.imageSmoothingEnabled = true;
                            ctx.imageSmoothingQuality = 'high';
                            ctx.drawImage(this.originalImage, 0, 0, newWidth, newHeight);

                            // 3. Apply Filters (Convolution) based on mode
                            // Only apply if not 'basic'
                            if (mode !== 'basic') {
                                const imageData = ctx.getImageData(0, 0, newWidth, newHeight);
                                if (mode === 'sharp') {
                                    // Sharpen Kernel
                                    //  0 -1  0
                                    // -1  5 -1
                                    //  0 -1  0
                                    this.convolve(imageData, [0, -1, 0, -1, 5, -1, 0, -1, 0]);
                                } else if (mode === 'smooth') {
                                    // Slight Gaussian Blur to reduce noise then slight sharpen
                                    // 1 2 1
                                    // 2 4 2
                                    // 1 2 1  (div 16)
                                    // For simplicity in this demo, let's just do a subtle sharpen to make lines pop
                                    // 0 -0.5 0
                                    // -0.5 3 -0.5
                                    // 0 -0.5 0
                                    this.convolve(imageData, [0, -0.2, 0, -0.2, 1.8, -0.2, 0, -0.2, 0]); 
                                }
                                ctx.putImageData(imageData, 0, 0);
                            }

                            // 4. Get Result
                            this.processedDataUrl = canvas.toDataURL('image/png', 0.9);

                            // --- LOGIC END ---

                            const endTime = performance.now();
                            const duration = ((endTime - startTime) / 1000).toFixed(2);
                            
                            document.getElementById('process_time_display').textContent = `${duration}s`;
                            document.getElementById('compare_container').classList.remove('processing');
                            
                            // Update UI Images
                            const imgBefore = document.getElementById('img_before');
                            const imgAfter = document.getElementById('img_after');
                            
                            imgBefore.src = this.originalImage.src;
                            imgBefore.style.filter = "none"; // Remove fake filter
                            
                            imgAfter.src = this.processedDataUrl;
                            imgAfter.style.filter = "none";
                            
                            // Update Stats
                            document.getElementById('res_original_size').textContent = `${this.originalImage.width} x ${this.originalImage.height}`;
                            document.getElementById('res_new_size').textContent = `${newWidth} x ${newHeight}`;

                            document.getElementById('result_section').scrollIntoView({ behavior: 'smooth' });

                        } catch (e) {
                            console.error(e);
                            alert('Processing failed. Image might be too large for browser memory.');
                        } finally {
                            this.isProcessing = false;
                            btn.disabled = false;
                            btn.classList.remove('opacity-75', 'cursor-not-allowed');
                            btnText.textContent = originalBtnText;
                            btn.querySelector('i').className = "fas fa-rocket";
                        }
                    }, 100); // Small delay to let UI render loading state
                });
            },

            // Basic Convolution Filter for Image Processing
            convolve: function(imageData, weights) {
                const side = Math.round(Math.sqrt(weights.length));
                const halfSide = Math.floor(side / 2);
                const src = imageData.data;
                const sw = imageData.width;
                const sh = imageData.height;
                
                // Create output buffer
                const output = new Uint8ClampedArray(src.length);
                // Copy alpha channel first
                for (let i=0; i<src.length; i+=4) output[i+3] = src[i+3];

                for (let y = 0; y < sh; y++) {
                    for (let x = 0; x < sw; x++) {
                        const dstOff = (y * sw + x) * 4;
                        
                        let r = 0, g = 0, b = 0;
                        
                        for (let cy = 0; cy < side; cy++) {
                            for (let cx = 0; cx < side; cx++) {
                                const scy = y + cy - halfSide;
                                const scx = x + cx - halfSide;
                                
                                if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {
                                    const srcOff = (scy * sw + scx) * 4;
                                    const wt = weights[cy * side + cx];
                                    
                                    r += src[srcOff] * wt;
                                    g += src[srcOff + 1] * wt;
                                    b += src[srcOff + 2] * wt;
                                }
                            }
                        }
                        
                        output[dstOff] = r;
                        output[dstOff + 1] = g;
                        output[dstOff + 2] = b;
                        output[dstOff + 3] = src[dstOff + 3]; // Keep original alpha
                    }
                }
                
                // Write back
                for (let i=0; i<src.length; i++) imageData.data[i] = output[i];
            },

            clearAll: function() {
                document.getElementById('file_input').value = '';
                this.originalImage = null;
                this.processedDataUrl = null;
                
                document.getElementById('upload_prompt').classList.remove('hidden');
                document.getElementById('file_preview_container').classList.add('hidden');
                document.getElementById('result_section').classList.add('hidden');
            },

            downloadResult: function() {
                if (!this.processedDataUrl) return;
                
                const link = document.createElement('a');
                // Generate filename
                const originalName = document.getElementById('file_input').files[0]?.name || 'image';
                const namePart = originalName.substring(0, originalName.lastIndexOf('.')) || originalName;
                
                link.download = `${namePart}_upscaled.png`;
                link.href = this.processedDataUrl; 
                link.click();
            },

            // Slider Logic (Unchanged but ensuring resilience)
            initSlider: function() {
                const container = document.getElementById('compare_container');
                const overlay = document.getElementById('img_overlay');
                const handle = document.getElementById('slider_handle');
                let isDragging = false;

                const updateSlider = (x) => {
                    const rect = container.getBoundingClientRect();
                    let percentage = ((x - rect.left) / rect.width) * 100;
                    if (percentage < 0) percentage = 0;
                    if (percentage > 100) percentage = 100;
                    overlay.style.width = `${percentage}%`;
                    handle.style.left = `${percentage}%`;
                    
                    const imgAfter = document.getElementById('img_after');
                    imgAfter.style.width = `${rect.width}px`;
                    imgAfter.style.maxWidth = 'none';
                };

                container.addEventListener('mousedown', () => isDragging = true);
                window.addEventListener('mouseup', () => isDragging = false);
                window.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    updateSlider(e.clientX);
                });
                
                container.addEventListener('touchstart', () => isDragging = true);
                window.addEventListener('touchend', () => isDragging = false);
                window.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    updateSlider(e.touches[0].clientX);
                });
                
                new ResizeObserver(entries => {
                   for (let entry of entries) {
                       const width = entry.contentRect.width;
                       const imgAfter = document.getElementById('img_after');
                       if(imgAfter) imgAfter.style.width = `${width}px`;
                   }
                }).observe(container);
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            ImageTool.init();
        });
    </script>

    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
    

    <div id="toolbox-seo-wrapper-unique-id" class="max-w-4xl mx-auto px-4"></div>
    <script src="/scripts/seo-loader.js"></script>

</body>
</html>