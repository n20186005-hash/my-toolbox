<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="category" content="Image Tools">
    <meta name="icon" content="ğŸ”">
    <title>å›¾ç‰‡åŠ æ°´å°å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #f0fdf4; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 900px; margin: 0 auto; position: relative; }
        .section { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.9rem; color: #4b5563; margin-bottom: 4px; }
        input, select, textarea { width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; }
        textarea { min-height: 80px; resize: vertical; }
        .result-card { background: #ecfdf5; border: 1px solid #d1fae5; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .result-stats { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed #a7f3d0; flex-wrap: wrap; gap: 10px;}
        .stat-label { color: #1e3a8a; font-size: 0.9rem;}
        .stat-value { font-weight: 600; color: #065f46; margin-left: 5px;}
        .intro-section { margin-top: 30px; padding: 20px; background-color: #f8fafc; border-radius: 8px; font-size: 0.95rem; color: #475569; }
        .options-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        button { background: #22c55e; color: white; border: none; padding: 10px 15px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #16a34a; }
        .image-preview { max-width: 100%; max-height: 300px; margin: 15px 0; border: 1px dashed #d1d5db; border-radius: 6px; padding: 10px; display: block; }
        .watermark-options { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; }
        .watermark-option { padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .watermark-option:hover { border-color: #22c55e; background-color: #f0fdf4; }
        .watermark-option.selected { border-color: #22c55e; background-color: #ecfdf5; }
        .color-picker { height: 40px; padding: 2px; }
        .slider-control { width: 100%; margin-top: 5px; }
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/image-tools/image-watermark-tool.html" />
</head>
<body>

    <div class="tool-module" id="watermark-tool">
        <!-- Language Selector -->
        <div class="absolute top-4 right-4">
            <select id="lang-selector" onchange="WatermarkTool.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en">English</option>
                <option value="zh-CN" selected>ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-6 text-gray-800 border-b pb-2" data-i18n="title">ğŸ” å›¾ç‰‡åŠ æ°´å°å·¥å…·</h2>

        <div class="space-y-6">
            <!-- Image Upload Section -->
            <div class="section">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-i18n="upload_image">ä¸Šä¼ å›¾ç‰‡</h3>
                <div class="form-group">
                    <input type="file" id="image_upload" accept="image/*" class="focus:ring-2 focus:ring-green-500 outline-none">
                    <p class="text-sm text-gray-500 mt-2" data-i18n="supported_formats">æ”¯æŒ JPGã€PNGã€WEBP ç­‰å¸¸è§å›¾ç‰‡æ ¼å¼</p>
                </div>
                <div id="image_preview_container" class="hidden">
                    <h4 class="font-medium text-gray-700 mb-2" data-i18n="preview">é¢„è§ˆ</h4>
                    <img id="image_preview" class="image-preview" src="" alt="Preview">
                </div>
            </div>

            <!-- Watermark Options Section -->
            <div class="section">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-i18n="watermark_options">æ°´å°è®¾ç½®</h3>
                
                <div class="options-grid">
                    <div class="form-group">
                        <label data-i18n="watermark_type">æ°´å°ç±»å‹</label>
                        <select id="watermark_type" onchange="WatermarkTool.toggleWatermarkOptions()" class="focus:ring-2 focus:ring-green-500 outline-none">
                            <option value="text" data-i18n="text_watermark">æ–‡å­—æ°´å°</option>
                            <option value="image" data-i18n="image_watermark">å›¾ç‰‡æ°´å°</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label data-i18n="position">ä½ç½®</label>
                        <select id="watermark_position" class="focus:ring-2 focus:ring-green-500 outline-none">
                            <option value="center" data-i18n="center">å±…ä¸­</option>
                            <option value="top-left" data-i18n="top_left">å·¦ä¸Šè§’</option>
                            <option value="top-right" data-i18n="top_right">å³ä¸Šè§’</option>
                            <option value="bottom-left" data-i18n="bottom_left">å·¦ä¸‹è§’</option>
                            <option value="bottom-right" data-i18n="bottom_right">å³ä¸‹è§’</option>
                            <option value="tile" data-i18n="tile">å¹³é“º</option>
                        </select>
                    </div>
                </div>

                <!-- Text Watermark Options -->
                <div id="text_watermark_options">
                    <div class="form-group">
                        <label data-i18n="watermark_text">æ°´å°æ–‡å­—</label>
                        <textarea id="watermark_text" placeholder="è¯·è¾“å…¥æ°´å°æ–‡å­—..." class="focus:ring-2 focus:ring-green-500 outline-none">Sample Watermark</textarea>
                    </div>
                    
                    <div class="options-grid">
                        <div class="form-group">
                            <label data-i18n="font_size">å­—ä½“å¤§å° (px)</label>
                            <input type="number" id="font_size" value="40" min="8" max="300" class="focus:ring-2 focus:ring-green-500 outline-none">
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="color">é¢œè‰²</label>
                            <input type="color" id="watermark_color" value="#ff0000" class="color-picker focus:ring-2 focus:ring-green-500 outline-none">
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="opacity">é€æ˜åº¦ (0-100)</label>
                            <input type="range" id="opacity" min="0" max="100" value="50" class="slider-control focus:ring-2 focus:ring-green-500 outline-none">
                            <span id="opacity_value" class="text-sm text-gray-600">50%</span>
                        </div>
                    </div>
                </div>

                <!-- Image Watermark Options (Hidden by default) -->
                <div id="image_watermark_options" class="hidden">
                    <div class="form-group">
                        <label data-i18n="watermark_image">ä¸Šä¼ æ°´å°å›¾ç‰‡</label>
                        <input type="file" id="watermark_image_upload" accept="image/*" class="focus:ring-2 focus:ring-green-500 outline-none">
                        <div id="watermark_image_preview_container" class="hidden mt-2">
                             <img id="watermark_image_preview" class="h-20 object-contain border border-gray-200 rounded" src="" alt="Watermark Preview">
                        </div>
                        <p class="text-sm text-gray-500 mt-2" data-i18n="watermark_image_note">å»ºè®®ä½¿ç”¨ PNG é€æ˜èƒŒæ™¯å›¾ç‰‡</p>
                    </div>
                    
                    <div class="options-grid">
                        <div class="form-group">
                            <label data-i18n="watermark_size">æ°´å°ç¼©æ”¾ (%)</label>
                            <input type="range" id="watermark_size" min="10" max="100" value="30" class="slider-control focus:ring-2 focus:ring-green-500 outline-none">
                            <span id="watermark_size_value" class="text-sm text-gray-600">30%</span>
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="watermark_opacity">é€æ˜åº¦ (0-100)</label>
                            <input type="range" id="watermark_image_opacity" min="0" max="100" value="50" class="slider-control focus:ring-2 focus:ring-green-500 outline-none">
                            <span id="watermark_image_opacity_value" class="text-sm text-gray-600">50%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex gap-4">
                <button onclick="WatermarkTool.applyWatermark()" class="flex-1 bg-green-600 text-white py-3 rounded font-bold hover:bg-green-700 transition shadow-md" data-i18n="apply_watermark">æ·»åŠ æ°´å°</button>
                <button onclick="WatermarkTool.clearAll()" class="flex-1 bg-gray-200 text-gray-800 py-3 rounded font-bold hover:bg-gray-300 transition shadow-sm" data-i18n="clear_all">æ¸…ç©ºæ‰€æœ‰</button>
            </div>

            <!-- Results -->
            <div class="summary-section mt-8">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-i18n="result">å¤„ç†ç»“æœ</h3>
                
                <div id="result_container" class="hidden">
                    <div class="result-stats">
                        <div>
                            <span class="stat-label" data-i18n="processing_time">å¤„ç†è€—æ—¶ï¼š</span>
                            <span class="stat-value" id="processing_time">0ms</span>
                        </div>
                        <div>
                            <span class="stat-label" data-i18n="file_size">æ–‡ä»¶å¤§å°ï¼š</span>
                            <span class="stat-value" id="file_size">0KB</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <img id="result_image" class="image-preview" src="" alt="Result">
                    </div>
                    <button onclick="WatermarkTool.downloadResult()" class="w-full mt-2 bg-blue-600 text-white py-3 rounded font-medium hover:bg-blue-700 transition shadow-md" data-i18n="download_result">ä¸‹è½½å›¾ç‰‡</button>
                </div>
                
                <div id="no_result" class="p-6 text-center text-gray-500 border border-dashed rounded" data-i18n="no_result_text">å¤„ç†åçš„å›¾ç‰‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
            </div>

            <!-- Recent Watermarks -->
            <div class="section">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-i18n="recent_history">æœ€è¿‘å¤„ç†</h3>
                <div id="watermark_history" class="p-4 bg-gray-50 rounded border border-gray-100 min-h-[60px]">
                    <p data-i18n="no_history" class="text-gray-400 italic text-sm">æš‚æ— å¤„ç†è®°å½•</p>
                </div>
            </div>

            <!-- Intro -->
            <div class="intro-section">
                <h3 class="text-lg font-semibold mb-2 text-gray-800" data-i18n="intro_title">å…³äºæœ¬å·¥å…·</h3>
                <p data-i18n="intro_text">æœ¬å·¥å…·å¯ç»™å›¾ç‰‡æ·»åŠ æ–‡å­—æˆ–å›¾ç‰‡æ°´å°ï¼Œæ”¯æŒè‡ªå®šä¹‰æ°´å°ä½ç½®ã€å¤§å°ã€é€æ˜åº¦ç­‰å‚æ•°ï¼Œé€‚ç”¨äºä¿æŠ¤å›¾ç‰‡ç‰ˆæƒã€æ ‡è¯†å›¾ç‰‡æ¥æºç­‰åœºæ™¯ã€‚å¤„ç†åçš„å›¾ç‰‡ä¿æŒåŸæ ¼å¼è´¨é‡ï¼Œæ“ä½œç®€å•é«˜æ•ˆï¼Œæ‰€æœ‰å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        const WatermarkTool = {
            uploadedImage: null,
            watermarkImage: null,
            i18n: {
                'en': {
                    title: 'ğŸ” Image Watermark Tool',
                    upload_image: 'Upload Image',
                    supported_formats: 'Supports JPG, PNG, WEBP',
                    preview: 'Preview',
                    watermark_options: 'Watermark Settings',
                    watermark_type: 'Watermark Type',
                    text_watermark: 'Text Watermark',
                    image_watermark: 'Image Watermark',
                    position: 'Position',
                    top_left: 'Top Left',
                    top_right: 'Top Right',
                    bottom_left: 'Bottom Left',
                    bottom_right: 'Bottom Right',
                    center: 'Center',
                    tile: 'Tiled',
                    watermark_text: 'Watermark Text',
                    font_size: 'Font Size (px)',
                    color: 'Color',
                    opacity: 'Opacity (0-100)',
                    watermark_image: 'Upload Watermark Image',
                    watermark_image_note: 'PNG with transparent background recommended',
                    watermark_size: 'Watermark Scale (%)',
                    watermark_opacity: 'Opacity (0-100)',
                    apply_watermark: 'Apply Watermark',
                    clear_all: 'Clear All',
                    result: 'Processing Result',
                    processing_time: 'Processing Time:',
                    file_size: 'File Size:',
                    download_result: 'Download Image',
                    no_result_text: 'Processed image will be displayed here',
                    recent_history: 'Recent Processing',
                    no_history: 'No processing history yet',
                    intro_title: 'About This Tool',
                    intro_text: 'This tool allows you to add text or image watermarks locally. All processing is done in your browser.',
                    please_upload_image: 'Please upload an image first',
                    please_enter_text: 'Please enter watermark text',
                    please_upload_watermark_image: 'Please upload a watermark image',
                    processing: 'Processing...',
                    download_success: 'Download started successfully',
                    view: 'View'
                },
                'zh-CN': {
                    title: 'ğŸ” å›¾ç‰‡åŠ æ°´å°å·¥å…·',
                    upload_image: 'ä¸Šä¼ å›¾ç‰‡',
                    supported_formats: 'æ”¯æŒ JPGã€PNGã€WEBP ç­‰å¸¸è§å›¾ç‰‡æ ¼å¼',
                    preview: 'é¢„è§ˆ',
                    watermark_options: 'æ°´å°è®¾ç½®',
                    watermark_type: 'æ°´å°ç±»å‹',
                    text_watermark: 'æ–‡å­—æ°´å°',
                    image_watermark: 'å›¾ç‰‡æ°´å°',
                    position: 'ä½ç½®',
                    top_left: 'å·¦ä¸Šè§’',
                    top_right: 'å³ä¸Šè§’',
                    bottom_left: 'å·¦ä¸‹è§’',
                    bottom_right: 'å³ä¸‹è§’',
                    center: 'å±…ä¸­',
                    tile: 'å¹³é“º',
                    watermark_text: 'æ°´å°æ–‡å­—',
                    font_size: 'å­—ä½“å¤§å° (px)',
                    color: 'é¢œè‰²',
                    opacity: 'é€æ˜åº¦ (0-100)',
                    watermark_image: 'ä¸Šä¼ æ°´å°å›¾ç‰‡',
                    watermark_image_note: 'å»ºè®®ä½¿ç”¨ PNG é€æ˜èƒŒæ™¯å›¾ç‰‡',
                    watermark_size: 'æ°´å°ç¼©æ”¾ (%)',
                    watermark_opacity: 'é€æ˜åº¦ (0-100)',
                    apply_watermark: 'æ·»åŠ æ°´å°',
                    clear_all: 'æ¸…ç©ºæ‰€æœ‰',
                    result: 'å¤„ç†ç»“æœ',
                    processing_time: 'å¤„ç†è€—æ—¶ï¼š',
                    file_size: 'æ–‡ä»¶å¤§å°ï¼š',
                    download_result: 'ä¸‹è½½å›¾ç‰‡',
                    no_result_text: 'å¤„ç†åçš„å›¾ç‰‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ',
                    recent_history: 'æœ€è¿‘å¤„ç†',
                    no_history: 'æš‚æ— å¤„ç†è®°å½•',
                    intro_title: 'å…³äºæœ¬å·¥å…·',
                    intro_text: 'æœ¬å·¥å…·å¯ç»™å›¾ç‰‡æ·»åŠ æ–‡å­—æˆ–å›¾ç‰‡æ°´å°ï¼Œæ”¯æŒè‡ªå®šä¹‰æ°´å°ä½ç½®ã€å¤§å°ã€é€æ˜åº¦ç­‰å‚æ•°ã€‚æ‰€æœ‰å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨ã€‚',
                    please_upload_image: 'è¯·å…ˆä¸Šä¼ å›¾ç‰‡',
                    please_enter_text: 'è¯·è¾“å…¥æ°´å°æ–‡å­—',
                    please_upload_watermark_image: 'è¯·å…ˆä¸Šä¼ æ°´å°å›¾ç‰‡',
                    processing: 'å¤„ç†ä¸­...',
                    download_success: 'ä¸‹è½½æˆåŠŸå¼€å§‹',
                    view: 'æŸ¥çœ‹'
                },
                'zh-TW': {
                    title: 'ğŸ” åœ–ç‰‡åŠ æ°´å°å·¥å…·',
                    upload_image: 'ä¸Šå‚³åœ–ç‰‡',
                    supported_formats: 'æ”¯æ´ JPGã€PNGã€WEBP ç­‰å¸¸è¦‹åœ–ç‰‡æ ¼å¼',
                    preview: 'é è¦½',
                    watermark_options: 'æ°´å°è¨­å®š',
                    watermark_type: 'æ°´å°é¡å‹',
                    text_watermark: 'æ–‡å­—æ°´å°',
                    image_watermark: 'åœ–ç‰‡æ°´å°',
                    position: 'ä½ç½®',
                    top_left: 'å·¦ä¸Šè§’',
                    top_right: 'å³ä¸Šè§’',
                    bottom_left: 'å·¦ä¸‹è§’',
                    bottom_right: 'å³ä¸‹è§’',
                    center: 'å±…ä¸­',
                    tile: 'å¹³é‹ª',
                    watermark_text: 'æ°´å°æ–‡å­—',
                    font_size: 'å­—é«”å¤§å° (px)',
                    color: 'é¡è‰²',
                    opacity: 'é€æ˜åº¦ (0-100)',
                    watermark_image: 'ä¸Šå‚³æ°´å°åœ–ç‰‡',
                    watermark_image_note: 'å»ºè­°ä½¿ç”¨ PNG é€æ˜èƒŒæ™¯åœ–ç‰‡',
                    watermark_size: 'æ°´å°ç¸®æ”¾ (%)',
                    watermark_opacity: 'é€æ˜åº¦ (0-100)',
                    apply_watermark: 'æ–°å¢æ°´å°',
                    clear_all: 'æ¸…ç©ºæ‰€æœ‰',
                    result: 'è™•ç†çµæœ',
                    processing_time: 'è™•ç†è€—æ™‚ï¼š',
                    file_size: 'æª”æ¡ˆå¤§å°ï¼š',
                    download_result: 'ä¸‹è¼‰åœ–ç‰‡',
                    no_result_text: 'è™•ç†å¾Œçš„åœ–ç‰‡å°‡é¡¯ç¤ºåœ¨é€™è£¡',
                    recent_history: 'æœ€è¿‘è™•ç†',
                    no_history: 'æš«ç„¡è™•ç†è¨˜éŒ„',
                    intro_title: 'é—œæ–¼æœ¬å·¥å…·',
                    intro_text: 'æœ¬å·¥å…·å¯çµ¦åœ–ç‰‡æ–°å¢æ–‡å­—æˆ–åœ–ç‰‡æ°´å°ï¼Œæ‰€æœ‰è™•ç†å‡åœ¨æœ¬æ©Ÿå®Œæˆï¼Œä¿è­·æ‚¨çš„éš±ç§å®‰å…¨ã€‚',
                    please_upload_image: 'è«‹å…ˆä¸Šå‚³åœ–ç‰‡',
                    please_enter_text: 'è«‹è¼¸å…¥æ°´å°æ–‡å­—',
                    please_upload_watermark_image: 'è«‹å…ˆä¸Šå‚³æ°´å°åœ–ç‰‡',
                    processing: 'è™•ç†ä¸­...',
                    download_success: 'ä¸‹è¼‰æˆåŠŸé–‹å§‹',
                    view: 'æª¢è¦–'
                },
                'ja': {
                    title: 'ğŸ” ç”»åƒé€ã‹ã—ãƒ„ãƒ¼ãƒ«',
                    upload_image: 'ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
                    supported_formats: 'JPGã€PNGã€WEBPãªã©ã®ä¸€èˆ¬çš„ãªç”»åƒå½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ',
                    preview: 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
                    watermark_options: 'é€ã‹ã—è¨­å®š',
                    watermark_type: 'é€ã‹ã—ã®ç¨®é¡',
                    text_watermark: 'ãƒ†ã‚­ã‚¹ãƒˆé€ã‹ã—',
                    image_watermark: 'ç”»åƒé€ã‹ã—',
                    position: 'ä½ç½®',
                    top_left: 'å·¦ä¸Š',
                    top_right: 'å³ä¸Š',
                    bottom_left: 'å·¦ä¸‹',
                    bottom_right: 'å³ä¸‹',
                    center: 'ä¸­å¤®',
                    tile: 'ã‚¿ã‚¤ãƒ«çŠ¶',
                    watermark_text: 'é€ã‹ã—ãƒ†ã‚­ã‚¹ãƒˆ',
                    font_size: 'ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º (px)',
                    color: 'è‰²',
                    opacity: 'é€æ˜åº¦ (0-100)',
                    watermark_image: 'é€ã‹ã—ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
                    watermark_image_note: 'é€éèƒŒæ™¯ã®PNGç”»åƒã‚’æ¨å¥¨',
                    watermark_size: 'é€ã‹ã—æ‹¡å¤§ç¸®å° (%)',
                    watermark_opacity: 'é€æ˜åº¦ (0-100)',
                    apply_watermark: 'é€ã‹ã—ã‚’è¿½åŠ ',
                    clear_all: 'ã™ã¹ã¦ã‚¯ãƒªã‚¢',
                    result: 'å‡¦ç†çµæœ',
                    processing_time: 'å‡¦ç†æ™‚é–“ï¼š',
                    file_size: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼š',
                    download_result: 'ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
                    no_result_text: 'å‡¦ç†å¾Œã®ç”»åƒã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™',
                    recent_history: 'æœ€è¿‘ã®å‡¦ç†',
                    no_history: 'å‡¦ç†å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“',
                    intro_title: 'ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦',
                    intro_text: 'ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ç”»åƒã«ãƒ†ã‚­ã‚¹ãƒˆã¾ãŸã¯ç”»åƒã®é€ã‹ã—ã‚’è¿½åŠ ã§ãã¾ã™ã€‚ã™ã¹ã¦ã®å‡¦ç†ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§è¡Œã‚ã‚Œã¾ã™ã€‚',
                    please_upload_image: 'ã¾ãšç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„',
                    please_enter_text: 'é€ã‹ã—ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                    please_upload_watermark_image: 'é€ã‹ã—ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„',
                    processing: 'å‡¦ç†ä¸­...',
                    download_success: 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒæ­£å¸¸ã«é–‹å§‹ã•ã‚Œã¾ã—ãŸ',
                    view: 'è¡¨ç¤º'
                },
                'ru': {
                    title: 'ğŸ” Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ²Ğ¾Ğ´ÑĞ½Ñ‹Ñ… Ğ·Ğ½Ğ°ĞºĞ¾Ğ²',
                    upload_image: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
                    supported_formats: 'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ JPG, PNG, WEBP',
                    preview: 'ĞŸÑ€ĞµĞ²ÑŒÑ',
                    watermark_options: 'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸',
                    watermark_type: 'Ğ¢Ğ¸Ğ¿ Ğ·Ğ½Ğ°ĞºĞ°',
                    text_watermark: 'Ğ¢ĞµĞºÑÑ‚',
                    image_watermark: 'Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
                    position: 'ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ñ',
                    top_left: 'Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ»ĞµĞ²Ñ‹Ğ¹',
                    top_right: 'Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ°Ğ²Ñ‹Ğ¹',
                    bottom_left: 'ĞĞ¸Ğ¶Ğ½Ğ¸Ğ¹ Ğ»ĞµĞ²Ñ‹Ğ¹',
                    bottom_right: 'ĞĞ¸Ğ¶Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ°Ğ²Ñ‹Ğ¹',
                    center: 'ĞŸĞ¾ Ñ†ĞµĞ½Ñ‚Ñ€Ñƒ',
                    tile: 'ĞŸĞ»Ğ¸Ñ‚ĞºĞ°',
                    watermark_text: 'Ğ¢ĞµĞºÑÑ‚ Ğ·Ğ½Ğ°ĞºĞ°',
                    font_size: 'Ğ Ğ°Ğ·Ğ¼ĞµÑ€ (px)',
                    color: 'Ğ¦Ğ²ĞµÑ‚',
                    opacity: 'ĞŸÑ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ',
                    watermark_image: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ·Ğ½Ğ°Ğº',
                    watermark_image_note: 'Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ PNG',
                    watermark_size: 'ĞœĞ°ÑÑˆÑ‚Ğ°Ğ± (%)',
                    watermark_opacity: 'ĞŸÑ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ',
                    apply_watermark: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ',
                    clear_all: 'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ',
                    result: 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚',
                    processing_time: 'Ğ’Ñ€ĞµĞ¼Ñ:',
                    file_size: 'Ğ Ğ°Ğ·Ğ¼ĞµÑ€:',
                    download_result: 'Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ',
                    no_result_text: 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ´ĞµÑÑŒ',
                    recent_history: 'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ',
                    no_history: 'ĞĞµÑ‚ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸',
                    intro_title: 'Ğ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğµ',
                    intro_text: 'Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²Ğ¾Ğ´ÑĞ½Ñ‹Ñ… Ğ·Ğ½Ğ°ĞºĞ¾Ğ². ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ.',
                    please_upload_image: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
                    please_enter_text: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚',
                    please_upload_watermark_image: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ·Ğ½Ğ°ĞºĞ°',
                    processing: 'ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°...',
                    download_success: 'Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°Ñ‡Ğ°Ñ‚Ğ¾',
                    view: 'ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€'
                }
            },

            init: function() {
                this.initEventListeners();
                const params = new URLSearchParams(window.location.search);
                const lang = params.get('lang');
                if (lang && this.i18n[lang]) {
                    document.getElementById('lang-selector').value = lang;
                    this.changeLang(false);
                } else {
                    this.changeLang(false); 
                }
                this.loadProcessingHistory();
            },

            initEventListeners: function() {
                document.getElementById('image_upload').addEventListener('change', (e) => this.handleImageUpload(e));
                document.getElementById('watermark_image_upload').addEventListener('change', (e) => this.handleWatermarkImageUpload(e));
                
                document.getElementById('opacity').addEventListener('input', (e) => {
                    document.getElementById('opacity_value').textContent = `${e.target.value}%`;
                });
                
                document.getElementById('watermark_size').addEventListener('input', (e) => {
                    document.getElementById('watermark_size_value').textContent = `${e.target.value}%`;
                });
                
                document.getElementById('watermark_image_opacity').addEventListener('input', (e) => {
                    document.getElementById('watermark_image_opacity_value').textContent = `${e.target.value}%`;
                });
            },

            toggleWatermarkOptions: function() {
                const type = document.getElementById('watermark_type').value;
                const textOptions = document.getElementById('text_watermark_options');
                const imageOptions = document.getElementById('image_watermark_options');
                
                if (type === 'text') {
                    textOptions.classList.remove('hidden');
                    imageOptions.classList.add('hidden');
                } else {
                    textOptions.classList.add('hidden');
                    imageOptions.classList.remove('hidden');
                }
            },

            handleImageUpload: function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        this.uploadedImage = img;
                        const previewContainer = document.getElementById('image_preview_container');
                        const previewImage = document.getElementById('image_preview');
                        previewImage.src = event.target.result;
                        previewContainer.classList.remove('hidden');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            },

            handleWatermarkImageUpload: function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            this.watermarkImage = img;
                            const container = document.getElementById('watermark_image_preview_container');
                            const preview = document.getElementById('watermark_image_preview');
                            preview.src = event.target.result;
                            container.classList.remove('hidden');
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            },

            applyWatermark: function() {
                if (!this.uploadedImage) {
                    alert(this.getI18nText('please_upload_image'));
                    return;
                }
                
                const watermarkType = document.getElementById('watermark_type').value;
                if (watermarkType === 'text' && !document.getElementById('watermark_text').value.trim()) {
                    alert(this.getI18nText('please_enter_text'));
                    return;
                }
                if (watermarkType === 'image' && !this.watermarkImage) {
                    alert(this.getI18nText('please_upload_watermark_image'));
                    return;
                }
                
                const startTime = performance.now();
                document.getElementById('no_result').classList.add('hidden');
                document.getElementById('result_container').classList.remove('hidden');
                
                // Use a canvas to perform the watermarking
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas dimensions to image dimensions
                canvas.width = this.uploadedImage.width;
                canvas.height = this.uploadedImage.height;
                
                // Draw original image
                ctx.drawImage(this.uploadedImage, 0, 0);
                
                // Draw Watermark
                const position = document.getElementById('watermark_position').value;
                
                if (watermarkType === 'text') {
                    this.drawTextWatermark(ctx, canvas.width, canvas.height, position);
                } else {
                    this.drawImageWatermark(ctx, canvas.width, canvas.height, position);
                }
                
                const resultDataUrl = canvas.toDataURL('image/png');
                document.getElementById('result_image').src = resultDataUrl;
                
                const endTime = performance.now();
                document.getElementById('processing_time').textContent = `${Math.round(endTime - startTime)}ms`;
                
                const fileSize = this.calculateFileSize(resultDataUrl);
                document.getElementById('file_size').textContent = fileSize;
                
                this.saveToHistory(resultDataUrl);
            },

            drawTextWatermark: function(ctx, width, height, position) {
                const text = document.getElementById('watermark_text').value;
                const fontSize = parseInt(document.getElementById('font_size').value);
                const color = document.getElementById('watermark_color').value;
                const opacity = parseInt(document.getElementById('opacity').value) / 100;
                
                ctx.font = `${fontSize}px sans-serif`;
                ctx.fillStyle = color;
                ctx.globalAlpha = opacity;
                ctx.textBaseline = 'middle';
                
                const metrics = ctx.measureText(text);
                const textWidth = metrics.width;
                const textHeight = fontSize; // approximate
                
                const padding = 20;
                let x, y;
                
                if (position === 'tile') {
                    this.drawTiledText(ctx, text, width, height, textWidth, textHeight);
                    return;
                }

                switch (position) {
                    case 'top-left':
                        x = padding;
                        y = padding + textHeight / 2;
                        ctx.textAlign = 'left';
                        break;
                    case 'top-right':
                        x = width - padding;
                        y = padding + textHeight / 2;
                        ctx.textAlign = 'right';
                        break;
                    case 'bottom-left':
                        x = padding;
                        y = height - padding - textHeight / 2;
                        ctx.textAlign = 'left';
                        break;
                    case 'bottom-right':
                        x = width - padding;
                        y = height - padding - textHeight / 2;
                        ctx.textAlign = 'right';
                        break;
                    case 'center':
                    default:
                        x = width / 2;
                        y = height / 2;
                        ctx.textAlign = 'center';
                        break;
                }
                
                ctx.fillText(text, x, y);
                ctx.globalAlpha = 1.0; // Reset
            },

            drawTiledText: function(ctx, text, width, height, textWidth, textHeight) {
                ctx.textAlign = 'center';
                // Rotate context for tiled effect usually looks better angled
                ctx.translate(width / 2, height / 2);
                ctx.rotate(-Math.PI / 6); // -30 degrees
                ctx.translate(-width / 2, -height / 2);
                
                // Calculate cover area (larger than canvas to cover rotation edges)
                const diag = Math.sqrt(width * width + height * height);
                const gapX = textWidth + 100; // Horizontal gap
                const gapY = textHeight + 100; // Vertical gap
                
                const startX = -diag / 2;
                const startY = -diag / 2;
                const endX = width + diag / 2;
                const endY = height + diag / 2;
                
                for (let y = startY; y < endY; y += gapY) {
                    for (let x = startX; x < endX; x += gapX) {
                        ctx.fillText(text, x, y);
                    }
                }
                
                // Reset transformation
                ctx.setTransform(1, 0, 0, 1, 0, 0); 
                ctx.globalAlpha = 1.0;
            },

            drawImageWatermark: function(ctx, width, height, position) {
                const scale = parseInt(document.getElementById('watermark_size').value) / 100;
                const opacity = parseInt(document.getElementById('watermark_image_opacity').value) / 100;
                
                // Calculate target size keeping aspect ratio
                // Base the size relative to the main image size
                // Let's say 100% scale means the watermark width is 50% of image width
                const baseScale = 0.5; 
                let targetWidth = this.watermarkImage.width;
                let targetHeight = this.watermarkImage.height;
                
                // If watermark is larger than image, scale it down first
                if (targetWidth > width) {
                    const ratio = width / targetWidth;
                    targetWidth = width;
                    targetHeight = targetHeight * ratio;
                }
                
                // Apply user scale
                // Actually let's interpret user scale as relative to main image width
                // 100% = 1/2 of main image width, 10% = 1/20 main image width
                const finalWidth = (width * 0.5) * scale;
                const ratio = finalWidth / this.watermarkImage.width;
                const finalHeight = this.watermarkImage.height * ratio;

                ctx.globalAlpha = opacity;
                
                const padding = 20;
                let x, y;

                if (position === 'tile') {
                    this.drawTiledImage(ctx, this.watermarkImage, width, height, finalWidth, finalHeight);
                    return;
                }

                switch (position) {
                    case 'top-left':
                        x = padding;
                        y = padding;
                        break;
                    case 'top-right':
                        x = width - finalWidth - padding;
                        y = padding;
                        break;
                    case 'bottom-left':
                        x = padding;
                        y = height - finalHeight - padding;
                        break;
                    case 'bottom-right':
                        x = width - finalWidth - padding;
                        y = height - finalHeight - padding;
                        break;
                    case 'center':
                    default:
                        x = (width - finalWidth) / 2;
                        y = (height - finalHeight) / 2;
                        break;
                }
                
                ctx.drawImage(this.watermarkImage, x, y, finalWidth, finalHeight);
                ctx.globalAlpha = 1.0;
            },

            drawTiledImage: function(ctx, img, width, height, w, h) {
                // Rotate context
                ctx.translate(width / 2, height / 2);
                ctx.rotate(-Math.PI / 6);
                ctx.translate(-width / 2, -height / 2);
                
                const diag = Math.sqrt(width * width + height * height);
                const gapX = w + 50;
                const gapY = h + 50;
                
                const startX = -diag / 2;
                const startY = -diag / 2;
                const endX = width + diag / 2;
                const endY = height + diag / 2;
                
                for (let y = startY; y < endY; y += gapY) {
                    for (let x = startX; x < endX; x += gapX) {
                        ctx.drawImage(img, x, y, w, h);
                    }
                }
                
                ctx.setTransform(1, 0, 0, 1, 0, 0); 
                ctx.globalAlpha = 1.0;
            },

            calculateFileSize: function(dataUrl) {
                const byteLength = atob(dataUrl.split(',')[1]).length;
                const kb = Math.round(byteLength / 1024);
                return kb < 1024 ? `${kb}KB` : `${(kb / 1024).toFixed(1)}MB`;
            },

            downloadResult: function() {
                const resultImage = document.getElementById('result_image');
                if (!resultImage.src) return;
                
                const link = document.createElement('a');
                link.href = resultImage.src;
                link.download = `watermarked_${Date.now()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },

            clearAll: function() {
                this.uploadedImage = null;
                this.watermarkImage = null;
                document.getElementById('image_upload').value = '';
                document.getElementById('watermark_text').value = 'Sample Watermark';
                document.getElementById('watermark_image_upload').value = '';
                
                document.getElementById('image_preview_container').classList.add('hidden');
                document.getElementById('watermark_image_preview_container').classList.add('hidden');
                document.getElementById('result_container').classList.add('hidden');
                document.getElementById('no_result').classList.remove('hidden');
                
                document.getElementById('watermark_type').value = 'text';
                this.toggleWatermarkOptions();
            },

            saveToHistory: function(imageSrc) {
                try {
                    let history = JSON.parse(localStorage.getItem('watermarkHistory') || '[]');
                    history.unshift({
                        id: Date.now(),
                        src: imageSrc,
                        timestamp: new Date().toLocaleString()
                    });
                    if (history.length > 5) history = history.slice(0, 5);
                    localStorage.setItem('watermarkHistory', JSON.stringify(history));
                    this.loadProcessingHistory();
                } catch (e) {
                    console.error("Local storage error (quota likely exceeded for images):", e);
                }
            },

            loadProcessingHistory: function() {
                const historyContainer = document.getElementById('watermark_history');
                const history = JSON.parse(localStorage.getItem('watermarkHistory') || '[]');
                
                if (history.length === 0) {
                    historyContainer.innerHTML = `<p data-i18n="no_history" class="text-gray-400 italic text-sm">${this.getI18nText('no_history')}</p>`;
                    return;
                }
                
                let html = '';
                history.forEach(item => {
                    html += `
                        <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 last:border-0 last:mb-0 last:pb-0">
                            <img src="${item.src}" alt="History" class="w-16 h-16 object-cover rounded bg-gray-200">
                            <div class="flex-1 min-w-0">
                                <p class="text-xs text-gray-500 truncate">${item.timestamp}</p>
                                <button onclick="WatermarkTool.loadHistoryItem('${item.src}')" class="text-xs text-blue-600 hover:underline mt-1" data-i18n="view">æŸ¥çœ‹</button>
                            </div>
                        </div>
                    `;
                });
                
                historyContainer.innerHTML = html;
                this.updateI18nElements(historyContainer);
            },

            loadHistoryItem: function(src) {
                document.getElementById('result_image').src = src;
                document.getElementById('no_result').classList.add('hidden');
                document.getElementById('result_container').classList.remove('hidden');
            },

            changeLang: function(updateUrl = true) {
                const lang = document.getElementById('lang-selector').value;
                const i18nData = this.i18n[lang];
                this.updateI18nElements(document);
                if (updateUrl) {
                    const url = new URL(window.location);
                    url.searchParams.set('lang', lang);
                    window.history.pushState({}, '', url);
                }
                document.title = i18nData['title'];
            },

            updateI18nElements: function(container) {
                const lang = document.getElementById('lang-selector').value;
                const i18nData = this.i18n[lang];
                container.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (i18nData[key]) {
                        if (el.tagName === 'INPUT' && el.getAttribute('type') === 'placeholder') {
                            el.placeholder = i18nData[key];
                        } else {
                            el.textContent = i18nData[key];
                        }
                    }
                });
            },

            getI18nText: function(key) {
                const lang = document.getElementById('lang-selector').value;
                return this.i18n[lang] && this.i18n[lang][key] ? this.i18n[lang][key] : key;
            }
        };

        window.addEventListener('DOMContentLoaded', () => {
            WatermarkTool.init();
        });
    </script>

    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
    
</body>
</html>