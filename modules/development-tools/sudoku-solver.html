<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="category" content="development-tools">
    <meta charset="UTF-8">
    <title>Sudoku Solver Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #fff7ed; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
        .sudoku-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 1px; background: #94a3b8; border: 2px solid #475569; }
        .sudoku-cell { 
            width: 100%; aspect-ratio: 1; text-align: center; font-size: 1.2rem; outline: none; background: white; 
            transition: background 0.2s, color 0.2s;
        }
        .sudoku-cell:focus { background: #e0f2fe; }
        .sudoku-cell.user-input { font-weight: bold; color: #1e293b; }
        .sudoku-cell.solved { color: #2563eb; font-weight: bold; } /* Solved numbers in blue */
        .sudoku-cell.error { background-color: #fecaca; color: #dc2626; }
        
        /* Custom thick borders for 3x3 subgrids */
        .sudoku-cell:nth-child(3n) { border-right: 2px solid #475569; }
        .sudoku-cell:nth-child(9n) { border-right: none; }
        /* Bottom borders for 3rd and 6th row handled via margin in JS logic or specific child selection */
        /* Note: CSS Grid gap handles internal lines. We use JS to add margin for visual blocks. */
    </style>
    <link rel="canonical" href="https://toolboxpro.top/modules/development-tools/sudoku-solver.html" />
</head>
<body>

    <div class="tool-module active" 
         data-id="sudoku_solver" 
         data-category="game" 
         data-title="Sudoku Solver" 
         data-icon="üß©">
        
        <div class="absolute top-4 right-4">
            <select id="ss-lang" onchange="SudokuSolver.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en">English</option>
                <option value="zh-CN">Á∞°È´î‰∏≠Êñá</option>
                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">üß© Sudoku Solver</h2>

        <div class="flex justify-center mb-6">
            <div id="grid-container" class="grid grid-cols-9 gap-0.5 bg-gray-600 p-1 border-2 border-gray-700" style="width: 280px; height: 280px;">
                <!-- Cells generated by JS -->
            </div>
        </div>

        <div class="flex gap-2 justify-center">
            <button onclick="SudokuSolver.solve()" class="px-6 py-2 bg-orange-500 text-white rounded font-bold hover:bg-orange-600 transition" data-i18n="btn_solve">Solve</button>
            <button onclick="SudokuSolver.clear()" class="px-6 py-2 bg-gray-200 text-gray-700 rounded font-bold hover:bg-gray-300 transition" data-i18n="btn_clear">Clear</button>
        </div>
        <div id="ss-msg" class="text-center text-sm font-bold text-red-500 mt-3 h-5"></div>
    </div>

    <script>
        const SudokuSolver = {
            i18n: {
                'en': { title: 'üß© Sudoku Solver', btn_solve: 'Solve', btn_clear: 'Clear', msg_err: 'No solution found!', msg_invalid: 'Invalid input!' },
                'zh-CN': { title: 'üß© Êï∞Áã¨Ê±ÇËß£Âô®', btn_solve: 'Ê±ÇËß£', btn_clear: 'Ê∏ÖÁ©∫', msg_err: 'Êó†Ëß£ÔºÅ', msg_invalid: 'ËæìÂÖ•ÊúâÂÜ≤Á™ÅÔºÅ' },
                'zh-TW': { title: 'üß© Êï∏Áç®Ê±ÇËß£Âô®', btn_solve: 'Ê±ÇËß£', btn_clear: 'Ê∏ÖÁ©∫', msg_err: 'ÁÑ°Ëß£ÔºÅ', msg_invalid: 'Ëº∏ÂÖ•ÊúâË°ùÁ™ÅÔºÅ' },
                'ja': { title: 'üß© Êï∞Áã¨„ÇΩ„É´„Éê„Éº', btn_solve: 'Ëß£Ê±∫', btn_clear: '„ÇØ„É™„Ç¢', msg_err: 'Ëß£„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºÅ', msg_invalid: 'ÂÖ•Âäõ„ÅåÁÑ°Âäπ„Åß„ÅôÔºÅ' },
                'ru': { title: 'üß© –†–µ—à–∞—Ç–µ–ª—å –°—É–¥–æ–∫—É', btn_solve: '–†–µ—à–∏—Ç—å', btn_clear: '–û—á–∏—Å—Ç–∏—Ç—å', msg_err: '–†–µ—à–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!', msg_invalid: '–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞!' },
                'es': { title: 'üß© Resolver Sudoku', btn_solve: 'Resolver', btn_clear: 'Borrar', msg_err: '¬°Sin soluci√≥n!', msg_invalid: '¬°Entrada inv√°lida!' }
            },

            init: () => {
                const container = document.getElementById('grid-container');
                container.innerHTML = ''; // prevent duplicates on reload
                for (let i = 0; i < 81; i++) {
                    const input = document.createElement('input');
                    input.type = 'number'; // Allow number pad on mobile
                    input.className = 'sudoku-cell user-input';
                    
                    // Input restrictions
                    input.oninput = function() {
                        if (this.value.length > 1) this.value = this.value.slice(0, 1);
                        if (!/^[1-9]$/.test(this.value)) this.value = '';
                        this.classList.remove('error'); // Clear error on type
                        document.getElementById('ss-msg').innerText = "";
                    };

                    // Add margins for 3x3 blocks visually
                    const row = Math.floor(i / 9);
                    const col = i % 9;
                    if (col === 2 || col === 5) input.style.marginRight = '2px';
                    if (row === 2 || row === 5) input.style.marginBottom = '2px';
                    
                    container.appendChild(input);
                }
            },

            changeLang: () => {
                const lang = document.getElementById('ss-lang').value;
                const texts = SudokuSolver.i18n[lang];
                document.querySelector('[data-i18n="title"]').innerText = texts.title;
                document.querySelector('[data-i18n="btn_solve"]').innerText = texts.btn_solve;
                document.querySelector('[data-i18n="btn_clear"]').innerText = texts.btn_clear;
            },

            getBoard: () => {
                const inputs = document.querySelectorAll('#grid-container input');
                const board = [];
                let row = [];
                inputs.forEach((inp, idx) => {
                    const val = parseInt(inp.value) || 0;
                    row.push(val);
                    if ((idx + 1) % 9 === 0) {
                        board.push(row);
                        row = [];
                    }
                });
                return board;
            },

            // Set board with visual distinction
            setBoard: (board, originalBoard) => {
                const inputs = document.querySelectorAll('#grid-container input');
                board.flat().forEach((val, idx) => {
                    inputs[idx].value = val === 0 ? '' : val;
                    // If it was 0 in original board, it is a solved number -> blue
                    const originalVal = originalBoard.flat()[idx];
                    if (originalVal === 0) {
                        inputs[idx].classList.remove('user-input');
                        inputs[idx].classList.add('solved');
                    } else {
                        inputs[idx].classList.add('user-input');
                        inputs[idx].classList.remove('solved');
                    }
                });
            },

            isValid: (board, row, col, num) => {
                // Check Row & Col
                for (let x = 0; x < 9; x++) {
                    // Check against other cells, ignoring the cell itself (for validation)
                    if (x !== col && board[row][x] === num) return false;
                    if (x !== row && board[x][col] === num) return false;
                }
                // Check 3x3 Box
                const startRow = row - row % 3;
                const startCol = col - col % 3;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        const r = i + startRow;
                        const c = j + startCol;
                        if ((r !== row || c !== col) && board[r][c] === num) return false;
                    }
                }
                return true;
            },

            // Check entire initial board for conflicts
            validateInitialBoard: (board) => {
                const inputs = document.querySelectorAll('#grid-container input');
                let valid = true;
                
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        const num = board[r][c];
                        if (num !== 0) {
                            if (!SudokuSolver.isValid(board, r, c, num)) {
                                valid = false;
                                // Highlight conflict
                                const idx = r * 9 + c;
                                inputs[idx].classList.add('error');
                            }
                        }
                    }
                }
                return valid;
            },

            solveHelper: (board) => {
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        if (board[row][col] === 0) {
                            for (let num = 1; num <= 9; num++) {
                                if (SudokuSolver.isValid(board, row, col, num)) {
                                    board[row][col] = num;
                                    if (SudokuSolver.solveHelper(board)) return true;
                                    board[row][col] = 0;
                                }
                            }
                            return false;
                        }
                    }
                }
                return true;
            },

            solve: () => {
                const lang = document.getElementById('ss-lang').value;
                const msgEl = document.getElementById('ss-msg');
                msgEl.innerText = "";
                
                // Clear previous errors
                document.querySelectorAll('.sudoku-cell').forEach(el => el.classList.remove('error'));

                const board = SudokuSolver.getBoard();
                const originalBoard = JSON.parse(JSON.stringify(board)); // Deep copy

                // 1. Validate User Input First
                if (!SudokuSolver.validateInitialBoard(board)) {
                    msgEl.innerText = SudokuSolver.i18n[lang].msg_invalid;
                    return;
                }

                // 2. Attempt Solve
                if (SudokuSolver.solveHelper(board)) {
                    SudokuSolver.setBoard(board, originalBoard);
                } else {
                    msgEl.innerText = SudokuSolver.i18n[lang].msg_err;
                }
            },

            clear: () => {
                const inputs = document.querySelectorAll('#grid-container input');
                inputs.forEach(inp => {
                    inp.value = '';
                    inp.classList.remove('solved', 'error');
                    inp.classList.add('user-input');
                });
                document.getElementById('ss-msg').innerText = "";
            }
        };

        SudokuSolver.init();
    </script>

    <div id="related-tools-container"></div>
    <script src="../../scripts/related.js"></script>
    
</body>
</html>