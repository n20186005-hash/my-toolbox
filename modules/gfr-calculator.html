<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GFR Calculator Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { padding: 20px; background: #eff6ff; font-family: sans-serif; }
        .tool-module { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; position: relative; }
    </style>
</head>
<body>

    <div class="tool-module active" 
         data-id="gfr_calc" 
         data-category="health" 
         data-title="GFR Calculator" 
         data-icon="ü©∫">
        
        <div class="absolute top-4 right-4">
            <select id="gc-lang" onchange="GFRCalc.changeLang()" class="text-xs border border-gray-300 rounded p-1 bg-gray-50 text-gray-600 focus:outline-none">
                <option value="en">English</option>
                <option value="zh-CN">Á∞°È´î‰∏≠Êñá</option>
                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2" data-i18n="title">ü©∫ GFR Calculator</h2>
        <p class="text-xs text-gray-400 mb-4" data-i18n="desc">Uses CKD-EPI (2021) Creatinine Equation.</p>

        <div class="mb-4">
            <label class="block text-xs text-gray-500 mb-1" data-i18n="lbl_creat">Serum Creatinine</label>
            <div class="flex gap-2">
                <input type="number" id="gc-creat" class="flex-1 p-2 border rounded focus:ring-1 focus:ring-blue-500 outline-none" placeholder="0.9" step="0.01">
                <select id="gc-unit" class="border rounded bg-white text-sm px-2">
                    <option value="mgdl">mg/dL</option>
                    <option value="umol">¬µmol/L</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div>
                <label class="block text-xs text-gray-500 mb-1" data-i18n="lbl_age">Age</label>
                <input type="number" id="gc-age" class="w-full p-2 border rounded focus:ring-1 focus:ring-blue-500 outline-none" placeholder="45">
            </div>
            <div>
                <label class="block text-xs text-gray-500 mb-1" data-i18n="lbl_gender">Gender</label>
                <select id="gc-gender" class="w-full p-2 border rounded bg-white text-sm">
                    <option value="male" data-i18n="g_male">Male</option>
                    <option value="female" data-i18n="g_female">Female</option>
                </select>
            </div>
        </div>

        <button onclick="GFRCalc.calc()" class="w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 transition mb-6" data-i18n="btn_calc">Calculate GFR</button>

        <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 text-center">
            <span class="text-gray-500 text-xs block mb-1" data-i18n="res_gfr">Estimated GFR</span>
            <div id="gc-result" class="text-4xl font-bold text-blue-800">--</div>
            <div id="gc-stage" class="text-sm text-blue-600 mt-2 font-medium"></div>
            <div class="text-xs text-gray-400 mt-1">mL/min/1.73m¬≤</div>
        </div>
    </div>

    <script>
        const GFRCalc = {
            i18n: {
                'en': {
                    title: 'ü©∫ GFR Calculator',
                    desc: 'Uses CKD-EPI (2021) Creatinine Equation.',
                    lbl_creat: 'Serum Creatinine',
                    lbl_age: 'Age', lbl_gender: 'Gender',
                    g_male: 'Male', g_female: 'Female',
                    btn_calc: 'Calculate GFR',
                    res_gfr: 'Estimated GFR',
                    st_norm: 'Normal Kidney Function',
                    st_mild: 'Mild Reduction',
                    st_mod: 'Moderate Reduction',
                    st_sev: 'Severe Reduction',
                    st_fail: 'Kidney Failure'
                },
                'zh-CN': {
                    title: 'ü©∫ GFR ËÇæÂ∞èÁêÉÊª§ËøáÁéá',
                    desc: '‰ΩøÁî® CKD-EPI (2021) ËÇåÈÖêÂÖ¨Âºè„ÄÇ',
                    lbl_creat: 'Ë°ÄËÇåÈÖê',
                    lbl_age: 'Âπ¥ÈæÑ', lbl_gender: 'ÊÄßÂà´',
                    g_male: 'Áî∑ÊÄß', g_female: 'Â•≥ÊÄß',
                    btn_calc: 'ËÆ°ÁÆó GFR',
                    res_gfr: '‰º∞ÁÆó GFR ÂÄº',
                    st_norm: 'ËÇæÂäüËÉΩÊ≠£Â∏∏', st_mild: 'ËΩªÂ∫¶‰∏ãÈôç', st_mod: '‰∏≠Â∫¶‰∏ãÈôç', st_sev: 'ÈáçÂ∫¶‰∏ãÈôç', st_fail: 'ËÇæË°∞Á´≠'
                },
                'zh-TW': {
                    title: 'ü©∫ GFR ËÖéÁµ≤ÁêÉÈÅéÊøæÁéá',
                    desc: '‰ΩøÁî® CKD-EPI (2021) ËÇåÈÖêÂÖ¨Âºè„ÄÇ',
                    lbl_creat: 'Ë°ÄËÇåÈÖê',
                    lbl_age: 'Âπ¥ÈΩ°', lbl_gender: 'ÊÄßÂà•',
                    g_male: 'Áî∑ÊÄß', g_female: 'Â•≥ÊÄß',
                    btn_calc: 'Ë®àÁÆó GFR',
                    res_gfr: '‰º∞ÁÆó GFR ÂÄº',
                    st_norm: 'ËÖéÂäüËÉΩÊ≠£Â∏∏', st_mild: 'ËºïÂ∫¶‰∏ãÈôç', st_mod: '‰∏≠Â∫¶‰∏ãÈôç', st_sev: 'ÈáçÂ∫¶‰∏ãÈôç', st_fail: 'ËÖéË°∞Á´≠'
                },
                'ja': {
                    title: 'ü©∫ eGFR ËÖéÊ©üËÉΩË®àÁÆó',
                    desc: 'CKD-EPI (2021) Âºè„Çí‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ',
                    lbl_creat: 'Ë°ÄÊ∏Ö„ÇØ„É¨„Ç¢„ÉÅ„Éã„É≥',
                    lbl_age: 'Âπ¥ÈΩ¢', lbl_gender: 'ÊÄßÂà•',
                    g_male: 'Áî∑ÊÄß', g_female: 'Â•≥ÊÄß',
                    btn_calc: 'Ë®àÁÆó„Åô„Çã',
                    res_gfr: 'Êé®ÁÆó GFRÂÄ§',
                    st_norm: 'Ê≠£Â∏∏', st_mild: 'ËªΩÂ∫¶‰Ωé‰∏ã', st_mod: '‰∏≠Á≠âÂ∫¶‰Ωé‰∏ã', st_sev: 'È´òÂ∫¶‰Ωé‰∏ã', st_fail: 'ËÖé‰∏çÂÖ®'
                },
                'ru': {
                    title: 'ü©∫ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –°–ö–§ (GFR)',
                    desc: '–§–æ—Ä–º—É–ª–∞ CKD-EPI (2021).',
                    lbl_creat: '–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω',
                    lbl_age: '–í–æ–∑—Ä–∞—Å—Ç', lbl_gender: '–ü–æ–ª',
                    g_male: '–ú—É–∂—Å–∫–æ–π', g_female: '–ñ–µ–Ω—Å–∫–∏–π',
                    btn_calc: '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å',
                    res_gfr: '–†–µ–∑—É–ª—å—Ç–∞—Ç –°–ö–§',
                    st_norm: '–ù–æ—Ä–º–∞', st_mild: '–õ–µ–≥–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ', st_mod: '–£–º–µ—Ä–µ–Ω–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ', st_sev: '–¢—è–∂–µ–ª–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ', st_fail: '–ü–æ—á–µ—á–Ω–∞—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å'
                },
                'es': {
                    title: 'ü©∫ Calculadora TFG (GFR)',
                    desc: 'Usa la f√≥rmula CKD-EPI (2021).',
                    lbl_creat: 'Creatinina S√©rica',
                    lbl_age: 'Edad', lbl_gender: 'G√©nero',
                    g_male: 'Hombre', g_female: 'Mujer',
                    btn_calc: 'Calcular TFG',
                    res_gfr: 'TFG Estimada',
                    st_norm: 'Funci√≥n Normal', st_mild: 'Reducci√≥n Leve', st_mod: 'Reducci√≥n Moderada', st_sev: 'Reducci√≥n Severa', st_fail: 'Fallo Renal'
                }
            },

            changeLang: () => {
                const lang = document.getElementById('gc-lang').value;
                const texts = GFRCalc.i18n[lang];
                const elements = document.querySelectorAll('[data-id="gfr_calc"] [data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(texts[key]) {
                        if(el.tagName === 'OPTION') el.text = texts[key];
                        else el.innerText = texts[key];
                    }
                });
            },

            calc: () => {
                let creat = parseFloat(document.getElementById('gc-creat').value);
                const unit = document.getElementById('gc-unit').value;
                const age = parseFloat(document.getElementById('gc-age').value);
                const gender = document.getElementById('gc-gender').value;

                if (isNaN(creat) || isNaN(age)) return;

                // Convert umol/L to mg/dL if needed
                if (unit === 'umol') {
                    creat = creat / 88.4;
                }

                // CKD-EPI 2021 Formula
                // GFR = 142 * min(Scr/kappa, 1)^alpha * max(Scr/kappa, 1)^-1.20 * 0.9938^Age * (1.012 if female)
                
                let kappa, alpha, genderFactor;
                if (gender === 'female') {
                    kappa = 0.7;
                    alpha = -0.241;
                    genderFactor = 1.012;
                } else {
                    kappa = 0.9;
                    alpha = -0.302;
                    genderFactor = 1;
                }

                const ratio = creat / kappa;
                const minRatio = Math.min(ratio, 1);
                const maxRatio = Math.max(ratio, 1);

                const gfr = 142 * Math.pow(minRatio, alpha) * Math.pow(maxRatio, -1.20) * Math.pow(0.9938, age) * genderFactor;

                document.getElementById('gc-result').innerText = gfr.toFixed(1);

                // Stage logic
                const lang = document.getElementById('gc-lang').value;
                const txt = GFRCalc.i18n[lang];
                let stage = "";
                if (gfr >= 90) stage = txt.st_norm;
                else if (gfr >= 60) stage = txt.st_mild;
                else if (gfr >= 30) stage = txt.st_mod;
                else if (gfr >= 15) stage = txt.st_sev;
                else stage = txt.st_fail;

                document.getElementById('gc-stage').innerText = stage;
            }
        };
    </script>
</body>
</html>