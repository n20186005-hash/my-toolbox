<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Category Meta Tag -->
    <meta name="category" content="finance">
    <meta name="description" content="Cash Flow Calculator - Track your monthly income and expenses to understand where your money goes.">
    <title>Cash Flow Pro | 个人现金流计算器</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#10b981', hover: '#059669' }, /* Emerald for Income */
                        secondary: { DEFAULT: '#f59e0b', hover: '#d97706' }, /* Amber for Expenses */
                        surface: { light: '#ffffff', dark: '#1e293b' },
                        bg: { light: '#f8fafc', dark: '#020617' } 
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            /* 列表行样式 */
            .list-row {
                @apply flex items-center gap-3 py-3.5 px-5 border-b border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900 transition-colors hover:bg-slate-50 dark:hover:bg-slate-800/50;
            }
            .list-row:last-child {
                @apply border-b-0;
            }

            /* 左侧标签输入 */
            .label-input {
                @apply flex-grow bg-transparent border-none text-sm font-semibold text-slate-700 dark:text-slate-200 focus:text-slate-900 dark:focus:text-white focus:ring-0 p-0 placeholder-slate-400 transition-colors;
            }

            /* 右侧金额输入容器 */
            .amount-wrapper {
                @apply flex items-center bg-slate-50 dark:bg-slate-800 rounded-lg px-3 py-1.5 border border-transparent transition-all focus-within:bg-white dark:focus-within:bg-black focus-within:shadow-sm;
            }
            
            /* 收入特定样式 */
            .wrapper-income:focus-within {
                @apply border-emerald-500 ring-1 ring-emerald-500/20;
            }
            .text-income { @apply text-emerald-600 dark:text-emerald-400; }

            /* 支出特定样式 */
            .wrapper-expense:focus-within {
                @apply border-amber-500 ring-1 ring-amber-500/20;
            }
            .text-expense { @apply text-amber-600 dark:text-amber-400; }

            /* 输入框本体 */
            .input-field {
                @apply w-28 sm:w-36 bg-transparent border-none text-right font-mono font-bold text-base outline-none p-0 ml-1 text-slate-800 dark:text-slate-200 placeholder-slate-400;
            }

            /* 删除按钮 */
            .delete-btn {
                @apply w-8 h-8 flex items-center justify-center rounded-full text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all cursor-pointer flex-shrink-0;
            }

            /* 添加按钮 */
            .add-btn {
                @apply w-full py-3.5 text-sm font-semibold text-slate-500 hover:text-primary dark:text-slate-400 dark:hover:text-primary hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors flex items-center justify-center gap-2 border-t border-slate-100 dark:border-slate-800;
            }
            
            /* 快速添加标签样式 */
            .quick-add-container {
                @apply px-5 py-3 flex flex-wrap gap-2 bg-slate-50/50 dark:bg-slate-800/30 border-t border-slate-100 dark:border-slate-800;
            }
            .chip {
                @apply px-2.5 py-1 rounded-md text-xs font-medium cursor-pointer transition-all border;
            }
            .chip-income {
                @apply bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 border-slate-200 dark:border-slate-700 hover:bg-emerald-50 hover:text-emerald-600 hover:border-emerald-200 dark:hover:bg-emerald-900/20 dark:hover:text-emerald-400 dark:hover:border-emerald-800;
            }
            .chip-expense {
                @apply bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 border-slate-200 dark:border-slate-700 hover:bg-amber-50 hover:text-amber-600 hover:border-amber-200 dark:hover:bg-amber-900/20 dark:hover:text-amber-400 dark:hover:border-amber-800;
            }
            
            /* 总计区域 */
            .section-footer {
                @apply p-5 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-100 dark:border-slate-800 flex justify-between items-center rounded-b-2xl;
            }
        }
    </style>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9279583389810634"
     crossorigin="anonymous"></script>

</head>
<body class="bg-bg-light dark:bg-bg-dark min-h-screen font-sans text-slate-800 dark:text-slate-200 transition-colors duration-300 overflow-x-hidden">

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row items-center justify-between gap-6 mb-10">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 flex items-center justify-center text-xl shadow-lg">
                    <i class="fa fa-line-chart"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight text-slate-900 dark:text-white" data-i18n="title">Cash Flow Pro</h1>
                    <p class="text-xs text-slate-500 font-medium tracking-wide uppercase" data-i18n="subtitle">个人现金流计算器</p>
                </div>
            </div>

            <div class="flex items-center gap-3 bg-white dark:bg-slate-800 p-1.5 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm">
                <select id="lang-selector" class="bg-transparent text-xs font-bold px-2 py-1 rounded focus:outline-none cursor-pointer text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700">
                    <option value="zh-CN">CN</option>
                    <option value="en">EN</option>
                </select>
                <div class="w-px h-4 bg-slate-200 dark:bg-slate-600"></div>
                <button id="mode-toggle" class="w-7 h-7 rounded flex items-center justify-center text-slate-400 hover:text-indigo-600 dark:hover:text-yellow-400 transition-all">
                    <i class="fa fa-moon-o dark:hidden"></i>
                    <i class="fa fa-sun-o hidden dark:inline"></i>
                </button>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="grid lg:grid-cols-12 gap-8 items-start mb-12">
            
            <!-- Left Column: Input Lists -->
            <main class="lg:col-span-7 space-y-8">
                
                <!-- Income Section -->
                <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-card border border-slate-200 dark:border-slate-800">
                    <!-- Header -->
                    <div class="px-5 py-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-emerald-50/50 dark:bg-emerald-900/10 rounded-t-2xl">
                        <div class="flex items-center gap-2 text-emerald-700 dark:text-emerald-400 font-bold text-sm uppercase tracking-wide">
                            <i class="fa fa-plus-circle"></i> <span data-i18n="h_income">收入 (Income)</span>
                        </div>
                    </div>
                    
                    <!-- List -->
                    <div id="income-list" class="divide-y divide-slate-100 dark:divide-slate-800">
                        <!-- Rows injected here -->
                    </div>

                    <!-- Quick Add Chips -->
                    <div class="quick-add-container">
                        <span class="text-[10px] uppercase font-bold text-slate-400 self-center mr-1" data-i18n="lbl_quick_add">快速添加:</span>
                        <div id="income-chips" class="flex flex-wrap gap-2">
                            <!-- Chips injected via JS -->
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <button onclick="App.addRow('income')" class="add-btn hover:text-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900/20">
                        <i class="fa fa-plus text-xs"></i> <span data-i18n="btn_add_income">添加收入项目</span>
                    </button>
                    
                    <!-- Footer Total -->
                    <div class="section-footer">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider" data-i18n="subtotal_income">总收入</span>
                        <span class="font-mono text-xl font-bold text-emerald-600 dark:text-emerald-400" id="display-total-income">¥0</span>
                    </div>
                </div>

                <!-- Expenses Section -->
                <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-card border border-slate-200 dark:border-slate-800">
                    <!-- Header -->
                    <div class="px-5 py-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-amber-50/50 dark:bg-amber-900/10 rounded-t-2xl">
                        <div class="flex items-center gap-2 text-amber-700 dark:text-amber-400 font-bold text-sm uppercase tracking-wide">
                            <i class="fa fa-minus-circle"></i> <span data-i18n="h_expenses">支出 (Expenses)</span>
                        </div>
                    </div>
                    
                    <!-- List -->
                    <div id="expenses-list" class="divide-y divide-slate-100 dark:divide-slate-800">
                        <!-- Rows injected here -->
                    </div>

                    <!-- Quick Add Chips -->
                    <div class="quick-add-container">
                        <span class="text-[10px] uppercase font-bold text-slate-400 self-center mr-1" data-i18n="lbl_quick_add">快速添加:</span>
                        <div id="expenses-chips" class="flex flex-wrap gap-2">
                             <!-- Chips injected via JS -->
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <button onclick="App.addRow('expenses')" class="add-btn hover:text-amber-600 hover:bg-amber-50 dark:hover:text-amber-400 dark:hover:bg-amber-900/20">
                        <i class="fa fa-plus text-xs"></i> <span data-i18n="btn_add_expense">添加支出项目</span>
                    </button>

                    <!-- Footer Total -->
                    <div class="section-footer">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider" data-i18n="subtotal_expenses">总支出</span>
                        <span class="font-mono text-xl font-bold text-amber-600 dark:text-amber-400" id="display-total-expenses">¥0</span>
                    </div>
                </div>

            </main>

            <!-- Right Column: Dashboard Sticky -->
            <aside class="lg:col-span-5 lg:sticky lg:top-6 space-y-6">
                
                <!-- Cash Flow Card -->
                <div class="bg-slate-900 dark:bg-black text-white rounded-3xl shadow-xl p-8 relative overflow-hidden flex flex-col items-center text-center">
                    <!-- Glow Effects -->
                    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-64 h-64 bg-emerald-500/10 rounded-full blur-[80px] pointer-events-none"></div>
                    
                    <h2 class="relative z-10 text-slate-400 text-xs font-bold uppercase tracking-[0.2em] mb-4" data-i18n="res_net_cash_flow">净现金流 (Surplus/Deficit)</h2>
                    
                    <div class="relative z-10 mb-8">
                        <div class="text-5xl sm:text-6xl font-mono font-bold tracking-tighter" id="main-net-cash-flow">¥0</div>
                        <div id="cash-flow-status" class="mt-3 inline-block px-4 py-1.5 rounded-full bg-white/10 text-[10px] font-medium backdrop-blur-md border border-white/5 text-slate-300">
                            Ready
                        </div>
                    </div>

                    <!-- Chart & Legend -->
                    <div class="relative z-10 w-full bg-white/5 rounded-2xl p-6 border border-white/5 backdrop-blur-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-2 text-xs">
                                <span class="w-2.5 h-2.5 rounded-full bg-emerald-400"></span>
                                <span class="text-slate-300" data-i18n="h_income">Income</span>
                            </div>
                            <div class="flex items-center gap-2 text-xs">
                                <span class="w-2.5 h-2.5 rounded-full bg-amber-500"></span>
                                <span class="text-slate-300" data-i18n="h_expenses">Expenses</span>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="space-y-2">
                             <div class="flex justify-between text-[10px] font-medium text-slate-400">
                                <span data-i18n="ratio_usage">支出占比 (Expense Ratio)</span>
                                <span id="ratio-display" class="text-white font-mono">0%</span>
                            </div>
                            <div class="w-full bg-slate-700/50 rounded-full h-2 overflow-hidden">
                                <div id="ratio-bar" class="bg-amber-500 h-full rounded-full transition-all duration-700" style="width: 0%"></div>
                            </div>
                        </div>

                         <div class="h-32 w-full mt-6 flex justify-center">
                             <canvas id="cashFlowChart"></canvas>
                        </div>
                    </div>
                </div>

            </aside>
        </div>

        <!-- Expanded Guide Section -->
        <section class="mb-12">
            <div class="bg-white dark:bg-slate-900 rounded-3xl p-8 shadow-card border border-slate-200 dark:border-slate-800">
                
                <div class="grid md:grid-cols-2 gap-10">
                    <!-- Left: Core Concept -->
                    <div class="space-y-4">
                        <h3 class="flex items-center gap-3 text-lg font-bold text-slate-900 dark:text-white">
                            <div class="w-10 h-10 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-blue-600 flex items-center justify-center">
                                <i class="fa fa-book"></i>
                            </div>
                            <span data-i18n="intro_title">个人现金流计算器</span>
                        </h3>
                        <div class="prose prose-slate dark:prose-invert text-sm text-slate-600 dark:text-slate-400 leading-relaxed">
                            <p data-i18n="intro_text_main">
                                有时候难免会想，钱都花哪儿去了？为了更好地了解您每月或每年的支出明细，请输入以下类别的信息。建议准备好您的银行账户、信用卡、贷款和其他对账单，以便更轻松地填写您的收入和支出。
                            </p>
                        </div>
                    </div>

                    <!-- Right: Optimization Tips -->
                    <div class="space-y-6">
                        <h3 class="flex items-center gap-3 text-lg font-bold text-slate-900 dark:text-white">
                            <div class="w-10 h-10 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 flex items-center justify-center">
                                <i class="fa fa-lightbulb-o"></i>
                            </div>
                            <span data-i18n="intro_tips_title">理财建议</span>
                        </h3>
                        
                        <div class="grid sm:grid-cols-2 gap-4">
                            <!-- Tip 1 -->
                            <div class="p-4 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-700 hover:bg-emerald-50/50 dark:hover:bg-emerald-900/10 transition-colors group">
                                <h4 class="font-bold text-slate-800 dark:text-slate-200 mb-2 text-xs uppercase tracking-wide group-hover:text-emerald-600 transition-colors" data-i18n="tip_h_income">增加收入</h4>
                                <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed" data-i18n="tip_p_income">
                                    关注长期职业发展，发展副业或被动收入（如股息、租金），提升总现金流入。
                                </p>
                            </div>

                            <!-- Tip 2 -->
                            <div class="p-4 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-700 hover:bg-amber-50/50 dark:hover:bg-amber-900/10 transition-colors group">
                                <h4 class="font-bold text-slate-800 dark:text-slate-200 mb-2 text-xs uppercase tracking-wide group-hover:text-amber-600 transition-colors" data-i18n="tip_h_expenses">优化支出</h4>
                                <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed" data-i18n="tip_p_expenses">
                                    区分“需要”与“想要”。定期审查订阅服务和冲动消费，保持正向现金流。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Footer -->
        <footer class="border-t border-slate-200 dark:border-slate-800 pt-8 pb-12 text-center">
             <div class="max-w-4xl mx-auto space-y-4">
                <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed" data-i18n="footer_disclaimer_1">
                    这些结果取决于您输入信息的准确性和完整性。这些结果并非财务计划。
                </p>
                <p class="text-[10px] text-slate-400 dark:text-slate-600 leading-relaxed max-w-3xl mx-auto opacity-80" data-i18n="footer_disclaimer_2">
                    本文所含信息仅供参考。信息出自我们认为可靠的来源。本信息不提供财务、法律、税务或投资方面的规划或建议。具体的投资、交易或税务策略应根据每位投资者的目标和风险承受能力加以评估。
                </p>
                <p class="text-[10px] text-slate-400 dark:text-slate-600 leading-relaxed max-w-3xl mx-auto opacity-80" data-i18n="footer_disclaimer_3">
                    对于您或任何第三方提供给我们的信息的准确性、对于因您或任何第三方使用本文档中的信息所导致的任何后果，以及对于任何人以任何方式使用本文档中的信息而产生的任何原因的任何直接或间接损失，道明投资服务有限公司、道明银行及其附属公司和相关实体均不承担任何责任。
                </p>
             </div>
        </footer>

    </div>

    <script>
        const i18nData = {
            'zh-CN': {
                title: "Cash Flow Pro", subtitle: "个人现金流计算器",
                h_income: "收入 (Income)", h_expenses: "支出 (Expenses)",
                btn_add_income: "添加收入项目", btn_add_expense: "添加支出项目",
                subtotal_income: "总收入", subtotal_expenses: "总支出",
                res_net_cash_flow: "净现金流 (Net Cash Flow)", 
                ratio_usage: "支出占比 (Expense Ratio)",
                lbl_quick_add: "快速添加:",
                
                // New Guide Section
                intro_title: "个人现金流计算器",
                intro_text_main: "有时候难免会想，钱都花哪儿去了？为了更好地了解您每月或每年的支出明细，请输入以下类别的信息。建议准备好您的银行账户、信用卡、贷款和其他对账单，以便更轻松地填写您的收入和支出。",
                intro_tips_title: "理财建议",
                tip_h_income: "增加收入",
                tip_p_income: "关注长期职业发展，发展副业或被动收入（如股息、租金），提升总现金流入。",
                tip_h_expenses: "优化支出",
                tip_p_expenses: "区分“需要”与“想要”。定期审查订阅服务和冲动消费，保持正向现金流，增加储蓄率。",

                // Footer
                footer_disclaimer_1: "这些结果取决于您输入信息的准确性和完整性。这些结果并非财务计划。",
                footer_disclaimer_2: "本文所含信息仅供参考。信息出自我们认为可靠的来源。本信息不提供财务、法律、税务或投资方面的规划或建议。具体的投资、交易或税务策略应根据每位投资者的目标和风险承受能力加以评估。",
                footer_disclaimer_3: "对于您或任何第三方提供给我们的信息的准确性、对于因您或任何第三方使用本文档中的信息所导致的任何后果，以及对于任何人以任何方式使用本文档中的信息而产生的任何原因的任何直接或间接损失，道明投资服务有限公司、道明银行及其附属公司和相关实体均不承担任何责任。",

                // Defaults & Chips
                def_income_total: "家庭净收入总额",
                def_housing: "住房", def_living: "个人与生活", def_transport: "汽车与交通", def_debt: "债务偿还", def_savings: "储蓄", def_other: "其他",
                
                chip_salary: "工资/薪水", chip_bonus: "奖金", chip_invest_inc: "投资收益", chip_rent_inc: "租金收入", chip_side: "副业收入",
                chip_rent: "房租/房贷", chip_food: "餐饮/超市", chip_util: "水电网费", chip_insur: "保险", chip_entertain: "娱乐", chip_med: "医疗", chip_edu: "教育"
            },
            'en': {
                title: "Cash Flow Pro", subtitle: "Personal Cash Flow Calculator",
                h_income: "Income", h_expenses: "Expenses",
                btn_add_income: "Add Income Item", btn_add_expense: "Add Expense Item",
                subtotal_income: "Total Income", subtotal_expenses: "Total Expenses",
                res_net_cash_flow: "Net Cash Flow", 
                ratio_usage: "Expense Ratio",
                lbl_quick_add: "Quick Add:",
                
                // New Guide Section
                intro_title: "Personal Cash Flow Calculator",
                intro_text_main: "Sometimes you wonder, where did the money go? To better understand your monthly or annual spending, please enter information for the following categories. It is recommended to have your bank accounts, credit cards, loans, and other statements ready to easily fill in your income and expenses.",
                intro_tips_title: "Financial Tips",
                tip_h_income: "Grow Income",
                tip_p_income: "Focus on career growth, side hustles, or passive income (dividends, rent) to increase total inflow.",
                tip_h_expenses: "Optimize Spending",
                tip_p_expenses: "Distinguish 'needs' vs 'wants'. Review subscriptions and impulse buys regularly to maintain positive cash flow.",

                // Footer
                footer_disclaimer_1: "These results depend on the accuracy and completeness of the information you entered. These results are not a financial plan.",
                footer_disclaimer_2: "The information contained herein is for informational purposes only. The information is derived from sources believed to be reliable. This information does not constitute financial, legal, tax or investment planning or advice. Specific investment, trading or tax strategies should be evaluated based on each investor's objectives and risk tolerance.",
                footer_disclaimer_3: "TD Investment Services Inc., TD Bank and its affiliates and related entities do not assume any liability for the accuracy of the information provided to us by you or any third party, for any consequences arising from your or any third party's use of the information in this document, or for any direct or indirect loss arising from any use of the information in this document by anyone in any manner.",

                // Defaults & Chips
                def_income_total: "Family Net Income",
                def_housing: "Housing", def_living: "Personal & Living", def_transport: "Auto & Transport", def_debt: "Debt Repayment", def_savings: "Savings", def_other: "Other",

                chip_salary: "Salary", chip_bonus: "Bonus", chip_invest_inc: "Investment Income", chip_rent_inc: "Rental Income", chip_side: "Side Hustle",
                chip_rent: "Rent/Mortgage", chip_food: "Groceries/Dining", chip_util: "Utilities", chip_insur: "Insurance", chip_entertain: "Entertainment", chip_med: "Medical", chip_edu: "Education"
            }
        };

        const Calculator = {
            chart: null,
            calculate() {
                const income = this.sumInputs('income');
                const expenses = this.sumInputs('expenses');
                const netCashFlow = income - expenses;

                this.updateText('display-total-income', income);
                this.updateText('display-total-expenses', expenses);
                
                const nwEl = document.getElementById('main-net-cash-flow');
                nwEl.textContent = this.format(netCashFlow);
                
                // Color Logic for Net Cash Flow
                if (netCashFlow > 0) nwEl.className = "text-5xl sm:text-6xl font-mono font-bold tracking-tighter text-emerald-400";
                else if (netCashFlow < 0) nwEl.className = "text-5xl sm:text-6xl font-mono font-bold tracking-tighter text-red-400";
                else nwEl.className = "text-5xl sm:text-6xl font-mono font-bold tracking-tighter text-white";

                const ratio = income > 0 ? (expenses / income) * 100 : (expenses > 0 ? 100 : 0);
                document.getElementById('ratio-display').textContent = ratio.toFixed(1) + '%';
                
                const bar = document.getElementById('ratio-bar');
                bar.style.width = Math.min(ratio, 100) + '%';
                
                // Bar Color Logic
                let barClass = "h-full rounded-full transition-all duration-700 ";
                if(ratio < 50) barClass += "bg-emerald-500";
                else if(ratio < 80) barClass += "bg-amber-400";
                else barClass += "bg-red-500";
                bar.className = barClass;

                let status = "Balanced";
                if(netCashFlow < 0) status = "Deficit (Shortfall)";
                else if(netCashFlow > 0) status = "Surplus (Positive)";
                document.getElementById('cash-flow-status').textContent = status;

                this.updateChart(income, expenses);
            },
            sumInputs(id) {
                let sum = 0;
                document.querySelectorAll(`#${id}-list .input-field`).forEach(el => sum += parseFloat(el.value) || 0);
                return sum;
            },
            format(val) {
                return App.symbol + val.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
            },
            updateText(id, val) {
                document.getElementById(id).textContent = this.format(val);
            },
            updateChart(income, expenses) {
                const ctx = document.getElementById('cashFlowChart').getContext('2d');
                if (this.chart) {
                    this.chart.data.datasets[0].data = [income, expenses];
                    this.chart.update();
                } else {
                    this.chart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Income', 'Expenses'],
                            datasets: [{
                                data: [income, expenses],
                                backgroundColor: ['#34d399', '#fbbf24'], // Emerald-400, Amber-400
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '85%',
                            plugins: { legend: { display: false }, tooltip: { enabled: false } }
                        }
                    });
                }
            }
        };

        const App = {
            lang: 'zh-CN',
            symbol: '¥',
            
            // Chip Definitions
            incomeChips: ['chip_salary', 'chip_bonus', 'chip_invest_inc', 'chip_rent_inc', 'chip_side'],
            expenseChips: ['chip_rent', 'chip_food', 'chip_util', 'chip_insur', 'chip_entertain', 'chip_med', 'chip_edu'],

            init() {
                const params = new URLSearchParams(window.location.search);
                this.lang = params.get('lang') || 'zh-CN';
                document.getElementById('lang-selector').value = this.lang;
                this.updateSymbol();

                // Defaults based on Prompt
                this.renderRow('income', 'def_income_total', 15000);
                
                this.renderRow('expenses', 'def_housing', 4000);
                this.renderRow('expenses', 'def_living', 2500);
                this.renderRow('expenses', 'def_transport', 1000);
                this.renderRow('expenses', 'def_debt', 1500);
                this.renderRow('expenses', 'def_savings', 3000);
                this.renderRow('expenses', 'def_other', 500);
                
                document.getElementById('lang-selector').addEventListener('change', e => {
                    this.lang = e.target.value;
                    this.updateSymbol();
                    this.translate();
                    this.translateRows(); 
                    this.renderChips();
                    this.updateUrl();
                    Calculator.calculate();
                });
                
                document.getElementById('mode-toggle').addEventListener('click', () => {
                    document.documentElement.classList.toggle('dark');
                });

                this.translate();
                this.renderChips();
                Calculator.calculate();
            },
            
            updateSymbol() {
                this.symbol = this.lang === 'zh-CN' ? '¥' : '$';
            },

            updateUrl() {
                try {
                    const newUrl = new URL(window.location);
                    newUrl.searchParams.set('lang', this.lang);
                    window.history.pushState({}, '', newUrl);
                } catch (e) {
                    console.warn('URL update skipped due to environment restrictions.');
                }
            },

            renderRow(type, labelKey, val) {
                const container = document.getElementById(type + '-list');
                const div = document.createElement('div');
                div.className = 'list-row group';
                
                const texts = i18nData[this.lang] || i18nData['en'];
                const label = texts[labelKey] || labelKey || 'Item';
                const wrapClass = type === 'income' ? 'wrapper-income text-income' : 'wrapper-expense text-expense';
                
                // Add key for translation if available
                const isKnownKey = (labelKey.startsWith('def_') || labelKey.startsWith('chip_'));
                const dataKeyAttr = isKnownKey ? `data-key="${labelKey}"` : '';

                div.innerHTML = `
                    <input type="text" class="label-input" value="${label}" placeholder="Item Name" ${dataKeyAttr}>
                    <div class="amount-wrapper ${wrapClass}">
                        <span class="text-xs font-bold opacity-50 font-mono">${this.symbol}</span>
                        <input type="number" class="input-field" value="${val}" oninput="Calculator.calculate()" placeholder="0">
                    </div>
                    <div class="delete-btn" onclick="this.parentElement.remove(); Calculator.calculate();">
                        <i class="fa fa-times text-xs"></i>
                    </div>
                `;
                container.appendChild(div);
                return div;
            },
            
            renderChips() {
                this.renderChipSet('income', this.incomeChips, 'chip-income');
                this.renderChipSet('expenses', this.expenseChips, 'chip-expense');
            },
            
            renderChipSet(type, keys, cssClass) {
                const container = document.getElementById(type + '-chips');
                container.innerHTML = '';
                const texts = i18nData[this.lang] || i18nData['en'];
                
                keys.forEach(key => {
                    const label = texts[key] || key;
                    const span = document.createElement('span');
                    span.className = `chip ${cssClass}`;
                    span.textContent = `+ ${label}`;
                    span.onclick = () => {
                        this.renderRow(type, key, 0); 
                        Calculator.calculate();
                    };
                    container.appendChild(span);
                });
            },

            addRow(type) {
                this.renderRow(type, type === 'income' ? 'New Income' : 'New Expense', 0);
                Calculator.calculate();
            },

            translate() {
                const t = i18nData[this.lang] || i18nData['en'];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(t[key]) el.innerHTML = t[key];
                });
            },

            translateRows() {
                const t = i18nData[this.lang] || i18nData['en'];
                document.querySelectorAll('.label-input[data-key]').forEach(input => {
                    const key = input.getAttribute('data-key');
                    if(t[key]) {
                        input.value = t[key];
                    }
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
     <!--  结尾必须包含的代码 -->
    <div id="related-tools-container"></div>
    <script src="/scripts/related.js"></script>
</body>
</html>